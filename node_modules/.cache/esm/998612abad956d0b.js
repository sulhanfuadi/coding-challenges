/*
 * wallaby-core - v1.0.1523
 * https://wallabyjs.com
 * Copyright (c) 2014-2024 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of wallaby-core and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
!function s(i,n,o){function a(t,e){if(!n[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=n[t]={exports:{}},i[t][0].call(r.exports,function(e){return a(i[t][1][e]||e)},r,r.exports,s,i,n,o)}return n[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)a(o[e]);return a}({1:[function(r,e,t){const s="{".charCodeAt(0),i=" ".charCodeAt(0),n="assert";e.exports=function(e){const{tokTypes:a,TokenType:t}=e.acorn||r("acorn");return class extends e{constructor(...e){super(...e),this.assertToken=new t(n)}_codeAt(e){return this.input.charCodeAt(e)}_eat(e){this.type!==e&&this.unexpected(),this.next()}readToken(e){let t=0;for(;t<n.length;t++)if(this._codeAt(this.pos+t)!==n.charCodeAt(t))return super.readToken(e);for(;this._codeAt(this.pos+t)!==s;t++)if(this._codeAt(this.pos+t)!==i)return super.readToken(e);return"{"===this.type.label?super.readToken(e):(this.pos+=n.length,this.finishToken(this.assertToken))}parseDynamicImport(e){var t;return this.next(),e.source=this.parseMaybeAssign(),this.eat(a.comma)&&(t=this.parseObj(!1),e.arguments=[t]),this._eat(a.parenR),this.finishNode(e,"ImportExpression")}parseExport(e,t){var r,s;if(this.next(),this.eat(a.star))return 11<=this.options.ecmaVersion&&(this.eatContextual("as")?(e.exported=this.parseIdent(!0),this.checkExport(t,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==a.string&&this.unexpected(),e.source=this.parseExprAtom(),this.type===this.assertToken&&(this.next(),r=this.parseImportAssertions())&&(e.assertions=r),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(a._default))return this.checkExport(t,"default",this.lastTokStart),this.type===a._function||(s=this.isAsyncFunction())?(r=this.startNode(),this.next(),s&&this.next(),e.declaration=this.parseFunction(r,5,!1,s)):this.type===a._class?(r=this.startNode(),e.declaration=this.parseClass(r,"nullableID")):(e.declaration=this.parseMaybeAssign(),this.semicolon()),this.finishNode(e,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==a.string&&this.unexpected(),e.source=this.parseExprAtom(),this.type===this.assertToken&&(this.next(),s=this.parseImportAssertions())&&(e.assertions=s);else{for(var i=0,n=e.specifiers;i<n.length;i+=1){var o=n[i];this.checkUnreserved(o.local),this.checkLocalExport(o.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")}parseImport(e){var t;return this.next(),this.type===a.string?(e.specifiers=[],e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===a.string?this.parseExprAtom():this.unexpected()),this.type===this.assertToken&&(this.next(),t=this.parseImportAssertions())&&(e.assertions=t),this.semicolon(),this.finishNode(e,"ImportDeclaration")}parseImportAssertions(){this._eat(a.braceL);var e=this.parseAssertEntries();return this._eat(a.braceR),e}parseAssertEntries(){var t=[],r=new Set;do{if(this.type===a.braceR)break;var s=this.startNode();let e;e=this.type===a.string?this.parseLiteral(this.value):this.parseIdent(!0),this.next(),s.key=e,r.has(s.key.name)&&this.raise(this.pos,"Duplicated key in assertions"),r.add(s.key.name),this.type!==a.string&&this.raise(this.pos,"Only string is supported as an assertion value"),s.value=this.parseLiteral(this.value),t.push(this.finishNode(s,"ImportAttribute"))}while(this.eat(a.comma));return t}}}},{acorn:void 0}],2:[function(e,t,r){"use strict";const n=e("acorn").tokTypes,s=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,o=e=>{s.lastIndex=e.pos;var t=s.exec(e.input),t=e.pos+t[0].length;return"."===e.input.slice(t,t+1)};t.exports=function(e){return class extends e{parseExprAtom(e){if(this.type!==n._import||!o(this))return super.parseExprAtom(e);this.options.allowImportExportEverywhere||this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'");e=this.startNode();return this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),e.meta=this.parseIdent(!0),this.expect(n.dot),e.property=this.parseIdent(!0),"meta"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is import.meta"),this.containsEsc&&this.raiseRecoverable(e.property.start,'"meta" in import.meta must not contain escape sequences'),this.finishNode(e,"MetaProperty")}parseStatement(e,t,r){var s,i;return this.type===n._import&&o(this)?(s=this.startNode(),i=this.parseExpression(),this.parseExpressionStatement(s,i)):super.parseStatement(e,t,r)}}}},{acorn:void 0}],3:[function(t,e,r){e.exports=function(e){const r=(e.acorn||t("acorn")).tokTypes;return class extends e{readToken_pipe_amp(e){let t=this.input.charCodeAt(this.pos+1);return t===e?61===(t=this.input.charCodeAt(this.pos+2))?this.finishOp(r.assign,3):this.finishOp(124===e?r.logicalOR:r.logicalAND,2):61===t?this.finishOp(r.assign,2):this.finishOp(124===e?r.bitwiseOR:r.bitwiseAND,1)}getTokenFromCode(e){return 63==e?this.readToken_question():super.getTokenFromCode(e)}readToken_question(){if(11<=this.options.ecmaVersion){var e=this.input.charCodeAt(this.pos+1);if(63===e&&61===this.input.charCodeAt(this.pos+2))return this.finishOp(r.assign,3)}return super.readToken_question?super.readToken_question():this.finishOp(r.question,1)}}}},{acorn:void 0}],4:[function(e,t,r){"use strict";const n=e("acorn");t.exports=function(e){return class extends e{readInt(r,e){if(null!=e)return super.readInt(r,e);let t=this.pos,s=0,i=!1;for(;;){let e=this.input.charCodeAt(this.pos),t;if(97<=e)t=e-97+10;else{if(95==e){i||this.raise(this.pos,"Invalid numeric separator"),++this.pos,i=!1;continue}t=65<=e?e-65+10:48<=e&&e<=57?e-48:1/0}if(t>=r)break;++this.pos,s=s*r+t,i=!0}return this.pos===t?null:(i||this.raise(this.pos-1,"Invalid numeric separator"),s)}readNumber(e){var t=this.pos;e||null!==this.readInt(10)||this.raise(t,"Invalid number");let r=2<=this.pos-t&&48===this.input.charCodeAt(t),s=!1,i=(r&&this.strict&&this.raise(t,"Invalid number"),this.input.charCodeAt(this.pos));if(!r&&!e&&11<=this.options.ecmaVersion&&110===i)return e=this.getNumberInput(t,this.pos),e="undefined"!=typeof BigInt?BigInt(e):null,++this.pos,n.isIdentifierStart(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(n.tokTypes.num,e);r&&/[89]/.test(this.input.slice(t,this.pos))&&(r=!1,s=!0),46!==i||r||(++this.pos,this.readInt(10),i=this.input.charCodeAt(this.pos)),69!==i&&101!==i||r||(43!==(i=this.input.charCodeAt(++this.pos))&&45!==i||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),n.isIdentifierStart(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");e=this.getNumberInput(t,this.pos),(r||s)&&e.length<this.pos-t&&this.raise(t,"Invalid number"),t=r?parseInt(e,8):parseFloat(e);return this.finishToken(n.tokTypes.num,t)}parseLiteral(e){e=super.parseLiteral(e);return e.bigint&&(e.bigint=e.bigint.replace(/_/g,"")),e}readRadixNumber(e){var t=this.pos;this.pos+=2;let r=this.readInt(e);return null==r&&this.raise(this.start+2,"Expected number in radix "+e),11<=this.options.ecmaVersion&&110===this.input.charCodeAt(this.pos)?(e=this.getNumberInput(t,this.pos),r="undefined"!=typeof BigInt?BigInt(e):null,++this.pos):n.isIdentifierStart(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(n.tokTypes.num,r)}getNumberInput(e,t){return this.input.slice(e,t).replace(/_/g,"")}}}},{acorn:void 0}],5:[function(e,t,r){"use strict";t.exports=function(e){return class extends e{isDirectiveCandidate(){return!1}strictDirective(){return!1}canDeclareLexicalName(){return!0}canDeclareVarName(){return!0}isSimpleParamList(){return!0}adaptDirectivePrologue(){}checkParams(){}checkPatternErrors(){}checkPatternExport(){}checkPropClash(){}checkVariableExport(){}checkYieldAwaitInDefaultParams(){}declareLexicalName(){}declareVarName(){}enterFunctionScope(){}enterLexicalScope(){}exitFunctionScope(){}exitLexicalScope(){}invalidStringToken(){}}}},{}],6:[function(e,t,r){"use strict";t.exports=function(e){return class extends e{parseMaybeUnary(){return this.isContextual("await")?this.parseAwait():super.parseMaybeUnary.apply(this,arguments)}}}},{}],7:[function(e,t,r){t.exports=function(e){return e.JSXExpressionContainer=e.ExpressionStatement,e.JSXSpreadChild=e.ExpressionStatement,e.JSXClosingFragment=e.Identifier,e.JSXEmptyExpression=e.Identifier,e.JSXIdentifier=e.Identifier,e.JSXOpeningFragment=e.Identifier,e.JSXText=e.Identifier,e.JSXSpreadAttribute=e.SpreadElement,e.JSXAttribute=(e,t,r)=>{r(e.name,t),e.value&&r(e.value,t)},e.JSXMemberExpression=(e,t,r)=>{r(e.object,t),r(e.property,t)},e.JSXNamespacedName=(e,t,r)=>{r(e.namespace,t),r(e.name,t)},e.JSXOpeningElement=(t,r,s)=>{s(t.name,r);for(let e=0;e<t.attributes.length;++e)s(t.attributes[e],r)},e.JSXClosingElement=(e,t,r)=>{r(e.name,t)},e.JSXElement=(t,r,s)=>{s(t.openingElement,r);for(let e=0;e<t.children.length;++e)s(t.children[e],r);t.closingElement&&s(t.closingElement,r)},e.JSXFragment=(t,r,s)=>{s(t.openingFragment,r);for(let e=0;e<t.children.length;++e)s(t.children[e],r);s(t.closingFragment,r)},e}},{}],8:[function(u,e,t){u("./global");const p=u("path"),d=u("fs");process.on("uncaughtException",function(e){if(!(e&&"spawn"===e.syscall&&"OK"===e.code||(e&&e.message&&_.isString(e.message)&&0===e.message.indexOf("payload cannot exceed")&&(e.stack="One of the files specified in your `files`/`tests` list is too large, "+e.stack),e&&e.message&&_.isString(e.message)&&~e.message.indexOf("EADDRINUSE")&&~e.message.indexOf("51245")))){try{var r;e instanceof Error&&(r=u("path").dirname(process.mainModule.filename),e.stack=_.filter(e.stack.split("\n"),(e,t)=>!t||!_.contains(e,r)).join("\n"))}catch(e){}console.error(e instanceof Error?e.stack:u("util").inspect(e))}});let h=!1;e.exports={start:function(t){t.onConnected=function(r){t.Project=u("./project").Project,t.diffMatchPatch=new(u("./diffMatchPatch"));function s(){if(a(!0),!h){h=!0,i.stop(i._emergencyExit);var e=i.shutdown();const t=arguments,r=()=>{process.env.quokka||d.unlinkSync(p.join(i.projectCachePath,"running")),console.log("wallaby.js stopped"),n.apply(process,t)};!e||i._emergencyExit?r():Promise.race([e.finally(()=>r()),new Promise(e=>{setTimeout(()=>{r(),e()},1e4)})])}}var i=new t.Receiver(t),n=process.exit,e=process.exit=function(){s.apply(null,arguments)};process.on("SIGINT",function(){e.apply(null,[0])});let o;var a=e=>{clearTimeout(o),e&&(l=()=>{})},l=t=>{o=setTimeout(()=>{try{r.send({type:"ping"}),c()}catch(e){t?(i._emergencyExit=!0,s()):l(!0)}},t?1e3:1e4)},c=()=>{a(),l()};return i.on("message",function(e){if(!e._internal)try{r.send(e)}finally{c()}}),r.receive=function(e){c();var t="unknown";try{if(!("string"==typeof(t=e.type)&&0<t.length&&"_"!==t[0]))throw new Error("Incorrect incoming message format");var r=i[t](e);r&&r.catch&&r.catch(function(e){e.noDetails?console.error(e.message):console.error("Failed to execute "+t+" operation, "+e.stack)})}catch(e){console.error("Failed to start "+t+" operation, "+e.stack)}},i.configure(),i}}}},{"./diffMatchPatch":42,"./global":46,"./project":65,fs:void 0,path:void 0,util:void 0}],9:[function(n,e,t){"use strict";var o,a,l=n("path"),c=n("semver"),u=n("./utils").default,s=n("./babelVisitor");let p=!0;const d="babel-core",h="@babel/core";class g{constructor(e,t,r){_.isEmpty(e)||e.babelrc||(e.babelrc=!1),this._opts=_.extend({filename:t},e||{}),!this._opts.filename&&t&&(this._opts.filename=t),this._opts.filenameRelative||delete this._opts.filenameRelative,this._opts.sourceMaps=this._opts.sourceMap=!0,c.valid(o.version)&&c.gte(o.version,"7.0.0-beta.0")&&delete this._opts.sourceMap,this._opts.retainLines=this._opts.retainLines||!1,this._opts.compact=this._opts.compact||!1,this._opts.comments=!1!==this._opts.comments,_.isString(this._opts.plugins)&&(this._opts.plugins=[this._opts.plugins]),this._opts.plugins=(this._opts.plugins||[]).slice(),this._opts.plugins.unshift(new a("wallaby.js",s(_.bind(this._pushRange,this)))),r&&(this._opts.presets=(this._opts.presets||[]).slice(),this._opts.presets.push(r))}_pushRange(e){e&&this._ranges.push([e.start.line,e.start.column,e.end.line,e.end.column])}run(e){this._ranges=[];var t=(o.transformSync||o.transform)(e.content,this._opts);return"ts"!==e.type&&"tsx"!==e.type||!p||e.changeExt("js"),{map:t.map,code:t.code,ranges:this._ranges}}runAsync(r,s){this._ranges=[],o.transform(r.content,this._opts,(e,t)=>{e?s(e):("ts"!==r.type&&"tsx"!==r.type||!p||r.changeExt("js"),s({map:t.map,code:t.code,ranges:this._ranges}))})}}e.exports=r=>s=>{if(s=s||{},process.env.BABEL_ENV&&"undefined"!==process.env.BABEL_ENV||(process.env.BABEL_ENV="test"),u.patchModule("test-exclude",()=>()=>({shouldInstrument:_.noop})),s.babel)o=s.babel;else{try{const t=n(l.join(r,"package.json"));var e=_.find([h,d,"babel-cli","babel"],e=>t.devDependencies[e]||t.dependencies[e]);"babel-cli"===e?o=u.requireModuleFrom(l.join(r,"node_modules/babel-cli"),d):e&&(o=u.requireModuleFrom(r,e))}catch(e){}if(!o)try{o=u.requireModuleFrom(r,h)}catch(e){try{o=u.requireModuleFrom(r,d)}catch(e){try{o=u.requireModuleFrom(r,"babel")}catch(e){throw new Error("babel, babel-core or @babel/core must be installed locally or babel instance must be passed in opts.babel, for example `wallaby.compilers.babel({ babel: require('@babel/core') })`")}}}}if(!c.valid(o.version)||!c.lt(o.version,"5.0.9")){const i=s.asyncTransform;return a=o.Transformer||function(e,r){return _.each(r,(t,e)=>{r[e]=e=>t(e.node)}),{visitor:{Program(e){e.traverse(r)}}}},p=!1!==s.renameTypeScriptFiles,delete s.babel,delete s.asyncTransform,delete s.renameTypeScriptFiles,(e,t)=>{var r=e.additionalPreset;if(delete e.additionalPreset,i)new g(s,e.path,r).runAsync(e,t);else try{t(new g(s,e.path,r).run(e))}catch(e){t(e)}}}console.error("Babel version for compiler must be >= 5.0.9")}},{"./babelVisitor":10,"./utils":75,path:void 0,semver:void 0}],10:[function(e,t,r){t.exports=(t,e)=>{var r={Statement(e){switch(e.type){case"DoWhileStatement":case"WhileStatement":case"IfStatement":case"ForStatement":e.test&&t(e.test.loc);break;case"ForOfStatement":case"ForInStatement":e.right&&t(e.right.loc);break;case"SwitchStatement":t(e.discriminant.loc);break;case"BreakStatement":case"ContinueStatement":case"ThrowStatement":case"VariableDeclaration":case"ExpressionStatement":case"ReturnStatement":t(e.loc)}},ArrowFunctionExpression(e){e.body&&"BlockStatement"!==e.body.type&&t(e.body.loc)},LogicalExpression(e){t(e.left.loc),t(e.right.loc)},ConditionalExpression(e){t(e.consequent.loc),t(e.alternate.loc)}};return e&&e.visitImports&&(r.ImportDeclaration=function(e){t(e.loc)}),r}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BrowserEnvironment=void 0;const s=e("path"),i=e("compression"),n=e("express"),o=e("./fileCacheMiddleware");var a=e("graceful-fs");const l=e("./utils"),d=a.readFileSync(s.join(__dirname,"runners","browser","sandbox.html")).toString(),h="__wallaby__",g=logger.create("browserRunner")["debug"];r.BrowserEnvironment=class{constructor(e,t){var r=this;this._project=e,this._workerPool=t,this._baseDir=r._project._instrumentedRoot+s.sep,this._initializer=e.settings().bootstrap,this._reportUnhandledPromises=!!e.settings().reportUnhandledPromises,this._throwOnBeforeunload=!!e.settings().throwOnBeforeUnload,this._maxLogEntrySize=e.settings().maxLogEntrySize,this._maxTraceSteps=e.settings().maxTraceSteps,this._resolveGetters=e.settings().resolveGetters,this._logLimits=e.settings().logLimits,this._sandboxHtml={},this._report404AsError=e.settings().env.report404AsError,this._lruCache=r._project._lruCache,this._wallabyFileIdPrefix=r._workerPool.wallabyFileIdPrefix(),this._app=n(),this._app.use(i({filter:e=>!!~e.url.indexOf("____wallaby-bundle")})),this._app.use("/wallaby_sandbox:id.html",(e,t)=>{t.send(r._sandboxHtml[e.params.id])}),e.settings().testFramework.path&&this._app.use("/"+h+"/"+e.settings().testFramework.version+"/framework.js",o.fileCacheMiddleware.create({main:{root:s.join(e._localRoot,e.settings().testFramework.path)}})),this._app.use("/"+h+"/tracer.js",o.fileCacheMiddleware.create({main:{root:s.join(__dirname,"tracer.js")}})),this._app.use("/"+h,o.fileCacheMiddleware.create({main:{root:s.join(__dirname,"runners","browser")}})),e.settings().middleware(r._app,n),this._project.isNativeBundler()?this._app.use(o.fileCacheMiddleware.create({main:{root:r._baseDir,cache:r._lruCache},alt:{root:r._project._localProjectDir,read:(e,t)=>{e=l.default.normalizePath(s.relative(r._project._localProjectDir,e));r._project.idByPath(e)?r._project.getLatestOriginalFileContentByPathAsync(e).then(e=>t(null,e)).catch(e=>t(e)):t(new Error(`File '${e}' is not registered.`))}}},r._report404AsError)):this._app.use(o.fileCacheMiddleware.create({main:{root:r._baseDir,cache:r._lruCache}},r._report404AsError))}async prepareSandbox(t,e,r,s){var i=this,n=(t.allFilesHash=_.reduce(t.allFiles.concat(t.allTestFiles),(e,t)=>(e[t.normalizedRelativePath]={ts:t.ts,id:t.tmp&&t.originalId?t.originalId:t.id},e),{}),t.allFiles.concat(t.allTestFiles)),o=t.filesToLoad.concat(t.testFilesToLoad),a=_.reduce(t.testFilesToLoad,function(e,t){return e[t.id]=t,e},{}),l=(g("Total files to load in sandbox: "+o.length),i._workerPool.receiverPort());const c=i._project.settings();var u=s||"127.0.0.1";i._anyIncludedEsm=!1;const p=i._project.isNativeBundler();i._sandboxHtml[r]=d.replace("<inject/>",()=>_.reduce(n,function(e,t){return e+(_.isNumber(t.id)?"file = window.$_$coverage["+t.id+"]=[]; for(i=0, len="+t.rangesLength+"; i < len; i++) file[i] = {};":"")},"<script>(function() {window.$_$receiverPort = "+l+";window.$_$receiverHost = '"+u+"';window.$_$session=\""+e+'";window.$_$baseDir='+JSON.stringify(p?i._project._localProjectDir:i._baseDir)+";window.$_$initialSpecId="+1e5*(r+1)+";window.$_$reportUnhanledPromises="+i._reportUnhandledPromises+";window.$_$throwOnBeforeunload="+i._throwOnBeforeunload+";window.$_$maxLogEntrySize="+i._maxLogEntrySize+";window.$_$maxTraceSteps="+i._maxTraceSteps+";"+(i._resolveGetters?"window.$_$resolveGetters=true;":"")+"window.$_$logLimits="+JSON.stringify(i._logLimits)+";window.$_$traceContext="+JSON.stringify(i._workerPool.traceContext())+";window.$_$coverage=[]; var file, i, len;")+(t.profileRun?"window.$_$profileRun=true;":"")+"window.$_$slow="+c.slowTestThreshold+";window.$_$expressionsToEvaluate="+JSON.stringify(t.expressionsToEvaluate)+";window.$_$files="+JSON.stringify(t.allFilesHash)+";window.$_$tests="+(t.tests?JSON.stringify(t.tests):"null")+";window.$_$testFiles="+JSON.stringify(_.chain(t.allTestFiles).filter(e=>!e.shadowed).map(e=>({path:p?e.normalizedRelativePath:e.relativePath,loaded:e.include&&!!a[e.id],id:(t.allFilesHash[e.normalizedRelativePath]||{}).id})).value())+';})();<\/script><script src="'+h+'/tracer.js"><\/script><script src="'+h+"/"+t.framework.version+'/framework.js"><\/script><script src="'+h+"/"+t.framework.configurator+'/configurator.js"><\/script><script src="'+h+"/"+t.framework.reporter+'/reporter.js"><\/script>'+_.reduce(o,function(e,t){i._anyIncludedEsm=i._anyIncludedEsm||t.esm;var r=t.tmp,s=t.ts+(r?t.originalId?i._wallabyFileIdPrefix+t.originalId:"":i._wallabyFileIdPrefix+t.id);switch(t.type){case"js":case"mjs":case"jsx":case"es6":case"es7":return e+"<script "+(t.esm?'type="module"':"")+' src="'+t.normalizedRelativePath+"?"+s+'"><\/script>';case"html":case"htm":return e+'<link href="'+t.normalizedRelativePath+"?"+t.ts+'" rel="import">';case"css":return e+'<link rel="stylesheet" type="text/css" href="'+t.normalizedRelativePath+"?"+s+'"></link>';default:return e}},"")+(i._initializer&&n.length?"<script>$_$tracer.setInitializeResult(("+i._initializer+")(window.wallaby));<\/script>":"")+"<script "+(i._anyIncludedEsm?'type="module"':"")+' src="'+h+"/"+t.framework.starter+'/starter.js"><\/script>');s=i.sandboxRootUrl()+"wallaby_sandbox"+r+".html";return g("Sandbox is generated [%s]: %s",i.sandboxName(r,e),s),s}doesSandboxContainESModules(){return this._anyIncludedEsm}sandboxRootUrl(){return this._sandboxRootUrl||(this._sandboxRootUrl="http://localhost:"+this._workerPool.receiverPort()+"/"),this._sandboxRootUrl}webApp(){return this._app}sandboxName(e,t){return"worker #"+e+", session #"+t}}},{"./fileCacheMiddleware":45,"./utils":75,compression:void 0,express:void 0,"graceful-fs":void 0,path:void 0}],12:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ProfileViewer=void 0;let a,l;r.ProfileViewer=class{constructor(e){a=t("chrome-launcher"),l=t("chrome-remote-interface"),this._project=e}async show(e,t,r){this.stop(),this._chrome||(this._chrome=await a.launch({chromeFlags:["--disable-background-networking","--enable-features=NetworkService,NetworkServiceInProcess","--disable-background-timer-throttling","--disable-backgrounding-occluded-windows","--disable-breakpad","--disable-devTools-side-phishing-detection","--disable-component-extensions-with-background-pages","--disable-default-apps","--disable-dev-shm-usage","--disable-extensions","--disable-features=TranslateUI","--disable-hang-monitor","--disable-ipc-flooding-protection","--disable-popup-blocking","--disable-prompt-on-repost","--disable-renderer-backgrounding","--disable-sync","--force-color-profile=srgb","--metrics-recording-only","--no-first-run","--password-store=basic","--use-mock-keychain","--auto-open-devtools-for-tabs"],logLevel:"silent"}));var s={port:this._chrome.port,host:"127.0.0.1"},i=(this._startChecking(s),await l.List(s)),n=i.find(e=>e.url.startsWith("devtools:")),i=i.find(e=>e.url.startsWith("about:")),[i,n]=await Promise.all([l(Object.assign({target:i},s)),l(Object.assign({target:n},s))]);await i.Page.navigate({url:"devtools://devtools/bundled/devtools_app.html"}),await n.Runtime.evaluate({expression:`
        const checker = setInterval(() => {
          if (window.UI && (window.UI.viewManager || window.DevToolsAPI)
            && document.querySelector('.main-tabbed-pane').shadowRoot
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar')
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot.querySelector('.largeicon-delete')
          ) {
              clearInterval(checker);
              document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot.querySelector('.largeicon-delete').click();
          }

          if (window.UI && (window.UI.viewManager || window.DevToolsAPI)
            && document.querySelector('.main-tabbed-pane').shadowRoot
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar')
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot.querySelector('.close-devtools')
          ) {
              clearInterval(checker);
              document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot.querySelector('.close-devtools').click();
          }
        }, 5);
    `});const o="pageDataEvent";await i.send("Runtime.addBinding",{name:o}),i.Runtime.bindingCalled(({name:e,payload:t})=>{e===o&&(e=JSON.parse(t))&&"link"===e.type&&this._project.navigationRequested(e.href)}),await i.Runtime.evaluate({expression:`
        const checker = setInterval(async () => {
            if (window.UI && (window.UI.viewManager || window.DevToolsAPI) && document.querySelector('.main-tabbed-pane')
            && document.querySelector('.main-tabbed-pane').shadowRoot
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-header')
            ) {
                clearInterval(checker);
                
                document.title = '${process.env.quokka?"Quokka Profile":r}';
                var link = document.querySelector("link[rel~='icon']");
                if (!link) {
                    link = document.createElement('link');
                    link.rel = 'icon';
                    document.getElementsByTagName('head')[0].appendChild(link);
                }
                link.href = '${process.env.quokka?"https://quokkajs.com/assets/img/favicon.ico":"https://wallabyjs.com/assets/img/favicon.ico"}';
                
                document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-header').style.display = 'none';
                var viewManagerInstance = UI.ViewManager && UI.ViewManager.instance() || window.UI.viewManager;
                var viewName = window.UI.viewManager && window.UI.viewManager.views.has('js_profiler') ? 'js_profiler' : 'timeline';
                if (viewName === 'timeline') {
                  const consoleCloser = setInterval(() => {
                    if (document.querySelector('.drawer-tabbed-pane') ) {
                      clearInterval(consoleCloser);
                      document.querySelector('.drawer-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-header .tabbed-pane-right-toolbar').shadowRoot.querySelector('.toolbar-button').click();
                    }
                  }, 5);
                }
                if (window.UI.viewManager) {
                  await window.UI.viewManager.showView(viewName, true);
                } else {
                  window.DevToolsAPI.showPanel(viewName);
                  await new Promise(resolve => {
                    const checker = setInterval(() => {
                      if (window.UI.panels.timeline) {
                        clearInterval(checker);
                        resolve();
                      }
                    }, 5);
                  });
                }
                var profilerWidget = viewManagerInstance ? viewManagerInstance.materializedWidget(viewName) : window.UI.panels.timeline;
                var cpuProfileType = profilerWidget._findProfileTypeByExtension && profilerWidget._findProfileTypeByExtension('.cpuprofile') || profilerWidget;
                
                await cpuProfileType.loadFromFile(new File([decodeURIComponent('${encodeURIComponent(JSON.stringify(e))}')], '${t}.cpuprofile'));
                
                if (profilerWidget.showProfile) {
                  var profileToLoad = cpuProfileType._profiles && cpuProfileType._profiles[0] || cpuProfileType.selectedProfileType && cpuProfileType.selectedProfileType.profiles[0];

                  await profilerWidget.showProfile(profileToLoad);
                
                  var profileView = viewManagerInstance.materializedWidget(viewName).visibleView;

                  const selectFlameChart = () => {
                    if (!profileView.viewSelectComboBox) return setTimeout(() => selectFlameChart(), 10);
                    profileView.viewSelectComboBox.select(profileView.viewSelectComboBox.options()[0]);
                    profileView._changeView && profileView._changeView() || profileView.changeView();
                    profileView.viewSelectComboBox.selectElement().addEventListener('change', () => {
                      setTimeout(() => {
                        var allLinks = document.querySelectorAll('.profile-node-file.devtools-link');
                        for (var i = 0; i < allLinks.length; i++) {
                          let link = allLinks[i];
                          if (link.fixed) continue;
                          let newLink = link.cloneNode(true);
                          newLink.href = link.href + ':' + link.innerText.split(':').pop();
                          newLink.fixed = true;
                          link.parentNode.replaceChild(newLink, link);
                        }
                      }, 100);
                    });
                  };
                  
                  selectFlameChart();
                }
                
                window.history.replaceState({}, null, '/${process.env.quokka?"quokka":"wallaby"}');
                
                document.addEventListener('click', e => {
                  if (e && e.srcElement && e.srcElement.href) {
                    window.${o}(JSON.stringify({ type: 'link', href: e.srcElement.href }));
                  } else if (e && e.path && e.path[1]) {
                    var parent = e.path[1];
                    var hover = parent.querySelector('.flame-chart-entry-info table');
                    if (hover && hover.rows) {
                      window.${o}(JSON.stringify({ type: 'link', href: 'file://' + hover.rows[3].cells[1].innerHTML }));
                    }
                  }                  
                });
            }
        }, 5);
      `})}_startChecking(e){clearTimeout(this._checker),this._checker=setTimeout(async()=>{try{if(!(await l.List(e)).length)throw new Error("Profile closed");this._startChecking(e)}catch(e){this.stop()}},300)}stop(){if(clearTimeout(this._checker),this._chrome){try{process.kill(this._chrome.pid)}catch(e){}delete this._chrome}}}},{"chrome-launcher":void 0,"chrome-remote-interface":void 0}],13:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Runner=void 0;const s=a("child_process"),d=a("chrome-remote-interface"),r=a("./runWorkerPool"),n=a("./browserEnvironment"),o=a("net"),l=a("./utils"),h=logger.create("chromeRunner")["debug"];t.Runner=class{constructor(e){this._screenShotReady=Promise.resolve(),this._profilerStopped=Promise.resolve({});var t=(this._project=e).settings().env;this._useWsl=l.default.isWsl()&&!t.runner,this._useWsl||l.default.patchModulesCode([{files:["chrome-launcher/dist/utils.js"],replacements:[{from:'const isWsl = require("is-wsl");',to:"const isWsl = false;",optional:!1}]}]),this._Launcher=a("chrome-launcher").Launcher;const i=this;this._Launcher.prototype.isDebuggerReady=function(){return new Promise((e,t)=>{const r=i._useWsl?l.default.wslHostIpAddress():"127.0.0.1",s=o.createConnection({port:this.port,host:r,timeout:5e3});s.once("error",e=>{h(`Connection to Chrome Debugger Protocol on ${r}:${this.port} failed: `+e),this.cleanup(s),t(e)}),s.once("timeout",()=>{h(`Connection to Chrome Debugger Protocol on ${r}:${this.port} timed out`),this.cleanup(s);var e=`Chrome instance is not availble on ${r}:`+this.port+(i._useWsl?". Please verify that your network settings allow your WSL instance to connect to your Windows operating system. For more information please refer to https://wallabyjs.com/docs/intro/get-started-vscode.html#wsl-2":"");t({message:e})}),s.once("connect",()=>{h(`Connection to Chrome Debugger Protocol on ${r}:${this.port} succeeded`),this.cleanup(s),e(void 0)})})},this._path=t.runner,t.params&&t.params.runner&&(this._flags=t.params.runner.split(" ")),t.keepTabsOpened&&(this._keepTabsOpened=t.keepTabsOpened),this._chromePromise=this._launchChromeInstance(),this._workerPool=new r.WorkerPool(this._project,{create:_.bind(this._create,this),recycle:_.bind(this._recycle,this),healthy:()=>!0,prepare:_.bind(this._prepareTab,this)}),this._browserEnvironment=new n.BrowserEnvironment(e,this._workerPool)}run(e){return this._workerPool.run(e)}cancel(e){return this._workerPool.cancel(e)}async start(){var e=await this._workerPool.start(this._browserEnvironment.webApp());return this._workerPool.setFileRoot(this._browserEnvironment.sandboxRootUrl()),e}stop(){if(this._workerPool.stop(),this._chrome)try{process.kill(this._chrome.pid)}catch(e){}}mapStack(e,t){return this._workerPool._mapStackEntries(e,t)}async _create(e,t){await this._chromePromise,t({workerId:e})}_recycle(e){h("Closing tab as a result of recycle call"),this._closeTab(e)}async _prepareTab(s,e){const i=this;var t=_.randomId(),r=this._browserEnvironment.sandboxName(e,t);h("Starting sandbox [%s]",r);const n=await this._workerPool.getWorker(e);if(n instanceof Error||n.runCancelled)return Promise.reject(n);this._checkCancelled(),h("Preparing sandbox [%s]",r);const o=await this._browserEnvironment.prepareSandbox(s,t,e,this._useWsl?"localhost":void 0);return this._checkCancelled(),h("Prepared sandbox [%s]",r),{name:r,sessionId:t,workerId:e,instance:{resume(){i._evaluateOnTab(n.client,function(){$_$tracer.resume()})},ping(e){i._evaluateOnTab(n.client,function(){},e)},close(e){if(s.profileRun){const t={client:n&&n.client};n&&(h("Deleting worker client for profile run"),delete n.client),i._profilerStopped.then(function(e){i._workerPool["worker:profile"](e&&e.profile||{}),h("Closing tab for profile run"),i._closeTab(t)})}else if(s.screen){const r={client:n&&n.client};n&&(h("Deleting worker client for screen run"),delete n.client),i._screenShotReady.then(function(){h("Closing tab for screen run"),i._closeTab(r)})}else h("Closing tab as requested"),i._closeTab(n);e(!0)},closing(){try{s.profileRun?i._profilerStopped=n.client.Profiler.stop():s.screen&&(i._screenShotReady=n.client.Page.captureScreenshot().then(function(e){e=Buffer.from(e.data,"base64");a("fs").writeFileSync(s.screen,e,"base64")}))}catch(e){i._screenShotReady=Promise.resolve(),i._profilerStopped=Promise.resolve({})}},start(t){n.profileRun=s.profileRun,i._openTab(n,o,e=>{t(e.status)?i._evaluateOnTab(n.client,`function() {
              function startTracer() {
                var counter = 0;
                var interval = 10; //ms
                var timeout = 2000; //ms
                var maxIterations = timeout / interval;
                if (window.$_$tracer) {
                  counter++;
                  $_$tracer.start();
                } else {
                  // 2 seconds
                  if (counter > maxIterations) {
                    throw new Error('Cannot cannot start tracer in sandbox.');
                  }
                  setTimeout(startTracer, 10);
                }
              }
              startTracer();
            }`):h("Failed to open chrome tab: "+e.status)})}}}}_checkCancelled(){if(this._workerPool.cancelled())throw{runCancelled:!0}}_connectionOptions(e={}){var t=this._useWsl?l.default.wslHostIpAddress():"127.0.0.1";return _.extend({port:this._chrome.port,host:t},e)}async _evaluateOnTab(e,t,r=_.noop){var s,i="Failed to evaluate code on Chrome Tab:";try{e.Runtime&&((s=(await e.Runtime.evaluate({expression:`(${t.toString()})()`})).exceptionDetails)?(this._handleHostError({message:s.exception&&s.exception.description}),h(i+" "+JSON.stringify(s))):r())}catch(e){h(i+" "+e.message)}}async _openTab(t,e,r=_.noop){try{if(!this._chrome)throw new Error("Chrome is not running");var s=this._connectionOptions({url:e}),i=await d.New(s),n=(t.client={target:{id:i.id}},this._checkCancelled(),await d({host:s.host,port:s.port,tab:i,target:i.id}));if(t.client=n,t.client.target={id:i.id},!t.client.Runtime)throw h(`Failed to create Chrome Tab (url: ${e}, host: ${s.host}, port: ${s.port}, wsl: ${this._useWsl})`),await this._closeTab(t),new Error("Failed to create Chrome Tab");this._checkCancelled();const{Page:c,Network:u,Profiler:p}=n;try{var o=!!this._browserEnvironment.doesSandboxContainESModules(),a=t.profileRun,l=[c.enable()];if(o&&l.push(u.enable()),a&&l.push(p.enable()),await Promise.all(l),this._checkCancelled(),o){u.requestIntercepted(({interceptionId:e,request:t})=>u.continueInterceptedRequest({interceptionId:e,url:this._updateTrackedFileUrlIfRequired(t.url)}).catch(e=>{}));try{await n.send("Network.setRequestInterception",{patterns:[{urlPattern:"*"}]})}catch(e){try{await u.setRequestInterceptionEnabled({enabled:!0})}catch(e){console.warn("Unable to configure network request interception in Chrome")}}this._checkCancelled()}await c.navigate({url:e}),this._checkCancelled(),await c.loadEventFired(),this._checkCancelled(),a&&(await p.start(),this._checkCancelled()),r({status:"success"})}catch(e){h("Closing tab because failed to open it"),this._closeTab(t),r({status:"failed: "+(e.message||"unknown")})}}catch(e){r({status:"failed: "+(e.message||"unknown")})}}async _closeTab(e){if(h("Closing Chrome Tab"),delete this._screenShotReady,delete this._profilerStopped,e&&e.client){var t=e.client;delete e.client;try{this._keepTabsOpened||await d.Close(this._connectionOptions({id:t.target.id}))}catch(e){h("Failed to close Chrome Tab: "+e.message)}try{t.close()}catch(e){h("Failed to close Chrome Tab client: "+e.message)}}}async _launchChromeInstance(){try{var e=["--headless","--disable-gpu","--deterministic-fetch"],t=("Linux"!==a("os").type()||this._useWsl||(e.push("--no-sandbox"),e.push("--disable-setuid-sandbox")),this._flags||e),r=(this._useWsl&&t.push("--remote-debugging-address="+l.default.wslHostIpAddress()),h(`launch new instance (path: ${this._path||"<default>"}, flags: ${t.join(" ")})`),new this._Launcher({chromeFlags:t,chromePath:this._path,logLevel:"true"===process.env.WALLABY_DEBUG_ENABLED?"error":"silent",maxConnectionRetries:20},{spawn:(e,t,r)=>(r.detached=!1,s.spawn)(e,t,r)}));await r.launch(),this._chrome={pid:r.pid,port:r.port,process:r.chrome}}catch(e){this._handleHostError(e)}}_updateTrackedFileUrlIfRequired(e){if(!e||~e.indexOf("wallabyFileId")||~e.indexOf("__wallaby__"))return e;let t=e;var r,s;return(t=t.replace(this._browserEnvironment.sandboxRootUrl(),""))!==e&&(r=t.lastIndexOf("?"),s=(t=0<=r?t.substring(0,r):t)&&this._project.getFileMetadataByPath(t))?e+(~r?"&":"?")+s.changeTs+"&wallabyFileId="+s.id:e}_handleHostError(e){this._project._cleanStack(e=e||{});var t="Chrome runner error: "+(e.message||"unknown"),e=e.stack||t;console.error(e),this._project._emitTestRunError(t)}}},{"./browserEnvironment":11,"./runWorkerPool":66,"./utils":75,child_process:void 0,"chrome-launcher":void 0,"chrome-remote-interface":void 0,fs:void 0,net:void 0,os:void 0}],14:[function(r,e,t){"use strict";var s,i,n,o=r("path"),a={},l={};class c{constructor(e){var t=this;this._opts=_.extend({},e||{}),this._noRename=this._opts.noFileRename,delete this._opts.noFileRename,this._nodeVisitor("Block",function(e){_.each(e.expressions,function(e){e.expression?t._pushRange(e.expression):t._pushRange(e)})}),this._nodeVisitor("Op",function(e){"&&"!==e.operator&&"||"!==e.operator&&"?"!==e.operator||(t._pushRange(e.first),t._pushRange(e.second))})}_nodeVisitor(e,t){var r;l[e]=t,a[e]||(r=s[e].prototype.compileNode,s[e].prototype.compileNode=function(){return l[e](this),r.apply(this,arguments)},a[e]=!0)}_pushRange(e){var t;e&&((t=e.locationData)?this._ranges.push([t.first_line+1,t.first_column,t.last_line+1,t.last_column+1]):e.args&&e.args.length&&this._pushRange(e.args[0]))}run(e){this._ranges=[];var t=i.compile(e.content,_.extend({},this._opts,{filename:e.path,sourceMap:!0,literate:n.isLiterate(e.path)}));return this._noRename||e.changeExt("js"),{map:t.v3SourceMap,code:t.js,ranges:this._ranges}}}const u=(e,t)=>{try{s=r(o.join(e,t)),i=r(e)}catch(e){return!1}return!0};e.exports=r=>t=>{var e=Error.prepareStackTrace;return u(o.join(r,"node_modules","coffeescript"),"lib/coffee-script/nodes")||u(o.join(r,"node_modules","coffee-script"),"lib/coffee-script/nodes")||u(o.join(r,"node_modules","coffeescript"),"lib/coffeescript/nodes")||u("coffee-script","lib/coffee-script/nodes"),Error.prepareStackTrace=e,n=i.helpers,e=>new c(t).run(e)}},{path:void 0}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const path=require("path"),os=require("os"),fs=require("fs"),semver=require("semver"),url=require("url"),micromatch_1=require("micromatch"),utils_1=require("./utils"),{debug}=logger.create("config"),supportedTestFrameworks={node:{"mocha@2.1.0":{},"jest@0.4.3":{},"jest@24.8.0":{},"jasmine@2.3.4":{},"ava@1.0.0":{jsPreprocessor:e=>e.replace(/import test from ["|']ava["|']/,'var test = require("ava")')},"tape@4.2.2":{jsPreprocessor:e=>e.replace(/import test from ["|']tape["|']/,'var test = require("tape")')},"vitest@0.14.0":{}},browser:{"jasmine@1.3.1":{},"jasmine@2.1.3":{},"jasmine@2.2.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.3.4":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.4.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.5.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.5.2":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.6.3":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.8.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.2.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.4.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.5.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.6.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@4.6.0":{configurator:"jasmine@4.6.0",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@5.1.1":{configurator:"jasmine@4.6.0",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.10.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"mocha@2.0.1":{},"mocha@2.2.4":{configurator:"mocha@2.0.1",reporter:"mocha@2.0.1",starter:"mocha@2.0.1"},"mocha@3.2.0":{configurator:"mocha@2.0.1",reporter:"mocha@2.0.1",starter:"mocha@2.0.1"},"qunit@1.16.0":{},"qunit@1.18.0":{configurator:"qunit@1.16.0",reporter:"qunit@1.16.0",starter:"qunit@1.16.0"},"qunit@2.4.0":{configurator:"qunit@1.16.0",reporter:"qunit@2.4.0",starter:"qunit@1.16.0"}}},defaultPatterns={typeScript:"**/*.ts?(x)",coffeeScript:"**/*.?(lit)coffee?(.md)"};var defaults,config;class Config{constructor(e,t){defaults={files:{ignore:!1,trigger:!0,load:!0},tests:{ignore:!1,trigger:!0,load:!0}};const r=this._localProjectDir=path.dirname(e);this._configFile=e,this._root=t,this._builtinCompilers={coffeeScript:require("./coffeeScriptCompiler")(r),babel:require("./babelCompiler")(r),typeScript:e=>e&&e.isolatedModules?require("./typeScriptCompiler")(r)(e):{replaceWithPostprocessor:!0,localProjectDir:r,opts:e}},this._builtinPostprocessors={typeScript:require("./typeScriptPostprocessor")(r),webpack:require("./postprocessors/webpack/initialize")(r)}}async load(){if(this._settings)return this._settings;let packageJson={};try{packageJson=require(path.join(this._localProjectDir,"package.json"))}catch(e){}const wallaby={localProjectDir:path.dirname(this._configFile)+path.sep,projectCacheDir:this._root,compilers:this._builtinCompilers,postprocessors:this._builtinPostprocessors,override:e=>({override:e}),defaults:{files:_.extend({},defaults.files),tests:_.extend({},defaults.tests)}};let esmConfig=!1,settings,configFilePath=this._configFile;if("auto.detect"!==path.basename(configFilePath)){let config;try{config=require(configFilePath)}catch(cjsErr){if(process.env.WALLABY_INTEGRATION_TEST_RUN||process.env.WALLABY_UNIT_TEST_RUN)throw cjsErr;try{try{configFilePath=require("url").pathToFileURL(configFilePath)}catch(e){}config=await eval(_ad9‍.c("import(configFilePath)")),esmConfig=!0}catch(mjsErr){throw new Error("\nWe have tried both CommonJs require and ESM import to load the config, you may find errors for each attempt below.\n-----------------------------\nCommonJs config loading error\n-----------------------------\n"+cjsErr.stack+"\n------------------------------\nES module config loading error\n------------------------------\n"+mjsErr.stack)}}if(config&&(config.__esModule||esmConfig)&&config.default&&(config=config.default),_.isFunction(config)){if(2===config.length?settings=await new Promise(t=>config(wallaby,e=>t(e))):(settings=config(wallaby),settings&&settings.constructor&&"Promise"===settings.constructor.name&&(settings=await settings)),!settings)throw new Error("Configuration function did not return an object.")}else settings=config;void 0!==settings.autoDetect||settings.files&&!_.isFunction(settings.files.override)||settings.tests&&!_.isFunction(settings.tests.override)||(settings.autoDetect=!0)}else settings={noSettingsFile:!0};const validateFileTestsPatterns=(e,t)=>{e&&_.isArray(e)&&e.forEach(e=>{if(_.isString(e)){if(-1!==e.indexOf("\\"))throw new Error(t+" Pattern contains backslashes, please use forward slashes instead.")}else if(_.isObject(e)&&e.pattern&&-1!==e.pattern.indexOf("\\"))throw new Error(t+" Pattern contains backslashes, please use forward slashes instead.")})},noSettingsFile=(validateFileTestsPatterns(settings.files,"File"),validateFileTestsPatterns(settings.tests,"Test"),settings.diagnostics=settings.diagnostics||{},settings=this._mergePackageFileSettings(settings,packageJson),settings.debug&&logger.enableDebug(),settings.trace&&logger.enableTrace(),this._settings=settings,settings.noSettingsFile);delete settings.noSettingsFile;let autoDetectSettings="autoDetect"===(_.isString(settings.testFramework||"")?settings.testFramework:settings.testFramework.type)||settings.testFramework&&settings.testFramework.autoDetected||settings.autoDetect;const availableAutomaticConfigurationProviders=_.isArray(settings.autoDetect)?settings.autoDetect:["angular","jest","vitest"],autoDetectedSettings=(delete settings.autoDetect,{original:void 0,hard:{},soft:{}});if(noSettingsFile||autoDetectSettings){noSettingsFile&&(settings.testFramework="autoDetect",autoDetectSettings=!0),settings.env&&settings.env.params&&settings.env.params.env&&_.reduce(settings.env.params.env.split(";"),function(e,t){var r=t.split("=");return e[_.trimLeft(r[0])]=t.substring(r[0].length+1),e},process.env);const automaticConfigurationProviders=[...availableAutomaticConfigurationProviders.map(e=>{switch(e){case"angular":return{provider:e,configure:require("./configurators/angular-cli/configure").configure};case"jest":return{provider:e,configure:require("./configurators/jest/configure").configure};case"vitest":return{provider:e,configure:require("./configurators/vitest/configure").configure}}})].filter(e=>!!e),errors=(await automaticConfigurationProviders.reduce(async(e,t)=>{e=await e;if(!e.success){var r=(new Date).getTime(),s=(debug("Attempting automatic configuration for %s",t.provider),await t.configure(this._localProjectDir,autoDetectedSettings,settings,packageJson)),i=(new Date).getTime();if(debug("Finished attempting automatic configuration for %s (%sms)",t.provider,i-r),s.success)return Promise.resolve({success:!0,errors:[]});s&&s.errors&&e.errors.push(...s.errors)}return Promise.resolve(e)},Promise.resolve({success:!1,errors:[]}))).errors;if(errors.length){if(1===errors.length)throw errors[0];{let message=""+errors[0].message+os.EOL+os.EOL+"We've also tried to automatically configure Wallaby.js for other frameworks";throw errors.shift(),errors.forEach(e=>message+=""+os.EOL+e.message),new Error(message)}}}let filesOrTestsAutoPopulated=!1;if(!settings.files||_.isFunction(settings.files.override)){let files=[];if(filesOrTestsAutoPopulated=!0,settings.testFramework&&"jest"===settings.testFramework.type){const jestWallabyConfig=settings.testFramework.originalConfig.wallaby;files=_.map(jestWallabyConfig.watchPathIgnorePatterns,e=>({pattern:e,regexp:new RegExp(e),ignore:!0})),files.push({pattern:"**/**"}),jestWallabyConfig.roots.length&&(files=files.concat(_.map(jestWallabyConfig.roots,e=>({pattern:e+"/**"}))))}settings.files=settings.files&&_.isFunction(settings.files.override)?settings.files.override(files):files}if(void 0===settings.captureConsoleLog)settings.captureConsoleLog=!0;else if(!1!==settings.captureConsoleLog&&!0!==settings.captureConsoleLog)throw new Error("captureConsoleLog property must be either true or false");if(!_.isArray(settings.files)||!settings.files.length)throw new Error("Files property must be non-empty array of files/file patterns");if(!settings.tests||_.isFunction(settings.tests.override)){let tests=[];if(filesOrTestsAutoPopulated=!0,"jest"===settings.testFramework.type){const jestWallabyConfig=settings.testFramework.originalConfig.wallaby;tests=_.map(jestWallabyConfig.testPathIgnorePatterns,e=>({pattern:e,regexp:new RegExp(e),ignore:!0})),jestWallabyConfig.roots.length&&jestWallabyConfig.testMatch.length&&_.every(jestWallabyConfig.testMatch,e=>_.startsWith(e,"**"))?tests=tests.concat(_.reduce(jestWallabyConfig.roots,(e,t)=>e.concat(_.map(jestWallabyConfig.testMatch,e=>({pattern:t+"/"+e}))),[])):(jestWallabyConfig.testMatch.length&&(tests=tests.concat(_.map(jestWallabyConfig.testMatch,e=>({pattern:e})))),jestWallabyConfig.testRegex.length&&(tests=tests.concat(_.map(jestWallabyConfig.testRegex,e=>({pattern:e,regexp:new RegExp(e)})))))}settings.tests=settings.tests&&_.isFunction(settings.tests.override)?settings.tests.override(tests):tests}if(!_.isArray(settings.tests)||!settings.tests.length)throw new Error("Tests property must be non-empty array of test files/file patterns");if(settings.filesWithNoCoverageCalculated=settings.filesWithNoCoverageCalculated||[],settings.runAllTestsInAffectedTestFile=settings.runAllTestsInAffectedTestFile||!1,settings.updateNoMoreThanOneSnapshotPerTestFileRun=settings.updateNoMoreThanOneSnapshotPerTestFileRun||!1,void 0!==settings.addModifiedTestFileToExclusiveTestRun)throw settings.addModifiedTestFileToExclusiveTestRun?new Error(`addModifiedTestFileToExclusiveTestRun has been deprecated, use smartStart settings instead: 
...
  smartStart: [
    { startMode: 'edit' }, // Supported Options: 'edit', 'open', 'never'
  ],
...
`):new Error(`addModifiedTestFileToExclusiveTestRun has been deprecated, use smartStart settings instead: 
...
  smartStart: [
    { startMode: 'never' },  // Supported Options: 'edit', 'open', 'never'
  ],
...
`);if(settings.compilers=settings.compilers||{},!_.isObject(settings.compilers))throw new Error("If defined, compilers property must be an object.");const isNativeBundler=settings.postprocessor&&settings.postprocessor.bundler&&settings.postprocessor.bundler.native;if(isNativeBundler||(settings.compilers[defaultPatterns.coffeeScript]||autoDetectedSettings.hard.noCompilers||(settings.compilers[defaultPatterns.coffeeScript]=this._builtinCompilers.coffeeScript()),autoDetectedSettings.hard.noCompilers)||settings.compilers[defaultPatterns.typeScript]||_.find(_.keys(settings.compilers),e=>(0,micromatch_1.isMatch)("a.ts",e))||settings.noDefaultTypeScriptCompiler||(settings.compilers[defaultPatterns.typeScript]=this._builtinCompilers.typeScript()),this._configureSmartStart(settings),this._configureLogLimits(settings),settings.preprocessors=settings.preprocessors||{},!_.isObject(settings.preprocessors))throw new Error("If defined, preprocessors property must be an object.");if(_.values(settings.preprocessors).length&&autoDetectedSettings.hard.noPreprocessors)throw new Error("Preprocessors cannot be set.");if(settings.postprocessor&&!_.isFunction(settings.postprocessor))throw new Error("Postprocessor must be a function if set");if(settings.testRunComplete&&!_.isFunction(settings.testRunComplete))throw new Error("TestRunComplete hook must be a function if set");if(settings.postprocessor&&autoDetectedSettings.hard.noPostprocessor)throw new Error("Postprocessor cannot be set.");if(isNativeBundler){if(_.values(settings.compilers).length)throw new Error("Compilers cannot be set if built in webpack postprocessor is used.");if(_.values(settings.preprocessors).length)throw new Error("Preprocessors cannot be set if built in webpack postprocessor is used.")}if(autoDetectedSettings.hard.noCompilers||isNativeBundler||this._adjustTypeScriptCompilers(settings),_.isFunction(settings.middleware)||(settings.middleware=_.noop),settings.maxConsoleMessagesPerTest=settings.maxConsoleMessagesPerTest||100,settings.telemetry=!1!==settings.telemetry,settings.autoConsoleLog=!1!==settings.autoConsoleLog,settings.delays=settings.delays||{},settings.delays.run=settings.delays.run||0,settings.delays.run?settings.delays.edit=0:settings.delays.edit=settings.delays.edit||100,settings.delays.update=settings.delays.update||0,settings.workers=settings.workers||{},settings.workers.initial=settings.workers.initial||0,settings.workers.regular=settings.workers.regular||0,_.isBoolean(settings.workers.restart)?settings.workers.recycle=settings.workers.restart:settings.workers.recycle=!!settings.workers.recycle,settings.bootstrap&&settings.setup)throw new Error("The `setup` and `bootstrap` functions are alias of the same setting, so only one of them is allowed in the config.");var setup=settings.bootstrap||settings.setup,modulePrototype,compile;if(settings.bootstrap=setup&&setup.toString(),delete settings.setup,settings.teardown=settings.teardown&&settings.teardown.toString(),this._normalizeFunction(settings,"bootstrap"),this._normalizeFunction(settings,"teardown"),settings.hints=settings.hints||{},settings.hints.ignoreCoverage=utils_1.default.serializeRegExp(settings.hints.ignoreCoverage||/ignore coverage|istanbul ignore|c8 ignore/),settings.hints.ignoreCoverageForFile=utils_1.default.serializeRegExp(settings.hints.ignoreCoverageForFile||/ignore file coverage/),settings.hints.commentAutoLog=settings.hints.commentAutoLog||"?",settings.hints.testFileSelection=settings.hints.testFileSelection||{},settings.hints.testFileSelection.include=utils_1.default.serializeRegExp(settings.hints.testFileSelection.include||/file\.only/),settings.hints.testFileSelection.exclude=utils_1.default.serializeRegExp(settings.hints.testFileSelection.exclude||/file\.skip/),settings.automaticTestFileSelection=!1!==settings.automaticTestFileSelection,settings.runSelectedTestsOnly=!0===settings.runSelectedTestsOnly,settings.mapConsoleMessagesStackTrace=!0===settings.mapConsoleMessagesStackTrace,settings.extensions=settings.extensions||{},settings.env||(settings.env=autoDetectedSettings.hard.env||{type:"browser",kind:"chrome"}),!_.isObject(settings.env))throw new Error("Environment is not specified correctly");if(settings.env.type=autoDetectedSettings.hard.env&&autoDetectedSettings.hard.env.type||settings.env.type||"browser",settings.env.params=settings.env.params||{},"browser"!==settings.env.type||settings.env.kind||(settings.env.kind="chrome"),settings.env.kind&&"phantomjs"!==settings.env.kind&&"electron"!==settings.env.kind&&"chrome"!==settings.env.kind)throw new Error('Specified browser environment kind "'+settings.env.kind+'" is not supported');if("node"!==settings.env.type||settings.env.runner||(settings.env.runner=process.execPath),"node"===settings.env.type){const pathParts=(process.env.PATH||"").split(":"),runnerPath=path.dirname(settings.env.runner);pathParts.includes(runnerPath)||(process.env.PATH=[runnerPath,...pathParts].join(":"))}if("electron"===settings.env.kind&&!settings.env.runner)try{try{settings.env.runner=utils_1.default.requireModuleFrom(wallaby.localProjectDir,"electron")}catch(ignored){settings.env.runner=utils_1.default.requireModuleFrom(wallaby.localProjectDir,"electron-prebuilt")}}catch(e){throw new Error("Electron runner path is not specified and `electron` module was not found.\nEither specify a path in `env.runner` or install the electron module by running `npm install electron --save-dev`")}if("phantomjs"===settings.env.kind&&!settings.env.runner)try{try{settings.env.runner=utils_1.default.requireModuleFrom(wallaby.localProjectDir,"phantomjs").path}catch(ignored){settings.env.runner=utils_1.default.requireModuleFrom(wallaby.localProjectDir,"phantomjs-prebuilt").path}}catch(e){throw new Error("From June 2019, Wallaby.js no longer ships with PhantomJs version 2.1.1.\nPhantomJs runner path is not specified and neither `phantomjs` nor `phantomjs-prebuilt` modules were found.\nEither specify a path in `env.runner` or install the phantomjs module by running `npm install phantomjs-prebuilt --save-dev`\nRead more in our docs: https://wallabyjs.com/docs/integration/phantomjs2.html ")}if(settings.reportUnhandledPromises="node"===settings.env.type?!1!==settings.reportUnhandledPromises:!0===settings.reportUnhandledPromises,"browser"===settings.env.type&&(settings.throwOnBeforeUnload=!1!==settings.throwOnBeforeUnload),settings.env.viewportSize=_.extend({width:800,height:600},settings.env.viewportSize||{}),settings.env.options=_.extend({},settings.env.viewportSize,settings.env.options||{}),!1!==settings.env.bundle&&(settings.env.bundle=!0),settings.testFramework=settings.testFramework||("browser"===settings.env.type?"jasmine@3.10.0":"mocha@2.1.0"),settings.testFramework=this._normalizeTestFramework(settings),settings.env&&"node"===settings.env.type&&settings.env.params&&settings.env.params.runner&&-1!==settings.env.params.runner.indexOf("--experimental-vm-modules")&&settings.testFramework&&settings.testFramework.version){if(-1===settings.env.params.runner.indexOf("--experimental-loader")){const hooksV2Api=semver.gte(process.versions.node,"17.0.0")||semver.gte(process.versions.node,"16.12.0")&&semver.lt(process.versions.node,"17.0.0")||semver.gte(process.versions.node,"14.999.999")&&semver.lt(process.versions.node,"15.0.0")||semver.gte(process.versions.node,"12.999.999")&&semver.lt(process.versions.node,"13.0.0"),hookFilename=hooksV2Api?"hooks-v2.mjs":"hooks.mjs",hookPath=path.join(path.dirname(process.mainModule.filename),`runners/node/${settings.testFramework.version}/`+hookFilename);fs.existsSync(hookPath)&&(settings.env.params.runner+=` --experimental-loader "${url.pathToFileURL(hookPath)}"`)}-1!==settings.env.params.runner.indexOf("--experimental-loader")&&delete settings.testFramework.jsPreprocessor}_.values(settings.compilers).length&&(wallaby.defaults&&wallaby.defaults.files&&!1!==wallaby.defaults.files.instrument&&(wallaby.defaults.files.instrument=!0),wallaby.defaults&&wallaby.defaults.tests&&!1!==wallaby.defaults.tests.instrument&&(wallaby.defaults.files.instrument=!0),defaults.files.instrument=!0,defaults.tests.instrument=!0),settings.files=_.map(settings.files,this._normalizeFileObject.bind(this,wallaby.defaults&&wallaby.defaults.files||_.extend({},defaults.files))),settings.tests=_.map(settings.tests,this._normalizeFileObject.bind(this,wallaby.defaults&&wallaby.defaults.tests||_.extend({},defaults.tests))),filesOrTestsAutoPopulated&&_.each(_.filter(settings.tests,e=>!e.ignore),t=>{var e;_.find(settings.files,e=>e.ignore&&e.pattern===t.pattern)||((e=_.clone(t)).ignore=!0,settings.files.push(e))}),settings.slowTestThreshold=settings.slowTestThreshold||75,settings.lowCoverageThreshold=settings.lowCoverageThreshold||80;const isJest=0===settings.testFramework.version.indexOf("jest");if(void 0===settings.runAllTestsWhenNoAffectedTests&&(settings.runAllTestsWhenNoAffectedTests=!isJest&&!isNativeBundler),isJest||"node"!==settings.env.type||void 0===settings.symlinkNodeModules&&(settings.symlinkNodeModules="module"===packageJson.type||void 0),isJest&&!autoDetectSettings){if(!_.find(settings.files,function(e){return e&&_.endsWith(e.pattern,".snap")})){const self=this;_.each(settings.tests,e=>{e&&e.pattern&&settings.files.push(self._normalizeFileObject({ignore:e.ignore,instrument:!1,trigger:!0,load:!0},e.pattern+".snap"))})}_.find(settings.files,function(e){return e&&"package.json"===e.pattern})||settings.files.push(this._normalizeFileObject({ignore:!1,instrument:!1,trigger:!0,load:!0},"package.json")),_.isEmpty(settings.preprocessors)||(modulePrototype=require("module").Module.prototype,compile=modulePrototype._compile,modulePrototype._compile=function(e,t){return t&&~t.indexOf("babel-plugin-jest-hoist")&&e&&((t=e.replace("if (!expr.isCallExpression())",'if(expr.isSequenceExpression()){const expressions = expr.get("expressions");if (!expressions || expressions.length !== 2) return false;expr = expressions[1];}if (!expr.isCallExpression())'))===e&&console.warn("Initialization of babel-plugin-jest-hoist preset has failed."),arguments[0]=t),compile.apply(this,arguments)},global.$_$w)||(global.$_$w=global.$_$w_=global.$_$wf=global.$_$wv=global.$_$tracer=!0),settings.preprocessors&&!settings.preprocessors["package.json"]&&(settings.preprocessors["package.json"]=e=>{e=JSON.parse(e.content);return delete e.babel,JSON.stringify(e)})}return settings}_normalizeFunction(e,t){var r,s,i;e[t]&&0!==e[t].indexOf("function")&&0!==e[t].indexOf("async function")&&(0===e[t].indexOf("async")?e[t]="async function "+e[t].substr("async".length):e[t]="function "+e[t],i=(r=e[t].split("\n")[0]).indexOf("=>"),s=r.indexOf("{"),0<i&&(-1===s||i<s)&&(e[t]=e[t].replace("=>","{")+"}"),0<i)&&r.indexOf("(")<0&&(s=(r=e[t].split("\n")[0]).indexOf("{"),i=r.substring("function ".length,s),e[t]=e[t].replace(i,"("+i+")"))}_configureLogLimits(a){const l={inline:{depth:5,elements:5e3},values:{default:{stringLength:200},autoExpand:{elements:5e3,stringLength:8192,depth:10}}},i=(t,r)=>{if(r=r||[],_.isObject(t)){const s=[];return Object.keys(t).forEach(e=>{i(t[e],[...r,e]).filter(e=>!!e).forEach(e=>s.push(e))}),s}return[r]};var e=i(l);e.forEach(e=>{var r=["logLimits",...e.slice(0,-1)];{var s,i=r;let t=a;for(let e=0;e<i.length;e++){var n=i[e];if(t[n]){if(!_.isObject(t[n]))throw new Error(i.join(".")+" property must be an object.")}else t[n]={};t=t[n]}}{var o=e;let t=a.logLimits,r=l;for(let e=0;e<o.length-1;e++)t=t[o[e]],r=r[o[e]];if(t[o[o.length-1]]){if(!_.isNumber(t[o[o.length-1]]))throw new Error(`logLimits.${o.join(".")} property must be numeric.`);if(t[o[o.length-1]]<=0)throw new Error(`logLimits.${o.join(".")} property must be greater than zero.`)}else t[o[o.length-1]]=r[o[o.length-1]]}})}_configureSmartStart(e){if(e.smartStart){if(!_.isArray(e.smartStart))throw new Error("smartStart property must be an array of options");if(0===e.smartStart.length)throw new Error("smartStart array must contain at least one option.");e.smartStart=e.smartStart.map(t=>{var e={};if(!_.isObject(t))throw new Error("smartStart option must be an object.");if(t.test){if(!_.isBoolean(t.test))throw new Error("smartStart option.test must be a boolean.");e.test=t.test}if(t.source)throw new Error("smartStart option.source is not a supported option.");if(e.source=!1,void 0!==e.test||e.source||(e.test=!0),t.pattern){if(!_.isString(t.pattern))throw new Error("smartStart option.pattern must be a string.");e.pattern=t.pattern}else e.pattern="**/*";if(t.path){if(t.pattern)throw new Error("smartStart only one of option.path and option.pattern may be specified.");if(!_.isString(t.path))throw new Error("smartStart option.path must be a string.");e.path=t.path}if(t.startMode){var r=["always","never","edit","open"];if(!r.find(e=>t.startMode===e))throw new Error("smartStart option.pattern must one of ["+r.join(", ")+"].");e.startMode=t.startMode}return e})}else e.smartStart=[];e.smartStart.push({test:!0,source:!1,pattern:"**/*",startMode:"open"}),e.smartStart.push({test:!1,source:!0,pattern:"**/*",startMode:"edit"})}_normalizeTestFramework(e){var t,r=supportedTestFrameworks[e.env.type];if(r)return t=this._resolveTestFrameworkVersion(e,r),r=_.extend({version:t,configurator:t,reporter:t,starter:t},r[t]),e.testFramework.path&&(r.path=e.testFramework.path),e.testFramework.configFile&&(r.configFile=e.testFramework.configFile),e.testFramework.autoDetected&&(r.autoDetected=!0,delete r.originalConfig),r;throw new Error("Environment ["+e.env.type+"] is not supported")}_resolveTestFrameworkVersion(e,t){var r=_.isString(e.testFramework)?e.testFramework:e.testFramework.type;if("jest"!==r||e.testFramework.autoDetected||(r+="@0.4.3"),~r.indexOf("@")){if(t[r])return r;throw new Error("Test framework ["+r+"] is not supported")}{let s={};_.each(t,(e,t)=>{var r=t.substr(0,t.indexOf("@"));s[r]=t});e=s[r];if(e)return e;throw new Error("Test framework ["+r+"] is not supported")}}_adjustTypeScriptCompilers(r){var e,s=!!r.postprocessor,i={files:{}};_.each(r.compilers,(e,t)=>{e&&e.replaceWithPostprocessor&&(i.postprocessor=e.postprocessor,delete r.compilers[t],s&&(e.opts=e.opts||{}),i.files[t]=e.opts,e.opts)&&e.opts.typescript&&(i.typescript=e.opts.typescript,delete e.opts.typescript)}),_.isEmpty(i.files)||(e=i.postprocessor||this._builtinPostprocessors.typeScript(i),r.postprocessor=s?[e,r.postprocessor]:e)}_normalizeFileObject(e,t){if(_.isString(t))t={pattern:t};else if(!t.pattern)throw new Error("File/test entry must either be a string or an object that contains pattern property");t=_.defaults(t,e);return t.regexp||("!"===t.pattern[0]&&(t.ignore=!t.ignore,t.pattern=t.pattern.substring(1)),"/"===t.pattern[0]&&(t.pattern=t.pattern.substring(1)),"."===t.pattern[0]&&"/"===t.pattern[1]&&(t.pattern=t.pattern.substring(2))),t}_mergePackageFileSettings(e,t){return t&&t.wallaby?_.merge(t.wallaby,e):e}}function default_1(e,t,{forceUpdate:r}={}){return(config=config&&!r?config:new Config(e,t)).load()}exports.default=default_1},{"./babelCompiler":9,"./coffeeScriptCompiler":14,"./configurators/angular-cli/configure":16,"./configurators/jest/configure":38,"./configurators/vitest/configure":40,"./postprocessors/webpack/initialize":54,"./typeScriptCompiler":71,"./typeScriptPostprocessor":72,"./utils":75,fs:void 0,micromatch:void 0,module:void 0,os:void 0,path:void 0,semver:void 0,url:void 0}],16:[function(S,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configure=void 0;const P=S("path");var r=S("fs"),s=S("util");const F=S("semver"),C=S("../../utils"),T=s.promisify(r.exists),j=S("../../utils/joinWithLookUp").default,{debug:E,trace:R}=logger.create("angular/cli config");t.configure=async function(r,s,i,n){try{R("Detecting Angular CLI.");const{path:y,type:b,content:w}=await(0,S("./detect").default)(r)||{};if(!y)return E("Angular CLI not found."),{success:!1,errors:[]};E("Detected Angular CLI."),i.diagnostics.angular={workspace:w};try{if(!w.version||!Object.keys(w.projects||{}).length)throw new Error(`'${y}' is not a valid Angular CLI file.`);if("nx"===b&&w.projects){S("./nxModulePatch");for(const x in w.projects){var o=w.projects[x];o.targets&&o.targets.test&&(o.architect=o.targets,o.targets.test.executor)&&(o.targets.test.builder=o.targets.test.executor)}}const k=P.dirname(y);let e,t;if("ng"===b||"nx"===b){var a=j([k,"node_modules","@angular","cli","package.json"]);if(await T(a)){var l=S(P.resolve(a));if(e=l.version,!F.valid(e)||F.lt(e,"8.2.0"))throw new Error("Only Angular CLI v8.2.0 or higher is supported.")}else if("ng"===b)throw new Error("Cannot detect @angular/cli package version, is the package installed?")}if("nx"===b){var c=C.default.tryRequireModuleWithPathFrom(k,"@nrwl/workspace/package.json",!1)||C.default.tryRequireModuleWithPathFrom(k,"@nx/workspace/package.json",!1);if(!c)throw new Error("Cannot detect @nx/workspace package version, is the package installed?");var u=S(P.resolve(c.path));if(t=u.version,!F.valid(t)||F.lt(t,"8.0.0"))throw new Error("Only @nrwl/workspace v8.0.0 or higher is supported.")}if(E('Angular currentDirPath: "%s", workspaceDirPath: "%s"',r,k),r===k){var p,d,h=Object.keys(w.projects).map(e=>({name:e,configuration:w.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&("@angular-devkit/build-angular:karma"===e.configuration.architect.test.builder||"@angular-builders/custom-webpack:karma"===e.configuration.architect.test.builder)),g=Object.keys(w.projects).map(e=>({name:e,configuration:w.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&"@angular-builders/jest:run"===e.configuration.architect.test.builder),f=Object.keys(w.projects).map(e=>({name:e,configuration:w.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&("@nrwl/jest:jest"===e.configuration.architect.test.builder||"@nx/jest:jest"===e.configuration.architect.test.builder));if(!h.length&&!g.length&&!f.length)throw new Error("None of your projects are configured with `@angular-devkit/build-angular:karma`, `@angular-builders/custom-webpack:karma`, `@angular-builders/jest:run`, `@nrwl/jest:jest` or `@nx/jest:jest` builders as their test architect.");h.length&&e?(p=F.major(e),d=F.minor(e),1<h.length?await new(S(8===p?"./karma/v8/WorkspaceConfigurator":p<12?"./karma/v9/WorkspaceConfigurator":p<13?"./karma/v12/WorkspaceConfigurator":p<14?d<1?"./karma/v13/WorkspaceConfigurator":"./karma/v13.1/WorkspaceConfigurator":p<15?"./karma/v13.1/WorkspaceConfigurator":"./karma/v15/WorkspaceConfigurator").WorkspaceConfigurator)(k,y,w,e).configure(i):await new(S(8===p?"./karma/v8/ProjectConfigurator":p<12?"./karma/v9/ProjectConfigurator":p<13?"./karma/v12/ProjectConfigurator":p<14?d<1?"./karma/v13/ProjectConfigurator":"./karma/v13.1/ProjectConfigurator":p<15?"./karma/v13.1/ProjectConfigurator":"./karma/v15/ProjectConfigurator").ProjectConfigurator)(k,y,w,h[0]).configure(!0,i)):g.length?1<g.length?await new(S("./v8-jest/WorkspaceConfigurator").WorkspaceConfigurator)(r,s,i,n,k,w).configure():await new(S("./v8-jest/ProjectConfigurator").ProjectConfigurator)(r,s,i,n,k,g[0]).configure():f.length&&(1<f.length?await new(S("./v8-nrwl-jest/WorkspaceConfigurator").WorkspaceConfigurator)(r,s,i,n,k,w).configure():await new(S("./v8-nrwl-jest/ProjectConfigurator").ProjectConfigurator)(r,s,i,n,k,f[0]).configure())}else{var m=Object.keys(w.projects).map(e=>({name:e,configuration:w.projects[e]})).find(e=>P.resolve(P.join(k,e.configuration.root))===r);if(!m)throw new Error(`A project for '${r}' directory cannot be detected.`);if(!m.configuration.architect||!m.configuration.architect.test||"@angular-devkit/build-angular:karma"!==m.configuration.architect.test.builder&&"@angular-builders/custom-webpack:karma"!==m.configuration.architect.test.builder&&"@angular-builders/jest:run"!==m.configuration.architect.test.builder&&"@nx/jest:jest"!==m.configuration.architect.test.builder&&"@nrwl/jest:jest"!==m.configuration.architect.test.builder)throw new Error(`The project ${m.name} is not configured with \`@angular-devkit/build-angular:karma\`, \`@angular-builders/custom-webpack:karma\`, \`@angular-builders/jest:run\`, \`@nrwl/jest:jest\` or \`@nx/jest:jest\` builder as its test architect.`);if("@angular-devkit/build-angular:karma"===m.configuration.architect.test.builder||"@angular-builders/custom-webpack:karma"===m.configuration.architect.test.builder){var _=F.major(e),v=F.minor(e);await new(S(8===_?"./karma/v8/ProjectConfigurator":_<12?"./karma/v9/ProjectConfigurator":_<13?"./karma/v12/ProjectConfigurator":_<14?v<1?"./karma/v13/ProjectConfigurator":"./karma/v13.1/ProjectConfigurator":_<15?"./karma/v13.1/ProjectConfigurator":"./karma/v15/ProjectConfigurator").ProjectConfigurator)(k,y,w,m).configure(!1,i)}else if("@angular-builders/jest:run"===m.configuration.architect.test.builder)await new(S("./v8-jest/ProjectConfigurator").ProjectConfigurator)(r,s,i,n,k,m).configure();else if("@nrwl/jest:jest"===m.configuration.architect.test.builder||"@nx/jest:jest"===m.configuration.architect.test.builder){if(!F.valid(t)||F.gt(t,"11.1.4"))return delete i.diagnostics.angular,E("@nx/workspace v11.1.4 and higher uses jest automatic configuration."),{success:!1,errors:[]};await new(S("./v8-nrwl-jest/ProjectConfigurator"))(r,s,i,n,k,m).configure()}}return{success:!0,errors:[]}}catch(e){throw E(e),E("Angular.json: \n %O",w),e}}catch(e){return E(e),{success:!1,errors:[new Error("Automatic Angular CLI configuration error: "+e.message)]}}}},{"../../utils":75,"../../utils/joinWithLookUp":76,"./detect":17,"./karma/v12/ProjectConfigurator":18,"./karma/v12/WorkspaceConfigurator":19,"./karma/v13.1/ProjectConfigurator":20,"./karma/v13.1/WorkspaceConfigurator":21,"./karma/v13/ProjectConfigurator":22,"./karma/v13/WorkspaceConfigurator":24,"./karma/v15/ProjectConfigurator":25,"./karma/v15/WorkspaceConfigurator":26,"./karma/v8/ProjectConfigurator":27,"./karma/v8/WorkspaceConfigurator":28,"./karma/v9/ProjectConfigurator":30,"./karma/v9/WorkspaceConfigurator":31,"./nxModulePatch":32,"./v8-jest/ProjectConfigurator":33,"./v8-jest/WorkspaceConfigurator":34,"./v8-nrwl-jest/ProjectConfigurator":35,"./v8-nrwl-jest/WorkspaceConfigurator":36,fs:void 0,path:void 0,semver:void 0,util:void 0}],17:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=o("path");var r=o("fs"),s=o("util");const l=o("../../utils"),c=logger.create("angular/cli config")["trace"],i="angular.json",n="workspace.json",u="nx.json",p=s.promisify(r.exists);t.default=async function(e){var t=a.parse(e).root,r=async(r,s,e)=>{if("nx"===s){process.env.NX_DAEMON="false";try{if(2===o(r).version||e){var i=a.dirname(r);l.default.tryRequireModuleWithPathFrom(i,"nx/src/adapter/compat",!1);let t=l.default.tryRequireModuleWithPathFrom(i,"nx/src/config/workspaces",!1);if((t=t&&t.module?t:l.default.tryRequireModuleWithPathFrom(i,"@nrwl/tao/src/shared/workspace",!1))&&t.module){var n=new t.module.Workspaces(i);let e;return t.module.resolveOldFormatWithInlineProjects?(c("Loading nx workspace using resolveOldFormatWithInlineProjects"),e=t.module.resolveOldFormatWithInlineProjects(n.readWorkspaceConfiguration())):n.readWorkspaceConfiguration?(c("Loading nx workspace using readWorkspaceConfiguration"),(e=n.readWorkspaceConfiguration()).version=e.version||1):c("Missing readWorkspaceConfiguration and resolveOldFormatWithInlineProjects from "+t.path),e.configFileName=r,e.nxWorkspace=!0,{path:r,type:s,content:e}}}else c("Failed to detect nx workspace module")}catch(e){c(`Failed to load nx workspace: ${e.toString()} `+(e.stack||""))}}return{path:r,type:s,content:o(r)}};let s=e;if(await p(a.join(s,u)))return await p(a.join(s,i))?r(a.join(s,i),"nx"):await p(a.join(s,n))?r(a.join(s,n),"nx"):r(a.join(s,u),"nx",!0);if(await p(a.join(s,i)))return r(a.join(s,i),"ng");for(;;){if(s===t)return;if(s=a.resolve(s,".."),await p(a.join(s,u)))return await p(a.join(s,i))?r(a.join(s,i),"nx"):await p(a.join(s,n))?r(a.join(s,n),"nx"):r(a.join(s,u),"nx",!0);if(await p(a.join(s,i)))return r(a.join(s,i),"ng")}}},{"../../utils":75,fs:void 0,path:void 0,util:void 0}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ProjectConfigurator=void 0;class s extends e("../v9/ProjectConfigurator").ProjectConfigurator{constructor(e,t,r,s){super(e,t,r,s)}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getTypeScriptConfig:r,getStylesConfig:s,getTestConfig:i,getWorkerConfig:n}=e;return[e(t),s(t),r(t),i(t),n(t)]}_adjustPostprocessor(e){const n=e._prepareCompiler.bind(e);e._prepareCompiler=(e,t,r,s,i)=>{i.watchMode=!0,n(e,i)}}_adjustPlugins(e){const t="zone.js/testing fix: https://github.com/angular/angular/issues/42260";e.push({apply:e=>{e.hooks.normalModuleFactory.tap(t,e=>{e.hooks.createModule.tap(t,e=>{"zone.js/testing"!==e.rawRequest&&"zone.js/dist/zone-testing"!==e.rawRequest||e.resourceResolveData&&(e.resourceResolveData.patch=e=>e.replace("instance.install = function () {","instance.install = function () { var process = {listeners: function(){},removeAllListeners: function(){}};"))})})}})}_getZoneImportStatement(){return"import 'zone.js';"}_getZoneTestingImportStatement(){return"import 'zone.js/testing';"}_getAllLoaders(e){var t=e.filter(e=>e.rules).map(e=>e.rules).flat(),e=e.filter(e=>e.use).map(e=>e.use).flat(),r=t.filter(e=>e.use).map(e=>e.use).flat(),t=t.filter(e=>e.oneOf).map(e=>e.oneOf).flat().filter(e=>e.use).map(e=>e.use).flat();return _.union(e,r,t)}}r.ProjectConfigurator=s},{"../v9/ProjectConfigurator":30}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.WorkspaceConfigurator=void 0;const T=e("path"),s=e("semver"),j=e("lodash");var i=e("../v9/WorkspaceConfigurator");const E=e("../../../../utils"),R=logger.create("angular/cli karma workspace config")["trace"];class n extends i.WorkspaceConfigurator{constructor(e,t,r,s){super(e,t,r,s)}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getTypeScriptConfig:r,getStylesConfig:s,getTestConfig:i,getWorkerConfig:n}=e;return[e(t),s(t),r(t),i(t),n(t)]}_adjustPostprocessor(e,n,s,i,o){const a=e._prepareCompiler.bind(e);let l=!1;const c=()=>{var e=o();const t=e.lstat,r=e.readFile;e.readFile=e=>e===s?i:r(e),e.lstat=e=>e===s?{isDirectory:()=>!1}:t(e)};e._prepareCompiler=(e,t,r,s,i)=>{i.watchMode=!0,a(e,i),e?n&&!l&&(c(),l=!0):n&&c()}}_adjustPlugins(e){const t="zone.js/testing fix: https://github.com/angular/angular/issues/42260";e.push({apply:e=>{e.hooks.normalModuleFactory.tap(t,e=>{e.hooks.createModule.tap(t,e=>{"zone.js/testing"!==e.rawRequest&&"zone.js/dist/zone-testing"!==e.rawRequest||e.resourceResolveData&&(e.resourceResolveData.patch=e=>e.replace("instance.install = function () {","instance.install = function () { var process = {listeners: function(){},removeAllListeners: function(){}};"))})})}})}_deduplicateMainFileContent(e){return e.replace(/import\s*'zone\.js'\s*;/,"").replace(/import\s*'zone\.js\/testing'\s*;/,"").replace(/import\s*{\s*getTestBed\s*}\s*from\s*'@angular\/core\/testing'\s*;/,"").replace(/declare\s+const\s+require\s*:\s*any\s*;/,"").replace(/declare\s*const\s*require\s*:\s*{\s*context\s*\(\s*path\s*:\s*string\s*,\s*deep\?\s*:\s*boolean\s*,\s*filter\?\s*:\s*RegExp\s*\)\s*:\s*{\s*keys\s*\(\s*\)\s*:\s*string\s*\[\s*]\s*;\s*<\s*T\s*>\s*\(\s*id\s*:\s*string\s*\)\s*:\s*T\s*;\s*}\s*;\s*}\s*;/,"").replace(/declare\s*const\s*require\s*:\s*{\s*context\s*\(\s*path\s*:\s*string\s*,\s*deep\?\s*:\s*boolean\s*,\s*filter\?\s*:\s*RegExp\s*\)\s*:\s*{\s*<\s*T\s*>\s*\(\s*id\s*:\s*string\s*\)\s*:\s*T\s*;\s*keys\s*\(\s*\)\s*:\s*string\s*\[\s*]\s*;\s*}\s*;\s*}\s*;\s*/,"").replace(/import\s*{\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting,?\s*}\s*from\s*'@angular\/platform-browser-dynamic\/testing'\s*;/,"").replace(/getTestBed\s*\(\s*\)\s*.\s*initTestEnvironment\s*\(\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*\(\s*\)\s*,?\s*\)\s*;/,"").replace(/getTestBed\s*\(\s*\)\s*.\s*initTestEnvironment\s*\(\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*\(\s*\),\s*{\s*teardown\s*:\s*{\s*destroyAfterEach\s*:\s*true\s*}\s*,?\s*}\s*,?\s*\)\s*;/,"").replace(/getTestBed\s*\(\s*\)\s*.\s*initTestEnvironment\s*\(\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*\(\s*\),\s*{\s*teardown\s*:\s*{\s*destroyAfterEach\s*:\s*false\s*}\s*,?\s*}\s*,?\s*\)\s*;/,"")}_fixStyleRules(t,r){if(R("Sanitizing style rules."),r.module&&r.module.rules){var s=r.module.rules,r=s.filter(e=>e.rules).map(e=>e.rules).flat(),i=s.filter(e=>e.use).map(e=>e.use).flat(),n=r.filter(e=>e.use).map(e=>e.use).flat(),r=r.filter(e=>e.oneOf).map(e=>e.oneOf).flat().filter(e=>e.use).map(e=>e.use).flat();for(const w of j.union(i,n,r))"string"!=typeof w&&w.options&&(this._checkCssLoader(w.loader,"less-loader")||this._checkCssLoader(w.loader,"postcss-loader")||this._checkCssLoader(w.loader,"resolve-url-loader"))&&(w.options.sourceMap=!1);var o,a=new Map;for(let e=0;e<s.length;e++){var l=s[e],c=l.rules||[],c=(2===c.length&&c[0].oneOf&&c[0].oneOf.length&&c[1].use&&!c[1].use.length?c[0].oneOf.filter(e=>e.use).map(e=>e.use):c.filter(e=>e.use).map(e=>e.use)).flat();!l.mimetype&&c.length&&"string"!=typeof(c=c[c.length-1])&&(this._checkCssLoader(c.loader,"sass-loader")||this._checkCssLoader(c.loader,"less-loader")||this._checkCssLoader(c.loader,"stylus-loader")||this._checkCssLoader(c.loader,"postcss-loader"))&&a.set(e,l)}let e=0;for([o]of a)s.splice(o-e,1),e++;var u,p,d=new Map;for([,u]of a)if(u.test){let e={test:u.test,rules:[]};d.has(u.test.toString())?e=d.get(u.test.toString()):(e.rules.push({oneOf:[]}),e.rules.push({oneOf:[]}),d.set(u.test.toString(),e));var h=e.rules[0],g=e.rules[1],f=u.rules[0],m=u.rules[1],_=(e,t,r)=>{e.type&&(t.type=e.type),e.resourceQuery&&(t.resourceQuery=e.resourceQuery);for(const n of e.use){var s,i;"string"!=typeof n?((s=this._copyCssLoader(n)).options&&(i=r&&r.length?r.map(e=>E.default.normalizePath(T.resolve(T.join(this._workspaceDirPath,e)))):null,this._setCssLoaderOptionsPaths(s,i)),t.use.push(s)):t.use.push(n)}};for(const k of t){let r=null;if(k.configuration.architect.test.options){var v=k.configuration.architect.test.options.stylePreprocessorOptions;if(v&&v.includePaths){r=[];for(const P of v.includePaths)r.push(P)}}const x=[];t.filter(e=>e.name!==k.name).forEach(e=>{const t=T.resolve(T.join(this._workspaceDirPath,e.configuration.root));r&&r.length&&r.some(e=>T.resolve(T.join(this._workspaceDirPath,e)).startsWith(t))||x.push(t),(e.configuration.architect.test.options.styles||[]).forEach(e=>x.push(T.resolve(T.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))});var y=k.configuration.architect.test.options.styles||[];let e=!0;for(const F of f.oneOf){const C={use:[]};if(_(F,C,r),e)e=!1,C.exclude=[],y.forEach(e=>C.exclude.push(T.resolve(T.join(this._workspaceDirPath,"string"==typeof e?e:e.input)))),x.forEach(e=>C.exclude.push(e));else{if(!y.length)continue;C.include=[],y.forEach(e=>C.include.push(T.resolve(T.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))}C.use.length&&h.oneOf.push(C)}const S={use:[]};_(m,S,r),S.exclude=[],x.forEach(e=>S.exclude.push(e)),S.use.length&&g.oneOf.push(S)}var b={use:[]},b=(_(f.oneOf[0],b),b.use.length&&h.oneOf.push(b),{use:[]});_(m,b,null),b.use.length&&g.oneOf.push(b)}for([,p]of d)s.push(p)}}_getZoneImportStatement(){return"import 'zone.js';"}_getZoneTestingImportStatement(){return"import 'zone.js/testing';"}_getTestEnvironmentInitStatement(){return s.minor(this._version)<2?"getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting());":"getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting(), { teardown: { destroyAfterEach: true }});"}_copyCssLoader(e){return{loader:e.loader,options:this._copyCssLoaderOptions(e)}}}r.WorkspaceConfigurator=n},{"../../../../utils":75,"../v9/WorkspaceConfigurator":31,lodash:void 0,path:void 0,semver:void 0}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ProjectConfigurator=void 0;class s extends e("../v13/ProjectConfigurator").ProjectConfigurator{constructor(e,t,r,s){super(e,t,r,s)}_adjustBuildOptions(e){e.aot=!1,e.optimization=!1,e.buildOptimizer=!1}_adjustConfiguration(e){super._adjustConfiguration(e),e.experiments||(e.experiments={}),e.experiments.backCompat=!0}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getStylesConfig:r}=e;return[e(t),r(t)]}}r.ProjectConfigurator=s},{"../v13/ProjectConfigurator":22}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.WorkspaceConfigurator=void 0;const j=e("path");var s=e("../v13/WorkspaceConfigurator");const E=e("../../../../utils"),R=logger.create("angular/cli karma workspace config")["trace"];class i extends s.WorkspaceConfigurator{constructor(e,t,r,s){super(e,t,r,s)}_adjustBuildOptions(e){e.aot=!1,e.optimization=!1,e.buildOptimizer=!1}_adjustConfiguration(e){super._adjustConfiguration(e),e.experiments||(e.experiments={}),e.experiments.backCompat=!0}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getStylesConfig:r}=e;return[e(t),r(t)]}_fixStyleRules(t,r){if(R("Sanitizing style rules."),r.module&&r.module.rules){var s=r.module.rules,r=s.filter(e=>e.rules).map(e=>e.rules).flat(),i=s.filter(e=>e.use).map(e=>e.use).flat(),n=r.filter(e=>e.use).map(e=>e.use).flat(),r=r.filter(e=>e.oneOf).map(e=>e.oneOf).flat().filter(e=>e.use).map(e=>e.use).flat();for(const k of _.union(i,n,r))"string"!=typeof k&&k.options&&(this._checkCssLoader(k.loader,"less-loader")||this._checkCssLoader(k.loader,"postcss-loader")||this._checkCssLoader(k.loader,"resolve-url-loader"))&&(k.options.sourceMap=!1);var o,a=new Map;for(let e=0;e<s.length;e++){var l=s[e],c=l.rules||[],c=(2===c.length&&c[0].oneOf&&c[0].oneOf.length&&c[1].use&&!c[1].use.length?c[0].oneOf.filter(e=>e.use).map(e=>e.use):c.filter(e=>e.use).map(e=>e.use)).flat();!l.mimetype&&c.length&&"string"!=typeof(c=c[c.length-1])&&(this._checkCssLoader(c.loader,"sass-loader")||this._checkCssLoader(c.loader,"less-loader")||this._checkCssLoader(c.loader,"stylus-loader")||this._checkCssLoader(c.loader,"postcss-loader"))&&a.set(e,l)}let e=0;for([o]of a)s.splice(o-e,1),e++;var u,p,d=new Map;for([,u]of a)if(u.test){let e={test:u.test,rules:[]};d.has(u.test.toString())?e=d.get(u.test.toString()):(e.rules.push({oneOf:[]}),e.rules.push({oneOf:[]}),d.set(u.test.toString(),e));var h=e.rules[0],g=e.rules[1],f=u.rules[0],m=u.rules[1],v=(e,t,r)=>{e.type&&(t.type=e.type),e.resourceQuery&&(t.resourceQuery=e.resourceQuery);for(const n of e.use){var s,i;"string"!=typeof n?((s=this._copyCssLoader(n)).options&&(i=r&&r.length?r.map(e=>E.default.normalizePath(j.resolve(j.join(this._workspaceDirPath,e)))):null,this._setCssLoaderOptionsPaths(s,i)),t.use.push(s)):t.use.push(n)}};for(const x of t){let r=null;if(x.configuration.architect.test.options){var y=x.configuration.architect.test.options.stylePreprocessorOptions;if(y&&y.includePaths){r=[];for(const F of y.includePaths)r.push(F)}}const S=[];t.filter(e=>e.name!==x.name).forEach(e=>{const t=j.resolve(j.join(this._workspaceDirPath,e.configuration.root));r&&r.length&&r.some(e=>j.resolve(j.join(this._workspaceDirPath,e)).startsWith(t))||S.push(t),(e.configuration.architect.test.options.styles||[]).forEach(e=>S.push(j.resolve(j.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))});var b=x.configuration.architect.test.options.styles||[];let e=!0;for(const C of f.oneOf){const T={use:[]};if(v(C,T,r),e){if(e=!1,!b.length)continue;T.include=[],b.forEach(e=>T.include.push(j.resolve(j.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))}else T.exclude=[],b.forEach(e=>T.exclude.push(j.resolve(j.join(this._workspaceDirPath,"string"==typeof e?e:e.input)))),S.forEach(e=>T.exclude.push(e));T.use.length&&h.oneOf.push(T)}const P={use:[]};v(m,P,r),P.exclude=[],S.forEach(e=>P.exclude.push(e)),P.use.length&&g.oneOf.push(P)}var w={use:[]},w=(v(f.oneOf[0],w),w.use.length&&h.oneOf.push(w),{use:[]}),w=(v(f.oneOf[1],w),w.use.length&&h.oneOf.push(w),{use:[]});v(m,w,null),w.use.length&&g.oneOf.push(w)}for([,p]of d)s.push(p)}}}r.WorkspaceConfigurator=i},{"../../../../utils":75,"../v13/WorkspaceConfigurator":24,path:void 0}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ProjectConfigurator=void 0;var s=e("../v12/ProjectConfigurator");const i=e("./StyleLoaderResolverPlugin");class n extends s.ProjectConfigurator{constructor(e,t,r,s){super(e,t,r,s)}_adjustConfiguration(e){e.resolveLoader||(e.resolveLoader={}),e.resolveLoader.plugins||(e.resolveLoader.plugins=[]),e.resolveLoader.plugins.push(new i.StyleLoaderResolverPlugin),e.plugins=e.plugins.filter(e=>!(e.constructor&&e.constructor.name&&"MiniCssExtractPlugin"===e.constructor.name))}_replaceCssLoader(e){0<=e.loader.indexOf("mini-css-extract-plugin")&&(e.loader="style-loader",e.options={})}}r.ProjectConfigurator=n},{"../v12/ProjectConfigurator":18,"./StyleLoaderResolverPlugin":23}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.StyleLoaderResolverPlugin=void 0;var s=e("../../../../utils");const i=e("style-loader");s.default.patchModule("style-loader",()=>i);r.StyleLoaderResolverPlugin=class{constructor(){}apply(e){e=e.ensureHook("file");e.tapAsync("WallabyPlugin",(e,t,r)=>{if("./node_modules/style-loader"===e.relativePath)return r(null,{path:"style-loader"});r()})}}},{"../../../../utils":75,"style-loader":void 0}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WorkspaceConfigurator=void 0;const url=require("url"),joinWithLookUp=require("../../../../utils/joinWithLookUp").default,WorkspaceConfigurator_1=require("../v12/WorkspaceConfigurator"),StyleLoaderResolverPlugin_1=require("./StyleLoaderResolverPlugin");class WorkspaceConfigurator extends WorkspaceConfigurator_1.WorkspaceConfigurator{constructor(e,t,r,s){super(e,t,r,s)}async _getFileSystemGetter(){const path=joinWithLookUp([this._workspaceDirPath,"node_modules","@angular","compiler-cli","bundles","index.js"]);return eval(_ad9‍.c(`import('${url.pathToFileURL(path)}');`))}_getTestEnvironmentInitStatement(){return"getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting());"}_copyCssLoader(e){return e.loader.indexOf("mini-css-extract-plugin")<0?{loader:e.loader,options:this._copyCssLoaderOptions(e)}:{loader:"style-loader",options:{}}}_adjustConfiguration(e){e.resolveLoader||(e.resolveLoader={}),e.resolveLoader.plugins||(e.resolveLoader.plugins=[]),e.resolveLoader.plugins.push(new StyleLoaderResolverPlugin_1.StyleLoaderResolverPlugin),e.plugins=e.plugins.filter(e=>!(e.constructor&&e.constructor.name&&"MiniCssExtractPlugin"===e.constructor.name))}}exports.WorkspaceConfigurator=WorkspaceConfigurator},{"../../../../utils/joinWithLookUp":76,"../v12/WorkspaceConfigurator":19,"./StyleLoaderResolverPlugin":23,url:void 0}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ProjectConfigurator=void 0;class s extends e("../v13.1/ProjectConfigurator").ProjectConfigurator{constructor(e,t,r,s){super(e,t,r,s)}_getMainFileContent(){return`
  ${"library"===this._project.configuration.projectType?this._getZoneImportStatement():""}
  ${this._getZoneTestingImportStatement()}
  import { getTestBed } from '@angular/core/testing';
  import {
    BrowserDynamicTestingModule,
    platformBrowserDynamicTesting,
   } from '@angular/platform-browser-dynamic/testing';
   
  // Initialize the Angular testing environment.
  getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting(), {
    errorOnUnknownElements: true,
    errorOnUnknownProperties: true
  });`}_wrapStyleImport(e){return e+"?ngGlobalStyle"}_getMainFileExtension(){return".js"}get _isNoSpecMainFileAllowed(){return!0}}r.ProjectConfigurator=s},{"../v13.1/ProjectConfigurator":20}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.WorkspaceConfigurator=void 0;class s extends e("../v13.1/WorkspaceConfigurator").WorkspaceConfigurator{constructor(e,t,r,s){super(e,t,r,s)}_deduplicateMainFileContent(e){return e.replace(/import\s*'zone\.js'\s*;/,"").replace(/import\s*'zone\.js\/testing'\s*;/,"").replace(/import\s*{\s*getTestBed\s*}\s*from\s*'@angular\/core\/testing'\s*;/,"").replace(/declare\s+const\s+require\s*:\s*any\s*;/,"").replace(/declare\s*const\s*require\s*:\s*{\s*context\s*\(\s*path\s*:\s*string\s*,\s*deep\?\s*:\s*boolean\s*,\s*filter\?\s*:\s*RegExp\s*\)\s*:\s*{\s*keys\s*\(\s*\)\s*:\s*string\s*\[\s*]\s*;\s*<\s*T\s*>\s*\(\s*id\s*:\s*string\s*\)\s*:\s*T\s*;\s*}\s*;\s*}\s*;/,"").replace(/declare\s*const\s*require\s*:\s*{\s*context\s*\(\s*path\s*:\s*string\s*,\s*deep\?\s*:\s*boolean\s*,\s*filter\?\s*:\s*RegExp\s*\)\s*:\s*{\s*<\s*T\s*>\s*\(\s*id\s*:\s*string\s*\)\s*:\s*T\s*;\s*keys\s*\(\s*\)\s*:\s*string\s*\[\s*]\s*;\s*}\s*;\s*}\s*;\s*/,"").replace(/import\s*{\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting,?\s*}\s*from\s*'@angular\/platform-browser-dynamic\/testing'\s*;/,"").replace(/getTestBed\s*\(\s*\)\s*.\s*initTestEnvironment\s*\(\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*\(\s*\)(.|\n|\r\n)*\)\s*;/,"")}_getTestEnvironmentInitStatement(){return`getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting(), {
    errorOnUnknownElements: true,
    errorOnUnknownProperties: true
  });`}_wrapStyleImport(e){return e+"?ngGlobalStyle"}_getMainFileExtension(){return".js"}_copyCssLoaderOptions(e){var t;if(e.options)return this._checkCssLoader(e.loader,"sass-loader")?("legacy"===(t=Object.assign({},e.options)).api&&(t.sassOptions=Object.assign({},e.options.sassOptions)),t):super._copyCssLoaderOptions(e)}_setCssLoaderOptionsPaths(e,t){if(this._checkCssLoader(e.loader,"sass-loader"))if("modern"===e.options.api){const r=e.options.sassOptions;e.options.sassOptions=e=>{e=r(e);return e.includePaths=t,e}}else super._setCssLoaderOptionsPaths(e,t);else super._setCssLoaderOptionsPaths(e,t)}get _isNoSpecMainFileAllowed(){return!0}}r.WorkspaceConfigurator=s},{"../v13.1/WorkspaceConfigurator":21}],27:[function(V,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectConfigurator=void 0,V("./modulePatch");const U=V("../../../../utils/joinWithLookUp").default,J=V("path"),H=V("os"),G=V("fs");var r=V("util");const Q=V("semver"),Y=V("lodash"),Z=V("../../../../utils"),K=r.promisify(G.exists),X=r.promisify(G.readFile),{debug:ee,trace:te}=logger.create("angular/cli karma project config");process.env.NG_BUILD_IVY_LEGACY="1";t.ProjectConfigurator=class{constructor(e,t,r,s){this._workspaceDirPath=Z.default.normalizePath(e),this._workspaceConfigFilePath=Z.default.normalizePath(t),this._workspaceConfig=r,this._project=s}async configure(t,e){te("Configuring.");var r=Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"jasmine-core/package.json",!1),r=(e.testFramework&&(Y.isString(e.testFramework)&&e.testFramework.startsWith("jasmine")?e.testFramework={type:e.testFramework,autoDetected:!0}:e.testFramework.type&&e.testFramework.type.startsWith("jasmine")?e.testFramework.autoDetected=!0:delete e.testFramework),e.testFramework||(!r||!r.module||Q.lt(r.module.version,"4.0.0")?e.testFramework={type:"jasmine",autoDetected:!0}:Q.lt(r.module.version,"5.0.0")?e.testFramework={type:"jasmine@4.6.0",autoDetected:!0}:e.testFramework={type:"jasmine@5.1.1",autoDetected:!0}),e.env||(e.env={kind:"chrome"}),e.bootstrap||e.setup||(e.setup="function(){window.__moduleBundler.loadTests();}"),this._ts=Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"typescript",!0).module,Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/commands/test-impl",!1)||Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/src/commands/test/cli.js",!1));if(!r)throw new Error("Could not load Angular CLI package");var s=Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/utilities/config.js",!1)||Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/src/utilities/config.js",!1);const D=Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-builders/custom-webpack/dist/transform-factories.js");var{TestCommand:i,TestCommandModule:n}=r.module,o=Z.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/core/src/logger/null-logger",!0).module["NullLogger"];const $=Z.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/architect",!0).module["createBuilder"],A=Z.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/build-angular/src/utils/webpack-browser-config",!0).module["generateBrowserWebpackConfigFromContext"],a=Z.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/build-angular/src/angular-cli-files/models/webpack-configs",!1)||Z.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/build-angular/src/webpack/configs",!1)||Z.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/build-angular/src/tools/webpack/configs",!1);if(!a)throw new Error("Could not load Webpack configuration");let l;try{l=this._workspaceConfig.nxWorkspace?(c=await Z.default.tryRequireModuleWithPathFrom(J.dirname(this._workspaceConfig.configFileName),"@angular-devkit/core/src/workspace/json/reader",!1).module.readJsonWorkspace(J.basename(this._workspaceConfig.configFileName),{readFile:()=>this._convertFromNxWorkspaceConfig()}),{workspace:new s.module.AngularWorkspace(c,this._workspaceConfig.configFileName)}):{workspace:await s.module.AngularWorkspace.load(this._workspaceConfigFilePath)}}catch(e){l={workspace:{root:this._workspaceDirPath,configFile:"angular.json"}}}var c={name:"test",description:"",options:[],aliases:[],hidden:!(l.packageManager={name:"npm"}),scope:"default"};let u={};const N=this._getWebpackConfigurations,q=this;async function B(e,t){e.codeCoverage=!1,q._adjustBuildOptions(e);var r=(await A(Object.assign(Object.assign({},e),{outputPath:"",budgets:void 0}),t,e=>N(a.module,e)))["config"];return u=r[0]||r,t&&t.builder&&"@angular-builders/custom-webpack:karma"===t.builder.name&&(r=D.module.customWebpackConfigTransformFactory(e,t),u=r?await r(u):u),{success:!0}}s=new(i||n||r.module)(l,c,new o);s.initialize&&await s.initialize({}),(s._architectHost||s.getArchitectHost()).loadBuilder=()=>new Promise(e=>e($(B))),te("Calling test command for %s.",this._project.name),await s.run({project:this._project.name}),te("Initializing postprocessor.");i=V("../../../../postprocessors/webpack/initialize")(this._workspaceDirPath);if(delete u.output,delete u.performance,delete u.optimization,this._adjustConfiguration(u),te("Sanitizing style rules."),u.module&&u.module.rules){n=u.module.rules;for(const M of this._getAllLoaders(n))"string"!=typeof M&&(this._replaceCssLoader(M),M.options)&&(this._checkCssLoader(M.loader,"less-loader")||this._checkCssLoader(M.loader,"postcss-loader")||this._checkCssLoader(M.loader,"resolve-url-loader"))&&(M.options.sourceMap=!1)}te("Sanitizing plugins."),u.plugins=u.plugins.filter(e=>!e.sourceMappingURLComment&&!e.patterns&&!(e.options&&e.options.budgets||e.budgets||e.options&&e.modules||void 0!==e.profile&&void 0!==e.modulesCount&&void 0!==e.showEntries&&void 0!==e.showModules&&void 0!==e.showActiveModules||e.options&&e.options.scripts)),this._adjustPlugins(u.plugins);var p=this._project.configuration,r=p.architect.test.options,c=[],o=(te("Setting up polyfills."),u.entry.polyfills);if(o&&o.length){var d,h=[];for(d of o)h.push(`require('${Z.default.normalizePath(d)}');`);h.length&&c.push({path:J.join(this._workspaceDirPath,"wallaby-polyfills.js"),code:""+h.join(H.EOL)+this._getExtraPolyfills()})}s=r.styles;if(s){te("Setting up styles.");var g,f,m=[];for(g of s){let e=!0;"string"!=typeof g&&(e=void 0===g.inject||g.inject,e=void 0===g.bundleName&&e,g=g.input),e&&(f=Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,g))),G.existsSync(f)?m.push(`require('${this._wrapStyleImport(f)}');`):(f=Z.default.normalizePath(J.resolve(U([this._workspaceDirPath,"node_modules",g]))),G.existsSync(f)?m.push(`require('${this._wrapStyleImport(f)}');`):m.push(`require('${this._wrapStyleImport(g)}');`)))}m.length&&c.push({path:J.join(this._workspaceDirPath,"wallaby-styles.js"),code:m.join(H.EOL)})}te("Setting up main file.");n=p.sourceRoot||J.join(p.root,"src"),o=t?n:J.relative(p.root,n),s=J.join(this._workspaceDirPath,o)===J.join(this._workspaceDirPath,"./");let _=r.main?Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,r.main))):void 0,v=_?await X(_,"utf-8"):void 0;var y=_?J.extname(_):".ts",b=_?J.posix.basename(_,y):"test";let w=Z.default.normalizePath(J.resolve(J.join(_?J.dirname(_):J.join(this._workspaceDirPath,n),b+".wallaby"+y))),k=(await K(w)||(w=null),Z.default.normalizePath(J.resolve(J.join(_?J.dirname(_):J.join(this._workspaceDirPath,n),b+".base"+y))));await K(k)||(k=null);var y=/const\s+context\s*=\s*require\s*\.\s*context\s*\(\s*'\.\/'\s*,\s*true\s*,\s*\/\\\.spec\\\.ts\$\/\s*\)\s*;/g,x=/context\s*\.\s*keys\s*\(\s*\)\s*\.map\s*\(\s*context\s*\)\s*;/g,S=/context\s*\.\s*keys\s*\(\s*\)\s*\.forEach\s*\(\s*context\s*\)\s*;/g,y=(v=w?(ee("Using physical %s.",w),await X(w,"utf-8")):void 0!==v&&(this._isNoSpecMainFileAllowed||v.match(y)&&(v.match(x)||v.match(S)))?(ee("Using virtual %s.",_),v.replace(y,"").replace(x,"").replace(S,"")):k?(ee("Using physical %s.",k),await X(k,"utf-8")):(_=r.main?Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,r.main))):Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,n,b+this._getMainFileExtension()))),ee("Using builtin %s.",_),this._getMainFileContent()),e.diagnostics.angular.main=v,c.push({path:_,code:v}),te("Creating postprocessor."),i(u,{setupFiles:c}));this._adjustPostprocessor(y.owner),e.postprocessor=y,te("Created postprocessor.");const P=[];x=[];P.push({pattern:Z.default.normalizePath(J.join(o,"/**/*.spec.ts")),ignore:!0}),p.architect.test.options.polyfills&&"string"==typeof p.architect.test.options.polyfills&&P.push({pattern:Z.default.normalizePath(t?p.architect.test.options.polyfills:J.relative(p.root,p.architect.test.options.polyfills)),ignore:!0}),p.architect.test.options.main&&P.push({pattern:Z.default.normalizePath(t?p.architect.test.options.main:J.relative(p.root,p.architect.test.options.main)),ignore:!0}),p.architect.build&&p.architect.build.options&&(p.architect.build.options.main&&P.push({pattern:Z.default.normalizePath(t?p.architect.build.options.main:J.relative(p.root,p.architect.build.options.main)),ignore:!0}),p.architect.build.options.index)&&(S=p.architect.build.options.index.input||p.architect.build.options.index,P.push({pattern:Z.default.normalizePath(t?S:J.relative(p.root,S)),ignore:!0})),P.push({pattern:Z.default.normalizePath(J.join(o,"/test.base.ts")),ignore:!0}),P.push({pattern:Z.default.normalizePath(J.join(o,"/test.wallaby.ts"))}),s&&x.push({pattern:"/node_modules/**",ignore:!0}),x.push({pattern:Z.default.normalizePath(J.join(o,"/**/*.spec.ts")),load:!1});const F=[];var C=new Set,n=r.scripts;if(n&&n.length){te("Setting up scripts.");var T,W,j,E,z=[];for(T of n){let e=!0;"string"!=typeof T&&(!(e=void 0===T.inject||T.inject)&&T.bundleName&&T.input?(E=Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,T.input))),j=""+J.posix.sep+T.bundleName+".js",C.has(W=j+E)||(F.push({path:{virtual:j,physical:E}}),C.add(W))):(e=void 0===T.bundleName&&e,T=T.input)),e&&T&&(j=Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,T))),(t?j.startsWith(this._workspaceDirPath):j.startsWith(Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,p.root)))))?(E=Z.default.normalizePath(J.relative(t?this._workspaceDirPath:J.join(this._workspaceDirPath,p.root),j)),z.push(E),P.push({pattern:E,instrument:!1,load:!0})):console.warn(`Angular CLI automatic configuration: the script ${T} is outside of the ${t?"workspace":"project folder"}, Wallaby.js ignores such files at the moment. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues.`))}s&&Z.default.generateNodeModulesExcludesForIncludePatterns(z).forEach(e=>{P.push({pattern:e,ignore:!0})})}else s&&P.push({pattern:"/node_modules/**",ignore:!0});var R,I,O,b=r.assets;if(b&&b.length){te("Setting up assets.");for(var L of b)"string"==typeof L?(I=Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,L))),await K(I)&&(R=""+J.posix.sep+J.basename(I),C.has(O=R+I)||(F.push({path:{virtual:R,physical:I}}),C.add(O)))):L&&L.input&&L.output&&(R=Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,L.input))),I=L.output.startsWith(J.posix.sep)?L.output:""+J.posix.sep+L.output,C.has(O=""+I+R)||(F.push({path:{virtual:I,physical:R}}),C.add(O)))}F.length&&(i=(e,t)=>{for(const r of F)e.use(r.path.virtual,t.static(r.path.physical))},e.middleware?Y.isFunction(e.middleware.override)&&(e.middleware=e.middleware.override(i)):e.middleware=i),P.push({pattern:Z.default.normalizePath(J.join(o,"/**/*.+(ts|js)")),load:!1}),P.push({pattern:Z.default.normalizePath(J.join(o,"/**/*.+(css|less|scss|sass|styl|html|json|svg)")),instrument:!1,load:!1}),e.files?Y.isFunction(e.files.override)&&(e.files=e.files.override(P)):e.files=P,e.tests?Y.isFunction(e.tests.override)&&(e.tests=e.tests.override(x)):e.tests=x,te("Configured.")}_checkCssLoader(e,t){return e===t}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getNonAotConfig:r,getStylesConfig:s,getTestConfig:i,getWorkerConfig:n}=e;return[e(t),s(t),r(t),i(t),n(t)]}_getExtraPolyfills(){return""}_adjustPostprocessor(e){const a=e._prepareCompiler.bind(e);e._prepareCompiler=(e,t,r,s,i)=>{a(e,i);for(const n of i.options.plugins)if(n._compilerHost){if(n._firstRun=!e,e)t?(n._moduleResolutionCache=this._ts.createModuleResolutionCache(n._basePath,e=>e),n._compilerHost.moduleResolutionCache=n._moduleResolutionCache):r||s.forEach(e=>n._compilerHost.invalidate(e.fullPath));else{i.watchMode=!0;const o=n._createOrUpdateProgram.bind(n);n._createOrUpdateProgram=async()=>{await o(),n._program.getSemanticDiagnostics=()=>[]}}break}}}_adjustBuildOptions(e){}_adjustConfiguration(e){}_adjustPlugins(e){}_getMainFileContent(){return`
  ${"library"===this._project.configuration.projectType?this._getZoneImportStatement():""}
  ${this._getZoneTestingImportStatement()}
  import { getTestBed } from '@angular/core/testing';
  
  import {
    BrowserDynamicTestingModule,
    platformBrowserDynamicTesting
  } from '@angular/platform-browser-dynamic/testing'; 

  getTestBed().initTestEnvironment(
    BrowserDynamicTestingModule,
    platformBrowserDynamicTesting()
  );`}_getZoneImportStatement(){return"import 'zone.js/dist/zone';"}_getZoneTestingImportStatement(){return"import 'zone.js/dist/zone-testing';"}_replaceCssLoader(e){}_getAllLoaders(e){return Y.flatten(e.filter(e=>e.use).map(e=>e.use))}_wrapStyleImport(e){return e}_getMainFileExtension(){return".ts"}_convertFromNxWorkspaceConfig(){var e=JSON.parse(JSON.stringify(this._workspaceConfig));if(e.projects)for(const r of Object.keys(e.projects)){var t=e.projects[r],t=(delete t.name,t.targets||t.architect);t&&t.test&&(t=t.test.executor||t.test.builder)&&!t.startsWith("@angular")&&delete e.projects[r]}return JSON.stringify(e)}get _isNoSpecMainFileAllowed(){return!1}}},{"../../../../postprocessors/webpack/initialize":54,"../../../../utils":75,"../../../../utils/joinWithLookUp":76,"./modulePatch":29,fs:void 0,lodash:void 0,os:void 0,path:void 0,semver:void 0,util:void 0}],28:[function(N,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceConfigurator=void 0,N("./modulePatch");const o=N("../../../../utils/joinWithLookUp").default,q=N("path"),u=N("os"),B=N("fs");var r=N("util");const W=N("semver"),z=N("lodash"),V=N("../../../../utils"),U=r.promisify(B.exists),h=r.promisify(B.readFile),{debug:J,trace:H}=logger.create("angular/cli karma workspace config");process.env.NG_BUILD_IVY_LEGACY="1";t.WorkspaceConfigurator=class{constructor(e,t,r,s){this._workspaceDirPath=V.default.normalizePath(e),this._workspaceConfigFilePath=V.default.normalizePath(t),this._workspaceConfig=r,this._version=s}async configure(e){H("Configuring.");var t=V.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"jasmine-core/package.json",!1),t=(e.testFramework&&(z.isString(e.testFramework)&&e.testFramework.startsWith("jasmine")?e.testFramework={type:e.testFramework,autoDetected:!0}:e.testFramework.type&&e.testFramework.type.startsWith("jasmine")?e.testFramework.autoDetected=!0:delete e.testFramework),e.testFramework||(!t||!t.module||W.lt(t.module.version,"4.0.0")?e.testFramework={type:"jasmine",autoDetected:!0}:W.lt(t.module.version,"5.0.0")?e.testFramework={type:"jasmine@4.6.0",autoDetected:!0}:e.testFramework={type:"jasmine@5.1.1",autoDetected:!0}),e.env||(e.env={kind:"chrome"}),e.setup||e.setup||(e.setup="function(){window.__moduleBundler.loadTests();}"),this._ts=V.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"typescript",!0).module,await this._getFileSystemGetter())["getFileSystem"],r=V.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/commands/test-impl",!1)||V.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/src/commands/test/cli.js",!1);if(!r)throw new Error("Could not load Angular CLI package");var s=V.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/utilities/config.js",!1)||V.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/src/utilities/config.js",!1);const i=V.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-builders/custom-webpack/dist/transform-factories.js");var{TestCommand:n,TestCommandModule:o}=r.module,a=V.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/core/src/logger/null-logger",!0).module["NullLogger"];const l=V.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/architect",!0).module["createBuilder"],c=V.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/build-angular/src/utils/webpack-browser-config",!0).module["generateBrowserWebpackConfigFromContext"],u=V.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/build-angular/src/angular-cli-files/models/webpack-configs",!1)||V.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/build-angular/src/webpack/configs",!1)||V.default.tryRequireModuleWithPathFrom(r.path,"@angular-devkit/build-angular/src/tools/webpack/configs",!1);if(!u)throw new Error("Could not load Webpack configuration");let p;try{p=this._workspaceConfig.nxWorkspace?(d=await V.default.tryRequireModuleWithPathFrom(q.dirname(this._workspaceConfig.configFileName),"@angular-devkit/core/src/workspace/json/reader",!1).module.readJsonWorkspace(q.basename(this._workspaceConfig.configFileName),{readFile:()=>this._convertFromNxWorkspaceConfig()}),{workspace:new s.module.AngularWorkspace(d,this._workspaceConfig.configFileName)}):{workspace:await s.module.AngularWorkspace.load(this._workspaceConfigFilePath)}}catch(e){p={workspace:{root:this._workspaceDirPath,configFile:"angular.json"}}}var d={name:"test",description:"",options:[],aliases:[],hidden:!(p.packageManager={name:"npm"}),scope:"default"},s=e["angular-cli"];const h=s&&Array.isArray(s.excludedProjects)?new Set(s.excludedProjects):new Set,g=Object.keys(this._workspaceConfig.projects).map(e=>({name:e,configuration:this._workspaceConfig.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&("@angular-devkit/build-angular:karma"===e.configuration.architect.test.builder||"@angular-builders/custom-webpack:karma"===e.configuration.architect.test.builder)).filter(e=>!h.has(e.name));let f;s=g.filter(e=>"application"===e.configuration.projectType);f=1<s.length?((v=s.filter(e=>""===e.configuration.root)).length?v:(v=s.filter(e=>e.name===this._workspaceConfig.defaultProject)).length?v:s)[0]:s.length?s[0]:g.find(e=>"library"===e.configuration.projectType);let m="tsconfig.wallaby.spec.json",_=(await U(q.join(this._workspaceDirPath,m))||(m="tsconfig.workspace.spec.json",await U(q.join(this._workspaceDirPath,m)))||(m="tsconfig.wallaby.spec.json"),{});const D=this._getWebpackConfigurations,$=this;async function A(t,e){t.codeCoverage=!1,t.tsConfig=m,$._adjustBuildOptions(t),z.flatten(g.filter(e=>e.name!==f.name).map(e=>e.configuration).filter(e=>e.architect.test.options.fileReplacements).map(e=>e.architect.test.options.fileReplacements)).forEach(e=>t.fileReplacements.push(e));var r=(await c(Object.assign(Object.assign({},t),{outputPath:"",budgets:void 0}),e,e=>D(u.module,e)))["config"];return _=r[0]||r,e&&e.builder&&"@angular-builders/custom-webpack:karma"===e.builder.name&&(r=i.module.customWebpackConfigTransformFactory(t,e),_=r?await r(_):_),{success:!0}}var v=new(n||o||r.module)(p,d,new a),s=(v.initialize&&await v.initialize({}),(v._architectHost||v.getArchitectHost()).loadBuilder=()=>new Promise(e=>e(l(A))),await this._generateMainFiles(g));const y=q.join(this._workspaceDirPath,m),b=(H("Calling test command for %s.",f.name),V.default.normalizePath(y));n=!await U(y);let w="";if(n){J("Using virtual %s.",y);o=t();const j=o.lstat,E=B.statSync,R=this._ts.sys.readFile,I=o.readFile;w=await this._generateTsConfigFile(g,1===s.length?s[0].path:null),e.diagnostics.angular.tsConfig=w,o.lstat=e=>e===b?{isDirectory:()=>!1}:j(e),this._ts.sys.readFile=e=>e===b?w:R(e),B.statSync=(e,t)=>e===y?{isFile:()=>!0}:E(e,t),o.readFile=e=>e===b?w:I(e),await v.run({project:f.name}),B.statSync=E}else J("Using physical %s.",y),await v.run({project:f.name});H("Initializing postprocessor.");r=N("../../../../postprocessors/webpack/initialize")(this._workspaceDirPath);delete _.output,delete _.performance,delete _.optimization,this._adjustConfiguration(_),this._fixStyleRules(g,_),H("Sanitizing plugins."),_.plugins=_.plugins.filter(e=>!e.sourceMappingURLComment&&!e.patterns&&!(e.options&&e.options.budgets||e.budgets||e.options&&e.modules||e.generateName||void 0!==e.profile&&void 0!==e.modulesCount&&void 0!==e.showEntries&&void 0!==e.showModules&&void 0!==e.showActiveModules||e.options&&e.options.scripts)),this._adjustPlugins(_.plugins);const k=f.configuration.architect.test.options.polyfills&&"string"==typeof f.configuration.architect.test.options.polyfills?q.resolve(q.join(this._workspaceDirPath,f.configuration.architect.test.options.polyfills)):null;var d=(_.entry.polyfills||[]).filter(e=>null==k||k!==e),a=await this._generatePolyfillFile(g,d),o=this._generatesStyleFile(g),x=[];a&&(e.diagnostics.angular.polyfill=a,x.push(a)),e.diagnostics.angular.main=[];for(const O of s)void 0===O.code?x.push(O.path):(e.diagnostics.angular.main.push(O),x.push(O));o&&x.push(o);const S=await this._generatesAssetRoutes(g);S.length&&(v=(e,t)=>{for(const r of S)e.use(r.path.virtual,t.static(r.path.physical))},e.middleware?z.isFunction(e.middleware.override)&&(e.middleware=e.middleware.override(v)):e.middleware=v),H("Creating postprocessor.");var d=r(_,{setupFiles:x}),P=(this._adjustPostprocessor(d.owner,n,b,w,t),e.postprocessor=d,[]),F=[];for(const L of this._generatesScripts(g))P.push({pattern:L,instrument:!1,load:!0});for(const M of g.map(e=>e.configuration)){var C,T=M.sourceRoot||q.join(M.root,"src");M.architect.test.options.polyfills&&"string"==typeof M.architect.test.options.polyfills&&P.push({pattern:V.default.normalizePath(M.architect.test.options.polyfills),ignore:!0}),M.architect.test.options.main&&P.push({pattern:V.default.normalizePath(M.architect.test.options.main),ignore:!0}),M.architect.build&&M.architect.build.options&&(M.architect.build.options.main&&P.push({pattern:V.default.normalizePath(M.architect.build.options.main),ignore:!0}),M.architect.build.options.index)&&(C=M.architect.build.options.index.input||M.architect.build.options.index,P.push({pattern:V.default.normalizePath(C),ignore:!0})),P.push({pattern:V.default.normalizePath(q.join(T,"/test.base.ts")),ignore:!0}),P.push({pattern:V.default.normalizePath(q.join(T,"/test.wallaby.ts")),ignore:!0}),P.push({pattern:V.default.normalizePath(q.join(T,"/**/*.spec.ts")),ignore:!0}),P.push({pattern:V.default.normalizePath(q.join(T,"/**/*.+(ts|js)")),load:!1}),P.push({pattern:V.default.normalizePath(q.join(T,"/**/*.+(css|less|scss|sass|styl|html|json|svg)")),instrument:!1,load:!1}),F.push({pattern:V.default.normalizePath(q.join(T,"/**/*.spec.ts")),load:!1})}e.files?z.isFunction(e.files.override)&&(e.files=e.files.override(P)):e.files=P,e.tests?z.isFunction(e.tests.override)&&(e.tests=e.tests.override(F)):e.tests=F,H("Configured.")}async _generateMainFiles(e){var t="test.wallaby.ts",r=q.join(this._workspaceDirPath,t);if(await U(r))return J("Using physical %s.",t),[{path:r}];if(t="test.workspace.ts",r=q.join(this._workspaceDirPath,t),await U(r))return J("Using physical %s.",t),[{path:r}];var i=/const\s+context\s*=\s*require\s*\.\s*context\s*\(\s*'\.\/'\s*,\s*true\s*,\s*\/\\\.spec\\\.ts\$\/\s*\)\s*;/g,n=/context\s*\.\s*keys\s*\(\s*\)\s*\.map\s*\(\s*context\s*\)\s*;/g,o=/context\s*\.\s*keys\s*\(\s*\)\s*\.forEach\s*\(\s*context\s*\)\s*;/g,a=[];for(const d of e){var l=d.configuration.architect.test.options,c=d.configuration.sourceRoot||q.join(d.configuration.root,"src");let e=l.main?V.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,l.main))):void 0,t=e?await h(e,"utf-8"):void 0;var u=e?q.extname(e):".ts",p=e?q.posix.basename(e,u):"test";let r=V.default.normalizePath(q.resolve(q.join(e?q.dirname(e):q.join(this._workspaceDirPath,c),p+".wallaby"+u))),s=(await U(r)||(r=null),V.default.normalizePath(q.resolve(q.join(e?q.dirname(e):q.join(this._workspaceDirPath,c),p+".base"+u))));await U(s)||(s=null),t=r?(J("Using physical %s.",r),await h(r,"utf-8")):void 0!==t&&(this._isNoSpecMainFileAllowed||t.match(i)&&(t.match(n)||t.match(o)))?(J("Using virtual %s.",e),t.replace(i,"").replace(n,"").replace(o,"")):s?(J("Using physical %s.",s),await h(s,"utf-8")):(e=l.main?V.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,l.main))):V.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,c,p+this._getMainFileExtension()))),J("Using builtin %s.",e),`
              ${"library"===d.configuration.projectType?this._getZoneImportStatement():""}
              ${this._getZoneTestingImportStatement()}  
              import { getTestBed } from '@angular/core/testing';
      
              import {
                BrowserDynamicTestingModule,
                platformBrowserDynamicTesting
              } from '@angular/platform-browser-dynamic/testing'; 
          
              ${this._getTestEnvironmentInitStatement()}
              `),a.push({path:e,code:0<a.length?this._deduplicateMainFileContent(t):t})}return a}_readTsconfig(t){try{return this._ts.parseConfigFileTextToJson(t,B.readFileSync(t).toString()).config}catch(e){return N(t)}}async _generateTsConfigFile(e,t){let r=q.resolve(q.join(this._workspaceDirPath,"tsconfig.base.json"));if(await U(r)||(r=q.resolve(q.join(this._workspaceDirPath,"tsconfig.json"))),!await U(r))throw new Error(r+" file does not exist.");var s=this._readTsconfig(r),i=(s.compilerOptions=s.compilerOptions||{},s.compilerOptions.paths=s.compilerOptions.paths||{},s.compilerOptions.types=s.compilerOptions.types||[],[]),n=[],o=[],a=s.compilerOptions.paths,l=new Set;for(const f of e){var c=a[f.name],u=a[f.name+"/*"];if((c||u)&&f.configuration.architect.build&&f.configuration.architect.build.options&&f.configuration.architect.build.options.project){var p=q.resolve(q.join(this._workspaceDirPath,f.configuration.architect.build.options.project));if(await U(p)){var d=N(p);if(d.dest&&d.lib&&d.lib.entryFile){const m=V.default.normalizePath(q.relative(this._workspaceDirPath,q.resolve(q.join(q.dirname(p),d.dest))));c&&c.find(e=>e.includes(m))&&(c.splice(0,c.length),c.push(q.posix.join(f.configuration.root,d.lib.entryFile))),u&&u.find(e=>e.includes(m))&&(u.splice(0,u.length),p=f.configuration.sourceRoot||q.join(f.configuration.root,"src"),u.push(q.posix.join(p,"*")))}}}var c=q.resolve(q.join(this._workspaceDirPath,f.configuration.architect.test.options.tsConfig)),h=q.dirname(c);if(await U(c)){d=this._readTsconfig(c);if(d.compilerOptions&&d.compilerOptions.types)for(const _ of d.compilerOptions.types)l.add(_);if(d.files)for(var g of d.files)q.isAbsolute(g)||(g=V.default.normalizePath(q.join(q.relative(this._workspaceDirPath,h),g))),i.push(g);if(d.include)for(const v of d.include)n.push(V.default.normalizePath(q.join(q.relative(this._workspaceDirPath,h),v)));if(d.exclude)for(const y of d.exclude)o.push(V.default.normalizePath(q.join(q.relative(this._workspaceDirPath,h),y)))}}i.length&&(s.files=[]);for(const b of i)s.files.push(b);t&&s.files.push(t);e=q.join(this._workspaceDirPath,"polyfills.wallaby.ts");(await U(e)||(e=q.join(this._workspaceDirPath,"polyfills.workspace.ts"),await U(e)))&&s.files.push(e),n.length&&(s.include=[]);for(const w of n)s.include.push(w);o.length&&(s.exclude=[]);for(const k of o)s.exclude.push(k);l.size&&(s.compilerOptions.types=[]);for(const x of l)s.compilerOptions.types.push(x);return JSON.stringify(s)}async _generatePolyfillFile(e,t){var r,s=q.join(this._workspaceDirPath,"polyfills.wallaby.ts"),i=[];for(r of t)i.push(`require('${V.default.normalizePath(r)}');`);if(await U(s))i.push(`require('${V.default.normalizePath(s)}');`);else if(s=q.join(this._workspaceDirPath,"polyfills.workspace.ts"),await U(s))i.push(`require('${V.default.normalizePath(s)}');`);else{const a=new Set;t.forEach(e=>a.add(e));for(const l of e)if(l.configuration.architect.test.options.polyfills)if("string"==typeof l.configuration.architect.test.options.polyfills){H("Setting up polyfills for %s.",l.name);var n,o=q.resolve(q.join(this._workspaceDirPath,l.configuration.architect.test.options.polyfills));await U(o)&&(n=await h(o,"utf-8"),a.has(n)||(a.add(n),i.push(`require('${V.default.normalizePath(o)}');`)))}else if(Array.isArray(l.configuration.architect.test.options.polyfills))for(const c of l.configuration.architect.test.options.polyfills)"string"!=typeof c||a.has(c)||(H("Setting up polyfill %s from %s.",c,l.name),a.add(c),i.push(`require('${c}');`))}return i.length?{path:q.join(this._workspaceDirPath,"wallaby-polyfills.js"),code:""+i.join(u.EOL)+this._getExtraPolyfills()}:null}_generatesStyleFile(e){var t=[];for(const n of e){var r,s=n.configuration.architect.test.options.styles;if(s){H("Setting up styles for %s.",n.name);for(var i of s){let e=!0;"string"!=typeof i&&(e=void 0===i.inject||i.inject,e=void 0===i.bundleName&&e,i=i.input),e&&(r=V.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,i))),B.existsSync(r)?t.push(`require('${this._wrapStyleImport(r)}');`):(r=V.default.normalizePath(q.resolve(o([this._workspaceDirPath,"node_modules",i]))),B.existsSync(r)?t.push(`require('${this._wrapStyleImport(r)}');`):t.push(`require('${this._wrapStyleImport(i)}');`)))}}}return t.length?{path:q.join(this._workspaceDirPath,"wallaby-styles.js"),code:t.join(u.EOL)}:null}async _generatesAssetRoutes(e){var t=[];for(const p of e){var r,s,i,n=new Set,o=p.configuration.architect.test.options.assets;if(o&&o.length){H("Setting up assets for %s.",p.name);for(var a of o)"string"==typeof a?(s=V.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,a))),await U(s)&&(r=""+q.posix.sep+q.basename(s),n.has(i=r+s)||(t.push({path:{virtual:r,physical:s}}),n.add(i)))):a&&a.input&&a.output&&(r=V.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,a.input))),s=a.output.startsWith(q.posix.sep)?a.output:""+q.posix.sep+a.output,n.has(i=""+s+r)||(t.push({path:{virtual:s,physical:r}}),n.add(i)))}var l,c,o=p.configuration.architect.test.options.scripts;if(o&&o.length){H("Setting up non-injectable scripts for %s.",p.name);for(var u of o)"string"!=typeof u&&!u.inject&&u.bundleName&&u.input&&(l=V.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,u.input))),u=""+q.posix.sep+u.bundleName+".js",n.has(c=u+l)||(t.push({path:{virtual:u,physical:l}}),n.add(c)))}}return t}_generatesScripts(e){var t=new Set,r=[];for(const o of e){var s,i=o.configuration.architect.test.options.scripts;if(i&&i.length){H("Setting up scripts for %s.",o.name);for(var n of i){let e=!0;"string"!=typeof n&&(e=void 0===n.inject||n.inject,e=void 0===n.bundleName&&e,n=n.input),n&&((s=V.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,n)))).startsWith(this._workspaceDirPath)?e&&(n=V.default.normalizePath(q.relative(this._workspaceDirPath,s)),t.has(n)||(r.push(n),t.add(n))):console.warn(`Angular CLI automatic configuration: the script ${n} is outside of the workspace, Wallaby.js ignores such files at the moment. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues.`))}}}return r}_fixStyleRules(t,r){if(H("Sanitizing style rules."),r.module&&r.module.rules){var s=r.module.rules;for(const v of z.flatten(s.filter(e=>e.use).map(e=>e.use)))"string"!=typeof v&&v.options&&(this._checkCssLoader(v.loader,"less-loader")||this._checkCssLoader(v.loader,"postcss-loader")||this._checkCssLoader(v.loader,"resolve-url-loader"))&&(v.options.sourceMap=!1);var i,n=new Map;for(let e=0;e<s.length;e++){var o,a=s[e];a.use&&a.use.length&&"string"!=typeof(o=a.use[a.use.length-1])&&(this._checkCssLoader(o.loader,"sass-loader")||this._checkCssLoader(o.loader,"less-loader")||this._checkCssLoader(o.loader,"stylus-loader")||this._checkCssLoader(o.loader,"postcss-loader"))&&n.set(e,a)}let e=0;for([i]of n)s.splice(i-e,1),e++;var l,c,u,p,d,h=new Map;for([,l]of n){let e={test:l.test,oneOf:[]};h.has(l.test.toString())?e=h.get(l.test.toString()):h.set(l.test.toString(),e);for(const y of t){let r=null;if(y.configuration.architect.test.options){var g=y.configuration.architect.test.options.stylePreprocessorOptions;if(g&&g.includePaths){r=[];for(const k of g.includePaths)r.push(k)}}const b=[],w=(t.filter(e=>e.name!==y.name).forEach(e=>{const t=q.resolve(q.join(this._workspaceDirPath,e.configuration.root));r&&r.length&&r.some(e=>q.resolve(q.join(this._workspaceDirPath,e)).startsWith(t))||b.push(t),(e.configuration.architect.test.options.styles||[]).forEach(e=>b.push(q.resolve(q.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))}),{use:[]});for(const x of l.use)"string"!=typeof x?((c={loader:x.loader,options:this._copyCssLoaderOptions(x)}).options&&(u=r&&r.length?r.map(e=>V.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,e)))):null,this._setCssLoaderOptionsPaths(c,u)),w.use.push(c)):w.use.push(x);g=y.configuration.architect.test.options.styles||[];if(l.include&&l.include.length){if(w.include=[],!g.length)continue;g.forEach(e=>w.include.push(q.resolve(q.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))}else w.exclude=[],g.forEach(e=>w.exclude.push(q.resolve(q.join(this._workspaceDirPath,"string"==typeof e?e:e.input)))),b.forEach(e=>w.exclude.push(e));e.oneOf.push(w)}}for([,p]of n)if((!p.include||!p.include.length)&&h.has(p.test.toString())){var f,m=h.get(p.test.toString()),_={use:[]};for(const S of p.use)"string"!=typeof S?((f={loader:S.loader,options:this._copyCssLoaderOptions(S)}).options&&this._setCssLoaderOptionsPaths(f,void 0),_.use.push(f)):_.use.push(S);m.oneOf.push(_)}for([,d]of h)s.push(d)}}_deduplicateMainFileContent(e){return e.replace(/import\s*'zone\.js\/dist\/zone'\s*;/,"").replace(/import\s*'zone\.js\/dist\/zone-testing'\s*;/,"").replace(/import\s*{\s*getTestBed\s*}\s*from\s*'@angular\/core\/testing'\s*;/,"").replace(/declare\s+const\s+require\s*:\s*any\s*;/,"").replace(/import\s*{\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting,?\s*}\s*from\s*'@angular\/platform-browser-dynamic\/testing'\s*;/,"").replace(/getTestBed\s*\(\s*\)\s*.\s*initTestEnvironment\s*\(\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*\(\s*\)\s*,?\s*\)\s*;/,"")}_checkCssLoader(e,t){return e===t}_copyCssLoaderOptions(e){return e.options?Object.assign({},e.options):void 0}_setCssLoaderOptionsPaths(e,t){(this._checkCssLoader(e.loader,"less-loader")||this._checkCssLoader(e.loader,"stylus-loader"))&&(e.options.paths=t),this._checkCssLoader(e.loader,"sass-loader")&&(e.options.includePaths=t)}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getNonAotConfig:r,getStylesConfig:s,getTestConfig:i,getWorkerConfig:n}=e;return[e(t),s(t),r(t),i(t),n(t)]}_getExtraPolyfills(){return""}_adjustPostprocessor(e,a,s,i,n){const l=e._prepareCompiler.bind(e);let c=!1;const u=()=>{var e=n();const t=e.lstat,r=e.readFile;e.readFile=e=>e===s?i:r(e),e.lstat=e=>e===s?{isDirectory:()=>!1}:t(e)};e._prepareCompiler=(e,t,r,s,i)=>{l(e,i);for(const n of i.options.plugins)if(n._compilerHost){if(n._firstRun=!e,e)a&&!c&&(u(),c=!0),t?(n._moduleResolutionCache=this._ts.createModuleResolutionCache(n._basePath,e=>e),n._compilerHost.moduleResolutionCache=n._moduleResolutionCache):r||s.forEach(e=>n._compilerHost.invalidate(e.fullPath));else{i.watchMode=!0,a&&u();const o=n._createOrUpdateProgram.bind(n);n._createOrUpdateProgram=async()=>{await o(),n._program.getSemanticDiagnostics=()=>[]}}break}}}_adjustBuildOptions(e){}_adjustConfiguration(e){}_adjustPlugins(e){}_getZoneImportStatement(){return"import 'zone.js/dist/zone';"}_getZoneTestingImportStatement(){return"import 'zone.js/dist/zone-testing';"}_getTestEnvironmentInitStatement(){return"getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting());"}async _getFileSystemGetter(){return V.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/compiler-cli/src/ngtsc/file_system",!0).module}_getMainFileExtension(){return".ts"}_wrapStyleImport(e){return e}_convertFromNxWorkspaceConfig(){var e=JSON.parse(JSON.stringify(this._workspaceConfig));if(e.projects)for(const r of Object.keys(e.projects)){var t=e.projects[r],t=(delete t.name,t.targets||t.architect);t&&t.test&&(t=t.test.executor||t.test.builder)&&!t.startsWith("@angular")&&delete e.projects[r]}return JSON.stringify(e)}get _isNoSpecMainFileAllowed(){return!1}}},{"../../../../postprocessors/webpack/initialize":54,"../../../../utils":75,"../../../../utils/joinWithLookUp":76,"./modulePatch":29,fs:void 0,lodash:void 0,os:void 0,path:void 0,semver:void 0,util:void 0}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),e("../../../../utils").default.patchModulesCode([{files:["ora/index.js"],replacements:[{from:"stream: process.stderr,",to:"stream: process.stdout,",optional:!0}]}],"Possibly unsupported version of angular"),r.default={}},{"../../../../utils":75}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ProjectConfigurator=void 0;const s=e("path");class i extends e("../v8/ProjectConfigurator").ProjectConfigurator{constructor(e,t,r,s){super(e,t,r,s)}_checkCssLoader(e,t){return 0<=e.indexOf(s.sep+"node_modules"+s.sep+t+s.sep)}}r.ProjectConfigurator=i},{"../v8/ProjectConfigurator":27,path:void 0}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.WorkspaceConfigurator=void 0;const s=e("path");class i extends e("../v8/WorkspaceConfigurator").WorkspaceConfigurator{constructor(e,t,r,s){super(e,t,r,s)}_checkCssLoader(e,t){return 0<=e.indexOf(s.sep+"node_modules"+s.sep+t+s.sep)}_copyCssLoaderOptions(e){var t;if(e.options)return this._checkCssLoader(e.loader,"sass-loader")?((t=Object.assign({},e.options)).sassOptions=Object.assign({},e.options.sassOptions),t):this._checkCssLoader(e.loader,"less-loader")?((t=Object.assign({},e.options)).lessOptions=Object.assign({},e.options.lessOptions),t):Object.assign({},e.options)}_setCssLoaderOptionsPaths(e,t){this._checkCssLoader(e.loader,"sass-loader")&&(e.options.sassOptions.includePaths=t),this._checkCssLoader(e.loader,"less-loader")&&(e.options.lessOptions.paths=t),this._checkCssLoader(e.loader,"stylus-loader")&&(e.options.paths=t)}}r.WorkspaceConfigurator=i},{"../v8/WorkspaceConfigurator":28,path:void 0}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=["tags","implicitDependencies","configFilePath","$schema","generators","nxWorkspace","configFileName","npmScope","affected","tasksRunnerOptions","targetDefaults"];e("../../utils").default.patchModulesCode([{files:["@angular-devkit/core/src/workspace/json/reader.js"],replacements:[{from:"if (formatVersion !== 1) {",to:"if (formatVersion === 0) {",optional:!0},{from:"if (version !== 1) {",to:"if (version === 0) {",optional:!0},{from:"trackChanges: true,",to:"trackChanges: false,"},{from:"targets[name] = value;",to:"if (name === 'test') { value && value.executor && (value.builder = value.executor) && (delete value.executor); }; targets[name] = value;",optional:!0},{from:"targets[name] = value.value;",to:"if (name === 'test') { value.value && value.value.executor && (value.value.builder = value.value.executor) && (delete value.value.executor); }; targets[name] = value.value;",optional:!0},{from:"unprefixedWorkspaceExtensions: new Set([",to:"unprefixedWorkspaceExtensions: new Set([ "+s.reduce((e,t)=>e+`'${t}', `,""),optional:!0},{from:"unprefixedProjectExtensions: new Set([",to:"unprefixedProjectExtensions: new Set([  "+s.reduce((e,t)=>e+`'${t}', `,""),optional:!0}]},{files:["@angular-devkit/build-angular/src/utils/version.js"],replacements:[{from:"function assertCompatibleAngularVersion(projectRoot) {",to:"function assertCompatibleAngularVersion(projectRoot) { return;",optional:!0}]},{files:["@angular/cli/src/command-builder/architect-base-command-module.js"],replacements:[{from:"await this.reportAnalytics({",to:"false && await this.reportAnalytics({",optional:!0},{from:"await this.getAnalytics()",to:"(false && await this.getAnalytics())",optional:!0}]}],"Possibly unsupported version of NX/Angular Workspace"),r.default={}},{"../../utils":75}],33:[function(r,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectConfigurator=void 0;const c=r("../../../utils"),u=r("semver"),s=logger.create("angular/cli jest project config")["trace"];t.ProjectConfigurator=class{constructor(e,t,r,s,i,n){this._currentDirPath=e,this._autoDetectedSettings=t,this._settings=r,this._packageJson=s,this._workspaceDirPath=c.default.normalizePath(i),this._project=n}async getConfigurationOnly(){var e,t,r,s,i,n,o=this._settings,a=o&&!_.isString(o.testFramework||"")&&o.testFramework&&o.testFramework.path||"",o=o&&!_.isString(o.testFramework||"")&&o.testFramework&&o.testFramework.configFile||"",a=await c.default.loadJest(this._currentDirPath,a,o),o={workspace:{root:this._workspaceDirPath,configFile:"angular.json"},target:{project:this._project.name},workspaceRoot:this._workspaceDirPath},l=c.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/commands/test-impl",!1)||c.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/src/commands/test/cli.js",!1);if(l)return e=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-devkit/core/src/logger/null-logger",!0).module["NullLogger"],r=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-builders/jest/dist/index").moduleExports["getRoots"],i=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-builders/jest/dist/jest-configuration-builder").moduleExports["JestConfigurationBuilder"],n=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-builders/jest/dist/default-config.resolver").moduleExports["DefaultConfigResolver"],t=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-builders/jest/dist/custom-config.resolver").moduleExports["CustomConfigResolver"],l=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-builders/jest/package.json"),{workspaceRoot:r,projectRoot:o}=await r(o),s=this._project.configuration.architect.test.options||{},i=await new i(new n(l&&l.module&&l.module.version&&u.gte(l.module.version,"11.2.0")?{tsConfig:s.tsConfig}:s.tsConfig),new t(new e)).buildConfiguration(o,r,s.configPath),(n=await a.jestConfigLoader.module.readConfigs({config:JSON.stringify(i)},[this._currentDirPath])).globalConfig=Object.assign({},n.globalConfig),n.configs=(n.configs||[]).filter(e=>"jest-runner"===e.runner||~c.default.normalizePath(e.runner||"").indexOf("node_modules/jest-runner/")||"jest-runner-groups"===e.runner||~c.default.normalizePath(e.runner||"").indexOf("node_modules/jest-runner-groups/")).map(e=>Object.assign({},e)),n;throw new Error("Could not load Angular CLI package")}async configure(){s("Configuring.");var e=await this.getConfigurationOnly(),t=r("../../jest/configure")["applyJestAutoConfig"];await t(this._currentDirPath,this._settings,this._autoDetectedSettings,this._packageJson,e),this._settings.customJestConfig=e,s("Configured.")}}},{"../../../utils":75,"../../jest/configure":38,semver:void 0}],34:[function(s,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceConfigurator=void 0;const o=s("../../../utils"),i=logger.create("angular/cli jest workspace config")["trace"],n=s("./ProjectConfigurator");t.WorkspaceConfigurator=class{constructor(e,t,r,s,i,n){this._currentDirPath=e,this._autoDetectedSettings=t,this._settings=r,this._packageJson=s,this._workspaceDirPath=o.default.normalizePath(i),this._workspaceConfig=n}async configure(){i("Configuring.");var e=this._settings["angular-cli"];const t=e&&Array.isArray(e.excludedProjects)?new Set(e.excludedProjects):new Set;var e=Object.keys(this._workspaceConfig.projects).map(e=>({name:e,configuration:this._workspaceConfig.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&"@angular-builders/jest:run"===e.configuration.architect.test.builder).filter(e=>!t.has(e.name)),e=await Promise.all(e.map(e=>new n.ProjectConfigurator(this._currentDirPath,this._autoDetectedSettings,this._settings,this._packageJson,this._workspaceDirPath,e).getConfigurationOnly())),e=Object.assign(Object.assign({},e[0]),{configs:e.map(e=>e.configs).reduce((e,t)=>(e.push(...t),e),[])}),r=s("../../jest/configure")["applyJestAutoConfig"];await r(this._currentDirPath,this._settings,this._autoDetectedSettings,this._packageJson,e),this._settings.customJestConfig=e,i("Configured.")}}},{"../../../utils":75,"../../jest/configure":38,"./ProjectConfigurator":33}],35:[function(r,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectConfigurator=void 0,r("./modulePatch");let s,i={};const o=r("../../../utils"),n=logger.create("angular/cli nrwl-jest project config")["trace"];t.ProjectConfigurator=class{constructor(e,t,r,s,i,n){this._currentDirPath=e,this._autoDetectedSettings=t,this._settings=r,this._packageJson=s,this._workspaceDirPath=o.default.normalizePath(i),this._project=n}async getConfigurationOnly(){var e=this._settings,t=e&&!_.isString(e.testFramework||"")&&e.testFramework&&e.testFramework.path||"",e=e&&!_.isString(e.testFramework||"")&&e.testFramework&&e.testFramework.configFile||"",r=this._currentDirPath+`|${t}|`+e,t=(i[r]||(i[r]=await o.default.loadJest(this._currentDirPath,t,e)),i[r]),e={root:this._workspaceDirPath,workspace:{root:this._workspaceDirPath,configFile:"angular.json"},target:{project:this._project.name},workspaceRoot:this._workspaceDirPath},r=(s=s||(s=(s=(s=o.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@nx/jest/src/executors/jest/jest.impl",!1))||o.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@nrwl/jest/src/executors/jest/jest.impl",!1))||o.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@nrwl/jest/src/builders/jest/jest.impl",!0)).module,this._project.configuration.architect&&this._project.configuration.architect.test.options||{}),r=await s(r,e),e=await t.jestConfigLoader.module.readConfigs(r.config,[r.options.jestConfig]);return e.globalConfig=Object.assign({},e.globalConfig),e.configs=(e.configs||[]).filter(e=>"jest-runner"===e.runner||~o.default.normalizePath(e.runner||"").indexOf("node_modules/jest-runner/")||"jest-runner-groups"===e.runner||~o.default.normalizePath(e.runner||"").indexOf("node_modules/jest-runner-groups/")).map(e=>Object.assign({},e)),e}async configure(){n("Configuring.");var e=await this.getConfigurationOnly(),t=r("../../jest/configure")["applyJestAutoConfig"];await t(this._currentDirPath,this._settings,this._autoDetectedSettings,this._packageJson,e),this._settings.customJestConfig=e,n("Configured.")}}},{"../../../utils":75,"../../jest/configure":38,"./modulePatch":37}],36:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceConfigurator=void 0,o("./modulePatch");const a=o("../../../utils"),l=logger.create("angular/cli nrwl-jest workspace config")["trace"],c=o("./ProjectConfigurator");t.WorkspaceConfigurator=class{constructor(e,t,r,s,i,n){this._currentDirPath=e,this._autoDetectedSettings=t,this._settings=r,this._packageJson=s,this._workspaceDirPath=a.default.normalizePath(i),this._workspaceConfig=n}async configure(){l("Configuring.");var e=this._settings["angular-cli"];const t=e&&Array.isArray(e.excludedProjects)?new Set(e.excludedProjects):new Set;var r=Object.keys(this._workspaceConfig.projects).map(e=>({name:e,configuration:this._workspaceConfig.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&("@nrwl/jest:jest"===e.configuration.architect.test.builder||"@nx/jest:jest"===e.configuration.architect.test.builder)).filter(e=>!t.has(e.name)),s=[];for(let e=0;e<r.length;e++){var i=r[e],i=await new c.ProjectConfigurator(this._currentDirPath,this._autoDetectedSettings,this._settings,this._packageJson,this._workspaceDirPath,i).getConfigurationOnly();s.push(i)}var e=Object.assign(Object.assign({},s[0]),{configs:s.map(e=>e.configs).reduce((e,t)=>(e.push(...t),e),[])}),n=o("../../jest/configure")["applyJestAutoConfig"];await n(this._currentDirPath,this._settings,this._autoDetectedSettings,this._packageJson,e),this._settings.customJestConfig=e,l("Configured.")}}},{"../../../utils":75,"../../jest/configure":38,"./ProjectConfigurator":35,"./modulePatch":37}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});e=e("../../../utils");e.default.patchModulesCode([{files:["@nrwl/jest/src/builders/jest/jest.impl.js"],replacements:[{from:"exports.default = architect_1.createBuilder(run);",to:""},{from:"function run(options, context) {",to:"exports.default = (options, context) => {"},{from:"if (options.testFile)",to:"return { config, options };\nif (options.testFile)"}]}],"Possibly incompatible/unsupported Nrwl version"),e.default.patchModulesCode([{files:["@nrwl/jest/src/executors/jest/jest.impl.js"],replacements:[{from:"exports.default = jestExecutor;",to:"exports.default = jestConfigParser;"},{from:"if (options.testFile)",to:"return { config, options };\nif (options.testFile)"}]}],"Possibly incompatible/unsupported Nrwl version"),e.default.patchModulesCode([{files:["@nx/jest/src/executors/jest/jest.impl.js"],replacements:[{from:"exports.default = jestExecutor;",to:"exports.default = jestConfigParser;"},{from:"if (options.testFile)",to:"return { config, options };\nif (options.testFile)"}]}],"Possibly incompatible/unsupported Nx version"),r.default={}},{"../../../utils":75}],38:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.applyJestAutoConfig=r.configure=void 0,e("./modulePatch");const g=e("path"),{debug:f,trace:m}=logger.create("jest/config"),v=e("../../utils");async function i(e,r,t,s,i){m("Detecting Jest.");var n=r&&!_.isString(r.testFramework||"")&&r.testFramework&&r.testFramework.path||"",o=r&&!_.isString(r.testFramework||"")&&r.testFramework&&r.testFramework.configFile||"",n=await v.default.loadJest(e,n,o);n.jestCLI.path;i=i||n.jestConfig,r.diagnostics.jest={config:i},f("Detected Jest.");const a=v.default.escapePathForRegex(g.sep+"node_modules"+g.sep),l=[v.default.escapePathForRegex("."+g.sep+"dist"+g.sep),v.default.escapePathForRegex("."+g.sep+"build"+g.sep),v.default.escapePathForRegex("."+g.sep+"coverage"+g.sep),v.default.escapePathForRegex("."+g.sep+"git"+g.sep),v.default.escapePathForRegex(g.sep)+"\\..+"+v.default.escapePathForRegex(g.sep)];s&&s.dependencies&&s.dependencies["react-native"]&&(l.push(v.default.escapePathForRegex("android"+g.sep)),l.push(v.default.escapePathForRegex("ios"+g.sep)));o=[a,l.join("|")];const c=i.wallaby={roots:[],watchPathIgnorePatterns:o,testPathIgnorePatterns:o,testMatch:[],testRegex:[]},u=1<(i.configs||[]).length,p=e,d=v.default.normalizePath(p),h=(e,n,o,a,l)=>{const c=[];return _.each(e,e=>{e=e&&e.normalize();r=e,i=a;let t=(s=o)&&~r.indexOf(d)?r.split(d+"/").join("").split(d).join(""):!s&&~r.indexOf(p)?i?r.split(p).join(v.default.escapePathForRegex(".")):r.split(p+g.sep).join("").split(p).join(""):~r.indexOf(v.default.replacePathSepForRegex(p))?r.split(v.default.replacePathSepForRegex(p)).join(i?v.default.escapePathForRegex("."):""):r;var r,s,i;t&&!~n.indexOf(t)&&(t===e&&l&&(t=l+t),n.push(t),c.push(t))}),c};if(r.filesWithCoverageCalculated=[],_.each(i.configs,e=>{var t=`(${h(e.roots,c.roots,!1).map(e=>v.default.escapePathForRegex(v.default.platformDependentPath(e))).join("|")}.*)`;e.cacheDirectory&&h([e.cacheDirectory],c.watchPathIgnorePatterns,!1,!0,u&&t||void 0),c.roots.length&&(c.roots=c.roots.map(e=>v.default.normalizePath(e))),h(e.watchPathIgnorePatterns,c.watchPathIgnorePatterns,!1,!0,u&&t||void 0),h(e.testPathIgnorePatterns.concat(e.modulePathIgnorePatterns||[]),c.testPathIgnorePatterns,!1,!0,u&&t||void 0),h(e.testMatch,c.testMatch,!0,!1,void 0),h(e.testRegex,c.testRegex,!1,!0,u&&t||void 0),e.collectCoverageFrom&&(r.filesWithCoverageCalculated=r.filesWithCoverageCalculated.concat(e.collectCoverageFrom)),e.coveragePathIgnorePatterns&&(r.filesWithNoCoverageCalculated=(r.filesWithNoCoverageCalculated||[]).concat(e.coveragePathIgnorePatterns.filter(t=>t!==a&&!l.find(e=>e===t)).map(e=>new RegExp(e)))),r.globalSetup=r.globalSetup||!!e.globalSetup||!!e.globalTeardown}),(i.globalConfig||{}).collectCoverageFrom&&(r.filesWithCoverageCalculated=r.filesWithCoverageCalculated.concat((i.globalConfig||{}).collectCoverageFrom)),(i.globalConfig||{}).coverageDirectory&&h([(i.globalConfig||{}).coverageDirectory],c.watchPathIgnorePatterns,!1,!0,void 0),(i.globalConfig||{}).coveragePathIgnorePatterns&&(r.filesWithNoCoverageCalculated=(r.filesWithNoCoverageCalculated||[]).concat((i.globalConfig||{}).coveragePathIgnorePatterns.filter(t=>t!==a&&!l.find(e=>e===t)).map(e=>new RegExp(e)))),r.filesWithCoverageCalculated=r.filesWithCoverageCalculated.map(e=>e.replace("<rootDir>/","")),!c.testMatch.length&&!c.testRegex.length)throw new Error("Can not autodetect test patterns, neither Jest testMatch nor testRegex is set.");_.isObject(r.testFramework)||(r.testFramework={}),r.testFramework.type="jest",r.testFramework.originalConfig=i,r.testFramework.autoDetected=!0,r.dot=!0,t.hard.noCompilers=!0,t.hard.env={type:"node"},f("Configured Jest.")}r.applyJestAutoConfig=i,r.configure=async function(e,t,r,s){try{return await i(e,r,t,s,void 0),{success:!0,errors:[]}}catch(e){return f(e),{success:!1,errors:[new Error("Automatic Jest configuration error: "+e.message)]}}}},{"../../utils":75,"./modulePatch":39,path:void 0}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),e("../../utils").default.patchModulesCode([{files:["react-app-rewired/scripts/test.js"],replacements:[{from:"require(`${scriptVersion}/scripts/test`);",to:"module.exports = require('../overrides/jest')();",optional:!0},{from:"if (paths.customScriptsIndex > -1) {",to:"module.exports = config; return; if (paths.customScriptsIndex > -1) {",optional:!0}]},{files:["jest-util/build/tryRealpath.js"],replacements:[{from:"path = _gracefulFs().realpathSync.native(path);",to:`const newPath = _gracefulFs().realpathSync.native(path);
        path = (process.platform === 'win32' && path.substr(0, 1).toLowerCase() !== newPath.substr(0, 1).toLowerCase()) ? path : newPath;`}]},{files:["jest-config/build/readConfigFileAndSetRootDir.js"],replacements:[{from:"const tsNode = await import('ts-node');",to:"const tsNode = require('ts-node');",optional:!0}]}]),r.default={}},{"../../utils":75}],40:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.configure=void 0;const R=e("path"),I=e("url"),O=e("fs"),L=e("child_process"),M=e("semver"),{debug:D,trace:$}=logger.create("vitest/config"),A=e("../../utils").default["tryRequireModuleWithPathFrom"],N=e("./extract");r.configure=async function(t,r,s){var i,n,o,a,l;try{$("Detecting Vitest.");var c=s&&!_.isString(s.testFramework||"")&&s.testFramework&&s.testFramework.configFile||"",u=(t.endsWith(R.sep)&&(t=t.slice(0,-1)),s&&!_.isString(s.testFramework||"")&&s.testFramework&&s.testFramework.configFile||"");if(s.diagnostics.vitest={},u){var p=(0,R.join)(t,u);if(!(0,O.existsSync)(p))throw new Error(`Configuration file "${p} not found.`);s.diagnostics.vitest.file={config:(0,O.readFileSync)(p).toString()}}else{var d=["vitest.workspace.ts","vitest.workspace.js","vitest.workspace.json","vitest.projects.ts","vitest.projects.js","vitest.projects.json","vitest.config.ts","vitest.config.js","vitest.config.mjs","vite.config.ts","vite.config.js","vite.config.mjs"],h=(c&&d.unshift(c),d.find(e=>(0,O.existsSync)((0,R.join)(t,e))));h&&(s.diagnostics.vitest.file={config:(0,O.readFileSync)((0,R.join)(t,h)).toString()})}var g=A(t,"vitest/package.json",!1);if(!g)throw new Error("Vitest dependency not found.");if(D(`Detected Vitest (${g.module.version}).`),!(M.gte(process.versions.node,"17.0.0")||M.gte(process.versions.node,"16.12.0")&&M.lt(process.versions.node,"17.0.0")||M.gte(process.versions.node,"14.999.999")&&M.lt(process.versions.node,"15.0.0")||M.gte(process.versions.node,"12.999.999")&&M.lt(process.versions.node,"13.0.0")))throw new Error("Wallaby Vitest integration requires Node.js 16.12.0 or higher.");var f=(0,I.pathToFileURL)((0,R.join)((0,R.dirname)(process.mainModule.filename),"runners/node/hooks.mjs")),m="--experimental-loader",v=[],y=((M.gte(process.version,"19.0.0")&&M.lt(process.version,"20.0.0")||M.lt(process.version,"20.0.0")&&M.lt(process.version,"18.19.0")||M.gte(process.version,"20.0.0")&&M.lt(process.version,"20.6.0"))&&v.push(m+"="+f),v.push(process.mainModule.filename,"extractor","vitest"),v.push(JSON.stringify({moduleFolderPath:(0,R.dirname)(g.path),moduleVersion:g.module.version,hooksFileUrl:f,configFile:c})),s.env&&s.env.runner?s.env.runner:process.execPath),b=JSON.parse(JSON.stringify(process.env));if(process.env.WALLABY_PNP){let e="";-1===(e=b.NODE_OPTIONS?b.NODE_OPTIONS:e).indexOf("--require")&&(e=e+(e?" ":"")+process.env.WALLABY_PNP),b.NODE_OPTIONS=e}o=y,a=v,l={env:b};var w=await new Promise((t,r)=>{var e=(0,L.spawn)(o,a,l);let s="",i="";e.stdout.on("data",e=>{s+=e.toString()}),e.stderr.on("data",e=>{i+=e.toString()}),e.on("close",e=>{t({code:e,stdout:s,stderr:i})}),e.on("error",e=>{r(e)})}),k="Unable to extract Vitest configuration.";if(0!==w.code)throw w.stderr?new Error(w.stderr):new Error(k);if(!w.stdout)throw new Error(k);let e;var x=w.stdout.toString();try{e=JSON.parse(x.split(N.wallabyMarker)[1]);const j=e=>e.map(e=>e.startsWith(t)?e.slice(t.length+1):e),E=e=>{e.include&&(e.include=j(e.include)),e.exclude&&(e.exclude=j(e.exclude))};E(e.config),e.projects&&e.projects.forEach(t=>{t.config.root&&(t.config.include=t.config.include.map(e=>(0,R.join)(t.config.root,e)),t.config.exclude=t.config.exclude.map(e=>(0,R.join)(t.config.root,e))),E(t.config)})}catch(e){throw D("Failed to parse configuration\n%s\n%s",e.toString(),x),new Error(k)}if(null!=(n=null==(i=null===e||void 0===e?void 0:e.config)?void 0:i.browser)&&n.enabled)throw new Error("Vitest browser mode is not supported, see https://github.com/wallabyjs/public/issues/3282 for updates.");s.diagnostics.vitest.config=e,_.isObject(s.testFramework)||(s.testFramework={}),s.preserveComments=!1,s.extractComments=!0,s.testFramework.type="vitest",s.testFramework.autoDetected=!0,(M.gte(process.version,"19.0.0")&&M.lt(process.version,"20.0.0")||M.lt(process.version,"20.0.0")&&M.lt(process.version,"18.19.0")||M.gte(process.version,"20.0.0")&&M.lt(process.version,"20.6.0"))&&s.env&&s.env.params&&(s.env.params.runner?s.env.params.runner.indexOf(m)<0&&(s.env.params.runner+=` ${m}=`+f):s.env.params.runner=m+"="+f),r.hard.noCompilers=!0,r.hard.env={type:"node"},(M.gte(process.version,"19.0.0")&&M.lt(process.version,"20.0.0")||M.lt(process.version,"20.0.0")&&M.lt(process.version,"18.19.0")||M.gte(process.version,"20.0.0")&&M.lt(process.version,"20.6.0"))&&(r.hard.env.params={runner:m+"="+f});var S=[...new Set([...e.config.include,...e.projects?e.projects.map(e=>e.config.include).flat():[]])],P=[...new Set([...e.config.exclude,...e.projects?e.projects.map(e=>e.config.exclude).flat():[]])],F=[...new Set([...Array.isArray(e.config.globalSetup)?e.config.globalSetup:e.config.globalSetup?[e.config.globalSetup]:[],...e.projects?e.projects.map(e=>[...Array.isArray(e.config.globalSetup)?e.config.globalSetup:e.config.globalSetup?[e.config.globalSetup]:[]]).flat():[]])],C=[...new Set([...S.map(e=>"!"+e),...P.map(e=>"!"+e),...F.map(e=>"!"+e),"**/*.*"])],T=[...new Set([...P.map(e=>"!"+e),...F.map(e=>"!"+e),...S])];return s.files?_.isFunction(s.files.override)&&(s.files=s.files.override(C)):s.files=C,s.tests?_.isFunction(s.tests.override)&&(s.tests=s.tests.override(T)):s.tests=T,s.workers=s.workers||{},s.workers.initial=1,s.workers.regular=1,s.dot=!0,$("Configured Vitest."),{success:!0,errors:[]}}catch(e){return D(e),{success:!1,errors:[new Error("Automatic Vitest configuration error: "+e.message)]}}}},{"../../utils":75,"./extract":41,child_process:void 0,fs:void 0,path:void 0,semver:void 0,url:void 0}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.wallabyMarker=exports.extract=void 0;const path_1=require("path"),url_1=require("url"),semver_1=require("semver"),utils_1=require("../../utils"),{findFirstFileMatchingContentInDirectory}=utils_1.default,minSupportedVersion="0.14.0",wallabyMarker="####-WALLABY-MARKER-####";async function extract(moduleFolderPath,moduleVersion,hooksFileUrl,configFile){if(!(0,semver_1.valid)(moduleVersion)||(0,semver_1.lt)(moduleVersion,minSupportedVersion))throw new Error(`Only Vitest v${minSupportedVersion} or higher is supported.`);const{registerHook,patchFile}=await eval(_ad9‍.c(`import('${hooksFileUrl}')`)),moduleDistFolderPath=(await registerHook(),(0,path_1.join)(moduleFolderPath,"dist")),entryFilePath=findFirstFileMatchingContentInDirectory(moduleDistFolderPath,"const ctx = await createVitest(options, viteOverrides);")||findFirstFileMatchingContentInDirectory(moduleDistFolderPath,"const ctx = await createVitest(mode, options, viteOverrides);")||findFirstFileMatchingContentInDirectory(moduleDistFolderPath,"const ctx = await createVitest(mode, options, viteOverrides, vitestOptions);"),{startVitest}=(patchFile(entryFilePath,[{key:"createVitest",from:"const ctx = await createVitest(options, viteOverrides);",to:"const ctx = await createVitest(options, viteOverrides); await ctx.close(); return ctx;"},{key:"createVitest",from:"const ctx = await createVitest(mode, options, viteOverrides);",to:"const ctx = await createVitest(mode, options, viteOverrides); await ctx.close(); return ctx;"},{key:"createVitest",from:"const ctx = await createVitest(mode, options, viteOverrides, vitestOptions);",to:"const ctx = await createVitest(mode, options, viteOverrides, vitestOptions); await ctx.close(); return ctx;"},{from:"async function startVitest",to:"export async function startVitest"}]),await eval(_ad9‍.c(`import('${(0,url_1.pathToFileURL)(entryFilePath)}')`)));try{const options={},ctx=(configFile&&(options.config=configFile),await startVitest([],{},options)),projects=[];if(ctx.projects)for(const project of ctx.projects){const{config,path}=project;projects.push({path:path.toString(),config:config})}const configuration={config:ctx.config,projects:projects,package:{version:moduleVersion,urls:{hooks:hooksFileUrl},paths:{root:moduleFolderPath,dist:moduleDistFolderPath}}};return wallabyMarker+JSON.stringify(configuration)+wallabyMarker}catch(e){throw console.error("Error extracting vitest configuration"),console.error(`Please contact Wallaby support and provide the contents of this file '${entryFilePath}'`),e}}exports.wallabyMarker=wallabyMarker,exports.extract=extract},{"../../utils":75,path:void 0,semver:void 0,url:void 0}],42:[function(e,t,r){function f(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}f.prototype.diff_main=function(e,t,r,s){var i,n,o,s=s=void 0===s?this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout:s;if(null==e||null==t)throw new Error("Null input. (diff_main)");return e==t?e?[[0,e]]:[]:(r=r=void 0===r||r,o=this.diff_commonPrefix(e,t),i=e.substring(0,o),e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t),n=e.substring(e.length-o),e=e.substring(0,e.length-o),t=t.substring(0,t.length-o),o=this.diff_compute_(e,t,r,s),i&&o.unshift([0,i]),n&&o.push([0,n]),this.diff_cleanupMerge(o),o)},f.prototype.diff_compute_=function(e,t,r,s){var i,n,o,a,l;return e?t?(a=e.length>t.length?e:t,i=e.length>t.length?t:e,-1!=(o=a.indexOf(i))?(a=[[1,a.substring(0,o)],[0,i],[1,a.substring(o+i.length)]],e.length>t.length&&(a[0][0]=a[2][0]=-1),a):1==i.length?[[-1,e],[1,t]]:(o=this.diff_halfMatch_(e,t))?(a=o[0],i=o[1],l=o[2],n=o[3],o=o[4],a=this.diff_main(a,l,r,s),l=this.diff_main(i,n,r,s),a.concat([[0,o]],l)):r&&100<e.length&&100<t.length?this.diff_lineMode_(e,t,s):this.diff_bisect_(e,t,s)):[[-1,e]]:[[1,t]]},f.prototype.diff_lineMode_=function(e,t,r){e=(u=this.diff_linesToChars_(e,t)).chars1,t=u.chars2;for(var s=u.lineArray,i=this.diff_main(e,t,!1,r),n=(this.diff_charsToLines_(i,s),this.diff_cleanupSemantic(i),i.push([0,""]),0),o=0,a=0,l="",c="";n<i.length;){switch(i[n][0]){case 1:a++,c+=i[n][1];break;case-1:o++,l+=i[n][1];break;case 0:if(1<=o&&1<=a){i.splice(n-o-a,o+a);for(var u,n=n-o-a,p=(u=this.diff_main(l,c,!1,r)).length-1;0<=p;p--)i.splice(n,0,u[p]);n+=u.length}o=a=0,c=l=""}n++}return i.pop(),i},f.prototype.diff_bisect_=function(e,t,r){for(var s=e.length,i=t.length,n=Math.ceil((s+i)/2),o=n,a=2*n,l=new Array(a),c=new Array(a),u=0;u<a;u++)l[u]=-1,c[u]=-1;l[o+1]=0;for(var p=s-i,d=p%2!=(c[o+1]=0),h=0,g=0,f=0,m=0,_=0;_<n&&!((new Date).getTime()>r);_++){for(var v=-_+h;v<=_-g;v+=2){for(var y=o+v,b=(P=v==-_||v!=_&&l[y-1]<l[y+1]?l[y+1]:l[y-1]+1)-v;P<s&&b<i&&e.charAt(P)==t.charAt(b);)P++,b++;if(s<(l[y]=P))g+=2;else if(i<b)h+=2;else if(d){var w=o+p-v;if(0<=w&&w<a&&-1!=c[w])if((x=s-c[w])<=P)return this.diff_bisectSplit_(e,t,P,b,r)}}for(var k=-_+f;k<=_-m;k+=2){for(var x,w=o+k,S=(x=k==-_||k!=_&&c[w-1]<c[w+1]?c[w+1]:c[w-1]+1)-k;x<s&&S<i&&e.charAt(s-x-1)==t.charAt(i-S-1);)x++,S++;if(s<(c[w]=x))m+=2;else if(i<S)f+=2;else if(!d)if(0<=(y=o+p-k)&&y<a&&-1!=l[y]){var P,b=o+(P=l[y])-y;if((x=s-x)<=P)return this.diff_bisectSplit_(e,t,P,b,r)}}}return[[-1,e],[1,t]]},f.prototype.diff_bisectSplit_=function(e,t,r,s,i){var n=e.substring(0,r),o=t.substring(0,s),e=e.substring(r),r=t.substring(s),t=this.diff_main(n,o,!1,i),s=this.diff_main(e,r,!1,i);return t.concat(s)},f.prototype.diff_linesToChars_=function(e,t){var o=[],a=Object.create(null);function r(e){for(var t="",r=0,s=-1,i=o.length;s<e.length-1;){-1==(s=e.indexOf("\n",r))&&(s=e.length-1);var n=e.substring(r,s+1),r=s+1;void 0!==a[n]?t+=String.fromCharCode(a[n]):(t+=String.fromCharCode(i),a[n]=i,o[i++]=n)}return t}return o[0]="",{chars1:r(e),chars2:r(t),lineArray:o}},f.prototype.diff_wordMode=function(e,t){var e=this.diff_linesToWords_(e,t),t=e.chars1,r=e.chars2,e=e.lineArray,t=this.diff_main(t,r,!1);return this.diff_charsToLines_(t,e),t},f.prototype.diff_linesToWords_=function(e,t){var a=[],l=Object.create(null),c=(a[0]="",/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/);function r(e){for(var t="",r=function(e){for(var t=e.split(/(\s+|\b)/),r=0;r<t.length-1;r++)!t[r+1]&&t[r+2]&&c.test(t[r])&&c.test(t[r+2])&&(t[r]+=t[r+2],t.splice(r+1,2),r--);return t}(e),s=a.length,i=0,n=r.length;i<n;i++){var o=r[i];void 0!==l[o]?t+=String.fromCharCode(l[o]):(t+=String.fromCharCode(s),l[o]=s,a[s++]=o)}return t}return{chars1:r(e),chars2:r(t),lineArray:a}},f.prototype.diff_charsToLines_=function(e,t){for(var r=0;r<e.length;r++){for(var s=e[r][1],i=[],n=0;n<s.length;n++)i[n]=t[s.charCodeAt(n)];e[r][1]=i.join("")}},f.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var r=0,s=Math.min(e.length,t.length),i=s,n=0;r<i;)e.substring(n,i)==t.substring(n,i)?n=r=i:s=i,i=Math.floor((s-r)/2+r);return i},f.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var r=0,s=Math.min(e.length,t.length),i=s,n=0;r<i;)e.substring(e.length-i,e.length-n)==t.substring(t.length-i,t.length-n)?n=r=i:s=i,i=Math.floor((s-r)/2+r);return i},f.prototype.diff_commonOverlap_=function(e,t){var r=e.length,s=t.length;if(0==r||0==s)return 0;s<r?e=e.substring(r-s):r<s&&(t=t.substring(0,r));var i=Math.min(r,s);if(e==t)return i;for(var n=0,o=1;;){var a=e.substring(i-o),a=t.indexOf(a);if(-1==a)return n;o+=a,0!=a&&e.substring(i-o)!=t.substring(0,o)||(n=o,o++)}},f.prototype.diff_halfMatch_=function(e,t){var d,r,s,i,n,o,a,l;return!(this.Diff_Timeout<=0)&&(i=e.length>t.length?e:t,s=e.length>t.length?t:e,!(i.length<4||2*s.length<i.length))&&(d=this,r=c(i,s,Math.ceil(i.length/4)),s=c(i,s,Math.ceil(i.length/2)),r||s)?(i=!s||r&&r[4].length>s[4].length?r:s,e.length>t.length?(n=i[0],o=i[1],a=i[2],l=i[3]):(a=i[0],l=i[1],n=i[2],o=i[3]),[n,o,a,l,i[4]]):null;function c(e,t,r){for(var s,i,n,o,a=e.substring(r,r+Math.floor(e.length/4)),l=-1,c="";-1!=(l=t.indexOf(a,l+1));){var u=d.diff_commonPrefix(e.substring(r),t.substring(l)),p=d.diff_commonSuffix(e.substring(0,r),t.substring(0,l));c.length<p+u&&(c=t.substring(l-p,l)+t.substring(l,l+u),s=e.substring(0,r-p),i=e.substring(r+u),n=t.substring(0,l-p),o=t.substring(l+u))}return 2*c.length>=e.length?[s,i,n,o,c]:null}},f.prototype.diff_cleanupSemantic=function(e){for(var t,r,s,i,n=!1,o=[],a=0,l=null,c=0,u=0,p=0,d=0,h=0;c<e.length;)0==e[c][0]?(u=d,p=h,h=d=0,l=e[o[a++]=c][1]):(1==e[c][0]?d+=e[c][1].length:h+=e[c][1].length,l&&l.length<=Math.max(u,p)&&l.length<=Math.max(d,h)&&(e.splice(o[a-1],0,[-1,l]),e[o[a-1]+1][0]=1,a--,c=0<--a?o[a-1]:-1,h=d=p=u=0,n=!(l=null))),c++;for(n&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),c=1;c<e.length;)-1==e[c-1][0]&&1==e[c][0]&&(t=e[c-1][1],r=e[c][1],s=this.diff_commonOverlap_(t,r),(i=this.diff_commonOverlap_(r,t))<=s?(s>=t.length/2||s>=r.length/2)&&(e.splice(c,0,[0,r.substring(0,s)]),e[c-1][1]=t.substring(0,t.length-s),e[c+1][1]=r.substring(s),c++):(i>=t.length/2||i>=r.length/2)&&(e.splice(c,0,[0,t.substring(0,i)]),e[c-1][0]=1,e[c-1][1]=r.substring(0,r.length-i),e[c+1][0]=-1,e[c+1][1]=t.substring(i),c++),c++),c++},f.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){var r,s,i,n,o,a;return e&&t?(o=e.charAt(e.length-1),a=t.charAt(0),r=o.match(f.nonAlphaNumericRegex_),s=a.match(f.nonAlphaNumericRegex_),i=r&&o.match(f.whitespaceRegex_),n=s&&a.match(f.whitespaceRegex_),o=i&&o.match(f.linebreakRegex_),a=n&&a.match(f.linebreakRegex_),e=o&&e.match(f.blanklineEndRegex_),t=a&&t.match(f.blanklineStartRegex_),e||t?5:o||a?4:r&&!i&&n?3:i||n?2:r||s?1:0):6}for(var r=1;r<e.length-1;){if(0==e[r-1][0]&&0==e[r+1][0]){for(var s,i=e[r-1][1],n=e[r][1],o=e[r+1][1],a=this.diff_commonSuffix(i,n),l=(a&&(s=n.substring(n.length-a),i=i.substring(0,i.length-a),n=s+n.substring(0,n.length-a),o=s+o),i),c=n,u=o,p=t(i,n)+t(n,o);n.charAt(0)===o.charAt(0);){i+=n.charAt(0),n=n.substring(1)+o.charAt(0),o=o.substring(1);var d=t(i,n)+t(n,o);p<=d&&(p=d,l=i,c=n,u=o)}e[r-1][1]!=l&&(l?e[r-1][1]=l:(e.splice(r-1,1),r--),e[r][1]=c,u?e[r+1][1]=u:(e.splice(r+1,1),r--))}r++}},f.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,f.whitespaceRegex_=/\s/,f.linebreakRegex_=/[\r\n]/,f.blanklineEndRegex_=/\n\r?\n$/,f.blanklineStartRegex_=/^\r?\n\r?\n/,f.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,r=[],s=0,i=null,n=0,o=!1,a=!1,l=!1,c=!1;n<e.length;)0==e[n][0]?(i=e[n][1].length<this.Diff_EditCost&&(l||c)?(o=l,a=c,e[r[s++]=n][1]):(s=0,null),l=c=!1):(-1==e[n][0]?c=!0:l=!0,i&&(o&&a&&l&&c||i.length<this.Diff_EditCost/2&&o+a+l+c==3)&&(e.splice(r[s-1],0,[-1,i]),e[r[s-1]+1][0]=1,s--,o&&a?(l=c=!0,s=0):(n=0<--s?r[s-1]:-1,l=c=!1),t=!(i=null))),n++;t&&this.diff_cleanupMerge(e)},f.prototype.diff_cleanupMerge=function(e){e.push([0,""]);for(var t,r=0,s=0,i=0,n="",o="";r<e.length;)switch(e[r][0]){case 1:i++,o+=e[r][1],r++;break;case-1:s++,n+=e[r][1],r++;break;case 0:1<s+i?(0!==s&&0!==i&&(0!==(t=this.diff_commonPrefix(o,n))&&(0<r-s-i&&0==e[r-s-i-1][0]?e[r-s-i-1][1]+=o.substring(0,t):(e.splice(0,0,[0,o.substring(0,t)]),r++),o=o.substring(t),n=n.substring(t)),0!==(t=this.diff_commonSuffix(o,n)))&&(e[r][1]=o.substring(o.length-t)+e[r][1],o=o.substring(0,o.length-t),n=n.substring(0,n.length-t)),0===s?e.splice(r-i,s+i,[1,o]):0===i?e.splice(r-s,s+i,[-1,n]):e.splice(r-s-i,s+i,[-1,n],[1,o]),r=r-s-i+(s?1:0)+(i?1:0)+1):0!==r&&0==e[r-1][0]?(e[r-1][1]+=e[r][1],e.splice(r,1)):r++,s=i=0,o=n=""}""===e[e.length-1][1]&&e.pop();for(var a=!1,r=1;r<e.length-1;)0==e[r-1][0]&&0==e[r+1][0]&&(e[r][1].substring(e[r][1].length-e[r-1][1].length)==e[r-1][1]?(e[r][1]=e[r-1][1]+e[r][1].substring(0,e[r][1].length-e[r-1][1].length),e[r+1][1]=e[r-1][1]+e[r+1][1],e.splice(r-1,1),a=!0):e[r][1].substring(0,e[r+1][1].length)==e[r+1][1]&&(e[r-1][1]+=e[r+1][1],e[r][1]=e[r][1].substring(e[r+1][1].length)+e[r+1][1],e.splice(r+1,1),a=!0)),r++;a&&this.diff_cleanupMerge(e)},f.prototype.diff_xIndex=function(e,t){for(var r=0,s=0,i=0,n=0,o=0;o<e.length&&(1!==e[o][0]&&(r+=e[o][1].length),-1!==e[o][0]&&(s+=e[o][1].length),!(t<r));o++)i=r,n=s;return e.length!=o&&-1===e[o][0]?n:n+(t-i)},f.prototype.diff_prettyHtml=function(e){for(var t=[],r=/&/g,s=/</g,i=/>/g,n=/\n/g,o=0;o<e.length;o++){var a=e[o][0],l=e[o][1].replace(r,"&amp;").replace(s,"&lt;").replace(i,"&gt;").replace(n,"&para;<br>");switch(a){case 1:t[o]='<ins style="background:#e6ffe6;">'+l+"</ins>";break;case-1:t[o]='<del style="background:#ffe6e6;">'+l+"</del>";break;case 0:t[o]="<span>"+l+"</span>"}}return t.join("")},f.prototype.diff_prettyCompactHtml=function(e){for(var t=[],r=0;r<e.length;r++){var s=0===r,i=r===e.length-1,n=e[r][0],o=e[r][1];switch(n){case 1:t[r]='<ins style="background:#e6ffe6;">'+this.prepare_text_(o)+"</ins>";break;case-1:t[r]='<del style="background:#ffe6e6;">'+this.prepare_text_(o)+"</del>";break;case 0:t[r]="<span>"+this.truncate_context_(o,s,i)+"</span>"}}return t.join("")},f.prototype.prepare_text_=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&para;<br>")},f.prototype.truncate_context_=function(e,t,r){var s=e.split(/\r\n|\r|\n/),i='<span class="dots">...</span>',n=s.length;return n<=4||!t&&!r&&n<=8?this.prepare_text_(e):t?i+this.prepare_text_("\n"+s.slice(-4).join("\n")):r?this.prepare_text_(s.slice(0,4).join("\n")+"\n")+i:this.prepare_text_(s.slice(0,4).join("\n")+"\n")+i+this.prepare_text_("\n"+s.slice(-4).join("\n"))},f.prototype.diff_text1=function(e){for(var t=[],r=0;r<e.length;r++)1!==e[r][0]&&(t[r]=e[r][1]);return t.join("")},f.prototype.diff_text2=function(e){for(var t=[],r=0;r<e.length;r++)-1!==e[r][0]&&(t[r]=e[r][1]);return t.join("")},f.prototype.diff_levenshtein=function(e){for(var t=0,r=0,s=0,i=0;i<e.length;i++){var n=e[i][0],o=e[i][1];switch(n){case 1:r+=o.length;break;case-1:s+=o.length;break;case 0:t+=Math.max(r,s),s=r=0}}return t+=Math.max(r,s)},f.prototype.diff_toDelta=function(e){for(var t=[],r=0;r<e.length;r++)switch(e[r][0]){case 1:t[r]="+"+encodeURI(e[r][1]);break;case-1:t[r]="-"+e[r][1].length;break;case 0:t[r]="="+e[r][1].length}return t.join("\t").replace(/%20/g," ")},f.prototype.diff_fromDelta=function(e,t){for(var r=[],s=0,i=0,n=t.split(/\t/g),o=0;o<n.length;o++){var a=n[o].substring(1);switch(n[o].charAt(0)){case"+":try{r[s++]=[1,decodeURI(a)]}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var l=parseInt(a,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+a);l=e.substring(i,i+=l);"="==n[o].charAt(0)?r[s++]=[0,l]:r[s++]=[-1,l];break;default:if(n[o])throw new Error("Invalid diff operation in diff_fromDelta: "+n[o])}}if(i!=e.length)throw new Error("Delta length ("+i+") does not equal source text length ("+e.length+").");return r},f.prototype.match_main=function(e,t,r){if(null==e||null==t||null==r)throw new Error("Null input. (match_main)");return r=Math.max(0,Math.min(r,e.length)),e==t?0:e.length?e.substring(r,r+t.length)==t?r:this.match_bitap_(e,t,r):-1},f.prototype.match_bitap_=function(e,r,s){if(r.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var t=this.match_alphabet_(r),i=this;function n(e,t){e/=r.length,t=Math.abs(s-t);return i.Match_Distance?e+t/i.Match_Distance:t?1:e}for(var o,a,l,c=this.Match_Threshold,u=(-1!=(p=e.indexOf(r,s))&&(c=Math.min(n(0,p),c),-1!=(p=e.lastIndexOf(r,s+r.length)))&&(c=Math.min(n(0,p),c)),1<<r.length-1),p=-1,d=r.length+e.length,h=0;h<r.length;h++){for(o=0,a=d;o<a;)n(h,s+a)<=c?o=a:d=a,a=Math.floor((d-o)/2+o);var d=a,g=Math.max(1,s-a+1),f=Math.min(s+a,e.length)+r.length,m=Array(f+2);m[f+1]=(1<<h)-1;for(var _=f;g<=_;_--){var v=t[e.charAt(_-1)];if(m[_]=0===h?(m[_+1]<<1|1)&v:(m[_+1]<<1|1)&v|(l[_+1]|l[_])<<1|1|l[_+1],m[_]&u){v=n(h,_-1);if(v<=c){if(c=v,!(s<(p=_-1)))break;g=Math.max(1,2*s-p)}}}if(n(h+1,s)>c)break;l=m}return p},f.prototype.match_alphabet_=function(e){for(var t={},r=0;r<e.length;r++)t[e.charAt(r)]=0;for(r=0;r<e.length;r++)t[e.charAt(r)]|=1<<e.length-r-1;return t},f.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var r=t.substring(e.start2,e.start2+e.length1),s=0;t.indexOf(r)!=t.lastIndexOf(r)&&r.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)s+=this.Patch_Margin,r=t.substring(e.start2-s,e.start2+e.length1+s);s+=this.Patch_Margin;var i=t.substring(e.start2-s,e.start2),n=(i&&e.diffs.unshift([0,i]),t.substring(e.start2+e.length1,e.start2+e.length1+s));n&&e.diffs.push([0,n]),e.start1-=i.length,e.start2-=i.length,e.length1+=i.length+n.length,e.length2+=i.length+n.length}},f.prototype.patch_make=function(e,t,r){var s,i;if("string"==typeof e&&"string"==typeof t&&void 0===r)2<(i=this.diff_main(s=e,t,!0)).length&&(this.diff_cleanupSemantic(i),this.diff_cleanupEfficiency(i));else if(e&&"object"==typeof e&&void 0===t&&void 0===r)s=this.diff_text1(i=e);else if("string"==typeof e&&t&&"object"==typeof t&&void 0===r)s=e,i=t;else{if("string"!=typeof e||"string"!=typeof t||!r||"object"!=typeof r)throw new Error("Unknown call format to patch_make.");s=e,i=r}if(0===i.length)return[];for(var n=[],o=new f.patch_obj,a=0,l=0,c=0,u=s,p=s,d=0;d<i.length;d++){var h=i[d][0],g=i[d][1];switch(a||0===h||(o.start1=l,o.start2=c),h){case 1:o.diffs[a++]=i[d],o.length2+=g.length,p=p.substring(0,c)+g+p.substring(c);break;case-1:o.length1+=g.length,o.diffs[a++]=i[d],p=p.substring(0,c)+p.substring(c+g.length);break;case 0:g.length<=2*this.Patch_Margin&&a&&i.length!=d+1?(o.diffs[a++]=i[d],o.length1+=g.length,o.length2+=g.length):g.length>=2*this.Patch_Margin&&a&&(this.patch_addContext_(o,u),n.push(o),o=new f.patch_obj,a=0,u=p,l=c)}1!==h&&(l+=g.length),-1!==h&&(c+=g.length)}return a&&(this.patch_addContext_(o,u),n.push(o)),n},f.prototype.patch_deepCopy=function(e){for(var t=[],r=0;r<e.length;r++){var s=e[r],i=new f.patch_obj;i.diffs=[];for(var n=0;n<s.diffs.length;n++)i.diffs[n]=s.diffs[n].slice();i.start1=s.start1,i.start2=s.start2,i.length1=s.length1,i.length2=s.length2,t[r]=i}return t},f.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);for(var r=this.patch_addPadding(e),s=(t=r+t+r,this.patch_splitMax(e),0),i=[],n=0;n<e.length;n++){var o,a=e[n].start2+s,l=this.diff_text1(e[n].diffs),c=-1;if(l.length>this.Match_MaxBits?-1!=(o=this.match_main(t,l.substring(0,this.Match_MaxBits),a))&&(-1==(c=this.match_main(t,l.substring(l.length-this.Match_MaxBits),a+l.length-this.Match_MaxBits))||c<=o)&&(o=-1):o=this.match_main(t,l,a),-1==o)i[n]=!1,s-=e[n].length2-e[n].length1;else if(i[n]=!0,s=o-a,l==(a=-1==c?t.substring(o,o+l.length):t.substring(o,c+this.Match_MaxBits)))t=t.substring(0,o)+this.diff_text2(e[n].diffs)+t.substring(o+l.length);else{var u=this.diff_main(l,a,!1);if(l.length>this.Match_MaxBits&&this.diff_levenshtein(u)/l.length>this.Patch_DeleteThreshold)i[n]=!1;else{this.diff_cleanupSemanticLossless(u);for(var p,d=0,h=0;h<e[n].diffs.length;h++){var g=e[n].diffs[h];0!==g[0]&&(p=this.diff_xIndex(u,d)),1===g[0]?t=t.substring(0,o+p)+g[1]+t.substring(o+p):-1===g[0]&&(t=t.substring(0,o+p)+t.substring(o+this.diff_xIndex(u,d+g[1].length))),-1!==g[0]&&(d+=g[1].length)}}}}return[t=t.substring(r.length,t.length-r.length),i]},f.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,r="",s=1;s<=t;s++)r+=String.fromCharCode(s);for(s=0;s<e.length;s++)e[s].start1+=t,e[s].start2+=t;var i,n=e[0],o=n.diffs;return 0==o.length||0!=o[0][0]?(o.unshift([0,r]),n.start1-=t,n.start2-=t,n.length1+=t,n.length2+=t):t>o[0][1].length&&(i=t-o[0][1].length,o[0][1]=r.substring(o[0][1].length)+o[0][1],n.start1-=i,n.start2-=i,n.length1+=i,n.length2+=i),0==(o=(n=e[e.length-1]).diffs).length||0!=o[o.length-1][0]?(o.push([0,r]),n.length1+=t,n.length2+=t):t>o[o.length-1][1].length&&(i=t-o[o.length-1][1].length,o[o.length-1][1]+=r.substring(0,i),n.length1+=i,n.length2+=i),r},f.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,r=0;r<e.length;r++)if(!(e[r].length1<=t))for(var s=e[r],i=(e.splice(r--,1),s.start1),n=s.start2,o="";0!==s.diffs.length;){var a=new f.patch_obj,l=!0;for(a.start1=i-o.length,a.start2=n-o.length,""!==o&&(a.length1=a.length2=o.length,a.diffs.push([0,o]));0!==s.diffs.length&&a.length1<t-this.Patch_Margin;){var c=s.diffs[0][0],u=s.diffs[0][1];1===c?(a.length2+=u.length,n+=u.length,a.diffs.push(s.diffs.shift()),l=!1):-1===c&&1==a.diffs.length&&0==a.diffs[0][0]&&u.length>2*t?(a.length1+=u.length,i+=u.length,l=!1,a.diffs.push([c,u]),s.diffs.shift()):(u=u.substring(0,t-a.length1-this.Patch_Margin),a.length1+=u.length,i+=u.length,0===c?(a.length2+=u.length,n+=u.length):l=!1,a.diffs.push([c,u]),u==s.diffs[0][1]?s.diffs.shift():s.diffs[0][1]=s.diffs[0][1].substring(u.length))}var o=(o=this.diff_text2(a.diffs)).substring(o.length-this.Patch_Margin),p=this.diff_text1(s.diffs).substring(0,this.Patch_Margin);""!==p&&(a.length1+=p.length,a.length2+=p.length,0!==a.diffs.length&&0===a.diffs[a.diffs.length-1][0]?a.diffs[a.diffs.length-1][1]+=p:a.diffs.push([0,p])),l||e.splice(++r,0,a)}},f.prototype.patch_toText=function(e){for(var t=[],r=0;r<e.length;r++)t[r]=e[r];return t.join("")},f.prototype.patch_fromText=function(e){var t=[];if(e)for(var r=e.split("\n"),s=0,i=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;s<r.length;){var n=r[s].match(i);if(!n)throw new Error("Invalid patch string: "+r[s]);var o=new f.patch_obj;for(t.push(o),o.start1=parseInt(n[1],10),""===n[2]?(o.start1--,o.length1=1):"0"==n[2]?o.length1=0:(o.start1--,o.length1=parseInt(n[2],10)),o.start2=parseInt(n[3],10),""===n[4]?(o.start2--,o.length2=1):"0"==n[4]?o.length2=0:(o.start2--,o.length2=parseInt(n[4],10)),s++;s<r.length;){var a=r[s].charAt(0);try{var l=decodeURI(r[s].substring(1))}catch(e){throw new Error("Illegal escape in patch_fromText: "+l)}if("-"==a)o.diffs.push([-1,l]);else if("+"==a)o.diffs.push([1,l]);else if(" "==a)o.diffs.push([0,l]);else{if("@"==a)break;if(""!==a)throw new Error('Invalid patch mode "'+a+'" in: '+l)}s++}}return t},(f.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0}).prototype.toString=function(){for(var e,t=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,r=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2,s=["@@ -"+t+" +"+r+" @@\n"],i=0;i<this.diffs.length;i++){switch(this.diffs[i][0]){case 1:e="+";break;case-1:e="-";break;case 0:e=" "}s[i+1]=e+encodeURI(this.diffs[i][1])+"\n"}return s.join("").replace(/%20/g," ")},t.exports=f},{}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Runner=void 0;const o=logger.create("electronRunner")["debug"],i=e("path"),n=e("child_process"),a=e("./runWorkerPool"),l=e("./browserEnvironment");var c=0;r.Runner=class{constructor(e){var s=this;this._project=e,this._screenShotReady=Promise.resolve(!0),this._params=e.settings().env.params,this._runner=e.settings().env.runner,this._envOptions=e.settings().env.options,this._clearMemoryCache=e.settings().env.clearMemoryCache,this._host=void 0,this._callbacks=Object.create(null),this._hostPromise=new Promise(function(t,r){try{var e=_.extend({},process.env,s._params.env?_.reduce(s._params.env.split(";"),function(e,t){t=t.split("=");return e[t[0]]=t[1],e},{}):{});delete e.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete e.ELECTRON_RUN_AS_NODE,e.ELECTRON_DISABLE_SECURITY_WARNINGS="true",s._host=n.fork(i.join(__dirname,"runners","browser","electronHost.js"),[],{execPath:s._runner,env:e,execArgv:s._params.runner?s._params.runner.split(" "):[]}),s._host.on("error",function(e){s._handleHostError(e)}),s._host.on("message",function(e){try{e.id?s._responseWithCorrelationId(e):"ready"===e.type?t(s._host):"error"===e.type&&s._handleHostError(e.error)}catch(e){s._handleHostError(e)}})}catch(e){r(e)}}).catch(function(e){s._handleHostError(e)}),this._workerPool=new a.WorkerPool(this._project,{create:_.bind(s._create,this),recycle:_.bind(s._recycle,this),healthy:()=>!0,prepare:_.bind(s._prepare,this)}),this._browserEnvironment=new l.BrowserEnvironment(e,this._workerPool)}run(e){return this._workerPool.run(e)}_handleHostError(e){this._project._cleanStack(e=e||{});var t="Electron runner error: "+(e.message||"unknown"),e=e.stack||t;console.error(e),this._project._emitTestRunError(t)}_create(e,t){this._hostPromise.then(function(){t({pageId:e})})}_recycle(e){this._host&&this._host.send({type:"closePage",pageId:e.pageId})}_evaluateOnPage(e,t,r){e={type:"evaluateOnPage",pageId:e,action:"("+t.toString()+")()"};this._requestWithCorrelationId(e,r||_.noop)}_openPage(e,t,r,s){this._requestWithCorrelationId({type:"openPage",pageId:e,url:t,options:r},s||_.noop)}_closePage(e){this._host.send({type:"closePage",pageId:e})}_capturePage(e,t){var r=Q.defer();try{this._requestWithCorrelationId({type:"capturePage",file:t,pageId:e},function(){r.resolve()}),this._screenShotReady=r.promise}catch(e){r.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",e.message)}}_prepare(t,r){var s=this,i=_.randomId(),n=s._browserEnvironment.sandboxName(r,i);return o("Starting sandbox [%s]",n),s._workerPool.getWorker(r).then(function(e){return s._workerPool.cancelled()?Promise.reject({runCancelled:!0}):e instanceof Error||e.runCancelled?Promise.reject(e):(o("Preparing sandbox [%s]",n),s._browserEnvironment.prepareSandbox(t,i,r))}).then(function(e){return s._workerPool.cancelled()?Promise.reject({runCancelled:!0}):(o("Prepared sandbox [%s]",n),Promise.resolve({instance:{resume:function(){s._evaluateOnPage(r,function(){$_$tracer.resume()})},ping:function(e){s._evaluateOnPage(r,function(){},e)},close:function(e){s._closePage(r),e(!0)},closing:function(){s._screenShotReady=Promise.resolve(!0)},start:function(t){s._openPage(r,e,s._envOptions,function(e){t(e.status)&&s._evaluateOnPage(r,function(){$_$tracer.start()})})}},name:n,sessionId:i,workerId:r}))})}cancel(e){return this._workerPool.cancel(e)}start(){var t=this;return t._workerPool.start(t._browserEnvironment.webApp()).then(function(e){return t._workerPool.setFileRoot(t._browserEnvironment.sandboxRootUrl()),Promise.resolve(e)})}stop(){var e=this;e._host&&(e._host.send({type:"stop"}),e._host.disconnect(),delete e._callbacks,delete e._host),e._workerPool.stop()}_requestWithCorrelationId(e,t){var r=this,s=++c,t=r._callbacks[s]={done:t};e.id=s,r._host.send(e),t.timeout=setTimeout(function(){delete r._callbacks[s]},12e5)}_responseWithCorrelationId(e){var t=this._callbacks[e.id];delete this._callbacks[e.id],t&&(clearTimeout(t.timeout),t.done(e))}}},{"./browserEnvironment":11,"./runWorkerPool":66,child_process:void 0,path:void 0}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=["January","February","March","April","May","June","July","August","September","October","November","December"];const n="wallabyjs@gmail.com";r.default={wallabyEmail:function(){return n},normalizePath:function(e){return"win32"===process.platform&&e?e.replace(/\\/g,"/"):e},parseKey:function(e){var t={},r=(e&&2===(r=e.split(":")).length&&(e=(r=r[1])&&r.replace(/^\s+|\s+$/gm,"")),Buffer.from(e,"base64").toString().split("\n")),e=(t.licenseeName=r[0],t.licenseTags=r[1],t.licenseTags.split(",")||[]);t.licenseeEmail=e[0],t.licensedProduct=e[1],t.multiUserKey=e[2],t.source=e[3],t.trial="1"===e[5],t.expirationDateString=r[2],t.licenseSignature=r[3],t.freeLicense=t.licenseeEmail===n;try{var s=t.expirationDateString.split("/");t.expirationDateStringFormatted=s[0]+" "+i[parseInt(s[1],10)-1]+" "+s[2]}catch(e){t.expirationDateStringFormatted=t.expirationDateString}return t.expirationTime=e[7]&&parseInt(e[7],10)||new Date(t.expirationDateString+" UTC").getTime(),t},format:function(s,i){return s.replace(/\{([0-9a-zA-Z_]+)\}/g,function(e,t,r){return"{"===s[r-1]&&"}"===s[r+e.length]?t:null==(r=i.hasOwnProperty(t)?i[t]:null)?"":r})},validPackageName:function(e){if(e&&!e.match(/^\./)&&!e.match(/^_/)&&!(214<e.length||e.toLowerCase()!==e||/[~'!()*]/.test(e.split("/").slice(-1)[0]))){if(encodeURIComponent(e)===e)return e;var t=e.match(/^(?:@([^/]+?)[/])?([^/]+?)$/);if(t){var r=t[1],t=t[2];if(encodeURIComponent(r)===r&&encodeURIComponent(t)===t)return e}}},withFreePort:function(t){var r=e("http").createServer();r.listen(0),r.on("listening",function(){var e=r.address().port;r.once("close",function(){t(e)}),r.close()}),process.nextTick(function(){})},checkPort:function(s){const i=e("net"),t=e=>{return new Promise((r=e,t=>{const e=i.createServer().once("error",e=>e&&"EADDRNOTAVAIL"===e.code?t(s):t(0)).once("listening",()=>e.once("close",()=>t(s)).close()).listen(s,r)}));var r};return t("0.0.0.0").then(e=>e?t("127.0.0.1"):0).then(e=>e?t("::1"):0)}}},{http:void 0,net:void 0}],45:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fileCacheMiddleware=void 0;const p=e("path"),s=e("parseurl"),i=e("mime"),n=e("graceful-fs"),o=new Map,d=(e,t,r)=>{e.set({"Cache-Control":"public, max-age=86400",Expires:new Date(Date.now()+864e5).toUTCString()}),e.type(i.lookup(r,"text/plain")),e.status(200).end(t)};r.fileCacheMiddleware={create:(t,c)=>{const u=logger.create("middleware")["trace"],r=t.main.cache||o;return t.main.read=t.main.read||n.readFile,t.alt&&(t.alt.cache||(t.alt.cache={get:()=>{},set:()=>{},del:()=>{}}),t.alt.read=t.alt.read||n.readFile),(e,i)=>{let n=decodeURI(s(e).pathname),o=("/"===n&&(n=""),t.main.root),a=(u("Preparing to serve %s",n||o),p.normalize(p.join(o,n)));e=r.get(a);if(_.isString(e)||e instanceof Buffer)u("Serving %s from cache",n||o),d(i,e,a);else{const l=(e,t,r,s)=>{r?e?(o=e.root,u("Serving %s from disk (alt. location)",n||o),a=p.normalize(p.join(o,n)),e.read(a,l.bind(null,void 0,e.cache))):(u("Error when reading file %s, %s",a,r&&r.message||"unknown"),c&&console.error("Trying to access missing resource or API: "+n),i.status(404).end()):(t.set(a,s),d(i,s,a))};u("Serving %s from disk",n||o),t.main.read(a,l.bind(null,t.alt,r))}}}}},{"graceful-fs":void 0,mime:void 0,parseurl:void 0,path:void 0}],46:[function(e,t,r){global._=e("lodash"),global.Q=e("q"),global.EventEmitter=e("events").EventEmitter,Q.longStackSupport=!1,global.Promise||(global.Promise=Q.Promise),_.extend(_,e("./utils").default),_.str=e("underscore.string"),_.mixin(_.str.exports()),global.logger=global.logger||e("./logger"),_["_"+["u7","rp","tm","jx","c6"].join("")]=["u7","rp","tm","jx","c6"].join("")},{"./logger":48,"./utils":75,events:void 0,lodash:void 0,q:void 0,"underscore.string":void 0}],47:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t("acorn");const i=["AssignmentExpression","AssignmentPattern","ArrayExpression","ArrayPattern","ArrowFunctionExpression","AwaitExpression","BlockStatement","BinaryExpression","BreakStatement","CallExpression","CatchClause","ClassBody","ClassDeclaration","ClassExpression","ComprehensionBlock","ComprehensionExpression","ConditionalExpression","ContinueStatement","DoWhileStatement","DebuggerStatement","EmptyStatement","ExportBatchSpecifier","ExportDeclaration","ExportSpecifier","ExportNamedDeclaration","ExportDefaultDeclaration","ExportAllDeclaration","ExpressionStatement","FieldDefinition","ForOfStatement","ForStatement","ForInStatement","FunctionDeclaration","FunctionExpression","GeneratorExpression","Identifier","IfStatement","ImportBatchSpecifier","ImportDeclaration","ImportSpecifier","Literal","LabeledStatement","LogicalExpression","MemberExpression","MethodDefinition","ModuleDeclaration","NewExpression","ObjectExpression","ObjectPattern","Program","Property","ReturnStatement","SequenceExpression","SpreadElement","SwitchStatement","SwitchCase","Super","TaggedTemplateExpression","TemplateElement","TemplateLiteral","ThisExpression","ThrowStatement","TryStatement","UnaryExpression","UpdateExpression","VariableDeclaration","VariableDeclarator","WhileStatement","WithStatement","YieldExpression","JSXIdentifier","JSXNamespacedName","JSXMemberExpression","JSXElement","JSXOpeningElement","JSXClosingElement","JSXEmptyExpression","JSXExpressionContainer","JSXSpreadAttribute","JSXAttribute"],a=s.Parser.extend(t("./acornTolerancePlugin"),t("./acornTopLevelAwaitPlugin"),t("./acornLogicalAssignment"),t("./acornImportMetaPlugin"),t("./acornImportAssertionsPlugin"),t("./acornNumericSeparatorPlugin.js"),t("acorn-jsx")());var l=t("escodegen-wallaby"),c="Babel.objectSpread";function n(e){var t;return 0===e.indexOf("__REGEXP ")?(t=e.split("__REGEXP ")[1].match(/\/(.*)\/(.*)?/),new RegExp(t[1],t[2]||"")):e}class o{constructor(e){var a=this;if(this._autoLogHints={},this._loggedRanges={},this._liveCommentLines={},this._ignoreCoverageHints=[],this._ignoreCoverageHints.lastHintPosition=-1,this._ignoreFileCoverage=!1,this._captureConsoleLog=e.captureConsoleLog,this._logMarkers=e.recordValues?e.logMarkers:void 0,this._extractedComments=e.extractedComments,this._outstandingLogpointCount=0,this._extractedComments&&this._extractedComments.isCoverageIgnored&&(this._ignoreFileCoverage=!0),e.hints&&(this._extractedComments||this._ignoreFileCoverage||(e.hints.ignoreCoverage&&(this._ignoreCoverageRegExp=n(e.hints.ignoreCoverage)),e.hints.ignoreCoverageForFile&&(this._ignoreFileCoverageRegExp=n(e.hints.ignoreCoverageForFile))),e.recordValues&&e.hints.commentAutoLog&&(_.isString(e.hints.commentAutoLog)?this._autoLogHintExpPrefix=e.hints.commentAutoLog:(this._autoLogHintExpPrefix=e.hints.commentAutoLog.value,this._autoLogHintGlobalExp=e.hints.commentAutoLog.exp)),e.hints.logpointsNotAvailableExpression&&(this._logpointsNotAvailableExpression=e.hints.logpointsNotAvailableExpression),e.hints.testFileSelection)&&(e.hints.testFileSelection.include&&(this._includeTestFileRegExp=n(e.hints.testFileSelection.include)),e.hints.testFileSelection.exclude)&&(this._excludeTestFileRegExp=n(e.hints.testFileSelection.exclude)),this._opts=_.defaults(e||{},{}),this._opts.recordValues||(this._wrapExpressionStatementExpressionIntoVisitor=function(e){return e}),this._opts.test){let t=this._opts.testFileChangeStart;this._logMarkers&&(e=this._logMarkers.find(e=>e.new&&e.range))&&(t={line:e.range[0],column:e.range[1]}),a._containsChangePosition=t&&t.line?function(e){return e&&e.loc.start.line<=t.line&&e.loc.end.line>=t.line&&(t.line>e.loc.start.line||t.column>e.loc.start.column)&&(t.line<e.loc.end.line||t.column<e.loc.end.column)}:function(e){return e&&e.start<a._opts.testFileChangeStart&&e.end>a._opts.testFileChangeStart}}else this._containsChangePosition=function(){return!1};if(a._visitor=this._createVisitor(),a._opts.sequenceExpressionToDiff||(a._replaceSequenceWithDiff=()=>{}),a._opts.automaticTestFileSelection&&a._visitor.CallExpression.add(function(e){e.arguments&&e.arguments[0]&&"Literal"===e.arguments[0].type&&(e.callee&&"Identifier"===e.callee.type&&"fit"===e.callee.name&&2===e.arguments.length&&(a._includedTestFile=!0),e.callee&&"Identifier"===e.callee.type&&"fdescribe"===e.callee.name&&2===e.arguments.length||e.callee&&"MemberExpression"===e.callee.type&&e.callee.property&&"Identifier"===e.callee.property.type&&"only"===e.callee.property.name&&(2===e.arguments.length||3===e.arguments.length))&&(a._includedTestFile=!0)}),a._opts.recordMatchSnapshotRanges&&(a._matchSnapshotRanges=[],a._visitor.CallExpression.add(function(e){e.callee&&"MemberExpression"===e.callee.type&&e.callee.property&&"Identifier"===e.callee.property.type&&("toMatchSnapshot"===e.callee.property.name||"toThrowErrorMatchingSnapshot"===e.callee.property.name)&&(e.callee.object=a._sequence([{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:"_beforeMatchSnapshot"}},arguments:[a._literal(a._opts.file),a._literal(a._matchSnapshotRanges.length)]},e.callee.object]),a._matchSnapshotRanges.push([e.loc.start.line,e.loc.start.column,e.loc.end.line,e.loc.end.column]))})),null!=(e=a._opts.snaps)&&e.enabled){const o=a._opts.vue,l=a._opts.svelte;a._snaps=[],a._snapScopes=new Map,a._lastSnap=void 0,a._visitor.BlockStatement.add(function(e,s){var i=a._lastSnap;if(!(i&&i.body.end>e.start)&&e.body&&1===e.body.length&&Array.isArray(s.parentNode)){i=e.body[0];if("BlockStatement"===i.type&&i.body){var t=!i.body.length;if(t||1<i.body.length||"BlockStatement"!==i.body[0].type){i=a._lastSnap={empty:t,body:e};if(a._snaps.push(i),o){let e=void 0,t=void 0,r=s.parentContext;for(;r;){var n=r.parentNode;if(!n)break;if(e){if("CallExpression"===n.type&&n.callee&&"Identifier"===n.callee.type&&"_defineComponent"===n.callee.name&&n.arguments&&1<=n.arguments.length&&"ObjectExpression"===n.arguments[0].type){t=n;break}}else"Property"===n.type&&n.method&&"init"===n.kind&&"Identifier"===n.key.type&&"setup"===n.key.name&&"FunctionExpression"===n.value.type&&n.value.params&&"BlockStatement"===n.value.body.type&&1<=n.value.params.length&&"__props"===n.value.params[0].name&&(e=n);r=r.parentContext}t&&e&&(i.scope="vue",a._snapScopes.set(i.scope,{source:e.value.body,call:a._vueSfcSetupFuncCall()}))}if(l){let e=void 0,t=s.parentContext;for(;t;){var r=t.parentNode;if(!r)break;if("FunctionDeclaration"===r.type&&r.id&&"Identifier"===r.id.type&&"instance"===r.id.name&&r.params&&3<=r.params.length&&"Identifier"===r.params[0].type&&"$$self"===r.params[0].name&&"Identifier"===r.params[1].type&&"$$props"===r.params[1].name&&"Identifier"===r.params[2].type&&"$$invalidate"===r.params[2].name){e=r;break}t=t.parentContext}e&&(i.scope="svelte",a._snapScopes.set(i.scope,{source:e.body,call:a._svelteInstanceFuncCall()}))}t=s.parentNode.indexOf(e),s=s.parentNode[t+1];if(s&&"ExpressionStatement"===s.type&&s.expression){e="TemplateLiteral"===s.expression.type,t="Literal"===s.expression.type&&"string"==typeof s.expression.value;if(e||t)if(i.output=s.expression,e&&l){e=s.expression.quasis;if(e&&1===e.length){const e=s.expression.quasis[0];e.loc&&e.loc.start&&e.loc.end?i.outputLines=e.loc.end.line-e.loc.start.line+1:i.outputContent=e.value.raw}}else i.outputContent=t?s.expression.value:void 0}}}}}),a._visitor.ExpressionStatement.add(function(e,t){a._lastSnap&&a._lastSnap.output===e.expression&&(t.hinted=!0)})}a._visitor.IfStatement.add(function(e){e.consequent&&"BlockStatement"!==e.consequent.type&&(e.consequent=a._wrapInBlock([e.consequent])),e.alternate&&"BlockStatement"!==e.alternate.type&&"IfStatement"!==e.alternate.type&&(e.alternate=a._wrapInBlock([e.alternate]))}),a._visitor.add([this._visitor.DoWhileStatement,this._visitor.WhileStatement,this._visitor.IfStatement,this._visitor.ForStatement],function(e,t){e.test&&(e.test=a._instructionValueSequence([a._instruction(e.test,t,"TST"),e.test],t,void 0,1)),e.update&&(t=a._wrapIfMarkedForAutoLog(e.update,t))&&(e.update=t)}),a._visitor.add([this._visitor.ForOfStatement,this._visitor.ForInStatement],function(e,t){e.right&&(e.right=a._instructionValueSequence([a._instruction(e.right,t,"FR"),e.right],t))}),a._visitor.SwitchStatement.add(function(e,t){e.discriminant=a._instructionValueSequence([a._instruction(e.discriminant,t,"SWT"),e.discriminant],t)}),a._visitor.SwitchCase.add(function(e){e.consequent&&0<e.consequent.length&&(1!=e.consequent.length||"BlockStatement"!==e.consequent[0].type)&&(e.consequent=[a._wrapInBlock(e.consequent)])}),a._visitor.add([a._visitor.DoWhileStatement,a._visitor.ForInStatement,a._visitor.ForStatement,a._visitor.ForOfStatement,a._visitor.LabeledStatement,a._visitor.WhileStatement,a._visitor.WithStatement],function(e){e.body&&"BlockStatement"!==e.body.type&&("LabeledStatement"!==e.type||"DoWhileStatement"!==e.body.type&&"ForInStatement"!==e.body.type&&"ForStatement"!==e.body.type&&"WhileStatement"!==e.body.type)&&"ForOfStatement"!==e.body.type&&(e.body=a._wrapInBlock([e.body]))}),a._visitor.add([a._visitor.BreakStatement,a._visitor.ContinueStatement,a._visitor.ThrowStatement],function(e,t){t.parentNode&&("ForStatement"===t.parentNode.type||"ForInStatement"===t.parentNode.type||"ForOfStatement"===t.parentNode.type||"ExportDeclaration"===t.parentNode.type)||(e=[a._instructionStatement(e,t,"S"),e],t.replacement=a._wrapInBlock(e))}),a._visitor.VariableDeclaration.add(function(t,r){if((!r.parentNode||"ForStatement"!==r.parentNode.type&&"ForInStatement"!==r.parentNode.type&&"ForOfStatement"!==r.parentNode.type&&"ExportDeclaration"!==r.parentNode.type&&"ExportNamedDeclaration"!==r.parentNode.type)&&t.declarations&&t.declarations.length&&"VariableDeclarator"===t.declarations[0].type){var e,s=t.declarations[0],i=a._instruction(t,r,"S");a._isUndefinedInstruction(i)||(!s.init||"FunctionExpression"!==s.init.type&&"ArrowFunctionExpression"!==s.init.type&&"ClassExpression"!==s.init.type?s.init?(e=a._getNodesToCheckForAutoLogsInVariableDeclaration(t,s),s.init=a._instructionValueSequence([i,s.init],r,e)):"var"===t.kind?s.init={type:"LogicalExpression",operator:"||",left:i,right:{type:"Identifier",name:s.id.name}}:s.init=i:t.declarations.unshift({type:"VariableDeclarator",id:{type:"Identifier",name:"$_$wvd"+a._ranges.length},init:i}));for(let e=1;e<t.declarations.length;e++){var n,o=t.declarations[e];"VariableDeclarator"===o.type&&o.init&&"FunctionExpression"!==o.init.type&&"ArrowFunctionExpression"!==o.init.type&&"ClassExpression"!==o.init.type&&(n=a._getNodesToCheckForAutoLogsInVariableDeclaration(t,o),n=a._wrapIfMarkedForAutoLog(o.init,r,!1,n))&&(o.init=n)}}}),a._visitor.ExpressionStatement.add(function(e,t){a._replaceConsoleLog(e.expression,t);var r=[],s=e.expression;a._replaceSequenceWithDiff(e)&&r.push(s),e._systemJsRegisterCall||(e.expression&&"YieldExpression"===e.expression.type?((s=a._wrapIfMarkedForAutoLog(e.expression.argument,t,void 0,[e.expression,e]))&&(e.expression.argument=s),e.expression=a._sequence([a._instruction(e,t,"S"),e.expression])):((s=t.hinted?e.expression:a._wrapExpressionStatementExpressionIntoVisitor(e.expression,e))===e.expression&&r.push(e),e.expression=a._instructionValueSequence([a._instruction(e,t,"S"),s],t,r)))}),a._visitor.ReturnStatement.add(function(e,t){a._replaceConsoleLog(e.argument,t),e.argument=e.argument?a._instructionValueSequence([a._instruction(e,t,"R"),e.argument],t,[e],-(e.end-e.start-6)):a._instruction(e,t,"R")}),a._visitor.ConditionalExpression.add(function(e,t){a._replaceConsoleLog(e.consequent,t),e.consequent=a._instructionValueSequence([a._instruction(e.consequent,t,"CDC"),e.consequent],t),a._replaceConsoleLog(e.alternate,t),e.alternate=a._instructionValueSequence([a._instruction(e.alternate,t,"CDA"),e.alternate],t)}),a._visitor.LogicalExpression.add(function(e,t){e.left=a._instructionValueSequence([a._instruction(e.left,t,"LGL"),e.left],t),e.right=a._instructionValueSequence([a._instruction(e.right,t,"LGR"),e.right],t)}),a._visitor.Program.add(function(e,t){_.isEmpty(a._autoLogHints)&&(a._visitor.removeVisitorsAddedForAutoLogHintsOnly(),a._getFunctionParameterLogInstructions=()=>[],a._getNodesToCheckForAutoLogsInVariableDeclaration=()=>[]),e.body=e.body||[];var r=e.body[0],s=1===e.body.length&&a._isSystemJsModule(r),i=a._scopeStartVariableDeclaration("P",[a._delayedLiteral(()=>a._totalRanges)]);a._needsToStayFirst(r)?e.body.splice(0,1,a._firstNode(r),i):s&&s.length?(r._systemJsRegisterCall=!0,e.body.splice(1,0,i,a._instructionStatement(e.body[0],t,"S"))):e.body.unshift(i),e.body.push(a._instructionStatement(e,t,"PE"))}),a._visitor.add([a._visitor.FunctionDeclaration,a._visitor.FunctionExpression,a._visitor.ArrowFunctionExpression],function(e,t){e.id&&e.id.name&&("_getJestObj"!==e.id.name&&"_interopRequireDefault"!==e.id.name||(t.hinted=!0)),a._numberOfFunctions++,a._tryFindTestName(e,t),"ArrowFunctionExpression"===e.type&&e.expression&&(e.body=a._wrapInBlock([a._return(a._instructionValueSequence([a._instruction(e.body,t,"R"),e.body],t))]),e.expression=!1);var r=a._scopeStartVariableDeclaration("F"),s=a._getFunctionParameterLogInstructions(e,t),i=e.body.body[0],n=a._needsToStayFirst(i),o=a._isSuperCall(i);n?(e.body.body.splice(0,1,a._firstNode(i),r),e.body.body.splice(2,0,...s)):o?a._handleSuperCall(e.body.body,t,r,s):e.body.body.unshift(r,...s)}),a._visitor.ImportBatchSpecifier.add(function(e){e.type="ImportNamespaceSpecifier",e.id=e.name,delete e.name}),a._visitor.ImportSpecifier.add(function(e){e.default&&(e.type="ImportDefaultSpecifier")}),a._visitor.AssignmentPattern.add(function(e){"="===e.operator&&(e.type="AssignmentExpression")}),a._visitor.add([a._visitor.ExportNamedDeclaration,a._visitor.ExportDefaultDeclaration,a._visitor.ExportAllDeclaration,a._visitor.ImportDeclaration],function(){a._esm=!0}),a._visitor.CatchClause.addForAutoLogOnly(function(e,t){var r;e.body&&e.body.body&&e.param&&"Identifier"===e.param.type&&(r=a._getAutoLogHint(e)||a._getAutoLogHint(e.param))&&e.param.name&&e.body.body.unshift({type:"ExpressionStatement",expression:a._generateUndefinedAutoLogNode(e.param,t,r)})}),a._visitor.ObjectPattern.addForAutoLogOnly(function(e,t){e.properties.forEach(e=>{e.ignore=!0})}),a._visitor.Property.addForAutoLogOnly(function(e,t){var r;!e.ignore&&e.value&&"ObjectPattern"!==t.parentNode.type&&!e.method&&(r=[],!e.computed&&e.key&&"Identifier"===e.key.type&&r.push(e.key),t=a._wrapIfMarkedForAutoLog(e.value,t,!1,r))&&(e.shorthand=!1,e.value=t)}),a._visitor.WithStatement.addForAutoLogOnly(function(e,t){e.object&&(t=a._wrapIfMarkedForAutoLog(e.object,t,!1))&&(e.object=t)}),a._visitor.SpreadElement.addForAutoLogOnly(function(e,t){e.argument&&(t=a._wrapIfMarkedForAutoLog(e.argument,t,!1,[e]))&&(e.argument=t)}),["ForInStatement","ForOfStatement"].forEach(e=>{a._visitor[e].addForAutoLogOnly(function(e,t){var r;e.body&&"BlockStatement"===e.body.type&&e.left&&("Identifier"===e.left.type?(r=a._getAutoLogHint(e)||a._getAutoLogHint(e.left))&&e.body.body.unshift(a._generateUndefinedAutoLogNode(e.left,t,r,!0)):"VariableDeclaration"===e.left.type&&1===e.left.declarations.length&&(r=a._getAutoLogHint(e)||a._getAutoLogHint(e.left)||a._getAutoLogHint(e.left.declarations[0]))&&e.body.body.unshift(a._generateUndefinedAutoLogNode(e.left.declarations[0].id,t,r,!0)))})}),a._visitor.ThrowStatement.addForAutoLogOnly(function(e,t){e.argument&&(t=a._wrapIfMarkedForAutoLog(e.argument,t,!1,[e]))&&(e.argument=t)}),a._visitor.MemberExpression.addForAutoLogOnly(function(e,t){var r;e.object&&(r=a._wrapIfMarkedForAutoLog(e.object,t))&&(e.object=r),e.property&&(e.computed?(r=a._wrapIfMarkedForAutoLog(e.property,t))&&(e.property=r):t.parentNode&&(a._isInstrumented(e,t)||"AssignmentExpression"===t.parentNode.type&&t.parentNode.left===e||"CallExpression"===t.parentNode.type&&t.parentNode.callee===e||"NewExpression"===t.parentNode.type&&t.parentNode.callee===e||"UpdateExpression"===t.parentNode.type&&t.parentNode.argument===e||"UnaryExpression"===t.parentNode.type&&t.parentNode.argument===e&&"delete"===t.parentNode.operator)||(r=a._wrapIfMarkedForAutoLog(e,t,!1,[e.property]))&&(t.replacement=r))}),a._visitor.BinaryExpression.addForAutoLogOnly(function(e,t){var r;e.left&&(r=a._wrapIfMarkedForAutoLog(e.left,t))&&(e.left=r),e.right&&(r=a._wrapIfMarkedForAutoLog(e.right,t))&&(e.right=r)}),a._visitor.CallExpression.addForAutoLogOnly(function(e,t){if(e.arguments&&e.arguments.length)for(var r,s=0,i=e.arguments.length;s<i;s++)"SpreadElement"!==e.arguments[s].type&&(r=a._wrapIfMarkedForAutoLog(e.arguments[s],t))&&(e.arguments[s]=r);var n;e.callee&&!a._isInstrumented(e,t)&&(n=[e.callee],"MemberExpression"===e.callee.type&&e.callee.property&&n.push(e.callee.property),n=a._wrapIfMarkedForAutoLog(e,t,!1,n))&&(t.replacement=n)}),a._visitor.NewExpression.addForAutoLogOnly(function(e,t){if(e.arguments&&e.arguments.length)for(var r,s=0,i=e.arguments.length;s<i;s++)"SpreadElement"!==e.arguments[s].type&&(r=a._wrapIfMarkedForAutoLog(e.arguments[s],t))&&(e.arguments[s]=r)}),a._visitor.ArrayExpression.addForAutoLogOnly(function(e,t){if(e.elements&&e.elements.length)for(var r=0,s=e.elements.length;r<s;r++){var i=e.elements[r];i&&"SpreadElement"!==i.type&&(i=a._wrapIfMarkedForAutoLog(i,t))&&(e.elements[r]=i)}}),a._visitor.TemplateLiteral.addForAutoLogOnly(function(e,t){if(e.expressions&&e.expressions.length)for(var r=0,s=e.expressions.length;r<s;r++){var i=a._wrapIfMarkedForAutoLog(e.expressions[r],t);i&&(e.expressions[r]=i)}}),a._visitor.AwaitExpression.addForAutoLogOnly(function(e,t){e.argument&&(t=a._wrapIfMarkedForAutoLog(e.argument,t))&&(e.argument=t)}),a._visitor.SequenceExpression.addForAutoLogOnly(function(e,t){if(e.expressions&&e.expressions.length)for(var r=0,s=e.expressions.length;r<s;r++){var i=e.expressions[r],i=a._wrapIfMarkedForAutoLog(i,t);i&&(e.expressions[r]=i)}}),a._visitor.ConditionalExpression.addForAutoLogOnly(function(e,t){e.test&&(t=a._wrapIfMarkedForAutoLog(e.test,t))&&(e.test=t)}),a._visitor.AssignmentExpression.addForAutoLogOnly(function(e,t){var r;e.right&&("="!==e.operator?!a._getAutoLogHint(e.right)&&((r=[]).push(e.left),"MemberExpression"===e.left.type&&e.left.property&&r.push(e.left.property),r=a._wrapIfMarkedForAutoLog(e,t,!1,r))&&(t.replacement=r):(r=[e.left],"MemberExpression"===e.left.type&&e.left.property?r.push(e.left.property):"ArrayPattern"!==e.left.type&&"ObjectPattern"!==e.left.type||r.push(...a._findAllChildIdentifiersExceptComputedPropertyKeys(e.left)),(t=a._wrapIfMarkedForAutoLog(e.right,t,!1,r))&&(e.right=t)))}),a._visitor.UnaryExpression.addForAutoLogOnly(function(e,t){e.argument&&"delete"!==e.operator&&(t=a._wrapIfMarkedForAutoLog(e.argument,t))&&(e.argument=t)})}instrument(e){var t=this,r=(t._ranges=[],t._code=e,t._numberOfFunctions=0,t._totalRanges=0,t._logMarkerRangeMap={},t._parse(e)),e=(t._postInitializeIgnoreCoverageHints(),t._postInitializeAutoLogHints(e,r),t._change(r,t._visitor));let s;this._snaps&&this._snaps.length?s=this._processSnaps(e):this._appendComponentInstantiation(e);r=t._generate(e);return delete t._code,{code:r.code,map:r.map.toString(),ranges:t._ranges,numberOfFunctions:t._numberOfFunctions,testName:t._testName,esm:t._esm,includedTestFile:t._includedTestFile,excludedTestFile:t._excludedTestFile,matchSnapshotRanges:t._matchSnapshotRanges,loggedRanges:t._loggedRanges,notInstrumentedLogMarkers:t._logMarkers&&t._logMarkers.filter(e=>!e.instrumented),liveCommentLines:!_.isEmpty(t._liveCommentLines)&&t._liveCommentLines||void 0,logpointInfo:{overlappingLogpointsPresent:0!==t._outstandingLogpointCount},snaps:s,logMarkerRangeMap:t._logMarkerRangeMap}}_nodeEndsBeforeSelectionStart(e,t,r){return e.loc.end.line<t||e.loc.end.line===t&&e.loc.end.column<r}_findBestMatchingAutoLogNode(e,t,r,s,i,n){if(("File"===e.type||"Program"===e.type)&&t.loc.start.line===r)return t;var o=this._nodeEndsBeforeSelectionStart(e,r,s),r=this._nodeEndsBeforeSelectionStart(t,r,s);if(o&&!r)return t;if(r&&!o)return e;if(e.loc.start.column<=s&&t.loc.start.column>s)return e;if(t.loc.start.column<=s&&e.loc.start.column>s)return t;if(t.loc.start.column<=s&&e.loc.start.column<=s){if(e.loc.start.column>t.loc.start.column)return e;if(t.loc.start.column>e.loc.start.column)return t}else{if(e.loc.start.column<t.loc.start.column)return e;if(t.loc.start.column<e.loc.start.column)return t}r=n-1;return(e.loc.end.line>i||e.loc.end.line===i&&e.loc.end.column>=r)&&(t.loc.end.line<i||t.loc.end.line===i&&t.loc.end.column<r)?e:(t.loc.end.line>i||t.loc.end.line===i&&t.loc.end.column>=r)&&(e.loc.end.line<i||e.loc.end.line===i&&e.loc.end.column<r)?t:(e.loc.end.line>i||e.loc.end.line===i&&e.loc.end.column>=r)&&(t.loc.end.line>i||t.loc.end.line===i&&t.loc.end.column>=r)?e.loc.end.line<t.loc.end.line||e.loc.end.line===t.loc.end.line&&e.loc.end.column<t.loc.end.column?e:t:e.loc.end.line<t.loc.end.line||e.loc.end.line===t.loc.end.line&&e.loc.end.column<t.loc.end.column?t:e}_postInitializeIgnoreCoverageHints(){if(this._extractedComments&&this._extractedComments.ignoreComments)for(const e of this._extractedComments.ignoreComments)this._ignoreCoverageHints.push(e.index);this._ignoreCoverageHints.length||(this._nextHint=()=>{})}_postInitializeAutoLogHints(e,t){var r;const p=this;if(p._opts.recordValues){if(p._extractedComments&&p._extractedComments.liveComments)for(const a of p._extractedComments.liveComments)p._handleLiveComment(a.index,a.exp,e);if(p._logMarkers&&p._logMarkers.length){let u=-1;const d=new Map;for(const c of p._logMarkers){var s=c.range;s&&(s=s[0],u=Math.max(u,s),null!=(r=d.get(s))&&r.push(c)||d.set(s,[c]))}const l=this._getVisitor(),h=(l.ChainExpression=function(e,t,r){r(e.expression,t,"Expression")},new Set(["ClassDeclaration","ClassExpression","FunctionDeclaration","FunctionExpression","ArrowFunctionExpression"])),g=new Map;!function e(c,t,r){var s,r=r||c.type;c.loc.start.line<=u&&((s=d.get(c.loc.start.line))&&!t.has(c)&&(t.add(c),s.forEach(e=>{if(e.range){var[,t,r,s]=e.range;if(c.loc.start.column<=s||c.loc.start.line!==r||c.loc.end.line>c.loc.start.line||c.loc.end.line===c.loc.start.line&&c.loc.end.column>=t)if(e.logpoint&&!e.inlineLogpoint&&!e.synthetic&&h.has(c.type)){var i,n=c.loc.start.line+1,o=c.loc.end.line,a=e.changeId;for(let e=n;e<=o;e++){var l={range:[e,0,e,1/0],changeId:a,expanded:!1,new:!0,action:"show",logpoint:!0,synthetic:!0};null!=(i=d.get(e))&&i.push(l)||d.set(e,[l])}u=Math.max(u,o)}else"EmptyStatement"!==c.type&&"DebuggerStatement"!==c.type&&"ChainExpression"!==c.type&&((n=g.get(e))?g.set(e,p._findBestMatchingAutoLogNode(n,c,c.loc.start.line,t,r,s)):g.set(e,c))}})),s=l[r])&&s(c,t,e)}(t,new Set);for(const[f,m]of g.entries()){var i="VariableDeclarator"===(i=m).type&&i.init?i.init:"IfStatement"===i.type&&i.test?i.test:"RestElement"===i.type&&i.argument?i.argument:"AssignmentExpression"===i.type&&"="!==i.operator&&i.right?i.left:i,n=(f.logpoint&&this._outstandingLogpointCount++,p._autoLogHints[i.end]),o=null!=n&&n.isLiveComment?n:null==n?void 0:n.liveComment;n&&!o||(p._autoLogHints[i.end]={start:i.start,logMarker:f,liveComment:o},p._logMarkerRangeMap[[i.loc.start.line,i.loc.start.column,i.loc.end.line,i.loc.end.column].join(",")]=f.range.join(","))}}}}_getVisitor(){var e=t("./acornWalkJsxPlugin")(t("acorn-walk").base);return e.MemberExpression=function(e,t,r){r(e.object,t,"Expression"),r(e.property,t,"Expression")},e.MethodDefinition=e.Property=function(e,t,r){e.computed?r(e.key,t,"Expression"):r(e.key,t,"Identifier"),r(e.value,t,"Expression")},e}_findAllChildIdentifiersExceptComputedPropertyKeys(e){var t=[];const i=this._getVisitor();return i.ObjectPattern=function(e,t,r){for(var s=0,i=e.properties;s<i.length;s+=1){var n=i[s];"Property"===n.type?(n.computed||n.method||r(n.key,t,"Identifier"),r(n.value,t,"Pattern")):"RestElement"===n.type&&r(n.argument,t,"Pattern")}},function e(t,r,s){s=s||t.type,"Identifier"===t.type&&r.indexOf(t)<0&&r.push(t),s=i[s];s&&s(t,r,e)}(e,t),t}_getNodesToCheckForAutoLogsInVariableDeclaration(e,t){e=[e];return"VariableDeclarator"===t.type&&t.id&&("Identifier"===t.id.type?e.push(t.id):"ObjectPattern"!==t.id.type&&"ArrayPattern"!==t.id.type||e.push(...this._findAllChildIdentifiersExceptComputedPropertyKeys(t.id))),e}_tryFindTestName(e,t){var r;this._containsChangePosition(e.body)&&t.parentContext&&(this._saveTestNameIfTestFunctionCall(t,e,t.parentNode)||this._tryFindTestNameFromWrappedFunction(e,t)||t.parentContext.parentContext&&(r=t.parentNode,!_.isArray(r)||r[0]!==e&&r[1]!==e||(e=(r=t.parentContext).parentNode)&&"CallExpression"===e.type&&r.parentContext&&this._tryFindTestNameFromWrappedFunction(t.parentContext.parentNode,t.parentContext.parentContext)))}_tryFindTestNameFromWrappedFunction(e,t){var r=t.parentNode;if(_.isArray(r)&&(r[0]===e||r[1]===e)){r=t.parentContext,e=r.parentNode;if(e&&"CallExpression"===e.type&&r.parentContext)return this._saveTestNameIfTestFunctionCall(r.parentContext,e,r.parentContext.parentNode)}}_createVisitor(){var r=[],s={removeVisitorsAddedForAutoLogHintsOnly:function(){_.each(r,function(e){s[e].clearAutoLogHintsActions()})},add:function(e,t){for(var r=0,s=e.length;r<s;r++)e[r].add(t)}};return _.each(i,function(t){var i=[],e=(s[t]=function(e,t){for(var r=0,s=i.length;r<s;r++)i[r](e,t)},s[t]);e.add=function(e){i.push(e)},e.addForAutoLogOnly=function(e){e.removeIfNoAutoLogHints=!0,r.push(t),i.push(e)},e.clearAutoLogHintsActions=function(){i=_.filter(i,function(e){return!e.removeIfNoAutoLogHints})},e.clear=function(){i.length=0}}),s}_change(e,t,r){var s,i,n;if(r=r||{},e.type){if(e.loc)if(t[e.type]){if(r.hinted||(r.hinted=this._nextHint(e)),r.hinted)return e;t[e.type](e,r)}if("Identifier"===e.type||"Literal"===e.type||"ThisExpression"===e.type||"DebuggerStatement"===e.type||"EmptyStatement"===e.type||"BreakStatement"===e.type||"ContinueStatement"===e.type)return}for(n in e)e.hasOwnProperty(n)&&"loc"!==n&&"type"!==n&&"start"!==n&&"end"!==n&&"name"!==n&&(s=e[n])&&_.isObject(s)&&(i={parentContext:r,parentNode:e,hinted:r.hinted},this._change(s,t,i),i.replacement)&&(e[n]=i.replacement);return e}_handleLiveComment(e,t,o){const a=this._autoLogHints[e]={exp:t,isLiveComment:!0};t=(e,t,r,s)=>{for(var i,n=e;0<=n;n--)if(i=o[n],!r.test(i)){n++;break}return n<t&&!this._autoLogHints[n]&&(this._autoLogHints[n]=a,s)&&s(n),n};t(t(e-1,e,/\s/)-1,e,/[\s,)]/,e=>a.bracelessIndex=e)}_parse(i){var e,n=this,t={locations:!0,ecmaVersion:"latest",allowReturnOutsideFunction:!0,allowImportExportEverywhere:!0,allowAwaitOutsideFunction:!0,plugins:{jsx:!0,objectSpread:!0,dynamicImport:!0,topLevelAwait:!0,tolerance:!0}},o=[];return n._ignoreCoverageRegExp&&o.push(function(e,t,r,s){t&&t.match(n._ignoreCoverageRegExp)&&n._ignoreCoverageHints.push(s)}),n._ignoreFileCoverageRegExp&&o.push(function(e,t){!n._ignoreFileCoverage&&t&&t.match(n._ignoreFileCoverageRegExp)&&(n._ignoreFileCoverage=!0,n._wrapExpressionStatementExpressionIntoVisitor=function(e){return e},n._autoLogHints={})}),n._includeTestFileRegExp&&o.push(function(e,t){!n._includedTestFile&&t&&t.match(n._includeTestFileRegExp)&&(n._includedTestFile=!0)}),n._excludeTestFileRegExp&&o.push(function(e,t){!n._excludedTestFile&&t&&t.match(n._excludeTestFileRegExp)&&(n._excludedTestFile=!0)}),!n._opts.recordValues||!n._autoLogHintExpPrefix||n._ignoreFileCoverage||n._extractedComments&&n._extractedComments.liveComments||o.push(function(e,t,r){var s;t&&!n._ignoreFileCoverage&&(0===(s=t.indexOf(n._autoLogHintExpPrefix))||-1!==s&&0===t.substring(0,s).trim().length)&&(t=t.substr(n._autoLogHintExpPrefix.length+s).trim(),n._handleLiveComment(r,t,i))}),n._opts.preserveComments?(t.ranges=!0,t.onComment=[],t.onToken=[],e=a.parse(i,t),_.each(t.onComment,function(t){_.each(o,function(e){e("Block"===t.type,t.value,t.start,t.end,null==(e=t.loc)?void 0:e.start)})}),l.attachComments(e,t.onComment,t.onToken)):(o.length&&(t.onComment=function(t,r,s,i,n){_.each(o,function(e){e(t,r,s,i,n)})}),a.parse(i,t))}_nextHint(e,t){for(var r=this,s=e.start,i=e.end,e=(!t&&_.isNumber(r._ignoreCoverageHints.prevLastHintPosition)&&(r._ignoreCoverageHints.lastHintPosition=r._ignoreCoverageHints.prevLastHintPosition,delete r._ignoreCoverageHints.prevLastHintPosition),r._ignoreCoverageHints.lastHintPosition),n=r._ignoreCoverageHints.lastHintPosition+1,o=!1,a=!1,l=!1;n<r._ignoreCoverageHints.length;){var c=r._ignoreCoverageHints[n];if(c<=s||l&&c<i)o=!0,r._ignoreCoverageHints.lastHintPosition=n,n++,l=!0;else{if(!(t&&c<i))break;a=!0,r._ignoreCoverageHints.lastHintPosition=n,n++}}return a&&(r._ignoreCoverageHints.prevLastHintPosition=e),o}_generate(e){var t={sourceMap:this._opts.fileName||"original",sourceMapWithCode:!0};return this._opts.preserveComments&&(t.comment=!0),l.generate(e,t)}_wrapInBlock(e){return{type:"BlockStatement",body:e}}_instructionValueSequence(e,t,r,s){var i=e[1],i=this._wrapIfMarkedForAutoLog(i,t,!0,r,s);return i&&(e[1]=i),_.isEmpty(this._autoLogHints)&&(this._instructionValueSequence=_.bind(this._sequence,this),this._getNodesToCheckForAutoLogsInVariableDeclaration=()=>[]),this._sequence(e)}_wrapIfMarkedForAutoLog(e,t,r,s,i){if(e&&!t.hinted){var n=this._getAutoLogHint(e,i);if(!n&&s&&s.length)for(var o=0;o<s.length&&!(n=this._getAutoLogHint(s[o]));o++);if(n&&(!e.tracerLog||"."===n.exp||n.logMarker&&"time"===n.logMarker.action))return r?this._wrapIntoVisitor(e,this._generateNodeContext(e),!1,n):this._generateUndefinedAutoLogNode(e,t,n)}}_isInstrumented(e,t){return t.parentNode&&(t.parentNode[5]===e||t.parentNode[6]===e)}_generateUndefinedAutoLogNode(e,t,r,s){let i=this._ranges.length-1;t=this._instruction(e,Object.assign(Object.assign({},t),{disallowValueLoggingInOrAfterCurrentDebuggerFrame:s}),"U",e=>{i=e}),s=this._wrapIntoVisitor(e,this._generateNodeContext(e),!1,r,()=>i);return this._sequence([t,s])}_getAutoLogHint(e,t){var r=e.end+(t||0),r=this._autoLogHints[r];r&&0<=r.start&&e.start!==r.start&&(r=void 0);try{return r?(r.bracelessIndex&&delete this._autoLogHints[r.bracelessIndex],r):t?r=this._getAutoLogHint(e):void 0}finally{r&&r.isLiveComment&&(this._liveCommentLines[e.loc.start.line]=e.loc.start.column)}}_sequence(e){return 2===e.length&&this._isUndefinedInstruction(e[0])?e[1]:{type:"SequenceExpression",expressions:e}}_literal(e){return{type:"Literal",value:e}}_delayedLiteral(e){return{type:"Literal",get value(){return _.isUndefined(this._value)&&(this._value=e()),this._value}}}_return(e){return{type:"ReturnStatement",argument:e}}_firstNode(e){return{type:"ExpressionStatement",expression:{type:"Literal",value:e&&e.expression&&e.expression.value||""}}}_handleSuperCall(e,t,r,s){var i=e[0],t=this._instructionStatement(i,t,"S");delete i.loc,delete i.expression.loc,e.splice(1,0,...[r,t].concat(s))}_replaceConsoleLog(e,t){var r=this;e&&!t.hinted&&r._captureConsoleLog&&("CallExpression"===e.type&&e.callee&&"MemberExpression"===e.callee.type&&e.callee.object&&"Identifier"===e.callee.object.type&&"console"===e.callee.object.name&&e.callee.property&&"Identifier"===e.callee.property.type&&"log"===e.callee.property.name?(e.tracerLog=!0,e.callee.object.name="$_$tracer",e.arguments||(e.arguments=[]),e.arguments.push(r._literal(r._generateNodeContext(e.arguments[0]))),e.arguments.push(r._literal(r._opts.file)),e.arguments.push(r._literal(r._ranges.length))):e.arguments&&e.arguments.length&&r._replaceConsoleLog(e.arguments[0],t))}_generateNodeContext(e){if(e&&"Literal"!==e.type)try{var t=_.truncate(l.generate(e,{}),40).toString().replace("$_$tracer.log","console.log");return~t.indexOf("$_$tracer")?"":t}catch(e){}return""}_replaceSequenceWithDiff(e){var t=this,r=e;if((e=r.expression)&&"SequenceExpression"===e.type&&e.expressions&&2===e.expressions.length){var s=e.expressions[0],e=e.expressions[1],i="";if(s&&"Literal"!==s.type)try{i=_.truncate(l.generate(s,{}),40).toString()+" vs "+_.truncate(l.generate(e,{}),40).toString()}catch(e){}return r.expression={type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:"diff"}},arguments:[s,e,t._literal(i),t._literal(t._opts.file),t._literal(t._ranges.length)]},!0}}_needsToStayFirst(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"Literal"===e.expression.type&&("use strict"===e.expression.value||"use babel"===e.expression.value||"ngInject"===e.expression.value)}_isSystemJsModule(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"CallExpression"===e.expression.type&&e.expression.callee&&"MemberExpression"===e.expression.callee.type&&e.expression.callee.object&&e.expression.callee.property&&"Identifier"===e.expression.callee.object.type&&"Identifier"===e.expression.callee.property.type&&"System"===e.expression.callee.object.name&&"register"===e.expression.callee.property.name&&e.expression.arguments}_isSuperCall(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"CallExpression"===e.expression.type&&e.expression.callee&&"Super"===e.expression.callee.type}_isUndefinedInstruction(e){return e&&"Identifier"===e.type&&"undefined"===e.name}_instruction(s,e,i,t){var n=s.loc,r="",o=[];switch(i){case"PE":o=[this._literal(this._opts.file)];case"FE":r=i.toLowerCase();break;default:if(this._ignoreFileCoverage||e.hinted||this._nextHint(s,!0))return{type:"Identifier",name:"undefined"};r="";const l=()=>{var e,t,r=[n.start.line,n.start.column,n.end.line,n.end.column];"R"===i&&(e=1,s.argument&&"CallExpression"===s.argument.type&&s.argument.callee&&("Identifier"===(t="SequenceExpression"===(t=s.argument.callee).type&&t.expressions&&t.expressions.length?t.expressions[t.expressions.length-1]:t).type?e=this._isObjectSpread(t)?c:t.name:"MemberExpression"===t.type&&(t.property&&"Identifier"===t.property.type&&"createElement"===t.property.name&&t.object&&(this._isReactObject(t.object)||"MemberExpression"===t.object.type&&this._isReactObject(t.object.object))?e="Babel.React.createElement":t.object&&this._isObjectSpread(t.object)&&(e=c))),r.push(e)),this._ranges.push(r)};this._totalRanges++,"U"!==i?(o=[this._literal(this._opts.file),this._literal(this._ranges.length)],l(),o.push({type:"Identifier",name:"$_$c"})):(r="_",(o=[this._literal(this._opts.file),this._delayedLiteral(()=>{var e=this._ranges.length;return l(),t&&t(e),e})]).push({type:"Identifier",name:"$_$c"}),e.disallowValueLoggingInOrAfterCurrentDebuggerFrame&&o.push(this._literal(!0)))}var a=this._instructionCallExpression(r,o);return s.loc&&(a.loc=s.loc,a.callee.loc=s.loc),a}_isReactObject(e){return e&&"Identifier"===e.type&&e.name&&~e.name.toLowerCase().indexOf("react")}_isObjectSpread(e){return e&&"Identifier"===e.type&&e.name&&~e.name.toLowerCase().indexOf("objectspread")}_wrapExpressionStatementExpressionIntoVisitor(e,t){return e&&"Identifier"===e.type?(t=(t=this._getAutoLogHint(t))||this._getAutoLogHint(e),this._wrapIntoVisitor(e,void 0,{hasAutoLogHint:!!t},t||{exp:""})):e}_autoHintDetails(e,t){e=this._autoLogHintGlobalExp&&!e&&t.isLiveComment||this._autoLogHintGlobalExp&&e&&e.hasAutoLogHint;let r=(t.logMarker||t).exp;var s=(r=e?"":r)&&"?"===r[0],i=r&&("."===r[0]||".+"===r.substr(0,2)||"+."===r.substr(0,2)),n=r&&("+"===r[0]||".+"===r.substr(0,2)||"+."===r.substr(0,2));return s&&(r=r.substr(1).trim()),i&&(r=r.substr(1).trim()),n&&(r=r.substr(1).trim()),t.logMarker&&(n=t.logMarker.expanded),{hasGlobalExp:e,exp:r,isProxyExp:s,isTimeDiffExp:i,isAutoExpandExp:n}}_wrapIntoVisitor(t,r,s,i,n,o){var a=this;let{hasGlobalExp:l,exp:c,isProxyExp:u,isTimeDiffExp:p,isAutoExpandExp:d}=this._autoHintDetails(s,i);var h=i.logMarker&&"time"!==i.logMarker.action&&i.logMarker;let g=i.logMarker&&"time"===i.logMarker.action&&i.logMarker;g&&(i.liveComment?((f=this._autoHintDetails(s,i.liveComment)).isTimeDiffExp&&(g.instrumented=!0,g=void 0),l=f.hasGlobalExp,c=f.exp,u=f.isProxyExp,p=f.isTimeDiffExp,d=f.isAutoExpandExp):p=!0);var f=a._ranges.length-(s?0:1),m=[a._literal(a._opts.file)];if(n?(m.push(a._delayedLiteral(()=>{var e=n();return a._loggedRanges[e]=!0,e})),m.push(a._delayedLiteral(()=>a._opts.file+","+n()))):(a._loggedRanges[f]=!0,m.push(a._literal(f)),m.push(a._literal(a._opts.file+","+f))),m.push({type:"Identifier",name:"$_$c"}),p&&!c)return m.push(a._literal(r||t.name||"")),m.push(a._tracerMethodCall("_time")),m.push(t),m.push(a._tracerMethodCall("_time")),g&&(f={type:"ObjectExpression",properties:[]},g.traceId&&f.properties.push(a._propertyNode("traceId",g.traceId)),g.changeId&&f.properties.push(a._propertyNode("changeId",g.changeId)),(g.traceId||g.changeId)&&m.push(f),g.instrumented=!0),this._tracerMethodCall("_logTime",m);{m.push(a._literal(c?_.truncate(c,40):r||t.name||"")),g?(delete(f=Object.assign({},g)).liveComment,m.push(a._wrapIntoVisitor(t,r,!!s,{exp:".",logMarker:f}))):p?m.push(a._wrapIntoVisitor(t,r,!!s,{exp:"."})):m.push(t),l?m.push(a._evalExpressionNode(a._autoLogHintGlobalExp)):this._logpointsNotAvailableExpression&&i.logMarker&&i.logMarker.logpoint?m.push(a._evalExpressionNode(this._logpointsNotAvailableExpression)):m.push(c?a._evalExpressionNode(c):a._literal("$_$ne")),m.push(a._literal(!s||a._autoLogHintExpPrefix&&s&&s.hasAutoLogHint?0:1));let e=0;if(d&&(e|=1),u&&(e|=2),m.push(a._literal(e)),h){f={type:"ObjectExpression",properties:[]};const o=i.liveComment&&""===i.liveComment.exp||!i.liveComment&&s;return o&&f.properties.push(a._propertyNode("permanent",1)),h.traceId&&f.properties.push(a._propertyNode("traceId",h.traceId)),h.changeId&&(f.properties.push(a._propertyNode("changeId",h.changeId)),this._outstandingLogpointCount--),(h.traceId||h.changeId||o)&&m.push(f),h.instrumented=!0,!o&&i.liveComment?a._wrapIntoVisitor(a._instructionCallExpression("v",m),r,s,i.liveComment,n,!0):a._instructionCallExpression("v",m)}return o&&m.push({type:"ObjectExpression",properties:[a._propertyNode("permanent",1)]}),a._instructionCallExpression("v",m)}}_propertyNode(e,t){return{type:"Property",key:{type:"Identifier",name:e},value:{type:"Literal",value:t}}}_tracerMethodCall(e,t){return{type:"CallExpression",callee:{type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:e}},arguments:t||[]}}_evalExpressionNode(e){return{type:"FunctionExpression",params:[{type:"Identifier",name:"$"}],body:{type:"BlockStatement",body:[{type:"TryStatement",block:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"CallExpression",callee:{type:"Identifier",name:"eval"},arguments:[{type:"Literal",value:e}]}}]},handler:{type:"CatchClause",param:{type:"Identifier",name:"__e"},body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"Literal",value:"✗"}}]}}}]},generator:!1,expression:!1}}_instructionCallExpression(e,t){return{type:"CallExpression",callee:{type:"Identifier",name:"$_$w"+e},arguments:t}}_selfExecutingAsyncFunction(e){return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"ArrowFunctionExpression",expression:!1,generator:!1,async:!0,params:[],body:{type:"BlockStatement",body:e}},arguments:[],optional:!1}}}_selfExecutingAsyncSnapFunction(e,t,r){return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"FunctionExpression",id:{type:"Identifier",name:"snapRootStackTraceMarker_"+e},expression:!1,generator:!1,async:!1,params:[],body:{type:"BlockStatement",body:[{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"FunctionExpression",id:{type:"Identifier",name:t},expression:!1,generator:!1,async:!0,params:[],body:r},arguments:[],optional:!1}}]}},arguments:[],optional:!1}}}_svelteInstanceFuncCall(){return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"Identifier",name:"instance"},arguments:[{type:"ObjectExpression",properties:[{type:"Property",key:{type:"Identifier",name:"$$"},value:{type:"ObjectExpression",properties:[{type:"Property",key:{type:"Identifier",name:"on_destroy"},value:{type:"ArrayExpression",elements:[]}}]}}]},{type:"ObjectExpression",properties:[]},{type:"ArrowFunctionExpression",expression:!1,generator:!1,async:!1,params:[],body:{type:"BlockStatement",body:[]}}]}}}_vueSfcSetupFuncCall(){return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"_sfc_main"},property:{type:"Identifier",name:"setup"}},arguments:[{type:"ObjectExpression",properties:[]},{type:"ObjectExpression",properties:[{type:"Property",key:{type:"Identifier",name:"expose"},value:{type:"ArrowFunctionExpression",expression:!1,generator:!1,async:!1,params:[],body:{type:"BlockStatement",body:[]}},kind:"init",computed:!1,method:!1,shorthand:!1}]}]}}}_appendComponentInstantiation(e){var t;!this._opts.vue&&!this._opts.svelte||null!=(t=this._opts.snaps)&&t.onlyMode||(e=(t=e.body).pop(),t.push(this._opts.svelte?this._svelteInstanceFuncCall():this._vueSfcSetupFuncCall()),t.push(e))}_processSnaps(r){var e,t=this._snaps,s=this._snapScopes,i={type:"Identifier",name:"e"},n={type:"EmptyStatement"};let o=r.body;if(null!=(h=this._opts.snaps)&&h.onlyMode){var a=[];for(let t=0;t<r.body.length;t++){var l=r.body[t];if("ImportDeclaration"===l.type){var c=[],u=l.source.value,p=l.specifiers||[];if(p.length){var d=p.find(e=>"ImportNamespaceSpecifier"===e.type);let e=void 0;for(const v of p)v!==d&&(e=e||{type:"ObjectPattern",properties:[]}).properties.push({type:"Property",key:"ImportDefaultSpecifier"===v.type?{type:"Identifier",name:"default"}:v.imported,value:v.local,kind:"init"});d&&c.push(this._variableDeclaration(d.local,this._dynamicImport(u))),e&&c.push(this._variableDeclaration(e,d?d.local:this._dynamicImport(u)))}else c.push({type:"ExpressionStatement",expression:this._dynamicImport(u)});let e=this._tracerMethodCall("reportSnapsImportError",[{type:"NewExpression",callee:{type:"Identifier",name:"Error"},arguments:[{type:"MemberExpression",object:i,property:{type:"Identifier",name:"message"}}]}]);e.loc=l.loc,e=this._instructionValueSequence([this._instruction(e,{}),e],{}),r.body[t]=this._wrapIntoTryCatch(c,i,[{loc:l.loc,type:"ExpressionStatement",expression:e}])}else"ExportDefaultDeclaration"===l.type?(l.declaration&&("FunctionDeclaration"===l.declaration.type||"ClassDeclaration"===l.declaration.type&&!l.declaration.superClass)&&a.push(l.declaration),r.body[t]=n):"ExportNamedDeclaration"===l.type?l.declaration?"FunctionDeclaration"===l.declaration.type||"ClassDeclaration"===l.declaration.type&&!l.declaration.superClass?(a.push(l.declaration),r.body[t]=n):(r.body[t]=l.declaration,"VariableDeclaration"===l.declaration.type&&(l.declaration.kind="var")):r.body[t]=n:"ExportAllDeclaration"===l.type?r.body[t]=n:"VariableDeclaration"===l.type?l.kind="var":"FunctionDeclaration"!==l.type&&("ClassDeclaration"!==l.type||l.superClass)||(a.push(l),r.body[t]=n)}var h=this._wrapIntoTryCatch(r.body,i,[{type:"ExpressionStatement",expression:this._tracerMethodCall("reportSnapsProgramScopeError",[i])}]);const g=o.pop();(o=[h,g]).unshift(...a),r.body=null!=(h=this._opts.snaps)&&h.asyncWrap?[this._selfExecutingAsyncFunction(o)]:o}const g=o.pop();try{const y=new Map;for(const w of s.keys()){const k=s.get(w);if(null!=(e=this._opts.snaps)&&e.onlyMode){var f=[];for(let e=0;e<k.source.body.length;e++){var m=k.source.body[e];"VariableDeclaration"===m.type?m.kind="var":"FunctionDeclaration"!==m.type&&("ClassDeclaration"!==m.type||m.superClass)||(f.push(m),k.source.body[e]=n)}var _=[];k.source.body=[this._wrapIntoTryCatch(k.source.body,i,[{type:"ExpressionStatement",expression:this._tracerMethodCall("reportSnapsProgramScopeError",[i])}],_)],k.source.body.unshift(...f),y.set(w,_)}else y.set(w,{push:e=>{k.source.body.splice(k.source.body.length-1,0,e)}});o.push(k.call)}const b=1===t.length;return t.map((e,t)=>{let r,s;var i;return e.empty||(i=e.body.body[0],r=i.body[0].loc.start,s=i.body[i.body.length-1].loc.end),(e.scope&&y.has(e.scope)?y.get(e.scope):o).push(this._selfExecutingAsyncSnapFunction(t,"quokka_snap"+(b?"":"_"+(t+1)),e.body.body[0])),e.body.body=[],{empty:e.empty,body:{range:[e.body.loc.start.line,e.body.loc.start.column,e.body.loc.end.line,e.body.loc.end.column],fallbackRange:e.empty?void 0:[r.line,r.column,s.line,s.column]},output:e.output&&{range:[e.output.loc.start.line,e.output.loc.start.column,e.output.loc.end.line,e.output.loc.end.column],content:e.outputContent,lines:e.outputLines}}})}finally{o.push(g)}}_wrapIntoTryCatch(e,t,r,s){return{type:"TryStatement",block:{type:"BlockStatement",body:e},handler:{type:"CatchClause",param:t,body:{type:"BlockStatement",body:r}},finalizer:s?{type:"BlockStatement",body:s}:void 0}}_variableDeclaration(e,t){return{type:"VariableDeclaration",declarations:[{type:"VariableDeclarator",id:e,init:t}],kind:"var"}}_dynamicImport(e){return{type:"AwaitExpression",argument:{type:"ImportExpression",source:{type:"Literal",value:e}}}}_getFunctionParameterLogInstructions(e,i){const n=[],o=this;return e.params.forEach(e=>{if("Identifier"===e.type){var t=o._getAutoLogHint(e);t&&e.name&&n.push(o._generateUndefinedAutoLogNode(e,i,t))}else if("AssignmentPattern"===e.type&&e.left&&e.right&&e.left.name){t=[o._getAutoLogHint(e.left),o._getAutoLogHint(e.right),o._getAutoLogHint(e)].find(e=>e);t&&n.push(o._generateUndefinedAutoLogNode(e.left,i,t))}else if("ObjectPattern"===e.type&&e.properties){const r=o._getAutoLogHint(e);e.properties.forEach(e=>{var t;e&&e.key&&e.value&&e.value.name&&(t=[o._getAutoLogHint(e.value),o._getAutoLogHint(e.key),o._getAutoLogHint(e),r].find(e=>e))&&n.push(o._generateUndefinedAutoLogNode(e.value,i,t))})}else if("ArrayPattern"===e.type&&e.elements){const s=o._getAutoLogHint(e);e.elements.forEach(e=>{var t;e&&e.name&&(t=[o._getAutoLogHint(e),s].find(e=>e))&&n.push(o._generateUndefinedAutoLogNode(e,i,t))})}else"RestElement"===e.type&&e.argument&&e.argument.name&&(t=o._getAutoLogHint(e))&&n.push(o._generateUndefinedAutoLogNode(e.argument,i,t))}),n.map(e=>({type:"ExpressionStatement",expression:e}))}_instructionStatement(e,t,r){return{type:"ExpressionStatement",expression:this._instruction(e,t,r)}}_scopeStartVariableDeclaration(e,t){return{type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:"$_$c"},init:{type:"CallExpression",callee:{type:"Identifier",name:"$_$w"+e.toLowerCase()},arguments:t?[this._literal(this._opts.file),...t]:[this._literal(this._opts.file)]}}]}}_saveTestNameIfTestFunctionCall(t,r,s){if(_.isArray(s)&&2<=s.length&&s[1]===r&&s[0]){let e;if("Literal"===s[0].type)e=s[0].value;else{if("TemplateLiteral"!==s[0].type)return;r=s[0];if(r.expressions&&r.expressions.length)return;if(!r.quasis||1!==r.quasis.length)return;s=r.quasis[0];if(!s||!s.value)return;e=s.value.cooked}r=t.parentContext.parentNode;if(r&&"CallExpression"===r.type){s=r.callee;if((s="SequenceExpression"===s.type&&s.expressions?s.expressions[s.expressions.length-1]:s)&&("it"===s.name||"test"===s.name||"asyncTest"===s.name||s.property&&"Identifier"===s.property.type&&("it"===s.property.name||"test"===s.property.name||"asyncTest"===s.property.name)))return this._testName=e,!0}}}}r.default=function(e,t){return new o(t).instrument(e)}},{"./acornImportAssertionsPlugin":1,"./acornImportMetaPlugin":2,"./acornLogicalAssignment":3,"./acornNumericSeparatorPlugin.js":4,"./acornTolerancePlugin":5,"./acornTopLevelAwaitPlugin":6,"./acornWalkJsxPlugin":7,acorn:void 0,"acorn-jsx":void 0,"acorn-walk":void 0,"escodegen-wallaby":void 0}],48:[function(e,t,r){const a=e("util"),s=new(e("lru-cache"))({max:5242880,length:e=>e.length});let i=0;const l={add(e){s.set(i++,e)},values(){var e=s.values();return e.reverse(),e}};let c=process.env.WALLABY_DEBUG_ENABLED||!1,n=process.env.WALLABY_TRACE_ENABLED||!1;const o={};o.log=function(e){return process.stdout.write(e)},o.formatArgs=function(e){var t=this["namespace"];e[0]=function(){if(o.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+t+" "+e[0]},o.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{var r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase());let s=process.env[t];return s=!!/^(yes|on|true|enabled)$/i.test(s)||!/^(no|off|false|disabled)$/i.test(s)&&("null"===s?null:Number(s)),e[r]=s,e},{depth:25,maxArrayLength:100,breakLength:200});d=o,((p.debug=p).default=p).coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},p.instances=[],Object.keys(d).forEach(e=>{p[e]=d[e]}),p.formatters={};const u=p;function p(e,t){let r;function o(...i){if(o.enabled){const n=o;var e=Number(new Date),t=e-(r||e);n.diff=t,n.prev=r,n.curr=e,r=e,i[0]=p.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");let s=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,(e,t)=>{var r;return"%%"!==e&&(s++,"function"==typeof(t=p.formatters[t]))&&(r=i[s],e=t.call(n,r),i.splice(s,1),s--),e}),p.formatArgs.call(n,i);t=a.format(...i)+"\n";(!n.isDebug||(l.add(t),c))&&p.log.call(n,t)}}return o.isDebug="debug"===t,o.isTrace="trace"===t,o.namespace=e,o.enabled=o.isTrace&&n||o.isDebug,p.instances.push(o),o}var d,e=u["formatters"];e.o=function(e){return a.inspect(e,o.inspectOpts).replace(/\s*\n\s*/g," ")},e.O=function(e){return a.inspect(e,o.inspectOpts)},t.exports={create(e){return{debug:u(e,"debug"),trace:u(e,"trace")}},enableDebug(){c||(process.env.WALLABY_DEBUG_ENABLED="true",c=!0,l.values().forEach(e=>{o.log(e)}))},getDebugLog(){return l.values()},enableTrace(){n||(process.env.WALLABY_TRACE_ENABLED="true",n=!0,u.instances.forEach(e=>{e.isTrace&&(e.enabled=!0)})),this.enableDebug()}}},{"lru-cache":void 0,util:void 0}],49:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Runner=void 0;const s=e("path"),a=e("child_process"),u=logger.create("nodeRunner")["debug"],i=e("./runWorkerPool"),n=e("./utils");var p="###wpm###";r.Runner=class{constructor(e){this._project=e,this._nodePath=e.settings().env.runner,this._initializer=e.settings().bootstrap,this._teardown=e.settings().teardown,this._slowTestThreshold=e.settings().slowTestThreshold,this._zeroConfigJest=e.isZeroConfigJest(),this._vitest=e.isVitest(),this._viteNode=this._project.isQuokkaVite(),this._nodeModules=s.join(e._localRoot,"node_modules");try{this._regeneratorRuntime=s.join(s.dirname(n.default.resolveModulePathFrom(this._nodeModules,"regenerator-runtime")),"runtime.js")}catch(e){}this._params=e.settings().env.params,this._recycle=e.settings().workers.recycle,this._testFramework=e.settings().testFramework,this._cwd=process.env.quokka||this._zeroConfigJest||this._vitest?process.cwd():e._instrumentedRoot,this._localProjectDir=e._localProjectDir,this._originalCacheRoot=e._originalRoot,this._reportUnhandledPromises=!!e.settings().reportUnhandledPromises,this._maxLogEntrySize=e.settings().maxLogEntrySize,this._maxTraceSteps=e.settings().maxTraceSteps,this._workerPool=new i.WorkerPool(this._project,{create:_.bind(this._createNodeInstance,this),recycle:_.bind(this._recycleNodeInstance,this),healthy:_.bind(this._isNodeInstanceHealthy,this),prepare:_.bind(this._prepare,this)}),this._workerPool.setFileRoot(this._cwd)}run(e){return this._workerPool.run(e)}cancel(e){return this._workerPool.cancel(e)}start(){return this._workerPool.start()}stop(){this._workerPool.stop()}mapStack(e,t){return this._workerPool._mapStackEntries(e,t)}_createNodeInstance(i,n){var o=this;setImmediate(function(){try{process.env.quokka&&(o._params=o._project.settings().env.params,o._recycle=o._project.settings().workers.recycle);var e,t=(o._params.runner?_.map(o._params.runner.replace(/"([^"]+)"/g,e=>e.replace(/\s/g,"_space_token_")).split(" "),e=>_.trim(e.replace(/_space_token_/g," "),'"')).filter(e=>!!e):[]).concat([process.mainModule.filename,"runner",i,o._workerPool.receiverPort(),o._testFramework.version+(o._testFramework.autoDetected?",autoDetected":""),o._testFramework.path||"",o._nodeModules,o._originalCacheRoot,process.env.BABEL_ENV&&o._regeneratorRuntime||"",o._testFramework.configFile||"",JSON.stringify(o._project.settings().logLimits)]),r=_.extend({},process.env,o._params.env?_.reduce(o._params.env.split(";"),function(e,t){var r=t.split("=");return e[_.trimLeft(r[0])]=t.substring(r[0].length+1),e},{}):{});if(process.env.WALLABY_PNP){let e="";r.NODE_OPTIONS?e=r.NODE_OPTIONS:process.env.NODE_OPTIONS&&(e=process.env.NODE_OPTIONS),-1===e.indexOf("--require")&&(e=e+(e?" ":"")+process.env.WALLABY_PNP),r.NODE_OPTIONS=e}process.env.WALLABY_PNP_ESM&&(e=r.NODE_OPTIONS||process.env.NODE_OPTIONS||"",e=process.env.WALLABY_PNP_ESM+(e?" ":"")+e,r.NODE_OPTIONS=e),delete r.ATOM_SHELL_INTERNAL_RUN_AS_NODE,r.WALLABY_ELECTRON_RUN_AS_NODE||delete r.ELECTRON_RUN_AS_NODE,process.env.WALLABY_INTEGRATION_TEST_RUN&&delete r.CI;var s={process:(0,a.spawn)(o._nodePath,t,{cwd:o._cwd,env:r}),onConnected:function(e){_.isFunction(e)?this._onConnected=e:this._onConnected&&(this._onConnected(e),delete this._onConnected,delete this.onConnected)}};s.process.stderr.on("data",function(e){let t=e.toString("utf8");(t=t.split("\n").filter(e=>-1===e.indexOf("ExperimentalWarning:")&&-1===e.indexOf("node --trace-warnings")&&!e.startsWith("--import 'data:text/javascript")).join("\n"))&&(u("Error in worker: %s",t),console.error(t))}),n(s)}catch(e){u("Error while creating worker #%s: %s",i,e&&(e.stack||e.message)),n()}})}_recycleNodeInstance(e){try{e.process.stdout.removeAllListeners("data"),e.process.stderr.removeAllListeners("data")}finally{e.process.kill()}}_isNodeInstanceHealthy(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode}_prepare(a,n){var l=this,t=_.randomId(),e=l._sandboxName(n,t),c={};return u("Starting sandbox [%s]",e),Promise.resolve().then(function(){return l._workerPool.cancelled()?Promise.reject({runCancelled:!0}):(u("Preparing sandbox [%s]",e),l._workerPool.getWorker(n))}).then(function(o){return o instanceof Error||o.runCancelled?Promise.reject(o):(u("Prepared sandbox [%s]",e),Promise.resolve({instance:{resume:function(){o.channel.send(JSON.stringify({type:"in:tracer.resume",data:{}}))},ping:function(r){function s(e){var t;try{t=JSON.parse(e)}catch(e){return}"pong"===t.type&&t.data===i&&(o.channel.removeListener("message",s),r())}var i=_.uniqueId();o.channel.on("message",s),o.channel.send(JSON.stringify({type:"in:ping",data:i}))},teardown:function(){o.channel.send(JSON.stringify({type:"in:teardown",data:{}}))},close:function(s){if(l._recycle&&!l._teardown)l._workerPool.recycleWorker(n),l._workerPool.getWorker(n).then(_.noop),s(!0);else{let r;if(l._teardown){if(c._closing)return;c._closing=!0,r=_.uniqueId();var i=function(e){var t;try{t=JSON.parse(e)}catch(e){return}"closed"===t.type&&t.data&&t.data.requestId===r&&(o.channel.removeListener("message",i),delete c._closing,l._recycle&&(l._workerPool.recycleWorker(n),l._workerPool.getWorker(n).then(_.noop)),s(!t.data.error))};o.channel.on("message",i)}o.channel.send(JSON.stringify({type:"in:stop",data:r})),l._teardown||s(!0)}},closing:_.noop,start:function(e,n){if(e("success")){try{o.process.stdout.removeAllListeners("data"),o.process.stdout.on("data",function(e){try{~(e=e&&e.toString("utf8")).indexOf(p)&&(e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(p))try{JSON.parse(e);o.channel.emit("message",e)}catch(e){u("Error while processing STDOUT message: "+e.message)}}))}catch(e){u("Error while processing STDOUT message: "+e.message)}})}catch(e){u("Error while subscribing to process STDOUT: "+e.message)}o.process.stderr.removeAllListeners("data"),o.process.stderr.on("data",function(e){var t,r,s,i;(e=e&&e.toString("utf8"))&&0===e.indexOf("Debugger listening on port")||(t="",~e.indexOf(p)?(e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(p))try{r=JSON.parse(e)}catch(e){u("Error while processing STDERR message: "+e.message)}}),r&&n(r.message,r.stack,r.actual,r.expected)):e&&(s=e.split("\n"),i=[],_.each(s,function(e){if(_.startsWith(_.trimLeft(e),"at"))return!1;i.push(e)}),t=i.join("\n"),/error/i.test(t)||/fail/i.test(t)?n(t,e):console.warn("STDERR: "+t)))});e={sessionId:t,tests:a.tests,files:_.reduce(a.allFiles.concat(a.allTestFiles),(e,t)=>{var r,s,i;return _.isNumber(t.id)&&(r={id:t.id,rangesLength:t.rangesLength},e.push(r),l._zeroConfigJest||l._vitest)&&(r.path=t.normalizedRelativePath,r.parentFilePath=t.parentFilePath,r.childFilePath=t.childFilePath,r.numberOfFunctions=t.numberOfFunctions,r.ts=t.ts,r.runnerCacheKey=t.runnerCacheKey,r.inOriginalFilesCache=t.inOriginalFilesCache,r.instrument=t.instrument,r.logMarkers=t.logMarkers,r.extractedComments=t.extractedComments,t.test)&&(r.test=!0,s=!(t.relatedFilesWithTests||l._project.hadGlobalErrorsPreviousRun()||l._project.settings().runAllTestsInAffectedTestFile||a.fullRun),i=t.changeStart&&t.changePosition&&s,r.allowedToRunSingleTestOnly=s||void 0,i)&&(r.changeStart=t.changeStart,r.changePosition=t.changePosition),e},[]),testFiles:_.map(a.testFilesToLoad,function(e){var t;return 0===l._testFramework.version.indexOf("jest")&&(t=(t=l._project._getFileMetadataById(e.originalId||e.id))&&t.getFileLineMap()),{path:e.path,id:e.originalId||e.id,type:e.type,originalType:e.originalType,content:process.env.quokka?e.content:void 0,lineMap:t,logMarkers:l._viteNode?e.logMarkers:void 0,extractedComments:l._viteNode?e.extractedComments:void 0}}),root:l._cwd,localProjectDir:l._localProjectDir,flushCache:!1,initializer:l._initializer,teardown:l._teardown,slowTestThreshold:l._slowTestThreshold,manualTestRun:a.manualRun,updateSnapshotsRun:a.updateSnapshotsRun,profileRun:a.profileRun||void 0,reportUnhandledPromises:l._reportUnhandledPromises,maxLogEntrySize:l._maxLogEntrySize,maxTraceSteps:l._maxTraceSteps,expressionsToEvaluate:a.expressionsToEvaluate,hints:l._project.settings().hints,autoConsoleLog:l._project.settings().autoConsoleLog,captureConsoleLog:l._project.settings().captureConsoleLog,preserveComments:l._project.settings().preserveComments,reportConsoleErrorAsError:l._project.settings().reportConsoleErrorAsError,suppressClearingRequireCache:l._zeroConfigJest||void 0,traceContext:a.traceContext||void 0,suppressCallStackEval:!!process.env.quokka||void 0,updateNoMoreThanOneSnapshotPerTestFileRun:l._project.settings().updateNoMoreThanOneSnapshotPerTestFileRun||void 0,runGlobals:a.runGlobals||!1,processEnvUpdates:a.processEnvUpdates,customJestConfig:l._project.settings().customJestConfig||void 0,symlinkNodeModules:l._project.settings().symlinkNodeModules,resolveGetters:l._project.settings().resolveGetters,autoExpandAllLogs:l._project.settings().autoExpandAllLogs||void 0,snapsAutoRun:process.env.quokka&&(null==(e=l._project.settings().quokka)?void 0:e.snapsAutoRun)||void 0};o.channel.send(JSON.stringify({type:"in:run",data:e}))}}},name:e,sessionId:t,workerId:n}))})}_sandboxName(e,t){return"worker #"+e+", session #"+t}}},{"./runWorkerPool":66,"./utils":75,child_process:void 0,path:void 0}],50:[function(u,e,t){var p=u("path"),d=u("util"),r=u("ws"),h=u("./utils").default,s=u("./utils/remapComments").default,i=(h.remapComments=s,JSON.stringify),n=JSON.parse,o=process.stderr.write.bind(process.stderr),g=function(e){var t="";"string"!=typeof(e=e||"")?(t=e.stack||e.message||e.toString&&e.toString()||"",e.message&&!~t.indexOf(e.message)&&(t=e.message+"\n"+t)):t=e,o(t)},a=process.stdout.write.bind(process.stdout),f={send:function(e){a(e)}};process.exit=function(){};var m=u("module").Module._cache,_=process.cwd(),l=[],c=[],v=u("timers").setTimeout,y=u("timers").setInterval,b=process.nextTick;u("timers").setTimeout=global.setTimeout=function(){var e=v.apply(this,arguments);return l.push(e),e},process.env.quokka&&(u("timers").setInterval=global.setInterval=function(){var e=y.apply(this,arguments);return c.push(e),e});try{d.promisify.custom&&d.promisify.custom&&(global.setTimeout[d.promisify.custom]=v[d.promisify.custom])}catch(e){}var w=function(e){if("string"==typeof e)g(e);else{var t="";e||g("");try{global.$_$tracer&&(e.stack||e.message)&&(t=JSON.stringify(global.$_$tracer.setAssertionData({actual:e.actual,expected:e.expected,showDiff:!0},{message:e.message,stack:e.stack,_p:"###wpm###"})))}catch(e){}"[object Object]"===(t=t||e&&(e.stack||e.message||e.diagnosticText||e.toString&&e.toString()||JSON.stringify(e))||"")&&e&&(t="Runtime error: "+JSON.stringify(e)),g(t||"")}};function k(e){w(e),process.env.quokka&&process.emit("beforeExit")}function x(){~process.listeners("uncaughtException").indexOf(k)||process.on("uncaughtException",k)}x();function S(e,t,r,s,i,n,o,a,l){var c=this;c._port=t,c._id=parseInt(e,10),global.$_$logLimits=JSON.parse(l),c._connect(function(){function e(){global._=u("lodash"),global._.extend(global._,u("./utils")),global._.str=u("underscore.string"),global._.mixin(global._.str.exports()),h.instrument=u("./instrumentor").default,global.$_$tracer.workerId=c._id}global.$_$reuseableTracer=!0,u("./tracer"),global.$_$tracer._utils=h,global.$_$tracer._handleUncaughtException=x,~r.indexOf("quokka")&&(global._quokkaLazyLoadHelperFunctions=e),(~r.indexOf("jest")||~r.indexOf("vitest"))&&(e(),process.exit=function(e){e&&~r.indexOf("jest")&&w(new Error("process.exit called with "+e))}),global.wallaby._frameworks={chai:{},sinon:{},quibble:{}},global.wallaby._originalCacheRoot=n,global.wallaby._localNodeModules=i,global.wallaby._testFrameworkPath=s,global.wallaby._testConfigFile=a,global.wallaby._fileExtensionsAdded=!1,global.wallaby._regeneratorRuntime=o,c.profileRunInTestWorker=!~r.indexOf("vitest");var t=console.error;process.stderr.write=function(e){if("string"==typeof(e=Buffer.isBuffer(e)?e.toString("utf8"):e)&&0===(e=e.trimEnd()).split("\n").filter(e=>-1===e.indexOf("ExperimentalWarning:")&&-1===e.indexOf("node --trace-warnings")).join("\n").length)return;t(e)},c._testFrameworkInitializer=u("./runners/node/"+r.split(",")[0]+"/initializer.js")}),global.$_$tracer._highPriorityReceiver=f,global.$_$tracer._onReceiverClosed=e=>{e?global.$_$tracer._onReceiverClosedCallback=e:global.$_$tracer._onReceiverClosedCallback&&(global.$_$tracer._onReceiverClosedCallback(),delete global.$_$tracer._onReceiverClosedCallback)},global.$_$tracer.unrefWebSocket=()=>{c._channel._socket.unref()},global.$_$tracer.refWebSocket=()=>{c._channel._socket.ref()},global.$_$tracer._nodeUtil=d,c._patchFrameworks()}var P=function(){process.on("unhandledRejection",function(e){throw e})};S.prototype={send:function(e){this._channel.send(i(e))},_connect:function(e){var t=this;t._channel=new r("ws://127.0.0.1:"+t._port),global.$_$receiver=t._channel,e&&e(),t._channel.on("open",function(){t.send({worker:t._id.toString()})}),t._channel.on("message",function(e){e=n(e),t[e.type](e.data)})},"in:connected":function(){this._onConnected&&this._onConnected(),delete this._onConnected},"in:teardown":async function(){global.wallaby.teardown&&await global.wallaby.teardown()},"in:run":function(r){var e=this;r.reportUnhandledPromises&&P&&(P(),P=void 0),global.$_$coverage=[],r.suppressClearingRequireCache||Object.keys(m).forEach(function(e){var t=m[e];(t.filename&&~t.filename.indexOf(r.root)||r.flushCache)&&delete m[e]}),global.$_$tracer._filePathToFileData={},global.$_$tracer._hints=r.hints,global.$_$tracer._autoConsoleLog=r.autoConsoleLog,global.$_$tracer._captureConsoleLog=r.captureConsoleLog,global.$_$tracer._preserveComments=r.preserveComments,global.$_$tracer._reportConsoleErrorAsError=r.reportConsoleErrorAsError,global.$_$tracer._suppressCallStackEval=r.suppressCallStackEval,global.$_$tracer._updateNoMoreThanOneSnapshotPerTestFileRun=r.updateNoMoreThanOneSnapshotPerTestFileRun,global.$_$tracer._autoExpandAllLogs=r.autoExpandAllLogs;for(var t=0,s=r.files.length;t<s;t++){for(var i=r.files[t],n=global.$_$coverage[i.id]=[],o=0;o<i.rangesLength;o++)n[o]={};i.path&&(global.$_$tracer._filePathToFileData[i.path]=i)}global.$_$baseDir=r.root+p.sep,global.$_$slow=r.slowTestThreshold,global.$_$tests=r.tests;var a=(r.testFiles||[]).map(function(e){return e.path});global.$_$testFiles=r.testFiles,global.wallaby.tests=a,global.$_$session=r.sessionId,global.$_$initialSpecId=1e5*(e._id+1)||1,global.$_$traceContext=r.traceContext,global.$_$profileRun=r.profileRun,global.$_$resolveGetters=r.resolveGetters,global.$_$snapsAutoRun=r.snapsAutoRun||void 0,global.$_$tracer._shouldReportProgramScope=!0,global.$_$tracer.initLoadingPhase(),global.$_$tracer._maxLogEntrySize=r.maxLogEntrySize||global.$_$tracer._maxLogEntrySize,global.$_$tracer._maxTraceSteps=r.maxTraceSteps||global.$_$tracer._maxTraceSteps;try{global.wallaby.testFramework=e._testFrameworkInitializer.init(a)}catch(e){w(e)}if(global.$_$tracer.reportGlobalError=g,global.wallaby.localProjectDir=r.localProjectDir,global.wallaby.projectCacheDir=_,global.wallaby.sessionId=r.sessionId,global.wallaby.workerId=e._id,global.wallaby.runGlobals=r.runGlobals,global.wallaby.customJestConfig=r.customJestConfig,global.$_$tracer._manualTestRun=r.manualTestRun,global.$_$tracer._updateSnapshotsRun=r.updateSnapshotsRun,global.$_$tracer._expressionsToEvaluate=r.expressionsToEvaluate||{},r.processEnvUpdates&&(r.processEnvUpdates.updates&&r.processEnvUpdates.updates.forEach(e=>{process.env[e.variable]=e.value}),r.processEnvUpdates.deletions)&&r.processEnvUpdates.deletions.forEach(e=>{delete process.env[e]}),r.symlinkNodeModules)try{var l=u("fs");l.existsSync(p.join(process.cwd(),"node_modules"))||l.symlinkSync(p.join(r.localProjectDir,"node_modules"),"node_modules","dir")}catch(e){}try{console._times&&console._times.clear()}catch(e){}try{if(u("./runners/node/bootstrap")(r.initializer),global.$_$profileRun&&e.profileRunInTestWorker){const c=new(u("inspector").Session);c.connect(),c.post("Profiler.enable",()=>{c.post("Profiler.start",()=>{global.$_$tracer.start()})}),global.$_$tracer._profileSession=c}else global.$_$tracer.start();e._teardown=r.teardown}catch(e){w(e)}},"in:stop":function(t){var e;global.$_$profileRun&&(global.$_$tracer._profileSession?(global.$_$tracer._profileSession.post("Profiler.stop",(e,{profile:t})=>{e?w(e):this.send({type:"profile",data:t})}),delete global.$_$tracer._profileSession):global.$_$tracer._profileResult&&(this.send({type:"profile",data:global.$_$tracer._profileResult}),delete global.$_$tracer._profileResult));try{process.nextTick!==b&&(process.nextTick=b),global.$_$tracer.reset(),global.$_$tracer.resetEnvGlobal();try{console._times&&console._times.clear()}catch(e){}e=u("./runners/node/teardown")(this._teardown),delete this._teardown}catch(e){w(e)}const r=e=>{l.forEach(function(e){clearTimeout(e)}),l.length=0,c.forEach(function(e){clearInterval(e)}),c.length=0,delete global.$_$coverage,delete global.$_$tests,delete global.$_$session,delete global.$_$initialSpecId,delete global.$_$profileRun,this.send({type:"closed",data:{requestId:t,error:e}})};e instanceof Promise?e.then(()=>r(!1)).catch(e=>{w(e),r(!0)}):r(!1)},"in:ping":function(e){var t=()=>this.send({type:"pong",data:e});process.env.quokka&&global.$_$tracer._asyncCodeMayBeExecuting?global.$_$tracer._pong=t:t()},"in:tracer.resume":function(){global.$_$tracer.resume()},_patchFrameworks:function(){h.patchModule("resolve",e=>{var e=e("resolve"),t=e.sync;return e.sync=function(){var e=arguments[1]=arguments[1]||{};return e.paths=e.paths||[],Array.isArray(e.paths)&&(e.paths=e.paths.concat([global.wallaby._localNodeModules]).concat(process.env.NODE_PATH?process.env.NODE_PATH.split(p.delimiter):[])),t.apply(this,arguments)},e}),h.patchModule("./util/core/wrap-method",e=>{var r=e("./util/core/wrap-method");return r&&r.toString&&~r.toString().indexOf("sinon")?function(e){var t=r.apply(this,arguments);return wallaby._frameworks.sinon.stubs.push(t),t}:r}),h.patchModulesCode([{files:["pretty-format/build/index.js"],replacements:[{from:"options && options.highlight",to:"options && options.highlight && false",optional:!0}]},{files:["@testing-library/react-native/build/helpers/format.js"],replacements:[{from:"function shouldHighlight() {",to:"function shouldHighlight() { return false;",optional:!0}]},{files:["@testing-library/react-native/build/helpers/debugDeep.js"],replacements:[{from:"console.log(`${message}\n\n`, (0, _format.default)(instance, formatOptions));",to:"const __output = (0, _format.default)(instance, formatOptions); console.log(`${message}\n\n`, __output); return __output;",optional:!0},{from:"console.log((0, _format.default)(instance, formatOptions));",to:"const __output = (0, _format.default)(instance, formatOptions); console.log(__output); return __output;",optional:!0}]},{files:["@testing-library/react-native/build/helpers/debugShallow.js"],replacements:[{from:"console.log(`${message}\n\n`, (0, _format.default)(output));",to:"const __output = (0, _format.default)(output); console.log(`${message}\n\n`, __output); return __output;",optional:!0},{from:"console.log((0, _format.default)(output));",to:"const __output = (0, _format.default)(output); console.log(__output); return __output;",optional:!0}]},{files:["@testing-library/dom/dist/pretty-dom.js"],replacements:[{from:"highlight: inNode()",to:"highlight: false",optional:!0},{from:"highlight: shouldHighlight(),",to:"highlight: false,",optional:!0},{from:"const logDOM = (...args) =>",to:"const logDOM = (...args) => (console.log(prettyDOM(...args)), prettyDOM(...args));const logDOM_ = (...args) =>",optional:!0}]},{files:["@testing-library/react/dist/pure.js"],replacements:[{from:"el.forEach(e => console.log((0, _dom.prettyDOM)(e, maxLength, options)))",to:"el.map(e => (console.log((0, _dom.prettyDOM)(e, maxLength, options)), _dom.prettyDOM(e, maxLength, options)))",optional:!0},{from:"console.log((0, _dom.prettyDOM)(el, maxLength, options))",to:"(console.log((0, _dom.prettyDOM)(el, maxLength, options)), _dom.prettyDOM(el, maxLength, options))",optional:!0}]},{files:["@testing-library/react-native/build/helpers/format.js"],replacements:[{from:"highlight: true",to:"highlight: false",optional:!0}]},{files:["@testing-library/react-native/build/helpers/debugDeep.js"],replacements:[{from:"console.log((0, _format.default)(instance));",to:"return (console.log((0, _format.default)(instance)), _format.default(instance));",optional:!0}]}])}},e.exports=function(e,t,r,s,i,n,o,a,l){new S(e,t,r,s,i,n,o,a,l)}},{"./instrumentor":47,"./tracer":69,"./utils":75,"./utils/remapComments":77,fs:void 0,inspector:void 0,lodash:void 0,module:void 0,path:void 0,timers:void 0,"underscore.string":void 0,util:void 0,ws:void 0}],51:[function(u,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Runner=void 0;const l=logger.create("phantomRunner")["debug"];var o=u("phantom");const r=u("./runWorkerPool"),s=u("./browserEnvironment");var a=!1;t.Runner=class{constructor(e){this._project=e,this._screenShotReady=Promise.resolve(!0),this._params=e.settings().env.params,this._viewportSize=e.settings().env.viewportSize,this._clearMemoryCache=e.settings().env.clearMemoryCache,this._phantomjsPath=e.settings().env.runner,this._workerPool=new r.WorkerPool(this._project,{create:_.bind(this._createPhantomInstance,this),recycle:_.bind(this._recyclePhantomInstance,this),healthy:_.bind(this._isPhantomInstanceHealthy,this),prepare:_.bind(this._prepare,this)}),this._browserEnvironment=new s.BrowserEnvironment(e,this._workerPool)}run(e){return this._workerPool.run(e)}_createPhantomInstance(r,t){var s=this;try{var e={dnodeOpts:{weak:!1}},i=(s._phantomjsPath&&(e.binary=s._phantomjsPath),e.onExit=function(e,t){return"SIGSEGV"!==t||a||(console.error("Looks like the PhantomJs version being used is not supported on your OS.\nTry using a different PhantomJs version (https://wallabyjs.com/docs/integration/phantomjs2.html)\nor Chromium/V8 via Electron runner (https://wallabyjs.com/docs/integration/electron.html)"),a=!0),l("Signal killed phantomjs #%s: %s, exit code: %s",r,t,e)},["--disk-cache=yes","--web-security=false"]),n=(s._params.runner&&(i=i.concat(_.filter(s._params.runner.split(" "),function(e){return!(!e||~e.indexOf("--disk-cache=")||~e.indexOf("--web-security="))}))),!1);i.push(function(e){if(!n){if(!e)return n=!0,l("Additional attempt to create phantom instance #%s",r),s._createPhantomInstance(r,t);e.set("onError",function(e){l("PhantomJs failure: %s, recycling phantom instance #%s",e,r),s._workerPool.recycleWorker(r)}),n=!0,t(e)}}),i.push(e),o.create.apply(o,i)}catch(e){l("Error while creating worker #%s: %s",r,e&&(e.stack||e.message)),t()}}_recyclePhantomInstance(e){e.exit(),e.process.kill()}_isPhantomInstanceHealthy(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode}_prepare(s,t){var i=this,n=_.randomId(),o=i._browserEnvironment.sandboxName(t,n);return l("Starting sandbox [%s]",o),Promise.resolve().then(function(){return i._workerPool.cancelled()?Promise.reject({runCancelled:!0}):(l("Preparing sandbox [%s]",o),Promise.all([i._getPage(t),i._browserEnvironment.prepareSandbox(s,n,t)]))}).then(function(e){l("Prepared sandbox [%s]",o);var c=e[0],r=e[1];return Promise.resolve({instance:{resume:function(){c.evaluate(function(){$_$tracer.resume()})},ping:function(e){c.evaluate(function(){},e)},close:function(e){c.stop&&c.stop(),c.close(),e(!0)},closing:function(){i._captureScreenShot(s.screen,c)},start:function(t,e){i._clearMemoryCache&&c.onResourceRequested(function(e,t,r){try{var s,i,n,o,a=global._urlUtil=global._urlUtil||u("url"),l=e.url;!l||0===l.indexOf("data:")||~l.indexOf("wallabyFileId")||(n=(i="/"===(s=a.parse(e.url)).pathname.charAt(0)?s.pathname.substr(1):s.pathname)&&r[i])&&(o=s.search&&s.search.length,t.changeUrl(l+(o?"&":"?")+n.ts+"&wallabyFileId="+n.id),c.clearMemoryCache())}catch(e){console.log(e&&e.message)}},_.noop,s.allFilesHash),c.set("onError",e),c.open(r,function(e){t(e)&&c.evaluate(function(){$_$tracer.start()})})}},name:o,sessionId:n,workerId:t})})}cancel(e){return this._workerPool.cancel(e)}start(){return this._workerPool.start(this._browserEnvironment.webApp())}stop(){this._workerPool.stop()}_captureScreenShot(e,t){if(e){var r=Q.defer();try{t.render(e,function(){r.resolve()}),this._screenShotReady=r.promise}catch(e){r.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",e.message)}}}_getPage(t){var r=this;return r._workerPool.getWorker(t).then(function(e){return r._workerPool.cancelled()?Promise.reject({runCancelled:!0}):e instanceof Error||e.runCancelled?Promise.reject(e):(l("Creating page for worker #"+t),r._createPage(e,t))})}_createPage(n,o){var a=this;return new Promise(function(t,r){var s=!1,e=setTimeout(function(){s||(i(),a._workerPool.recycleWorker(o),l("Phantom page is not created in time, recycling it"),r({runCancelled:!0,rerun:!0}))},400),i=function(){s=!0,clearTimeout(e)};try{n.createPage(function(e){s||(i(),l("Phantom page created"),e.set("viewportSize",a._viewportSize||{width:800,height:600}),t(e))})}catch(e){i(),r(e)}})}}},{"./browserEnvironment":11,"./runWorkerPool":66,phantom:void 0,url:void 0}],52:[function(e,t,r){t.exports=class{constructor(e,t){this._read=e,this._fs=t}stat(){return this._fs.stat.apply(this._fs,arguments)}statSync(){return this._fs.statSync.apply(this._fs,arguments)}readdir(){return this._fs.readdir.apply(this._fs,arguments)}readdirSync(){return this._fs.readdirSync.apply(this._fs,arguments)}readlink(){return this._fs.readlink.apply(this._fs,arguments)}readlinkSync(){return this._fs.readlinkSync.apply(this._fs,arguments)}readFile(e,t,r){e=this._read(e);e?("function"==typeof t&&(r=t,t=null),e.getContent().then(function(e){r(null,t?e:Buffer.from(e))}).catch(function(e){r(e)})):this._fs.readFile.apply(this._fs,arguments)}readFileSync(e,t){var e=this._read(e);return e?(e=e.getContentSync(),t?e:Buffer.from(e)):this._fs.readFileSync.apply(this._fs,arguments)}readJson(e,r){this.readFile(e,(e,t)=>{if(e)r(e);else{let e;try{e=JSON.parse(t.toString("utf-8"))}catch(e){return void r(e)}r(null,e)}})}readJsonSync(e){e=this.readFileSync(e);return JSON.parse(e.toString("utf-8"))}purge(){return this._fs.purge.apply(this._fs,arguments)}}},{}],53:[function(e,t,r){const y=e("path"),b=e("os"),w=e("util.promisify"),s=e("./InputFileSystem"),o=e("./loader"),i=e("../../utils").default,a="WallabyPlugin";let k=process.cwd();k.endsWith("/")&&(k=k.substring(0,k.length-1));const x=y.join(process.cwd(),"wallaby-webpack-entry.js");class n{constructor(e){this._setupFileByFullPath=e}apply(e){e.ensureHook("file").tapAsync(a,(e,t,r)=>{return e.path===x?r(null,{path:x}):(e=this._setupFileByFullPath.get(e.path))&&"string"!=typeof e?r(null,{path:e.fullPath}):void r()})}}class l{constructor(){}apply(e){const s="./node_modules/"+o.pre.id,i="./node_modules/"+o.post.id,n="./node_modules/"+o.single.id;e.ensureHook("file").tapAsync(a,(e,t,r)=>e.relativePath===s?r(null,{path:o.pre.id}):e.relativePath===i?r(null,{path:o.post.id}):e.relativePath===n?r(null,{path:o.single.id}):void r())}}t.exports=class{constructor(e,t,r){if(!e)throw new Error("webpack parameter is mandatory.");this._webpack=e,this._configuration=t||{},r=r||{},Array.isArray(r.setupFiles)||(r.setupFiles=[]),this._setupFiles=[],this._setupFileByFullPath=new Map;for(let e=0;e<r.setupFiles.length;e++){const i=r.setupFiles[e];var s;"string"==typeof i?this._setupFileByFullPath.get(i)||(s=y.resolve(i),this._setupFiles.push(s),this._setupFileByFullPath.set(s,s)):i.code&&i.path&&(s={fullPath:y.resolve(i.path),getContent:async()=>i.code,getContentSync:()=>i.code,ts:(new Date).getTime()},this._setupFileByFullPath.get(s.fullPath)||(this._setupFiles.push(s),this._setupFileByFullPath.set(s.fullPath,s)))}r.mapResourceToPath&&(this._mapResourceToPath=r.mapResourceToPath)}async process(t){this._logger=t.logger,this._logger.debug("Processing started."),this._settings=t.settings;let r=new Map;this._deletedFilePaths=new Set;var e=!!this._compilation;let s;if(e){if(t.anyFilesAdded||t.anyFilesDeleted){this._dependecyFileIdsByFileId={},this._moduleIdByFileFullPath=new Map,this._filePathByModuleId={},this._testFilePathByModuleId={},this._testFileModuleIdByPath={},this._initializeEntry(t.allTestFiles),t.allFiles.forEach(e=>r.set(e.fullPath,e)),t.anyFilesDeleted&&this._fileByFullPath.forEach((e,t)=>r.has(t)?{}:this._deletedFilePaths.add(t)),this._fileByFullPath=r,this._affectedFileByFullPath=r;const m=this._compilation.compiler.inputFileSystem;t.affectedFiles.forEach(e=>m.purge(e.fullPath)),this._deletedFilePaths.forEach(e=>m.purge(e))}else t.affectedFiles.forEach(e=>r.set(e.fullPath,e)),this._affectedFileByFullPath=r;s=this._compilation.compiler}else this._logger.debug("Initializing."),t.allFiles.forEach(e=>r.set(e.fullPath,e)),this._fileByFullPath=r,this._affectedFileByFullPath=r,this._dependecyFileIdsByFileId={},this._moduleIdByFileFullPath=new Map,this._filePathByModuleId={},this._testFilePathByModuleId={},this._testFileModuleIdByPath={},this._compilation=null,this._initializeEntry(t.allTestFiles),this._sanitizeConfiguration(),this._adjustConfiguration(t.timestamp),s=this._createCompiler(),this._customizeCompiler(s);this._prepareCompiler(e,t.anyFilesAdded,t.anyFilesDeleted,t.affectedFiles,s);var i=w(s.compile).bind(s),n=(this._logger.debug("Compilation started%s.",e?" (incremental)":""),await i(),this._compilation);if(n.errors.length){let e;try{e=this._formatErrors(n)}catch(e){throw n.errors[0]}throw new Error(e)}this._logger.debug("Compilation finished.");var o=[];function a(e){return e.buildMeta&&e.buildMeta["aurelia-id"]?e.buildMeta["aurelia-id"]:e.id}for(const _ of(!e||t.anyFilesAdded||t.anyFilesDeleted?n:n.wallaby).modules)if("runtime"!==_.type&&_.resource!==x){var l=this._mapResourceToPath?this._mapResourceToPath(_):_.resource;if(!this._deletedFilePaths.has(l)){this._logger.trace("Processing module %s (%s).",_.id,_.resource||_.userRequest),"string"==typeof l&&(l.startsWith(k)?this._filePathByModuleId[_.id]="."+l.substring(k.length):this._filePathByModuleId[_.id]=l);let e=this._affectedFileByFullPath.get(l)||this._fileByFullPath.get(l);var c,u,p,d,h=_.wallaby||{},g=this._renderModule(n,_);g?(c=(c=_.resourceResolveData&&_.resourceResolveData.patch)?c(g.source()):g.source(),g=g.map(),u=a(_),e&&e.test&&(p=[],this._traverseDependencies(n,_,p),this._dependecyFileIdsByFileId[e.id]=p),p=_.moduleArgument||"module",d=_.exportsArgument||"exports, __webpack_exports__",o.push(t.createFile({path:e?`${e.path}${e.test?"":"."+_.id}.wbp.js`:y.join("__modules",_.id+".js"),original:e,content:`window.__moduleBundler.modules[${JSON.stringify(u)}] = function(__wallaby_webpack_module__, __wallaby_webpack_export__, __webpack_require__) { (function(${p}, ${d}, __webpack_require__) { ${_.strict?'"use strict";':""}${c}${b.EOL}})(${p.split(",").map(()=>"__wallaby_webpack_module__").join(",")}, ${d.split(",").map(()=>"__wallaby_webpack_export__").join(",")}, __webpack_require__); }`,sourceMap:g,ranges:h.ranges,extra:{sourceMap:h.map,testName:h.testName,loggedRanges:h.loggedRanges,numberOfFunctions:h.numberOfFunctions,includedTestFile:h.includedTestFile,excludedTestFile:h.excludedTestFile,notInstrumentedLogMarkers:h.notInstrumentedLogMarkers,liveCommentLines:h.liveCommentLines}})),e||(e=this._setupFileByFullPath.get(l))&&"string"==typeof e&&(e={fullPath:e}),e&&(this._moduleIdByFileFullPath.set(e.fullPath,u),e.test)&&(this._testFilePathByModuleId[_.id]=e.path,this._testFileModuleIdByPath[e.path]=_.id)):this._logger.trace("Ignoring module %s (%s).",_.id,_.resource||_.userRequest)}}if(!e||t.anyFilesAdded||t.anyFilesDeleted){o.push(t.createFile({order:-1,path:"____wallaby-webpack.js",content:this._templates.webpack()})),o.push(t.createFile({order:-.99,path:"____wallaby-webpack-bootstrapper.js",content:this._templates.bootstrapper(this._testFileModuleIdByPath,this._testFilePathByModuleId,this._filePathByModuleId)}));var f=[];for(const v of this._setupFiles){let e;if((e="string"==typeof v?(e=this._fileByFullPath.get(v))||{fullPath:v}:v)&&!e.test){const a=this._moduleIdByFileFullPath.get(e.fullPath);a&&f.push(`window.__moduleBundler.require(${JSON.stringify(a)});`)}}f.length&&o.push(t.createFile({path:"____wallaby-webpack-setup.js",order:1/0,content:f.join(b.EOL)}))}return this._logger.debug("Emitting %s files.",o.length),await Promise.all(o),this._logger.debug("Processing finished."),{testDependencies:this._dependecyFileIdsByFileId}}get _templates(){throw new Error("Not implemented abstract member.")}_initializeEntry(e){this._logger.debug("Initializing entry.");var t=[];for(const r of this._setupFiles){let e;(e="string"==typeof r?(e=this._fileByFullPath.get(r))||{fullPath:r}:r)&&!e.test&&t.push(`require('${i.normalizePath(e.fullPath)}');`)}for(const s of e)t.push(`require('./${s.path}');`);this._entry={path:x,ts:(new Date).getTime(),content:t.join(b.EOL)}}async shutdown(){if(this._compilation){const e=this._compilation.compiler;if(e&&e.close)return new Promise((t,r)=>{e.close(e=>{e?r(e):t()})})}return Promise.resolve()}_sanitizeConfiguration(){this._logger.debug("Sanitizing configuration.");var e=this._configuration;e.module||(e.module={}),e.plugins||(e.plugins=[]),e.resolve||(e.resolve={}),e.resolveLoader||(e.resolveLoader={}),e.resolve.plugins||(e.resolve.plugins=[]),e.resolveLoader.plugins||(e.resolveLoader.plugins=[]),e.optimization||(e.optimization={}),e.entry={main:x},e.mode="none",e.devtool="source-map"}_adjustConfiguration(){this._logger.debug("Adjusting configuration.");var e=this._configuration,t=e.plugins;const r=e=>{var t;return e===x?{getContent:async()=>this._entry.content,getContentSync:()=>this._entry.content}:(t=this._setupFileByFullPath.get(e))&&"string"!=typeof t?t:this._affectedFileByFullPath.get(e)||this._fileByFullPath.get(e)};t.unshift(e=>{e.inputFileSystem=new s(r,e.inputFileSystem)}),t.unshift(new this._webpack.DefinePlugin({"process.env.NODE_ENV":JSON.stringify("development")})),e.resolve.plugins.unshift(new n(this._setupFileByFullPath)),e.resolveLoader.plugins.unshift(new l);t=e.optimization;void 0===t.removeAvailableModules&&(t.removeAvailableModules=!1),void 0===t.removeEmptyChunks&&(t.removeEmptyChunks=!1),void 0===t.mergeDuplicateChunks&&(t.mergeDuplicateChunks=!1),void 0===t.providedExports&&(t.providedExports=!1),void 0===t.splitChunks&&(t.splitChunks=!1)}_createCompiler(){return this._logger.debug("Creating compiler."),this._webpack(this._configuration)}_customizeCompiler(e){this._logger.debug("Customizing compiler."),e.hooks.normalModuleFactory.tap(a,e=>{this._customizeNormalModuleFactory(e)}),e.hooks.thisCompilation.tap(a,e=>{this._initializeCompilation(e),this._customizeCompilation(e)})}_customizeNormalModuleFactory(e){e.hooks.createModule.tap(a,e=>{var t,r;"stylable"!==e.type&&(t=e.loaders,0<e.loaders.length?(e=t[0].loader,r=t[t.length-1].loader,e!==o.post.id&&t.unshift({loader:o.post.id,options:null}),r!==o.pre.id&&t.push({loader:o.pre.id,options:null})):t.push({loader:o.single.id,options:null}))})}_initializeCompilation(e){throw new Error("Not implemented abstract member.")}_customizeCompilation(t){t.wallaby={load:e=>{e=this._mapResourceToPath?this._mapResourceToPath(e):e.resource;return this._affectedFileByFullPath.get(e)||this._fileByFullPath.get(e)},settings:this._settings,logger:this._logger,files:new Set,modules:[]},t.hooks.buildModule.tap(a,e=>{this._logger.trace("Compiled %s.",e.resource||e.userRequest),t.wallaby.modules.push(e)}),t.hooks.shouldGenerateChunkAssets.tap(a,()=>!1)}_prepareCompiler(e,t,r,s,i){}_renderModule(e,t){throw new Error("Not implemented abstract member.")}_traverseDependencies(e,t,r,s){throw new Error("Not implemented abstract member.")}_formatErrors(e){throw new Error("Not implemented abstract member.")}}},{"../../utils":75,"./InputFileSystem":52,"./loader":55,os:void 0,path:void 0,"util.promisify":void 0}],54:[function(n,e,t){n("./modulePatch");const o=n("semver"),a=n("../../utils").default,l=n("./loader"),c=n("./locator");e.exports=i=>(e,t,r)=>{r=r||c.load(i),a.patchModule(l.single.id,()=>l.single),a.patchModule(l.pre.id,()=>l.pre),a.patchModule(l.post.id,()=>l.post);var s=r.version;if(!o.valid(s)||o.lt(s,"4.36.1"))throw new Error("Only Webpack v4.36.1 or higher is supported.");s=o.major(s),s=new(n(4===s?"./v4/Postprocessor":"./v5/Postprocessor"))(r,e,t),r=s.process.bind(s);return r.owner=s,r.bundler={native:!0},r}},{"../../utils":75,"./loader":55,"./locator":56,"./modulePatch":57,"./v4/Postprocessor":58,"./v5/Postprocessor":60,semver:void 0}],55:[function(e,t,r){const c=e("lodash"),u=e("../../utils").default,p=e("../../utils/remapComments").default,d=e("../../instrumentor").default;function s(s,i,e,t){if(this._compilation&&this._compilation.wallaby){var{load:n,settings:o,logger:r,files:a}=this._compilation.wallaby,n;if((n=n(this))&&n.instrument)if(t||this.cacheable.verified)if(a.has(n.id))r.trace("Skipping instrumentation of '%s': file is already instrumented.",n.path);else{Buffer.isBuffer(s)&&65279===(s=s.toString("utf-8")).charCodeAt(0)&&(s=s.substr(1)),r.trace("Instrumenting '%s' [content %s, source-map %s].",n.path,!!s,!!i);let e=c.extend({},o.hints);(!n.test||(e.allowIgnoringCoverageInTests||(e=c.omit(e,"ignoreCoverage","ignoreCoverageForFile")),o.extractComments))&&(e=c.omit(e,"testFileSelection"));let t;try{let r;i&&(n.changeStart||n.logMarkers&&n.logMarkers.length||n.extractedComments&&!n.extractedComments.isCoverageIgnored)&&(r=new u.SourceMapConsumer(i));var l=n.logMarkers||[];(t=d(s,{file:n.id,test:n.test,testFileChangeStart:i?u.mapTextPosition(n.changeStart&&n.changePosition,r):n.changeStart,logMarkers:l.map(e=>({originalRange:e.range,range:u.mapOriginalRangeToTransformed(r,e.range),changeId:e.id,traceId:e.traceId,expanded:e.expanded,new:e.new,exp:e.exp,action:e.action,logpoint:e.logpoint,inlineLogpoint:e.inlineLogpoint})),extractedComments:p(n.extractedComments,s,r),hints:e,recordValues:o.autoConsoleLog,captureConsoleLog:o.captureConsoleLog,preserveComments:o.preserveComments||!1,automaticTestFileSelection:n.test&&!o.extractComments&&o.automaticTestFileSelection,sequenceExpressionToDiff:!1})).liveCommentLines&&i?(r=r||new u.SourceMapConsumer(i),t.liveCommentLines=c.chain(t.liveCommentLines).map((e,t)=>({line:parseInt(t,10),column:e+1})).map(({line:e,column:t})=>u.mapTransformedRangeToOriginal(r,[e,t,e,t])).filter(e=>e&&e.length).map(e=>e[0]).value()):t.liveCommentLines&&(t.liveCommentLines=Object.keys(t.liveCommentLines).map(e=>parseInt(e,10)).filter(e=>e).map(e=>e))}catch(e){throw u.formatInstrumentationError(e,s,n.path)}a.add(n.id),this._module.wallaby={ranges:t.ranges,loggedRanges:t.loggedRanges,map:i,testName:t.testName,numberOfFunctions:t.numberOfFunctions,includedTestFile:t.includedTestFile,excludedTestFile:t.excludedTestFile,notInstrumentedLogMarkers:t.notInstrumentedLogMarkers,liveCommentLines:t.liveCommentLines},s=t.code,i=i?u.combineSourceMaps(i,t.map):t.map,r.trace("Instrumented '%s'.",n.path)}else r.trace("Skipping instrumentation of '%s': file is wrapped by some loader.",n.path)}this.callback(null,s,i,e)}t.exports.pre=function(e,t,r){this.callback(null,e,t,r)},t.exports.pre.pitch=function(){this.cacheable.verified=!0},t.exports.pre.id="wallaby-pre-loader",t.exports.pre.raw=!0,t.exports.post=function(e,t,r){s.apply(this,[e,t,r,!1])},t.exports.post.id="wallaby-post-loader",t.exports.post.raw=!0,t.exports.single=function(e,t,r){s.apply(this,[e,t,r,!0])},t.exports.single.id="wallaby-loader",t.exports.single.raw=!0},{"../../instrumentor":47,"../../utils":75,"../../utils/remapComments":77,lodash:void 0}],56:[function(e,t,r){const i=e("path"),n=e("../../utils").default;t.exports={load:e=>{var t=[];t.length||(t.push(i.join(e,"node_modules/@angular-devkit/build-angular")),t.push(i.join(e,"node_modules/react-scripts")),t.push(i.join(e)));for(const s of t){var r=n.tryRequireModuleWithPathFrom(s,"webpack");if(r&&(r=r.module))return r}throw new Error("Unable to load webpack module.")}}},{"../../utils":75,path:void 0}],57:[function(e,t,r){e("../../utils").default.patchModulesCode([{files:["thread-loader/dist/index.js"],replacements:[{from:"function pitch() {",to:"function pitch() { this.loaders.slice(this.loaderIndex + 1); return;"}]}],"Possibly incompatible/unsupported thread-loader version")},{"../../utils":75}],58:[function(e,t,r){var s=e("../Postprocessor");const i=e("./templates");class n extends s{constructor(e,t,r){super(e,t,r)}get _templates(){return i}_adjustConfiguration(){super._adjustConfiguration();var e=this._configuration;e.cache=!1,void 0===e.module.unsafeCache&&(e.module.unsafeCache=!0)}_initializeCompilation(t){if(this._compilation)t.cache=this._compilation.cache;else{t.cache={};{const i=t.fileTimestamps.get.bind(t.fileTimestamps);t.fileTimestamps.get=e=>{e=i(e);return e||1}}{const n=t.contextTimestamps.get.bind(t.contextTimestamps);t.contextTimestamps.get=e=>{e=n(e);return e||1}}}const r=new Date(864e13).getTime(),s=(this._deletedFilePaths.forEach(e=>{t.fileTimestamps.set(e,r),t.contextTimestamps.set(e,r)}),(new Date).getTime());this._affectedFileByFullPath.forEach(e=>{t.fileTimestamps.set(e.fullPath,s),t.contextTimestamps.set(e.fullPath,s)}),t.fileTimestamps.set(this._entry.path,this._entry.ts),t.createHash=()=>this.hash="",t.sortItemsWithModuleIds=()=>{},t.sortItemsWithChunkIds=()=>{},this._compilation=t}_renderModule(e,t){t=e.moduleTemplates.javascript.render(t,e.dependencyTemplates,{});let r;return r=3===t.children.length?t.children[1]:t.children[2]}_traverseDependencies(e,t,r,s){if(s=s||new Set,t.dependencies)for(const n of t.dependencies){var i;n&&n.module&&n.module.resource&&(i=n.module.resource,!s.has(i))&&(s.add(i),i=this._fileByFullPath.get(i))&&(r.push(i.id),this._traverseDependencies(e,n.module,r,s))}}_formatErrors(t){let r=t.errors[0];var s,i=t.requestShortener;let n="";if((r="string"==typeof r?{message:r}:r).file&&(n+=r.file+`
`),r.module&&r.module.readableIdentifier&&"function"==typeof r.module.readableIdentifier&&(n+=this._formatFilePath(r.module.readableIdentifier(i)),"object"==typeof r.loc&&(t=this._formatLocation(r.loc))&&(n+=" "+t),n+="\n"),n+=r.message,r.origin){if(n+=`
 @ `+this._formatFilePath(r.origin.readableIdentifier(i)),"object"==typeof r.originLoc&&(t=this._formatLocation(r.originLoc))&&(n+=" "+t),r.dependencies)for(const o of r.dependencies)o.loc&&"string"!=typeof o.loc&&(s=this._formatLocation(o.loc))&&(n+=" "+s);let e=r.origin;for(;e.issuer;)e=e.issuer,n+=`
 @ `+e.readableIdentifier(i)}return n}_formatFilePath(e){return e.includes("!")?e.replace(/^(\s|\S)*!/,"")+` (${e})`:""+e}_formatLocation(e){return null===e?"":"string"==typeof e?e:"number"==typeof e?""+e:"object"==typeof e?"start"in e&&e.start&&"end"in e&&e.end?"object"==typeof e.start&&"number"==typeof e.start.line&&"object"==typeof e.end&&"number"==typeof e.end.line&&"number"==typeof e.end.column&&e.start.line===e.end.line?this._formatPosition(e.start)+"-"+e.end.column:this._formatPosition(e.start)+"-"+this._formatPosition(e.end):"start"in e&&e.start?this._formatPosition(e.start):"name"in e&&"index"in e?`${e.name}[${e.index}]`:"name"in e?e.name:this._formatPosition(e):""}_formatPosition(e){return null===e?"":"string"==typeof e?e:"number"==typeof e?""+e:"object"==typeof e?"line"in e&&"column"in e?e.line+":"+e.column:"line"in e?e.line+":?":"index"in e?"+"+e.index:"":""}}t.exports=n},{"../Postprocessor":53,"./templates":59}],59:[function(e,t,r){t.exports={webpack:()=>`
    window.__moduleBundler = {};
    window.__moduleBundler.modules = {};
    window.__moduleBundler.installedModules = {};
    window.__moduleBundler.assert = function(moduleId, suppressTestVerification) {};
    window.__moduleBundler.require = function(moduleId, suppressTestVerification) {    
      // Check if module is in cache
      if(window.__moduleBundler.installedModules[moduleId]) {
          return window.__moduleBundler.installedModules[moduleId].exports;
      }
      
      window.__moduleBundler.assert(moduleId, suppressTestVerification);
      
      // Create a new module (and put it into the cache)
      var module = window.__moduleBundler.installedModules[moduleId] = {
          i: moduleId,
          l: false,
          exports: {}
      };
 
      const executor = window.__moduleBundler.modules[moduleId];
 
      if(!executor) {
        throw new Error('Cannot find module ' + moduleId + '.');
      }
 
      // Execute the module function
      try {
        executor.call(module.exports, module, module.exports, window.__moduleBundler.require);
      } catch (err) {
        if (err && !err.moduleLoadError) {
          if (window.__moduleBundler.filePathByModuleId[moduleId]) {
            err.moduleLoadError = true;
            err.message = window.__moduleBundler.filePathByModuleId[moduleId] + ' : ' + err.message;
          }
        }
        throw err;
      }      
  
      // Flag the module as loaded
      module.l = true;
  
      // Return the exports of the module
      return module.exports;
    };
    
    // expose the modules object (__webpack_modules__)
    window.__moduleBundler.require.m = window.__moduleBundler.modules;
    
    // expose the module cache
    window.__moduleBundler.require.c = window.__moduleBundler.installedModules;
    
    (function() {  
      var hasOwnProperty = Object.prototype.hasOwnProperty;
        
      // define getter function for harmony exports
      window.__moduleBundler.require.d = function(exports, name, getter) {
        if(!hasOwnProperty.call(exports, name)) {
            Object.defineProperty(exports, name, { enumerable: true, get: getter });
        }
      };
    })();
    
    // define __esModule on exports
    window.__moduleBundler.require.r = function(exports) {
      if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
          Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
      }
      Object.defineProperty(exports, '__esModule', { value: true });
    };

    // create a fake namespace object
    // mode & 1: value is a module id, require it
    // mode & 2: merge all properties of value into the ns
    // mode & 4: return value when already ns object
    // mode & 8|1: behave like require
    window.__moduleBundler.require.t = function(value, mode) {
      if(mode & 1) value = window.__moduleBundler.require(value);
      if(mode & 8) return value;
      if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
      var ns = Object.create(null);
      window.__moduleBundler.require.r(ns);
      Object.defineProperty(ns, 'default', { enumerable: true, value: value });
      if(mode & 2 && typeof value != 'string') for(var key in value) window.__moduleBundler.require.d(ns, key, function(key) { return value[key]; }.bind(null, key));
      return ns;
    };
    
    // getDefaultExport function for compatibility with non-harmony modules
    window.__moduleBundler.require.n = function(module) {
        var getter = module && module.__esModule ?
            function getDefault() { return module['default']; } :
            function getModuleExports() { return module; };
        window.__moduleBundler.require.d(getter, 'a', getter);
        return getter;
    };

    window.__moduleBundler.require.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
        
    // __webpack_public_path__
    window.__moduleBundler.require.p = "";
    
    // on error function for async loading
    window.__moduleBundler.require.oe = function(err) { console.error(err); throw err; };
    
    window.__moduleBundler.require.i = function(value) { return value; };
    
    window.__moduleBundler.require.e = function() { return Promise.resolve(); };
  `,bootstrapper:(e,t,r)=>`
    window.__moduleBundler.testFileModuleIdByPath = ${JSON.stringify(e)};
    window.__moduleBundler.testFilePathByModuleId = ${JSON.stringify(t)};
    window.__moduleBundler.filePathByModuleId = ${JSON.stringify(r)};
    window.__moduleBundler.assert = function(moduleId, suppressTestVerification) {
      if(!suppressTestVerification) {
        var path = window.__moduleBundler.testFilePathByModuleId[moduleId];
        if(path) {
          throw new Error("Test file " + path + " is being imported from other test files.\\nThis may cause tests in the file to be executed more than once (when the test file runs and every time it gets imported).\\nIf the test file contains some test helper code, try refactoring the reused code into a file of its own and use it by importing the new helper file where required.");
        }
      }
    };
    window.__moduleBundler.loadTests = function () { 
      window.wallaby._startWhenReceiverIsReady(function() {
        for(var i = 0, len = wallaby.loadedTests.length; i < len; i++)
        {
          var path = wallaby.loadedTests[i];
          if (path && path.length > 7 && path.substr(-7) === ".wbp.js") {
            window.__moduleBundler.require(window.__moduleBundler.testFileModuleIdByPath[path.substr(0, path.length - 7)], true);      
          }
        }
      });
    };    
  `}},{}],60:[function(e,t,r){var s=e("../Postprocessor");const i=e("./templates");class n extends s{constructor(e,t,r){super(e,t,r)}get _templates(){return i}_adjustConfiguration(e){super._adjustConfiguration(e);var t=this._configuration;t.cache&&"filesystem"===t.cache.type?t.cache.version=""+e:t.cache||(t.cache={type:"memory"})}_initializeCompilation(t){var e;if(this._compilation||(e=this._webpack.javascript.JavascriptModulesPlugin,this._javascriptModulesPluginClass=e,this._javascriptModulesPluginInstance=new e),t.fileSystemInfo._fileTimestamps.map){t.compiler.fileTimestamps=new Map;for(var[r,s]of t.fileSystemInfo._fileTimestamps)t.compiler.fileTimestamps.has(r)||t.compiler.fileTimestamps.set(r,s);t.fileSystemInfo._fileTimestamps.stack=[t.compiler.fileTimestamps]}else t.compiler.fileTimestamps=t.fileSystemInfo._fileTimestamps;if(t.fileSystemInfo._contextTimestamps.map){t.compiler.contextTimestamps=new Map;for(var[i,n]of t.fileSystemInfo._contextTimestamps)t.compiler.contextTimestamps.has(i)||t.compiler.contextTimestamps.set(i,n);t.fileSystemInfo._contextTimestamps.stack=[t.compiler.contextTimestamps]}else t.compiler.contextTimestamps=t.fileSystemInfo._contextTimestamps;const o=new Date(864e13).getTime();t.compiler.modifiedFiles=new Set,t.compiler.removedFiles=new Set,this._deletedFilePaths.forEach(e=>{t.compiler.removedFiles.add(e),t.compiler.fileTimestamps.set(e,{safeTime:o,timestamp:o}),t.compiler.contextTimestamps.set(e,{safeTime:o,timestamp:o})}),this._affectedFileByFullPath.forEach(e=>{t.compiler.modifiedFiles.add(e.fullPath),t.compiler.fileTimestamps.set(e.fullPath,{safeTime:e.id+"_"+e.ts,timestamp:e.id+"_"+e.ts})}),t.compiler.fileTimestamps.set(this._entry.path,{safeTime:this._entry.ts,timestamp:this._entry.ts}),this._setupFiles.forEach(e=>{e.ts&&t.compiler.fileTimestamps.set(e.fullPath,{safeTime:e.ts,timestamp:e.ts})}),this._compilation=t}_renderModule(e,t){var r={dependencyTemplates:e.dependencyTemplates,runtimeTemplate:e.runtimeTemplate,moduleGraph:e.moduleGraph,chunkGraph:e.chunkGraph,codeGenerationResults:e.codeGenerationResults,chunk:{}};if(!e.codeGenerationResults.map.has(t))return null;e=this._javascriptModulesPluginClass.getCompilationHooks(e),t=this._javascriptModulesPluginInstance.renderModule(t,r,e,!0);if(!t)return null;let s;r=t.original().getChildren();return s=3===r.length?r[1]:r[2]}_traverseDependencies(e,t,r,s){s=s||new Set;for(const n of e.moduleGraph.getOutgoingConnections(t)){var i;n.module&&n.module.resource&&(i=n.module.resource,!s.has(i))&&(s.add(i),i=this._fileByFullPath.get(i))&&(r.push(i.id),this._traverseDependencies(e,n.module,r,s))}}_formatErrors(t){const r=t.requestShortener;let s=t.errors[0];var i=[];if("string"!=typeof s&&s.module){var n=t.moduleGraph,o=new Set;let e=s.module;for(;e&&!o.has(e);){o.add(e);var a=n.getIssuer(e);if(!a)break;i.push({origin:a,module:e}),e=a}}return"string"==typeof s&&(s={message:s}),i.length&&(s.message=""+s.message+i.map(e=>`
@ `+e.module.readableIdentifier(r)).join()),s.message}}t.exports=n},{"../Postprocessor":53,"./templates":61}],61:[function(e,t,r){t.exports={webpack:()=>`
    window.__moduleBundler = {};
    window.__moduleBundler.modules = {};
    window.__moduleBundler.installedModules = {};
    window.__moduleBundler.assert = function(moduleId, suppressTestVerification) {};
    window.__moduleBundler.require = function(moduleId, suppressTestVerification) {    

      if(window.__moduleBundler.installedModules[moduleId]) {
          return window.__moduleBundler.installedModules[moduleId].exports;
      }
      
      window.__moduleBundler.assert(moduleId, suppressTestVerification);
      
      var module = window.__moduleBundler.installedModules[moduleId] = {
          id: moduleId,
          loaded: false,
          exports: {}
      };
 
      const executor = window.__moduleBundler.modules[moduleId];
 
      if(!executor) {
        throw new Error('Cannot find module ' + moduleId + '.');
      }
      
      // Execute the module function
      try {
        executor.call(module.exports, module, module.exports, window.__moduleBundler.require);
      } catch (err) {
        if (err && !err.moduleLoadError) {
          if (window.__moduleBundler.filePathByModuleId[moduleId]) {
            err.moduleLoadError = true;
            err.message = window.__moduleBundler.filePathByModuleId[moduleId] + ' : ' + err.message;
          }
        }
        throw err;
      }
      
      module.loaded = true;
      
      return module.exports;
    };
        
    (function() {  
      var hasOwnProperty = Object.prototype.hasOwnProperty;
      window.__moduleBundler.require.d = function(exports, definition) {
        for(var key in definition) {
          if(hasOwnProperty.call(definition, key) && !hasOwnProperty.call(exports, key)) {
            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
          }
        }
      };
    })();
    
    window.__moduleBundler.require.r = function(exports) {
      if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
          Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
      }
      Object.defineProperty(exports, '__esModule', { value: true });
    };
    
    window.__moduleBundler.require.p = "";
    
    window.__moduleBundler.require.e = function() { return Promise.resolve(); };
    
    window.__moduleBundler.require.oe = function(err) { console.error(err); throw err; };
    
    window.__moduleBundler.require.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
    
    window.__moduleBundler.require.i = [];
    
    window.__moduleBundler.require.c = window.__moduleBundler.installedModules;
    
    window.__moduleBundler.require.m = window.__moduleBundler.modules;
    
    window.__moduleBundler.require.n = function(module) {
      var getter = module && module.__esModule ?
        function getDefault() { return module['default']; } :
        function getModuleExports() { return module; };
      window.__moduleBundler.require.d(getter, { a: getter });
      return getter;
    };
    
    window.__moduleBundler.require.t = function(value, mode) {
      if(mode & 1) value = this(value);
      if(mode & 8) return value;
      if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
      var ns = Object.create(null);
      window.__moduleBundler.require.r(ns);
      var def = {};
      if(mode & 2 && typeof value == 'object' && value) {
        for(const key in value) def[key] = function() { return value[key]; };
      }
      def['default'] = function() { return value; };
      window.__moduleBundler.require.d(ns, def);
      return ns;
    };
    
    window.__moduleBundler.require.nmd = function(module) {
      module.paths = [];
      if (!module.children) module.children = [];
      return module;
    }

    window.__moduleBundler.require.hmd = function(module) {
      module = Object.create(module);
      if (!module.children) module.children = [];
      Object.defineProperty(module, 'exports', {
        enumerable: true,
        set: function() {
          throw new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);
        }
      });
      return module;
    }
    
    window.__moduleBundler.require.g = (function() {
      if (typeof globalThis === 'object') return globalThis;
      try {
        return this || new Function('return this')();
      } catch (e) {
        if (typeof window === 'object') return window;
      }
    })();
    
    window.__moduleBundler.require.v = function() {
      throw new Error('WASM modules are not supported yet.');
    }

    window.__moduleBundler.require.u = function(chunkId) {
      return chunkId + ".js"
    }

    var baseURI = window.location.origin;
    window.__moduleBundler.require.b = baseURI;
  `,bootstrapper:(e,t,r)=>`
    window.__moduleBundler.testFileModuleIdByPath = ${JSON.stringify(e)};
    window.__moduleBundler.testFilePathByModuleId = ${JSON.stringify(t)};
    window.__moduleBundler.filePathByModuleId = ${JSON.stringify(r)};
    window.__moduleBundler.assert = function(moduleId, suppressTestVerification) {
      if(!suppressTestVerification) {
        var path = window.__moduleBundler.testFilePathByModuleId[moduleId];
        if(path) {
          throw new Error("Test file " + path + " is being imported from other test files.\\nThis may cause tests in the file to be executed more than once (when the test file runs and every time it gets imported).\\nIf the test file contains some test helper code, try refactoring the reused code into a file of its own and use it by importing the new helper file where required.");
        }
      }
    };
    window.__moduleBundler.loadTests = function () { 
      window.wallaby._startWhenReceiverIsReady(function() {
        for(var i = 0, len = wallaby.loadedTests.length; i < len; i++)
        {
          var path = wallaby.loadedTests[i];
          if (path && path.length > 7 && path.substr(-7) === ".wbp.js") {
            window.__moduleBundler.require(window.__moduleBundler.testFileModuleIdByPath[path.substr(0, path.length - 7)], true);      
          }
        }
      });
    };    
  `}},{}],62:[function(e,t,r){"use strict";t.exports=class{constructor(e,t,r){this.type=e.type,this.path=e.path,this.content=t,this.maps=[],this.config=r}rename(e){return this.newPath=e,this}changeExt(e){var t=this.newPath||this.path;return this.newPath=t.substr(0,t.lastIndexOf(".")+1)+e,this}}},{}],63:[function(e,t,r){var s=e("child_process"),i=e("events"),n=e("os"),e=e("util");const o={STARTING:"STARTING",READY:"READY",BUSY:"BUSY"};function a(e){this.process=s.fork(e,["worker"]),this.pid=this.process.pid,this.status=o.STARTING,this.process.once("message",this.onReady.bind(this)),i.EventEmitter.call(this)}function l(e,t){this.workers=[],this.queue=[];var i=this;t=t||n.cpus().length;for(var r=0;r<t;r++)!function r(){var s=new a(e);s.on("ready",i._run.bind(i)),s.process.on("exit",function(e){if(0!==e){for(var t=0;t<i.workers.length;t++)i.workers[t].pid===s.pid&&i.workers.splice(t,1);r()}}),i.workers.push(s)}()}e.inherits(a,i.EventEmitter),a.prototype.onReady=function(){this.status===o.STARTING&&(this.status=o.READY,this.emit("ready",this))},a.prototype.onMessage=function(e,t){e(t),this.status=o.READY,this.emit("ready",this)},a.prototype.send=function(e,t){this.status=o.BUSY,this.emit("busy"),this.process.once("message",this.onMessage.bind(this,t)),this.process.send(e)},l.prototype.enqueue=function(e,t){this.queue.push({task:e,callback:t}),process.nextTick(this._run.bind(this))},l.prototype.stop=function(){_.each(this.workers,function(e){e.process.send({type:"exit"})})},l.prototype._run=function(e){if(0!==this.queue.length){if(!e)for(var t=0;t<this.workers.length;t++)if(this.workers[t].status===o.READY){e=this.workers[t];break}var r;e&&(r=this.queue.shift(),e.send(r.task,r.callback))}},t.exports={_queue:void 0,start:function(e){this._queue||(this._queue=new l(e))},started:function(){return!!this._queue},run:function(e){var s=this;return s._queue?Q.promise(function(t,r){try{s._queue.enqueue(e,function(e){t(e)})}catch(e){r(e)}}):Q.reject(new Error("Processor pool is not started"))},stop:function(){this._queue&&(this._queue.stop(),delete this._queue)}}},{child_process:void 0,events:void 0,os:void 0,util:void 0}],64:[function(e,t,r){"use strict";var n=e("path"),o=e("micromatch").isMatch,s=e("./config").default,i=e("./utils").default,l=e("./preprocessedFile");const{debug:a,trace:c}=logger.create("processor");var u,p=!1,d="Processor must pass a string, an object with code property or an error to done function.";class h{constructor(e,t){this._config=e,this._settingsAreReady=_.isObject(this._config),this._root=t,this._localRoot=this._settingsAreReady?process.cwd():n.dirname(e)}run(i,o,n){var a=this;return(this._settingsAreReady?Q.when(this._config):s(this._config,this._root)).then(e=>{let t=a._processors(e,o,n);if(!t.length)return c("No %s found for %s",n?"compilers":"preprocessors",o.path),Q.when({content:i,noProcessors:!0});n&&(t=[t[0]]);var r=new l(o,i,e);r.additionalPreset=this._additionalPreset(e);let s=Q.when(r);return c("Running %s processor(s) for %s",t.length,o.path),t.forEach(function(r){s=s.then(n=>Q.promise((s,i)=>{try{var e=e=>{if(c("Finished running one processor for %s",o.path),e instanceof Error)i(e);else{if(_.isObject(e)){if(!_.isString(e.code))return void i(new Error(d));var t=e.code,r=e.map||e.sourceMap;r&&(!r.version&&r._mappings&&r.toString&&(r=r.toString()),n.maps.push(r)),e.ranges&&(n.ranges=e.ranges),e.scriptRange&&(n.scriptRange=e.scriptRange),e.noScript&&(n.noScript=e.noScript)}else{if(!_.isString(e))return void i(new Error(d));t=e}n.content=t,s(n)}};if(1===r.length){let t;try{t=r(n)}catch(e){t=e}finally{e(t)}}else 2===r.length?r(n,e):i(new Error("Processor must be an async function with two params, where last param is done callback, or sync function with one param and returning the result."))}catch(e){i(e)}}))}),s})}_additionalPreset(e){if(!p){if(e.testFramework&&e.testFramework.version&&0===e.testFramework.version.indexOf("jest"))try{u=i.requireModuleFrom(this._localRoot,"babel-preset-jest")}catch(e){try{u=i.requireModuleFrom(this._localRoot,"react-scripts/node_modules/babel-preset-jest")}catch(e){a("WARNING: could not find and load babel-preset-jest preset, it is required for correct jest.mock(...) calls hoisting")}}p=!0}return u}_processors(r,s,e){let i=[];e=e?r.compilers:r.preprocessors;return _.each(e,(e,t)=>{if(!_.isString(t))throw new Error("Processor patterns object keys must be strings.");if(!_.isArray(e)&&!_.isFunction(e))throw new Error('Processor(s) for "'+t+'" is specified incorrectly, must be an array of functions or a function.');_.isFunction(e)&&(e=[e]),o(0===(s.path||"").indexOf("..")?n.basename(s.path):s.path,t,{dot:r.dot})&&(i=i.concat(_.map(e,e=>{if(_.isFunction(e))return e;throw new Error('Processor for "'+t+'" is specified incorrectly, must be an array of functions or a function.')})))}),i}}t.exports=e=>new h(e.config,e.root).run(e.content,e.file,"compiler"===e.type)},{"./config":15,"./preprocessedFile":62,"./utils":75,micromatch:void 0,path:void 0}],65:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Project=void 0;const path=require("path"),url=require("url"),semver=require("semver"),utils_1=require("./utils"),config_1=require("./config"),utils_2=require("./extension/shared/utils"),remapComments_1=require("./utils/remapComments"),instrumentor_1=require("./instrumentor");var processor=require("./processor");const testTask_1=require("./testTask");var Tracker=require("./tracking");const{debug,trace}=logger.create("project"),chromeProfileViewer_1=require("./chromeProfileViewer");var cp=require("child_process"),spawn=cp.spawn,spawnedProcesses={},testPathSeparator=(cp.spawn=function(){"cmd"===arguments[0]&&arguments[1]&&3<=arguments[1].length&&"/d"===arguments[1][0]&&"/c"===arguments[1][1]&&(arguments[0]=arguments[1][2],arguments[1].splice(0,3));var e=spawn.apply(this,arguments);try{var t=e.pid;e.on("exit",function(){t&&delete spawnedProcesses[t]}),spawnedProcesses[t]=e}catch(e){}return e},"^#^"),runAlways=1,runOneTime=2,bundleFileId="bundle";const suggestConfigAutoDetectionNotificationIdBase="suggestConfigAutoDetection";class Project extends EventEmitter{constructor(r){super();this._structureFileFormatVersion=25,this._wallabyEmail=utils_2.default.wallabyEmail(),this._diffMatchPatch=r.diffMatchPatch,this._processorPool=r.processorPool,this._runnerResolver=r.runnerResolver,this._fileStructureCachePromise=r.fileStructureCachePromise,this._fileStatPromise=r.fileStatPromise,this._readFilePromise=r.readFilePromise,this._writeFilePromise=r.writeFilePromise,this._unlinkFilePromise=r.unlinkFilePromise,this._unlinkFileSync=r.unlinkFileSync,this._readFileSync=r.readFileSync,this._writeFileSync=r.writeFileSync,this._fileExistsSync=r.fileExistsSync,this._dirRemovePromise=r.dirRemovePromise,this._dirRemoveSync=r.dirRemoveSync,this._dirEnsurePromise=r.dirEnsurePromise,this._dirEnsureSync=r.dirEnsureSync,this._lruCache=require("lru-cache")({max:52428800,length:e=>e.length}),this._configFile=r.configPath,this._structureFile="structure.json",this._allowAutomaticConfigNotification=!0;var t,s,i,n,o,e=suggestConfigAutoDetectionNotificationIdBase+"_"+(r.projectCachePath&&path.basename(r.projectCachePath)),a=r.homeDir||require("os").homedir();if(this._globalSettingsDir=path.join(a,process.env.quokka?".quokka":".wallaby"),r.dirEnsureSync(this._globalSettingsDir),this._notificationSettingsFile=path.join(this._globalSettingsDir,"notifications.json"),this._fileExistsSync(this._notificationSettingsFile)?(this._allowAutomaticConfigNotification=!this.isNotificationMuted(e),this.muteNotification(e)):((a={})[e]={},this._writeFileSync(this._notificationSettingsFile,JSON.stringify(a))),process.env.quokka)try{this._globalSettingsDir=path.join(r.homeDir,".quokka"),this._quokkaTempDir=path.join(this._globalSettingsDir,"data",utils_1.default.randomId()),this._quokkaGlobalSettingsFile=path.join(this._globalSettingsDir,"config.json"),this._quokkaGlobalPackageFile=path.join(this._globalSettingsDir,"package.json"),i=!0,this._root="quokka_fake_path",this._quokkaFileName=r.quokka,this._localRoot=process.cwd(),this._useMemoryFs=r.useMemoryFs,this._originalLocalRoot=this._localRoot;let e=!1;if(r.fileExistsSync(path.join(this._localRoot,"package.json")))try{var l=JSON.parse(r.readFileSync(path.join(this._localRoot,"package.json")).toString());e=l.workspaces&&l.workspaces.length}catch(e){}if(!e){let e=path.dirname(path.join(this._localRoot,this._quokkaFileName));for(;e.length>this._localRoot.length;){if(r.fileExistsSync(path.join(e,"package.json"))){this._originalLocalRoot=this._localRoot,this._originalQuokkaFileName=this._quokkaFileName,this._quokkaFileName=path.join(this._localRoot,this._quokkaFileName).substring(e.length+1),r.quokka=this._quokkaFileName,this._localRoot=e,process.chdir(this._localRoot);break}e=path.dirname(e)}}let t=this._localRoot;for(;t.length>=this._originalLocalRoot.length&&(this._quokkaLocalSettingsFile=path.join(t,".quokka"),!r.fileExistsSync(this._quokkaLocalSettingsFile));)t=path.dirname(t);this._originalRoot=path.join("quokka_fake_path","original"),this._instrumentedRoot=path.join("quokka_fake_path","instrumented"),this._editorTypeScript=r.editorTypeScript,n=!0,r.useMemoryFs(this._root),r.useMemoryFs(this._originalRoot),r.useMemoryFs(this._instrumentedRoot),r.useMemoryFs(path.join(this._root,this._structureFile));var c=path.join(this._localRoot,this._quokkaFileName),u=path.join(this._originalRoot,path.basename(this._quokkaFileName)),p=(r.useMemoryFs(c),r.useMemoryFs(u,utils_1.default.isLevelUpRelativePath(this._quokkaFileName)),o=!0,"// This is an empty file waiting for changes");this._writeFileSync(c,p),this._writeFileSync(u,p),r.useMemoryFs(path.join(this._instrumentedRoot,this._quokkaFileName)),this._fullInstrumentedPathForTestRunner=function(e){return utils_1.default.isLevelUpRelativePath(this._quokkaFileName)?path.relative(this._localRoot,this._quokkaFileName):e.instrumentedPath.replace(this._instrumentedRoot,this._localRoot)},this._snapsOnlyMode=r.snapsOnlyMode,this._snapsAutoRun=r.snapsAutoRun}catch(e){throw new Error(`Failed to initialize Quokka paths
      homeDir: ${r.homeDir}, 
      cwd: ${process.cwd()}
      globalSettingsDir: ${this._globalSettingsDir}
      localSettingsFile: ${this._quokkaLocalSettingsFile}
      quokkaFileName: ${r.quokka}
      init status: ${i}, ${n}, `+o+"\n"+e.stack)}else this._root=r.projectCachePath,this._configFile=r.configPath,this._testsPath=r.testsPath,this._localRoot=path.dirname(this._configFile),this._originalRoot=path.join(this._root,"original"),this._instrumentedRoot=path.join(this._root,"instrumented");if(t=path.join(this._localRoot,"node_modules"),this._nodeModules=this._fileExistsSync(t)?t:void 0,this._packageJson=path.join(this._localRoot,"package.json"),this._babelrc=path.join(this._localRoot,".babelrc"),this._babelrcjs=path.join(this._localRoot,".babelrc.js"),this._localProjectDir=this._localRoot+path.sep,s=path.join(this._instrumentedRoot,"node_modules"),this._screenPath=path.join(this._instrumentedRoot,"screen.png"),this._profilePath=path.join(this._globalSettingsDir,"test.cpuprofile"),!process.env.quokka&&this._nodeModules&&r.nodeModulesLookup(function(e){e.push(t)},function(e){return e.replace(s,t)}),process.env.quokka){const d=path.join(this._globalSettingsDir,"node_modules");r.dirEnsureSync(this._quokkaTempDir),this._writeFileSync(path.join(this._quokkaTempDir,"package.json"),"{}"),r.dirEnsureSync(path.join(this._quokkaTempDir,"node_modules")),r.cidFile=path.join(this._globalSettingsDir,".qid"),r.lkp=path.join(this._globalSettingsDir,".qlc"),this._fileExistsSync(this._quokkaGlobalSettingsFile)||this._writeFileSync(this._quokkaGlobalSettingsFile,"{}"),this._fileExistsSync(this._quokkaGlobalPackageFile)||this._writeFileSync(this._quokkaGlobalPackageFile,"{}"),this._loadQuokkaSettings(r.quokkaSettingsOverride),r.edition=this._quokkaSettings.quokka.edition||"",r.nodeModulesLookup(function(e){e.push(d)})}this._live=!1,this._initialRunSignal=r.waitForInitialRunSignal?new Promise(e=>{debug("waiting for initial run signal"),this._signalInitialRun=e}):Promise.resolve(),this._sourceFileCache={},this._writeSourceFileCache={},this._changeQueue={changes:{},deletes:{}},this._testTask=new testTask_1.TestTask(this),this._tracker=new Tracker(r,process.env.quokka?path.dirname(process.mainModule.filename):this._root),this._init=r._init,this._coreVersion=r.coreVersion,this._allowedToSendBusy=!0}configure(){var i=this;return(process.env.quokka?Q.when(i._quokkaSettings):(0,config_1.default)(i._configFile,i._instrumentedRoot,{forceUpdate:i._forceConfigUpdate})).then(e=>{if(i._settings=e,process.env.quokka)i._settings.extensions={};else{var t;process.version;if(process.env.WALLABY_ELECTRON_RUN_AS_NODE&&0,debug("Wallaby Node version: %s",process.version),debug("Wallaby config: %s",i._configFile),i.runOnSave="onsave"===i._settings.runMode,i._settings.screenshot||(i._screenPath=void 0),i._testsPath?(t=void 0!==i._testsPath&&i._testsPath.length?this._validatePaths(i._testsPath):void 0)&&t.length&&(i._settings.smartStart=i._settings.smartStart.filter(e=>"always"!==e.startMode),t.forEach(e=>{i._settings.smartStart.unshift({test:!0,source:!1,path:e,startMode:"always"})})):delete i._settings.smartStart,i._testLocations&&i._updateSettingsTestLocations(),!i.isNativeBundler()){let s=e.postprocessor;_.isArray(e.postprocessor)?(s=e.postprocessor[0],e.postprocessor=i.isZeroConfigJest()?e.postprocessor[1]:i._combinePostprocessors(e.postprocessor)):i.isZeroConfigJest()&&delete e.postprocessor,i.isVitest()&&delete e.postprocessor,s&&s.ts&&s.filePatterns&&0<_.filter(s.filePatterns,e=>e&&!_.endsWith(e,"*.ts?(x)")&&!_.endsWith(e,"*.ts")).length&&(i._overrideFileTypesIncludedInTypeScriptCompiler=!0,i._overrideFileType=function(e,t,r){return"ts"!==e&&"tsx"!==e&&i._overrideFileTypesIncludedInTypeScriptCompiler&&t!==r&&s.filePatterns&&_.find(s.filePatterns,e=>utils_1.default.pathMatchesPattern(0===t.indexOf("..")?path.basename(t):t,e,{dot:i._settings.dot}))?"ts":void 0})}if(e.configCode=i._fileExistsSync(i._configFile)&&i._readFileSync(i._configFile)||"auto.detect","auto.detect"===e.configCode)try{e.configCode+="#"+utils_1.default.quickHash(JSON.stringify({files:e.files,tests:e.tests}))}catch(e){}}if(e.telemetry&&(i._tracker.start(e),i._testLocations?i._tracker.featureUsed("exclusive.run"):process.env.f4b4b415f5452454?i._tracker.featureUsed("quokka.treasure"):process.env.idm45hb6578bw45t&&i._tracker.featureUsed("quokka.demo"),i._tracker.featureUsed("node."+process.version.split(".")[0])),e.env.phantomDefault)throw new Error("Your wallaby.js configuration is using a deprecated default `env.kind` setting of `phantomjs`.\nTo continue using PhantomJs you must configure this setting explicitly.\nPlease refer to our PhantomJs docs at https://wallabyjs.com/docs/integration/phantomjs2.html for more information.");var r=e.files.length;i._emit({type:"projectConfigured",name:e.name,browser:"browser"===e.env.type,kind:e.env.kind,phantomDefault:e.env.phantomDefault,screenshot:!!e.screenshot,editDelay:e.delays.edit,runOnSave:"onsave"===i._settings.runMode,files:_.map(e.files.concat(e.tests),(e,t)=>(r<=t&&(e.test=!0),e))})}).catch(e=>{i._cleanStack(e,i._fileExistsSync(i._configFile)&&i._configFile),console.error("Failed to load configuration file:",e&&(e.stack||e.message)),console.error("Please refer to our docs: https://wallabyjs.com/docs/config/overview.html "),i._emitTestRunError(e&&(e.stack||e.message))})}profilingSupportedByRunner(){return"node"===this._settings.env.type||"chrome"===this._settings.env.kind||void 0}setLicenseMode(e){this._tracker.mode(e)}reloadQuokkaSettings(){this._settings&&this._settings.quokka&&!1===this._settings.quokka.reloadSettingsOnPackageInstall||(this._loadQuokkaSettings((this._settings||{})._currentInlineQuokkaConfig),this._settings=this._quokkaSettings),this._recycleRunner=!0}allowToRunSnaps(){var e;this._snapsAutoRun=!0,null!=(e=this._quokkaSettings)&&e.quokka&&(this._quokkaSettings.quokka.snapsAutoRun=!0)}_mergeQuokkaSettingsFromQuokkaSettingsFile(e,t){try{var r=this._readFileSync(t);try{var s=JSON.parse(r);try{_.merge(e,s)}catch(e){return`Error merging Quokka settings from: ${t}.`}}catch(e){return`Error parsing Quokka settings "${t}"; make sure that contents are valid JSON.

`+e}}catch(e){}}_loadQuokkaSettings(r){var s,i={globalConfigFile:this._quokkaGlobalSettingsFile,tempDir:this._quokkaTempDir,autoDetect:!0};try{let e=this._mergeQuokkaSettingsFromQuokkaSettingsFile(i,this._quokkaGlobalSettingsFile);if(!e){try{s=JSON.parse(this._readFileSync(this._packageJson)),_.merge(i,s.quokka)}catch(e){s={}}e=this._mergeQuokkaSettingsFromQuokkaSettingsFile(i,this._quokkaLocalSettingsFile)}r&&_.merge(i,r),i.node&&(i.node=i.node.replace(/^~(?=$|\/|\\)/,process.env.HOME));var n=process.versions&&process.versions.pnp,o=(t,e=!0)=>{var r=path.join(this._globalSettingsDir,"node_modules",t),s=path.join(this._localRoot,"node_modules",t);try{if(s=utils_1.default.requireResolve(t,{paths:[this._localRoot]})){let e=s;for(;path.dirname(e)!==e;){if(path.basename(e)===t){s=e;break}e=path.dirname(e)}}}catch(e){}return this._globalSettingsDir!==this._localRoot&&this._fileExistsSync(s)?s:this._fileExistsSync(r)?r:e&&(r=path.join(path.dirname(process.mainModule.filename),"node_modules",t),this._fileExistsSync(r))?path.join(path.dirname(process.mainModule.filename),"node_modules",t):void 0},a=e=>0===e.indexOf(path.join(path.dirname(process.mainModule.filename),"node_modules"));if(this._quokkaFileName.endsWith(".vue")||this._quokkaFileName.endsWith(".svelte"))if(semver.gte(process.versions.node,"18.0.0")){var l=o("vite"),c=o("vite-node");if(l)if(c){if(!a(l))try{var u=require(path.join(c,"package.json"));semver.gte(u.version,"1.2.0")||(e=`Quokka requires vite-node npm package version 1.2.0 or higher for vue/svelte files. Current version is ${u.version}.`)}catch(e){}if(!e)try{var p=require(path.join(l,"package.json"));semver.gte(p.version,"4.5.0")||(e=`Quokka requires vite npm package version 4.5.0 or higher for vue/svelte files. Current version is ${p.version}.`)}catch(e){}e||(i.vite={vitePath:path.join(l,"dist","node","index.js"),viteNodeServerPath:path.join(c,"dist","server.mjs"),viteNodeClientPath:path.join(c,"dist","client.mjs"),fileType:this._quokkaFileName.endsWith(".vue")?"vue":"svelte"},i.stdEsm=!1,i.nativeEsm=!0)}else e="Quokka requires vite-node npm package to be installed for vue/svelte files.";else e="Quokka requires vite npm package to be installed for vue/svelte files."}else e="Quokka requires Node 18.0.0 or higher for vue/svelte files.";else{var d,h,g,f=semver.gte(process.versions.node,"17.0.0")||semver.gte(process.versions.node,"16.12.0")&&semver.lt(process.versions.node,"17.0.0")||semver.gte(process.versions.node,"14.999.999")&&semver.lt(process.versions.node,"15.0.0")||semver.gte(process.versions.node,"12.999.999")&&semver.lt(process.versions.node,"13.0.0");if(s.dependencies&&s.dependencies["vite-node"]||s.devDependencies&&s.devDependencies["vite-node"])if(!i.ts&&!i.babel)if(f)try{d=utils_1.default.requireResolve("vite",{paths:[this._localRoot]}),h=utils_1.default.requireResolve("vite-node/server",{paths:[this._localRoot]}),g=utils_1.default.requireResolve("vite-node/client",{paths:[this._localRoot]}),d=utils_2.default.normalizePath(d).replace("/index.cjs","/dist/node/index.js"),h=path.join(path.dirname(h),path.basename(h,path.extname(h))+".mjs"),g=path.join(path.dirname(g),path.basename(g,path.extname(g))+".mjs"),i.vite={vitePath:d,viteNodeServerPath:h,viteNodeClientPath:g,fileType:"unknown"},i.stdEsm=!1,i.nativeEsm=!0}catch(e){i.e=e.toString()}if(i.vite&&!f)throw new Error("Quokka for vite requires Node 16.12.0 or higher.")}if(i.vite||(("module"===s.type||_.endsWith(this._quokkaFileName,".mjs"))&&!0!==i.stdEsm||!0!==i.stdEsm&&process.env.WALLABY_PNP)&&(i.stdEsm=!1,i.nativeEsm=!0),this._quokkaSettings={quokka:{globalSettingsDir:this._globalSettingsDir,globalSettingsFile:this._quokkaGlobalSettingsFile,edition:i.pro?"pro":"",installPackage:{command:i.installPackageCommand||(n?"yarn add {packageName}":"npm install {packageName}"),dir:i.tempDir,allowToInstallImportedModules:!0},ignoreExternalFileChanges:i.ignoreExternalFileChanges,autoLog:!!i.autoLog,showSingleInlineValue:i.showSingleInlineValue,reloadSettingsOnPackageInstall:i.reloadSettingsOnPackageInstall,allowDebuggerEditAndContinue:!0,vite:!!i.vite,snaps:!0,snapsOnlyMode:this._snapsOnlyMode,snapsAutoRun:this._snapsAutoRun},files:[],tests:[{pattern:this._quokkaFileName,ignore:!1,instrument:!0,trigger:!0,load:!0}],env:{type:"node",runner:process.execPath,params:i.env&&i.env.params||{}},compilers:{},preprocessors:{},testFramework:{version:"quokka@1.0.0",configurator:"",reporter:"",starter:""},delays:{run:i.delay||0,edit:0},workers:{recycle:!!i.recycle,regular:1,initial:1},maxConsoleMessagesPerTest:1/0,autoConsoleLog:!0,quokkaVite:!!i.vite,debug:i.debug,reportConsoleErrorAsError:!0,telemetry:!0,hints:{ignoreCoverage:"ignore coverage"},extractComments:!!i.vite,dot:!0,unresponsiveStandardTimeout:i.unresponsiveStandardTimeout||500,logLimits:{inline:{depth:5,elements:5e3},values:{default:{stringLength:200},autoExpand:{elements:5e3,stringLength:8192,depth:10}}},captureConsoleLog:!0},e)return void(this._quokkaSettings.error=e);"string"==typeof this._quokkaSettings.env.params.env&&_.each(this._quokkaSettings.env.params.env.split(";"),e=>{var t=e.split("=")[0];process.env[t]=e.substring(t.length+1)});let t=!(i.builtInPlugins=[]);if(!1!==i.autoDetect&&!i.vite){let e=path.join(this._localRoot,"node_modules","react-scripts","scripts","utils","createJestConfig.js");try{e=utils_1.default.requireResolve("react-scripts/scripts/utils/createJestConfig",{paths:[this._localRoot]})}catch(e){}this._fileExistsSync(e)&&(t=!0,delete i.ts,i.builtInPlugins.push("auto-detect:create-react-app"),i.babel={ts:!0,presets:["react-app"]},i.plugins=i.plugins||[],s.scripts)&&s.scripts.test&&-1===s.scripts.test.indexOf("--env")&&i.plugins.push("jsdom-quokka-plugin")}var m=t=>{if(!t&&(!1!==i.stdEsm||!1!==i.nativeEsm)||t&&(!0===i.stdEsm||!0===i.nativeEsm)){if(i.stdEsm=!1!==i.stdEsm,i.nativeEsm){i.stdEsm=!1;let e;if(i.node)try{var r=cp.spawnSync(""+i.node,["-v"]);e=(r.stdout||"").toString()}catch(e){debug("An error occurred detecting runner nodejs version: %s",e)}else e=process.version;e&&(e=semver.clean(e),semver.gte(e,"12.0.0"))?(this._quokkaSettings.env.params.runner=this._quokkaSettings.env.params.runner?this._quokkaSettings.env.params.runner+" ":"",semver.gte(e,"14.3.0")&&semver.lt(e,"18.0.0")&&!process.env.WALLABY_ELECTRON_RUN_AS_NODE&&(this._quokkaSettings.env.params.runner+="--experimental-top-level-await "),(semver.gte(e,"19.0.0")&&semver.lt(e,"20.0.0")||semver.lt(e,"20.0.0")&&semver.lt(e,"18.19.0")||semver.gte(e,"20.0.0")&&semver.lt(e,"20.6.0"))&&(t=semver.gte(e,"16.12.0")?"hooks-v2.mjs":"hooks.mjs",this._quokkaSettings.env.params.runner+=`--experimental-loader "${url.pathToFileURL(path.join(path.dirname(process.mainModule.filename),`runners/node/${this._quokkaSettings.testFramework.version}/`+t))}"`)):(i.stdEsm=!0,i.nativeEsm=!1)}i.stdEsm&&(this._quokkaSettings.env.params.runner=this._quokkaSettings.env.params.runner?this._quokkaSettings.env.params.runner+" ":"",this._quokkaSettings.env.params.runner+=`-r "${path.join(path.dirname(process.mainModule.filename),"node_modules/esm-wallaby")}"`,this._quokkaSettings.env.params.env+=";ESM_OPTIONS="+JSON.stringify({await:!0}))}this._quokkaSettings.quokka.nativeEsm=i.nativeEsm},v=i.babel&&!0===i.babel.ts,y=_.endsWith(this._quokkaFileName,".ts")||_.endsWith(this._quokkaFileName,".tsx")||_.endsWith(this._quokkaFileName,".cts")||_.endsWith(this._quokkaFileName,".mts");if(i.vite||!y||v)if(!i.vite&&i.babel){delete i.babel.ts,delete i.ts,process.env.VUE_CLI_BABEL_TRANSPILE_MODULES="true",_.isObject(i.babel)||(i.babel={}),process.env.BABEL_ENV||(process.env.BABEL_ENV=i.babel.env||"test");var b,w=[path.join(this._localRoot,"node_modules","@babel/core"),path.join(this._localRoot,"node_modules","babel-core"),path.join(this._globalSettingsDir,"node_modules","@babel/core"),path.join(this._globalSettingsDir,"node_modules","babel-core")];try{try{const k=utils_1.default.requireResolve("@babel/core",{paths:[this._localRoot]});w.unshift(k)}catch(e){}try{const k=utils_1.default.requireResolve("babel-core",{paths:[this._localRoot]});w.unshift(k)}catch(e){}i.babel.path&&path.resolve(i.babel.path)&&w.unshift(path.resolve(i.babel.path));var k=_.find(w,e=>this._fileExistsSync(e));if(!k)throw new Error("Babel core is not found");~k.indexOf("@babel")&&utils_1.default.patchBabelResolve(k),b=require(k),i.babel.path=k,v&&y&&(i.babel.tsconfigPaths={path:o("tsconfig-paths")}),i.babel.registerPath=o("@babel/register")}catch(e){return void(this._quokkaSettings.error=`Configured to use babel, but can not find babel-core or @babel/core module
${e.message}

Tried to search for babel core in these folders:
`+_.map(w,e=>"  "+e).join("\n"))}t&&utils_1.default.patchModulesCode([{files:["@babel/plugin-proposal-private-property-in-object/lib/index.js"],replacements:[{from:"setTimeout(console.warn, 2500",to:"setTimeout(() => {}, 0",optional:!0}]}]),this._quokkaSettings.compilers[this._quokkaFileName]=require("./babelCompiler")(this._localRoot)(_.extend({babel:b,renameTypeScriptFiles:!1,asyncTransform:i.nativeEsm},_.omit(i.babel,"env","path","polyfill","ignore","tsconfigPaths","registerPath"))),i.babel.version=b.version,m(!0)}else m();else delete i.babel,i.ts=i.ts||{},m(!1);if(!i.vite&&i.ts){var x,S=path.join(this._instrumentedRoot,this._quokkaFileName).replace(/\.[^/.]+$/,""),P=(this._useMemoryFs(S+".js"),this._useMemoryFs(S+".jsx"),delete i.js,_.isObject(i.ts)||(i.ts={}),i.ts.compilerOptions||{}),F=(P.baseUrl&&!path.isAbsolute(P.baseUrl)?P.baseUrl=path.join(this._localRoot,P.baseUrl):P.baseUrl=this._localRoot,i.ts.path);if(F){F=path.resolve(F);try{x=require(F),i.ts.path=F}catch(e){return void(this._quokkaSettings.error='Configured to use "'+F+'" as TypeScript path, but can not find the `typescript` module')}}if(!x)try{F=path.join(this._localRoot,"node_modules","typescript");try{F=utils_1.default.requireResolve("typescript",{paths:[this._localRoot]})}catch(e){}x=require(F)}catch(e){try{F=path.join(this._globalSettingsDir,"node_modules","typescript"),x=require(F)}catch(e){try{F=path.resolve(this._editorTypeScript),x=require(F)}catch(e){try{x=require("typescript"),F=path.join(path.dirname(process.mainModule.filename),"node_modules/typescript")}catch(e){return void(this._quokkaSettings.error="Can not load `typescript`, please install TypeScript as a dependency of your project.")}}}}let e={},t=path.join(this._localRoot,this._quokkaFileName),r=!0;for(;r&&t!==path.dirname(t);){var C=path.dirname(t);if(C===t){r=!1;break}t=C;var T=path.join(t,"tsconfig.json");if(this._fileExistsSync(T)){try{e=require("./typeScriptUtils").getCompilerOptions(x,T)}catch(e){throw new Error(`Error while loading ${T}:
`+e.message)}r=!1}t.length===this._originalLocalRoot.length&&(r=!1)}(P=Object.assign(Object.assign({},e),P)).module=i.nativeEsm?"esnext":"commonjs",P.jsx="react",P.noEmit=!1,P.noEmitOnError=!1,P.emitDeclarationOnly=!1,void 0!==P.target&&(!this._snapsOnlyMode||"ES3"!==P.target&&"ES5"!==P.target)||(P.target="ES6"),delete P.removeComments,process.env.TS_NODE_COMPILER=F;var j=Object.assign(Object.assign({jsx:"react"},i.ts.compilerOptions),{module:i.nativeEsm?"esnext":"commonjs"});try{semver.gte(x.version,"4.1.0")&&(j.jsxImportSource="")}catch(e){}i.nativeEsm||100!==P.moduleResolution&&"bundler"!==P.moduleResolution||(j.moduleResolution="Node16"),process.env.TS_NODE_COMPILER_OPTIONS=JSON.stringify(j);var E,R,I,O=[5110],A=(process.env.TS_NODE_IGNORE_DIAGNOSTICS=process.env.TS_NODE_IGNORE_DIAGNOSTICS?process.env.TS_NODE_IGNORE_DIAGNOSTICS+","+O.join(","):O.join(","),{typescript:x,files:{"**/*.ts?(x)":P,"**/*.cts":P,"**/*.mts":P}});this._quokkaSettings.postprocessor=require("./typeScriptPostprocessor")(this._localRoot)(A),i.ts.path=F,i.ts.version=x.version,i.ts.tsNode={path:o("ts-node")},P&&P.baseUrl&&(i.ts.tsconfigPaths={path:o("tsconfig-paths")}),!i.ts.swc&&void 0!==i.ts.swc||(E=path.join(i.ts.tsNode.path,"dist","transpilers","swc.js"),this._fileExistsSync(E)&&(R=require(path.join(i.ts.tsNode.path,"package.json")).version,!a(I=o("@swc/core",!1)||o("@swc/wasm"))||semver.gte(R,"10.9.2"))?(i.ts.swc=!0,i.ts.swcTranspilerPath=E,i.ts.swcPath=I,i.ts.version+=" + swc"):i.ts.swc=!1),i.ts.compilerOptions=P,i.ts.tsNode.path!==path.join(path.dirname(process.mainModule.filename),"node_modules","ts-node")&&void 0!==process.env.TS_NODE_TRANSPILE_ONLY||(process.env.TS_NODE_TRANSPILE_ONLY="true")}else if(!i.vite){var L=path.join(this._localRoot,this._quokkaFileName),M=!0,D=i.js&&i.js.compilerOptions||null;if(!D)for(;M&&L!==path.dirname(L);){var L=path.dirname(L),$=path.join(L,"jsconfig.json");if(this._fileExistsSync($)){try{D=require("./typeScriptUtils").getCompilerOptions(require("typescript"),$)}catch(e){throw new Error(`Error while loading ${$}:
`+e.message)}M=!1}L.length===this._originalLocalRoot.length&&(M=!1)}D?i.js={compilerOptions:D,tsconfigPaths:{path:o("tsconfig-paths")}}:delete i.js}i.plugins&&i.plugins.length&&(i.plugins=_.uniq(i.plugins)),i.snaps=this._quokkaSettings.quokka.snaps,i.snapsOnlyMode=this._quokkaSettings.quokka.snapsOnlyMode,process.env.quokka=JSON.stringify(i)}catch(e){this._quokkaSettings=this._quokkaSettings||{},this._quokkaSettings.error=e.message}let e=process.version;process.env.WALLABY_ELECTRON_RUN_AS_NODE&&(e+=" - Electron"),this._emitInternal(_.extend({type:"configChanged",settings:this._quokkaSettings},i,{nodeVersion:e}))}_combinePostprocessors(e){const a=this;if(2!==e.length)throw new Error("Only TypeScript postprocessor chaining is supported.");var t=e[0],l=e[1];return function(o){return _.each(o.affectedFiles,e=>{e=a._structure.filesById[e.id];e&&!a._isOriginallyVue(e)&&a._deleteDependantFilesMetadata(e)}),t(o).then(e=>{var t,r,s,i,n;return e.removePostprocessor?(a._settings.postprocessor=l,debug("TypeScript postprocessor is removed as requested by itself"),a._overrideFileTypesIncludedInTypeScriptCompiler=!1):(e=function(e){var t=a._createPostProcessorInputFile(!1,e);return e.originalId&&(t.id=e.originalId,t.originalType=e.originalType),t},t=e=>e&&(_.isEmpty(e.dependant)&&(!e.tmp||e.originalId&&!a._isOriginallyVue(a._structure.filesById[e.originalId]))||a._isOriginallyVue(e)),n=function(e){e=a._structure.filesById[e.id];return!e||_.isEmpty(e.dependant)||a._isOriginallyVue(e)?e:_.values(e.dependant)[0]},a._updateFileOrder(),r=_.chain(a._structure.testFilesInOrder).filter(t).map(e).value(),s=_.chain(a._structure.sourceFilesInOrder).filter(t).map(e).value().concat(r),i=_.chain(o.affectedFiles).map(n).filter(t).map(e).value(),n=_.chain(o.affectedTestFiles).map(n).filter(t).map(e).value(),o=_.extend(o,{allTestFiles:r,allFiles:s,affectedFiles:i,affectedTestFiles:n})),l(o)})}}configFilePath(){return this._configFile}coreVersion(){return this._coreVersion}projectName(){return this._settings.name||path.basename(this._localRoot)}preloadStructure(){return this._fileStructureCachePromise(path.join(this._root,this._structureFile)).then(e=>this._preloadedStructure=e).catch(()=>({}))}signalInitialRun(){this._signalInitialRun&&this._signalInitialRun()}start(r){var u=this,e=u._init(r,u);return u._emitInternal({type:"starting",files:r.files}),e.then(function(){return u._live&&u.stop(),Q.when(!0)}).then(function(){return debug("File cache: %s",u._root),u._live=!1,Promise.all([u._dirEnsurePromise(u._originalRoot),u._dirEnsurePromise(u._instrumentedRoot)])}).catch(function(e){return u._cleanStack(e),u._emitTestRunError(e.stack||e.message),Promise.reject({error:e})}).then(function(){return u._preloadedStructure||u._fileStructureCachePromise(path.join(u._root,u._structureFile))}).catch(function(e){return e&&e.error?Promise.reject(e.error):Q.when({})}).then(function(i){function n(){return u._dirRemovePromise(u._instrumentedRoot).then(function(){return u._dirEnsurePromise(u._instrumentedRoot)})}return Promise.all([u._fileStatPromise(u._packageJson).then(function(e){return Q.when(e.mtime.getTime())}).catch(function(){return Q.when(0)}),u._fileStatPromise(u._babelrc).then(function(e){return Q.when(e.mtime.getTime())}).catch(function(){return Q.when(0)}),u._fileStatPromise(u._babelrcjs).then(function(e){return Q.when(e.mtime.getTime())}).catch(function(){return Q.when(0)})]).then(function(e){var t=e[0],r=e[1],s=e[2];return i.invalidateCache?(debug("Invalidating local cache as requested"),delete i.timestamp,n().then(()=>Q.when({packageJsonTimestamp:t,babelrcTimestamp:r,babelrcJsTimestamp:s}))):t!==i.packageJsonTimestamp?(debug("package.json file change detected, invalidating local cache"),delete i.timestamp,n().then(()=>Q.when({packageJsonTimestamp:t,babelrcTimestamp:r,babelrcJsTimestamp:s}))):r!==i.babelrcTimestamp?(debug(".babelrc file change detected, invalidating local cache"),delete i.timestamp,n().then(()=>Q.when({packageJsonTimestamp:t,babelrcTimestamp:r,babelrcJsTimestamp:s}))):s!==i.babelrcJsTimestamp?(debug(".babelrc.js file change detected, invalidating local cache"),delete i.timestamp,n().then(()=>Q.when({packageJsonTimestamp:t,babelrcTimestamp:r,babelrcJsTimestamp:s}))):i.configCode!==u._settings.configCode||u._structureFileFormatVersion!==i.version?(debug("Config file change detected, invalidating local cache"),delete i.timestamp,n().then(()=>Q.when({packageJsonTimestamp:t,babelrcTimestamp:r,babelrcJsTimestamp:s}))):(i.packageJsonTimestamp=t,i.babelrcTimestamp=r,i.babelrcJsTimestamp=s,Q.when(i))})}).then(async function(e){u._emit({type:"awaitingInitialRunSignal"}),await u._initialRunSignal,e.timestamp||(e.timestamp=Date.now()),u._structure=_.extend({filesByPath:{},filesRenamed:{},filesById:{},testFilesById:{},testFileSelectionById:{included:{},excluded:{}},awaitingFiles:[],configCode:u._settings.configCode},e),u._structure.awaitingFiles=[],u._structure.sourceFilesInOrder=[],u._structure.testFilesInOrder=[],u._structure.notifiedAboutWallabyApp||(process.env.quokka||console.log("Wallaby App (realtime reports) is available at: http://localhost:51245"),u._structure.notifiedAboutWallabyApp=!0);var t=_.reduce(r.files,function(e,t){return e[t.path]=!0,e},{}),a=(_.each(u._structure.filesByPath,function(e){t[e.path]||(e=u._deleteFileMetadata(e))&&((u.isZeroConfigJest()||u.isVitest()||u.isNativeBundler())&&!e.inOriginalFilesCache||u._unlinkFilePromise(e.originalPath),u.isZeroConfigJest()||u.isVitest()||u.isNativeBundler()||u._unlinkFilePromise(e.instrumentedPath))}),[]),l=!!process.env.quokka,c=[],e=(_.each(r.files,function(t){var e=t.path;const r=0===e.indexOf("..")?path.basename(t.path):t.path;t.test||_.find(u._settings.tests,e=>e.ignore&&utils_1.default.pathMatchesPattern(r,e.regexp,e.options))?l=!0:(n=_.find(u._settings.tests,e=>!e.ignore&&utils_1.default.pathMatchesPattern(r,e.regexp,e.options)))&&console.error("File/pattern "+t.path+" is specified in the files list but also found in the tests list: "+n.pattern+".\r\n\tIf it's a test, make sure to exclude it from the files list, for example by adding { pattern: '"+n.pattern+"', ignore: true } to the files list.\r\n\tIf it's not a test, remove it from the tests list.");var s=u._structure.filesByPath[e],i=s&&s.id===t.id,n=!1;if(s?(s.includedExplicitlyTestFile=t.includedExplicitlyTestFile,s.smartModeStart=t.smartModeStart,s=u._createFileMetadata(s,t.id),t.order&&(s.order=t.order),s.ts!==t.ts&&(u._settings.extractComments&&t.coverable||!u.isZeroConfigJest()&&!u.isVitest()&&!u.isNativeBundler())&&(u._structure.awaitingFiles.push(t.id),n=!0)):(s=u._createFileMetadata(t,t.id),(u._settings.extractComments&&t.coverable||!u.isNativeBundler()&&(!u.isZeroConfigJest()&&!u.isVitest()||s.test))&&(u._structure.awaitingFiles.push(t.id),n=!0)),s.includedExplicitlyTestFile&&c.push(s.path),(u.isZeroConfigJest()||u.isVitest())&&(s.validSyntax=!0,i?t.ts!==s.ts&&(!n&&s.test&&(u._structure.awaitingFiles.push(t.id),n=!0),s.changeTs=+new Date):s.changeTs=+new Date),u.isNativeBundler()&&(s.validSyntax=!0,t.ts!==s.ts)&&(s.changeTs=+new Date),!n&&!u.isNativeBundler()&&(!u.isZeroConfigJest()&&!u.isVitest()||s.test)){const o=(e,t)=>e?t?e.toString("base64"):e.toString():"";a.push(u._fileStatPromise(s.originalPath).catch(()=>(trace("No cached file %s, requesting it",t.path),u._structure.awaitingFiles.push(t.id),Q.when(!1))).then(e=>!1===e||(s.inOriginalFilesCache=!0,u.isZeroConfigJest()||u.isVitest())?Q.when(!1):i?u._readFilePromise(s.instrumentedPath).catch(()=>(trace("No instrumented file %s, re-instrumenting original file",t.path),u._readFilePromise(s.originalPath).then(e=>u._processFile(s,o(e,s.binary),void 0,!0,!1)))):u._readFilePromise(s.originalPath).then(e=>(trace("Re-instrumenting original file %s because its ID has changed",t.path),u._processFile(s,o(e,s.binary),void 0,!0,!1)))))}}),u._settings.smartStart&&(u._exclusiveTestRun=!0,c.length?u.setTestLocations(c):(u._tracker.featureUsed("smartStart"),u._testLocations=new Set,u._updateSettingsTestLocations())),l||console.error("No files with tests found, check your tests list patterns."),u._fileOrderUpdatePending=!0,u._runnerResolver(u._settings.env.type,u._settings.env.kind));return u._testRunner=new e(u),Promise.all(a.concat([u._testRunner.start()]))}).catch(function(e){return u._signalIfBecameLive(),u._emitTestRunError(e.message),u._cleanStack(e),Promise.reject(e)}).then(function(){u._signalIfBecameLive()?(debug("File cache is up-to-date, starting full test run"),u._queueTestRunFromFileChanges(null,!0),u._scheduleTestRun()):(debug("File cache requires some updates, waiting required files from IDE"),u._emit({type:"filesRequired",files:u._structure.awaitingFiles}))})}file(r){var e,s=this,t=e=>{e.isTransientChange?!1!==s._hasPendingTransientFileChangesOnly&&(s._hasPendingTransientFileChangesOnly=!0):s._hasPendingTransientFileChangesOnly=!1};if(r.tsOnlyChange)t(r),s._fileChangesInProcess?r.file&&r.file.path&&(e=s._changeQueue.changes[r.file.path])&&e.length&&(e[e.length-1].file.ts=r.file.ts):(e=s._structure.filesByPath[r.file.path])&&(e.ts=r.file.ts),process.env.WALLABY_INTEGRATION_TEST_RUN||s._testRunInProgress||s._emit({type:"testRunReQueued",tsOnlyChange:!0});else{if(s._emitInternal({type:"file",file:r.file,delete:r.delete,inEditor:r.inEditor,logMarkers:r.logMarkers,extractedComments:r.extractedComments,isTransientChange:r.isTransientChange,snapOutputOnlyChange:r.snapOutputOnlyChange}),!process.env.quokka||r.inEditor)return(r.inEditor||process.env.WALLABY_INTEGRATION_TEST_RUN)&&(this._hasAnyPendingInEditorFileChanges=!0),t(r),new Promise(function(e,t){try{s._isTestTriggeringFileChange(r)&&s._tryCancelActiveTestRun(testTask_1.runPriority.fileChangePriority),s._queueFileChange(r),s.paused?(s._hasAnyPendingPausedFileChanges=!0,debug("File changed, but the project is paused")):s.runOnSave&&r.inEditor&&!r.isTransientChange?(debug("File changed in editor and set to only run on save, will not schedule test run"),s._emitInternal({type:"fileMarkersInvalid"})):s._scheduleChangedQueueProcessing(),e(void 0)}catch(e){t(e)}});s._structure&&s._filesAreUpToDate([r.file.id])}}scheduleChangedQueueProcessing(){this._scheduleChangedQueueProcessing()}scheduleChangeQueueProcessingIfInEditorPendingChanges(){this.hasAnyPendingInEditorFileChanges()&&this._scheduleChangedQueueProcessing()}hasAnyPendingPausedFileChanges(){return this._hasAnyPendingPausedFileChanges}hasAnyPendingInEditorFileChanges(){return this._hasAnyPendingInEditorFileChanges}runTests(e){this.runOnSave&&this.scheduleChangeQueueProcessingIfInEditorPendingChanges();var t=this,r=t.settings().quokka;if(r&&e.externalFileChange&&!t._expressionsToEvaluateReceived){if(r.ignoreExternalFileChanges)return;if(t._testRunInProgress)return;if(t._lastRunFinishTime&&+new Date-t._lastRunFinishTime<(r.externalFileChangeTimeout||1e3))return}if(!(r&&e.externalFileChangePath&&e.externalFileChangePath.endsWith(".mjs")&&-1!==e.externalFileChangePath.indexOf(".-timestamp"))){if(delete t._expressionsToEvaluateReceived,t._tryCancelActiveTestRun(e.notManualRun?testTask_1.runPriority.fileChangePriority:testTask_1.runPriority.testRunPriority),e.tests)t._queueRequestedTestRun(e.tests),debug("Requested to run some tests");else if(e.catchup){if(!this._catchupTestTask)throw new Error("Invalid run tests request");if(debug("Debugger stopped"),!this.runOnSave){if(!this._catchupTestTask.hasAnyFiles()&&!this._catchupTestTask.isFullRun())return void delete this._catchupTestTask;t._testTask=this._catchupTestTask}}else t._queueFullTestRun(!0),debug("Requested to run all tests");e.notManualRun&&(debug("Editor requested test run"),t._testTask.setEditorRequestedRun()),e.evaluateExpression&&(debug("Evaluated expression test run"),t._testTask.setEvaluatedExpressionRun()),e.initialTraceRun&&(debug("Debugger start test run"),t._tracker.featureUsed("debug.start"),t._testTask.setInitialTraceRun(e.initialTraceRun)),e.codeClipSharingRun&&(debug("Code Clip sharing test run"),t._testTask.setCodeClipSharingRun(e.codeClipSharingRun)),e.profileRun&&(debug("Profiler start test run"),t._tracker.featureUsed("profile.start"),t._testTask.setProfileRun(e.profileRun)),e.updateSnapshots&&(debug("Snapshots update test run"),t._tracker.featureUsed("updateSnapshots"),t._testTask.setUpdateSnapshotsRun()),t._scheduleTestRun()}}screen(t){var r=this;return r._settings&&"browser"===r._settings.env.type?r._testRunner._screenShotReady.then(function(){return r._readFilePromise(r._screenPath)}).catch(function(){return trace("Unable to load test run screen shot"),Q.when(!1)}).then(function(e){e&&r._emit({type:"screen",screen:Buffer.from(e).toString("base64")},t)}):Q.when(!1)}expressionsToEvaluate(e){this._emitInternal({type:"expressionsToEvaluateReceived",expressionsToEvaluate:e.expressionsToEvaluate}),this._expressionsToEvaluate=e.expressionsToEvaluate,this._expressionsToEvaluateReceived=!0}traceContext(e){(this._traceContext=e)||delete this._catchupTestTask}stop(e,r){var s,i=this;if(i._live=!1,i._tracker.dispose(),clearTimeout(i._emitBusyTimeout),i._quokkaTempDir)try{i._dirRemoveSync(i._quokkaTempDir)}catch(e){}debug("Stopping wallaby.js");try{i._unlinkFileSync(path.join(i._root,i._structureFile))}catch(e){}debug("Killing %s spawned process(es)",_.keys(spawnedProcesses).length),_.each(spawnedProcesses,function(e){try{e.kill()}catch(e){}}),i._multicaster&&i._multicaster.stop(),i._wallabyAppChecker&&i._wallabyAppChecker.stop(),e||i._flushSourceFileCacheSync(),i._uiService&&i._uiService.stop(),debug("Stopping test runner"),i._testRunner&&i._testRunner.stop(),i._profileViewer&&i._profileViewer.stop(),!e&&i._structure&&(s={version:i._structureFileFormatVersion,timestamp:i._structure.timestamp,filesByPath:i._structure.filesByPath,configCode:i._structure.configCode,packageJsonTimestamp:i._structure.packageJsonTimestamp,babelrcTimestamp:i._structure.babelrcTimestamp,babelrcJsTimestamp:i._structure.babelrcJsTimestamp,invalidateCache:i._invalidateCache,notifiedAboutWallabyApp:i._structure.notifiedAboutWallabyApp},_.each(s.filesByPath,function(e,t){delete e.changeTs,delete e.changeStart,delete e.changePosition,delete e.logMarkers,delete e.numberOfFunctionsChanged,delete e.lastChangeIsComplex,delete e.relatedFilesWithTests,delete e.lastSingleChangeTest,delete e.dependant,delete e.parentFilePath,delete e.inOriginalFilesCache,delete e.tmpLineMap,delete e.compiledTmpLineMap,delete e.noCompilers,delete e.noPreprocessors,delete e.sourceMap,delete e.testFilesLoadedFrom,delete e.tests,delete e.notInstrumentedLogMarkers,delete e.liveCommentLines,delete e.logpointInfo,i._settings.extractComments||delete e.extractedComments,r&&r[e.id]&&(e.ts=-1),e.tmp&&(delete s.filesByPath[t],e.notStored||i._unlinkFileSync(e.instrumentedPath))}),e=JSON.stringify(s),debug("Saving file structure"),i._writeFileSync(path.join(i._root,i._structureFile),e))}idByPath(e){e=this._structure.filesByPath[e];if(e)return e.id}invalidateCache(){this._invalidateCache=!0}settings(){return this._settings}setTestLocations(e){if((e=this._validatePaths(e)).length)this._testLocations=new Set(e);else{if(!this._testLocations)return;delete this._testLocations}this._updateSettingsTestLocations(),this._updateIncludedExplicitlyTestFiles()}addTestLocations(e){if((e=this._validatePaths(e)).length){if(this._testLocations&&0!==this._testLocations.size)for(const t of e)this._testLocations.add(t);else this._testLocations=new Set(e);this._updateSettingsTestLocations(),this._updateIncludedExplicitlyTestFiles()}}removeTestLocations(e){if((e=this._validatePaths(e)).length&&this._testLocations){for(const t of e)if(this._testLocations.delete(t),0===this._testLocations.size){delete this._testLocations;break}this._updateSettingsTestLocations(),this._updateIncludedExplicitlyTestFiles()}}hasTestLocation(e){return this._testLocations&&this._testLocations.has(e)}_validatePaths(e){return e?e.filter(e=>-1===e.indexOf("../")):[]}_updateSettingsTestLocations(){if(this._settings.runSelectedTestsOnly=!!this._testLocations,this._testLocations){this._settings.testLocations=[];for(const e of this._testLocations)this._settings.testLocations.push(e)}else delete this._settings.testLocations}_updateIncludedExplicitlyTestFiles(){var e=this._structure.testFilesById;for(const r in e)if(e.hasOwnProperty(r)){var t=e[r];if(this._testLocations){let e=!1;for(const s of this._testLocations)if(""===s||t.path.startsWith(s)){e=!0;break}e?t.includedExplicitlyTestFile=!0:delete t.includedExplicitlyTestFile}else delete t.includedExplicitlyTestFile;this._updateFileStructure(t)}}_cleanStack(e,r){if(e){var s,t,i=process.mainModule&&path.dirname(process.mainModule.filename)||"";if(e.stack&&_.isString(e.stack)?(t=e.stack.toString(),0===(t=e.message&&!~t.indexOf(e.message)?e.message+"\n"+t:t).indexOf("Error: ")&&(t=t.substr(7)),s=!1,t=this._cleanMessage(_.filter(t.split("\n"),(e,t)=>{if(!(s=s||_.contains(e,"quokkaStackTraceMarker")||_.contains(e,"snapRootStackTraceMarker"))&&!_.contains(e,"From previous event:"))return!t||!/(\s+at|^at)\s+/.test(e)||!r&&!_.contains(e,i)||r&&_.contains(e,r)}).join("\n")),i&&(t=t.split(i).join("[wallaby core]"))):t="",!_.isUndefined(t)){e.stack=t;try{Object.defineProperty(e,"stack",{value:t})}catch(e){}}return e}}_cleanMessage(e,t){return(!this._settings||!this._settings.preservePaths)&&e&&_.isString(e)?(t?e.split(t):e.split(this._instrumentedRoot).join(".").split(this._localRoot)).join("."):e}_startProcessorPool(){trace("Starting processor pool (if not yet started)"),this._processorPool.start(process.mainModule.filename)}_tryCancelActiveTestRun(e){process.env.quokka&&(e=testTask_1.runPriority.fileChangePriority),this._runCancelRequester=e;e=this._testRunner&&this._testRunner.cancel(e);e?debug("Test run was cancelled"):!1===e&&debug("Test run is not cancelled because cancel requester does not have enough priority to cancel the run")}_originalLineByFileId(e,t,r){e=this._structure.filesById[e];return e&&e.getFileLineMap()?utils_1.default.getOriginalLineByGeneratedLine(e.getFileLineMap(),t,r):t}_originalLineByFilePath(e,t,r){e=this._structure.filesByPath[e];return e&&e.getFileLineMap()?utils_1.default.getOriginalLineByGeneratedLine(e.getFileLineMap(),t,r):t}stackEntryByFileId(e,t,r){if(e===bundleFileId){var s=this._structure.filesById[bundleFileId];if(!s)return;s=s.fileAndLineByLine(t);if(!s||!_.isNumber(s[0])||!this._structure.filesById[s[0]])return;e=s[0],t=s[1]}s={file:e};return s.line=this._originalLineByFileId(s.file,t,r),s}stackEntryByFilePath(e,t,r){var s=this._structure.filesByPath[e]||this._structure.filesByPath[this._structure.filesRenamed[e]||""];if(s&&((!s.tmp||(s=this._structure.filesById[s.originalId]))&&(!s.childFilePath||(s=this.getFileMetadataByPath(s.childFilePath)))&&(!s||!s.hideFromErrorStackTrace)))return e=s.path,(s={file:s.id}).line=this._originalLineByFilePath(e,t,r),s}stackEntryByFileIdWithoutLineMapping(e,t){e=this._structure.filesById[e];if(e)return{file:e.path,loc:""+t,line:t}}copyToClipboard(e){var t;"string"==typeof e.data?(utils_1.default.copyToClipboard(e.data),this._emit({type:"copyToClipboard",data:e.data})):(e=this._buildObject(e.data),t=(t=require("util")).formatWithOptions?t.formatWithOptions({depth:null},e):t.format(e),utils_1.default.copyToClipboard(t),this._emit({type:"copyToClipboard",data:t}))}formatObject(e){var t=this._buildObject(e),r=require("util"),r=r.formatWithOptions?r.formatWithOptions({depth:null},t):r.format(t);return"string"===e.type.toLowerCase()?`'${(r||"").replace(/'/g,"\\'").replace(/\\"/g,'"')}'`:r}_buildObject(e){let t;switch(e.type.toLowerCase()){case"date":return new Date(e.value).toJSON();case"regexp":return new RegExp((e.value||"").replace(/^\//,"").replace(/\/$/,""));case"symbol":case"boolean":case"string":case"number":return e.capped?e.capped+"...":e.nan?NaN:e.positiveInfinity?1/0:e.negativeInfinity?-1/0:e.value;case"null":return null;case"undefined":return;case"array":t=[];break;default:t={}}return _.each(e.props,e=>this._handleProperty(e,t)),t}_handleProperty(e,t){var r;e.rangeNode||e.functionsNode?_.each(e.props,e=>this._handleProperty(e,t)):e.getter||(e.loadActionNode?t["..."]="...":e.type&&"function"!==e.type&&"symbol"!==e.type&&!e.symbol&&(r=e.name.startsWith("'")&&e.name.endsWith("'")?e.name.substr(1,e.name.length-2).replace(/\\'/g,"'"):e.name,t[r]=this._buildObject(e)))}isNotificationMuted(e){try{return!!JSON.parse(this._readFileSync(this._notificationSettingsFile))[e]}catch(e){console.warn("Unable to read notification settings file: "+(e&&e.message))}}muteNotification(e){try{var t=JSON.parse(this._readFileSync(this._notificationSettingsFile));t[e]={},this._writeFileSync(this._notificationSettingsFile,JSON.stringify(t))}catch(e){console.warn("Unable to read/write notification settings file: "+(e&&e.message))}}_emit(e,t){t&&t.id&&(e.id=t.id),this.emit("message",e)}_emitInternal(e,t){e._internal=!0,this._emit(e,t)}_isJavaScript(e){var t=this;return!!(this._isOriginallyJavaScript(e)||utils_1.default.isJavaScript(e.instrumentedType,this._settings&&this._settings.extensions&&this._settings.extensions.javascript)||_.find(e.dependant,e=>t._isJavaScript(e))||e.instrumentedByTestingFramework)}_isOriginallyJavaScript(e){return utils_1.default.isJavaScript(e.type,this._settings&&this._settings.extensions&&this._settings.extensions.javascript)}_isOriginallyVue(e){return e&&utils_1.default.isVue(e.type)}_isOriginallyCoffeeScript(e){return utils_1.default.isCoffeeScript(e.type,e.originalPath)}_isOriginallyTypeScript(e){return utils_1.default.isTypeScript(e.type)}_isOriginallySvelte(e){return e&&utils_1.default.isSvelte(e.type)}_runTests(e){var t=this,r=(this._traceContext&&this._traceContext.test?(e.setRegularTraceRunTest(this._traceContext.test),this._catchupTestTask.mergeTask(e)):e.isInitialTraceRun()?this._catchupTestTask=new testTask_1.TestTask(this):delete this._catchupTestTask,t._updateFileOrder(),e.isFullRun()),s=e.isManualRun(),i=e.isUpdateSnapshotsRun(),n=e.isFileChangedRun(),o=e.files(),a=e.testData(),l=this._expressionsToEvaluate,c=a&&a.files,a=a&&a.names,u=e.getPriority(),p=this._hasPendingTransientFileChangesOnly;if(delete this._hasAnyPendingPausedFileChanges,n&&(delete this._hasAnyPendingInEditorFileChanges,delete this._hasPendingTransientFileChangesOnly),r&&debug("Running all tests"),n&&c&&_.isEmpty(c)&&!_.find(o,function(e){return t._isJavaScript(e)}))return Q.when({queueAgain:!0});var d=t._structure.sourceFilesInOrder,c=c?t._orderFilesByConfig(t._expandDependantFiles(c)):t._structure.testFilesInOrder,h=_.find(d.concat(c),function(e){return t._isJavaScript(e)&&!e.validSyntax&&e.coverable});if(h)return Q.when({queueAgain:!0,file:h.path});var g,f=t._selectRunnerFiles(c),h=t._selectRunnerFiles(d);if(!f.length&&o){c=_.map(o,e=>e.id);if(_.isEqual(c,t._lastChangedFileIds)||(t._lastChangedFileIds=c),!t._settings.runAllTestsWhenNoAffectedTests||t.hasSomeSelectedTestFiles())return console.log("Can't determine tests to run for the change."),t.hasSomeSelectedTestFiles()||console.log("To run all tests when can not determine tests to run, use `runAllTestsWhenNoAffectedTests: true` configuration option."),Q.when({queueAgain:!0});console.log("Can't determine tests to run for the change, re-running all tests.\nTo prevent the full test run when can not determine tests to run, use `runAllTestsWhenNoAffectedTests: false` configuration option."),f=t._selectRunnerFiles(t._structure.testFilesInOrder),r=!(a=void 0),u=e.getFullRunPriority(),debug("Test task priority upgraded to full run")}else delete t._lastChangedFileIds;process.env.quokka&&t._recycleRunner&&(delete t._recycleRunner,g=!0);d=e.isInitialTraceRun()&&e.initialTraceRunData(),c=this.selectedTestFiles();if(this._settings.smartStart&&!c.hasSomeIncludedTestFiles&&!d)return Q.when({queueAgain:!0});this.settings().runSelectedTestsOnly&&!c.hasSomeIncludedTestFiles&&(h.length=0,f.length=0);c=e.isInitialTraceRun()||e.isRegularTraceRun();const m=e.profileRunData();return t._emitInternal({type:"runningTests",hasPendingTransientFileChangesOnly:p,changeRun:n,fullRun:r,recordTrace:c,userRequestedInitialTraceRun:d,tests:e.tests(),codeClipSharingRun:e.isCodeClipSharingRun()&&e.codeClipSharingRunData()}),t._testRunner.run({framework:t._settings.testFramework,fullRun:r,screen:t._screenPath,filesToLoad:_.filter(h,function(e){return!!e.include}),allFiles:h,testFilesToLoad:_.filter(f,function(e){return!!e.include}),allTestFiles:f,tests:a,priority:u,manualRun:s,updateSnapshotsRun:i,profileRun:!!m||void 0,recycleBeforeRun:g,expressionsToEvaluate:l,traceContext:c&&(this._traceContext||{})||void 0}).then(e=>(e.globalErrors&&e.globalErrors.length||_.each(o,e=>{delete e.testFilesLoadedFrom}),e.testFiles=_.filter(f,e=>!e.tmp),e.profileRunData=m,Q.when(e)))}_expandDependantFiles(t){return _.each(t,function(e){_.extend(t,e.dependant||{})}),t}_fullInstrumentedPathForTestRunner(e){return e.instrumentedPath}_fullLocalPathForTestRunner(e){return path.join(this._localRoot,e.path)}_selectRunnerFiles(e){var r=this;return _.map(e,function(e){var t=path.relative(r._instrumentedRoot,e.instrumentedPath);return{path:r.isZeroConfigJest()||r.isVitest()?r._fullLocalPathForTestRunner(e):r._fullInstrumentedPathForTestRunner(e),relativePath:t,normalizedRelativePath:r.normalizePath(t),ts:e.changeTs,runnerCacheKey:e.runnerCacheKey,id:e.id,tmp:e.tmp,test:e.test,instrument:e.coverable,changeStart:e.changeStart,changePosition:e.changePosition,logMarkers:e.logMarkers,extractedComments:e.extractedComments,relatedFilesWithTests:e.relatedFilesWithTests,parentFilePath:e.parentFilePath,numberOfFunctions:e.numberOfFunctions,childFilePath:e.childFilePath,inOriginalFilesCache:e.inOriginalFilesCache,originalId:e.originalId,originalType:e.originalType||e.type,include:e.include,esm:e.esm,type:e.instrumentedType||e.type,rangesLength:e.ranges&&e.ranges.length||0,shadowed:!_.isEmpty(e.dependant),content:process.env.quokka?r._getQuokkaContent(e):void 0}})}_queueFileChange(e){if(!e.file)throw new Error("File is missing");var t,r=e.file.path;if(!r)throw new Error("File path is missing");(e.delete?(delete this._changeQueue.changes[r],this._changeQueue.deletes[r]=this._changeQueue.deletes[r]||[]):(r=this._changeQueue.changes[r]=this._changeQueue.changes[r]||[],this.paused&&0<r.length&&((t=r[r.length-1]).file={content:t.file.content},delete t.logMarkers,delete t.extractedComments,delete t.delete,delete t.isTransientChange,delete t.suppressesSingleTestFileChangeStart,e.suppressesSingleTestFileChangeStart=!0),r)).push(e),this._changeQueue.containsTestTriggeringFileChanges=this._changeQueue.containsTestTriggeringFileChanges||this._isTestTriggeringFileChange(e)}_emitBusy(e){e&&(this._allowedToSendBusy=!0),this._allowedToSendBusy&&(this._emit({type:"busy"}),this._tracker.busy(),this._allowedToSendBusy=!1,this._emitBusyTimeout=setTimeout(()=>{this._allowedToSendBusy=!0,clearTimeout(this._emitBusyTimeout)},100))}_scheduleChangedQueueProcessing(e){var s=this;e=e||s._settings.delays.update,s._emitBusy(!0),s._changedQueueTimeout&&clearTimeout(s._changedQueueTimeout),s._changedQueueTimeout=setTimeout(function(){var r;s._fileChangesInProcess||s._testRunInProgress||!s._structure?s._scheduleChangedQueueProcessing(Math.max(e,50)):(s._emitBusy(),delete s._changedQueueTimeout,s._fileChangesInProcess=!0,r=!s._live,s._processChangedQueue().then(function(e){s._fileChangesInProcess=!1;var t=r&&s._live;e.length&&(t||_.find(e,function(e){return s._isTestTriggeringFileChange(e)}))?(s._queueTestRunFromFileChanges(e,t),!s._testTriggeringPendingChanges()&&s._live&&s._scheduleTestRun()):(debug("Changes did not trigger any tests"),s._emit({type:"testRunReQueued",snapOutputOnlyChange:process.env.quokka&&e.length&&!e.find(e=>!e.snapOutputOnlyChange)}))}).catch(function(e){debug("Test queueing failure: "+e&&(e.stack||e.message)),s._cleanStack(e),s._emitTestRunError(e&&e.message)}))},e)}_isTestTriggeringFileChange(e){var t="snap"===e.file.type&&!e.inEditor;return e.file.triggersTests&&!t&&!e.snapOutputOnlyChange}_testTriggeringPendingChanges(){return this._changeQueue.containsTestTriggeringFileChanges}_queueTestRunFromFileChanges(e,t){var r,s,i=this;t?i._queueFullTestRun():i._testTask.isFullRun()||(i._testTask.setFileChangeRunPriority(),i._traceContext&&i._traceContext.test&&i._testTask.setRegularTraceRunTest(i._traceContext.test),s=r=!1,_.each(e,function(e){r=r||e.added,s=s||e.deleted;var t=e.file;e.deleted?i._testTask.addTests(e.tests):i._testTask.addChangedFile(t,e.tests)}),r&&i._testTask.filesAdded(),s&&i._testTask.filesDeleted())}_queueRequestedTestRun(e){this._testTask.addTests(e),this._testTask.setTestRunPriority()}_queueFullTestRun(e){this._testTask=new testTask_1.TestTask(this),this._testTask.setFullRunPriority(),e&&this._testTask.setManuallyRequestedRun()}_scheduleTestRun(e){var l=this;l._emitBusy(!0),void 0===e&&(e=!l._firstScheduleTestRunComplete&&process.env.quokka?(l._firstScheduleTestRunComplete=!0,0):l._settings.delays.run),l._testTask&&process.env.quokka&&l._testTask.setFileChangeRunPriority(),l._testRunTimeout&&clearTimeout(l._testRunTimeout),l._testRunTimeout=setTimeout(function(){var n,o,a;l._fileChangesInProcess||l._testRunInProgress||!l._live?l._scheduleTestRun(Math.max(e,l._firstScheduleTestRunComplete?e:50)):(l._emitBusy(),l._emitTestRunStarted(),delete l._testRunTimeout,delete l._runCancelRequester,l._testRunInProgress=!0,n=l._testTask,l._testTask=new testTask_1.TestTask(l),n&&n.anyFilesAdded()&&l._removedPostprocessor&&!l._settings.postprocessor&&_.find(n.files(),e=>l._isOriginallyTypeScript(e))&&(debug("TypeScript file has been added, re-activating TypeScript postprocessor"),l._settings.postprocessor=l._removedPostprocessor,l._overrideFileTypesIncludedInTypeScriptCompiler=!0,delete l._removedPostprocessor),o={},a=[],(l._settings.postprocessor?new Promise(function(e,t){try{var r,s,i;!n.isManualRun()&&!n.isEditorRequestedRun()||n.isFullRun()?(debug("Running postprocessor"),r=n.testData(),s=l._settings.env.bundle&&(n.anyFilesAdded()||n.anyFilesDeleted()),!(i=l._createPostProcessorArgument({timestamp:l._structure.timestamp,native:l.isNativeBundler(),bundleAllowed:s,affectedFiles:_.values(n.files()),affectedTestFiles:r&&r.files,anyFilesAdded:n.anyFilesAdded(),anyFilesDeleted:n.anyFilesDeleted(),logger:{error:function(e){e={stack:e};l._cleanStack(e),a.push({message:e.stack})}},dot:l.settings().dot})).anyFilesAdded&&!i.anyFilesDeleted||l._settings.postprocessor.ts||l._deleteTmpFiles(),e(l._settings.postprocessor(i).then(function(e){return n.filesNotAdded(),n.filesNotDeleted(),s&&i.bundle.length?l._buildBundle(i.bundle).then(()=>e):e}).catch(function(e){return Promise.reject(e)}))):e(void 0)}catch(e){t(e)}}).catch(function(e){return l._runCancelRequester>=n.getPriority()?Promise.reject({runCancelled:!0}):(debug("Postprocessor run failure: "+e&&(e.stack||e.message)),e.postprocessor=!0,Promise.reject(e))}).then(e=>l._runCancelRequester>=n.getPriority()?Promise.reject({runCancelled:!0}):(e&&(debug("Postprocessor execution finished"),e.removePostprocessor&&(debug("Postprocessor is removed as requested by itself"),l._removedPostprocessor=l._settings.postprocessor,l._removedPostprocessor&&l._removedPostprocessor.ts&&(l._overrideFileTypesIncludedInTypeScriptCompiler=!1),delete l._settings.postprocessor),_.isEmpty(e.testDependencies)||(o=e.testDependencies)),!0)):Promise.resolve(!0)).then(function(){return l._testSelectionChanged&&(delete l._testSelectionChanged,n.isFileChangedRun()&&delete l._hasAnyPendingInEditorFileChanges,debug("Promoting test run to full run because of test selection changes"),n.setFullRunPriority()),debug("Test run started; run priority: %s",n.getPriority()),l._runTests(n)}).catch(function(e){return e.runCancelled?(debug("Test run cancelled, re-queueing run data"),Q.when({queueAgain:!0,rerun:e.rerun})):e.postprocessor?(l.isNativeBundler()?l._emitTestRunError(l._cleanStack({stack:utils_1.default.removeAnsi(e.message)}).stack):l._emitTestRunError("Postprocessor run failure: "+e.message),Q.when({queueAgain:!0,testErrorReported:!0})):(l._emitTestRunError((process.env.quokka?"":"Test run failure: ")+(e&&e.message)),Q.when(!1))}).then(function(r){if(debug("Test run finished"),!_.isEmpty(o)&&r&&_.each(r.loadingSequence,(e,t)=>{r.loadingSequence[t]=_.keys(_.reduce((e||[]).concat(o[t]||[]),(e,t)=>(e[t]=!0,e),{}))}),delete l._runCancelRequester,r)if(a.length&&(r.globalErrors=(r.globalErrors||[]).concat(a)),r.profile){l._emit({type:"testRunReQueued",profileRun:!0});var s=l._processProfile(r.profile);if(r.profileRunData&&"editor"===r.profileRunData.target)l._writeFileSync(l._profilePath,JSON.stringify(s)),l._emit({type:"profileAvailable",path:l._profilePath});else{l._profileViewer||(l._profileViewer=new chromeProfileViewer_1.ProfileViewer(l));let e;r.tests&&r.tests[0]&&(e=r.tests[0].name);let t;r.profileRunData&&(t=r.profileRunData.file),l._profileViewer.show(s,t||"Profile",e||"Test profile").catch(e=>{if(e)throw l._cleanStack(e),e})}}else{var i;r.queueAgain?(r.file&&(debug("File has invalid syntax: "+r.file),l._emitTestRunError("Test run failure: file "+r.file+" has invalid syntax"),r.testErrorReported=!0),l._testTask.mergeTask(n),debug("Test run data re-queued"),l._emit({type:"testRunReQueued",rerunScheduled:r.rerun,testErrorReported:r.testErrorReported}),r.rerun&&l._scheduleTestRun(e)):(s=r.globalErrors&&r.globalErrors.length,i=s||l._hadGlobalErrorsPreviousRun,(l._hadGlobalErrorsPreviousRun=s)&&r.testFiles&&(l._lastAffectedTestFileIds=_.map(r.testFiles,e=>e.id)),r.changed=!!n.isFullRun()||_.reduce(n.files(),function(e,t){var r=!!t.lastSingleChangeTest;return delete t.lastSingleChangeTest,e[t.id]={singleTestChange:!i&&r},e},{}),l._emit(l._processCoverageResult({time:r.time,type:"testResults",fullRun:n.isFullRun(),fileChangedRun:n.isFileChangedRun()},r)),debug("Test run result processed and sent to IDE"))}}).catch(function(e){l._testRunInProgress=!1,l._lastRunFinishTime=+new Date,l._testRunTimeout&&(clearTimeout(l._testRunTimeout),l._scheduleTestRun(100)),debug("Failed to process test run results",e.stack),console.error("Failed to process test run results",e.message)}).then(function(){l._testRunInProgress=!1,l._lastRunFinishTime=+new Date,l._testRunTimeout&&(clearTimeout(l._testRunTimeout),l._scheduleTestRun(100))}))},e)}navigationRequested(e){e=utils_1.default.normalizePath(e).split(":");let t=e.slice(0,e.length-1).join(":"),r=(t=path.relative(this._localRoot,t),parseInt(e[e.length-1],10));r?r--:r=0,process.env.quokka&&this._originalQuokkaFileName&&t===this._quokkaFileName&&(t=this._originalQuokkaFileName),this.emit("message",{type:"navigationRequested",path:t,line:r})}_processProfile(e){var i=process.mainModule&&utils_1.default.normalizePath(path.dirname(process.mainModule.filename))||"";return _.each(e.nodes,r=>{var e,t,s;r&&r.callFrame&&r.callFrame.url&&0!==r.callFrame.url.indexOf("node:")&&(~r.callFrame.url.indexOf(i)||0===r.callFrame.url.indexOf("http")&&~r.callFrame.url.indexOf("__wallaby__")&&!_.endsWith(r.callFrame.url,"framework.js")?(r.callFrame.functionName="(worker)",r.callFrame.scriptId="0",r.callFrame.url="",r.callFrame.lineNumber=-1,r.callFrame.columnNumber=-1):((e=r.callFrame.lineNumber+1)&&(s={stack:r.callFrame.url+`:${e}:`+r.callFrame.columnNumber,suppressErrorReporting:!0},this._testRunner.mapStack(s),s.stack.length?([s,t]=s.stack[0],(s=this._getFileMetadataById(s))&&(r.callFrame.lineNumber=t,r.callFrame.columnNumber=0,r.callFrame.url=utils_1.default.fileUrl(this._fullLocalPathForTestRunner(s)))):r.callFrame.lineNumber=e),r.positionTicks&&_.each(r.positionTicks,e=>{var t;1<=e.line&&(t={stack:r.callFrame.url+":"+e.line,suppressErrorReporting:!0},this._testRunner.mapStack(t),t.stack.length)&&(e.line=t.stack[0][1])})))}),e}_buildBundle(e){var i=1/0,n="",o=[],a=1,e=(_.each(e,e=>{e.file.include=!1,e.file.notStored=!0;var t=e.content+"\n",r=(i=Math.min(i,e.file.order),utils_1.default.textLines(t).length),r=a-1+r-1,s=[a,r];s.file=e.file.originalId,o.push(s),a=1+r,n+=t}),{id:bundleFileId,path:"____wallaby-bundle.js",ts:+new Date,tmp:!0,type:"js",instrumentedType:"js",include:!0,order:i-.1,test:!1}),t=this._createFileMetadata(e,e.id);return t.originalId=e.id,t.fileAndLineByLine=function(e){for(var t=0,r=o.length-1;t<=r;){var s=Math.floor((r+t)/2),i=o[s];if(e>=i[0]&&e<=i[1])return[i.file,e-i[0]+1];e>i[1]?t=s+1:r=s-1}},this._fileOrderUpdatePending=!0,this._doWriteFileWithLruCache(t.instrumentedPath,n)}hadGlobalErrorsPreviousRun(e){return void 0!==e&&(this._hadGlobalErrorsPreviousRun=e),this._hadGlobalErrorsPreviousRun}_emitTestRunError(e){this._emit({type:"testRunError",message:this._cleanMessage(e)})}_emitTestRunStarted(){this._emit({type:"testRunStarted"})}_deleteDependantFiles(e,t){var r=this;return t=t||[],_.each(e.dependant,e=>{t.push(r._unlinkFilePromise(e.instrumentedPath).catch(()=>{})),r._deleteDependantFiles(e,t)}),t}async _processChangedQueue(){var t=[],i=[],n=[],o=this._structure,r=this.isZeroConfigJest()||this.isVitest()||this.isNativeBundler(),a=e=>{var t=[];if(e&&e.tests)for(const r in e.tests)e.tests[r]===runOneTime&&delete e.tests[r],t.push(r.split(testPathSeparator));return t};for(const f in this._changeQueue.deletes)for(const m of this._changeQueue.deletes[f]){var s,l=o.filesById[m.file.id];if(l){let e=[];if(this._deleteDependantFiles(l,t),this._deleteFileMetadata(m.file),l.test){this._lastAffectedTestFileIds&&(-1<(s=this._lastAffectedTestFileIds.indexOf(m.file.id))&&this._lastAffectedTestFileIds.splice(s,1),this._lastAffectedTestFileIds.length||(this._lastAffectedTestFileIds=void 0));for(const v in o.filesById){var c=o.filesById[v];for(const y in c.tests)y!==f&&!_.startsWith(y,f+testPathSeparator)||delete c.tests[y]}}else e=a(l);r&&!l.inOriginalFilesCache||t.push(this._deleteSourceFile(l.originalPath)),r||t.push(this._unlinkFilePromise(l.instrumentedPath)),n.push({file:l,deleted:!0,tests:e})}}var u=[];for(const b in this._changeQueue.changes){var p=this._changeQueue.changes[b],d=p[p.length-1],h=o.filesByPath[b];let e=[],t=!1,r=!1,s=!!d;for(const w of p)e=e.concat(w.file.affectedTests||[]),t=t||w.inEditor,r=r||w.suppressesSingleTestFileChangeStart,s=s&&w.snapOutputOnlyChange;var g=h&&h.test||d.file.test,g=(e.length||(e=g?[[d.file.id]]:a(h)),g&&u.push(d.file.id),this._getOrCreateFileMetadata(d.file));g.logMarkers=d.logMarkers,g.extractedComments=d.extractedComments,i.push(this._writeFileChanges(g,d.file.fullContent,p.map(e=>e.file.content),d.file.ts,r,s)),n.push({file:g,added:!h,tests:e,inEditor:t,snapOutputOnlyChange:s})}u.length&&(this._lastAffectedTestFileIds=u),this._changeQueue={changes:{},deletes:{}};try{return await Promise.all(t),await Promise.all(i),this._filesAreUpToDate(n.map(e=>e.file.id)),n}catch(e){return debug("File system update failure: "+e&&(e.stack||e.message)),this._filesAreUpToDate(n.map(e=>e.file.id)),this._cleanStack(e),this._emitTestRunError(e&&e.message),[]}}normalizePath(e){return utils_1.default.normalizePath(e)}_createPostProcessorArgument(e){var c=this,t=c._createPostProcessorInputFile.bind(c,(e=e||{}).native),r=c._settings.testLocations?e=>!(e.tmp||e.test&&!e.includedExplicitlyTestFile):e=>!e.tmp,s=(c._updateFileOrder(),_.chain(c._structure.testFilesInOrder).filter(r).map(t).value()),i=_.chain(c._structure.sourceFilesInOrder).filter(r).map(t).value().concat(s),n=e.affectedFiles&&e.affectedFiles.length&&_.chain(e.affectedFiles).filter(r).map(t).value()||i,r=e.affectedTestFiles&&e.affectedTestFiles.length&&_.chain(e.affectedTestFiles).filter(r).map(t).value()||s,u=(delete e.affectedFiles,delete e.affectedTestFiles,e.bundleAllowed);return _.extend({},{bundle:[],anyFilesAdded:!0,anyFilesDeleted:!1,allFiles:i,allTestFiles:s,affectedFiles:n,affectedTestFiles:r,nodeModulesDir:c._nodeModules,baseDir:e.native?c._localProjectDir:c._instrumentedRoot,tsPostprocessorOnly:c._settings.postprocessor.ts,settings:c._settings,setFileOrder:function(e){var t;return e.file&&e.file.id&&(c._fileOrderUpdatePending=!0,t=c._getFileMetadataById(e.file.id))&&(t.order=e.order),Q.when(e.order)},createFile:async function(e){var t=_.ltrim(path.extname(e.path),"."),r=c.normalizePath(e.path),r=_.extend(e,{id:r,path:r,ts:e.ts||+new Date,tmp:!0,type:t,instrumentedType:t,include:!1!==e.load,order:e.order||0,test:e.test||!1!==e.test&&e.original&&e.original.test}),{includedTestFile:s,excludedTestFile:i}=c._getFileMetadataById(r.id)||{},s=(r.includedTestFile=!!s,r.excludedTestFile=!!i,c.isNativeBundler()),i=c._createFileMetadata(r,r.id);let n=!(c._fileOrderUpdatePending=!0);n=s?u&&!i.test&&"original"in e:u&&!i.test&&"original"in e&&e.content&&0===e.content.indexOf("window.__moduleBundler.cache");let o,a;if(s){if(e.original&&e.original.id&&(o=c._structure.filesById[e.original.id],i.originalId=o.id,i.originalType=o.originalType||o.type,o.dependant||(o.dependant={}),(o.dependant[i.id]=i).ranges)){if(e.sourceMap&&(o.lineMap=utils_1.default.updateFileMap({},[e.sourceMap])),o.ranges=[],e.extra.sourceMap)try{const l=new utils_1.default.SourceMapConsumer(e.extra.sourceMap);_.each(i.ranges||[],e=>{e=utils_1.default.mapTransformedRangeToOriginal(l,e);e&&e[3]===1/0&&(e[3]=e[1]+1),o.ranges.push(e||[])})}catch(e){debug("Failed to map ranges for [%s], error: %s",o.path,e.message)}else o.ranges=i.ranges;o.instrumentedType=t,o.numberOfFunctionsChanged=o.numberOfFunctions!==e.extra.numberOfFunctions,o.numberOfFunctions=e.extra.numberOfFunctions,o.loggedRanges=e.extra.loggedRanges,o.notInstrumentedLogMarkers=e.extra.notInstrumentedLogMarkers,o.liveCommentLines=e.extra.liveCommentLines,o.lastSingleChangeTest=o.test&&!o.numberOfFunctionsChanged&&e.extra.testName||void 0,o.lastSingleChangeTest&&debug("Detected single test [%s] change",e.extra.testName),o.include=!1,i.test&&(c._settings.extractComments?(r=o.extractedComments,c._updateTestFileSelection(o,{includedTestFile:r&&r.testFileSelection&&r.testFileSelection.included,excludedTestFile:r&&r.testFileSelection&&r.testFileSelection.excluded}),r&&delete r.testFileSelection):c._updateTestFileSelection(o,{includedTestFile:e.extra.includedTestFile,excludedTestFile:e.extra.excludedTestFile}))}a=n?e.content:await c._doWriteFileWithLruCache(i.instrumentedPath,e.content)}else{s=e.original&&e.original.id&&e.ranges&&e.sourceMap;e.original&&e.original.id&&((o=c._structure.filesById[e.original.id]).instrumentedType=t,i.originalId=o.id,i.originalType=o.originalType||o.type,i.ranges=o.ranges,i.loggedRanges=o.loggedRanges,i.notInstrumentedLogMarkers=o.notInstrumentedLogMarkers,i.liveCommentLines=o.liveCommentLines,o.dependant||(o.dependant={}),delete o.dependant[i.id],(r=_.values(o.dependant)[0])&&(!1===r.noCompilers?c._deleteFileMetadata(r):r=void 0),o.dependant[i.id]=i,e.sourceMap&&!s&&(o.tmpLineMap=utils_1.default.updateFileMap(r&&(o.compiledTmpLineMap||o.tmpLineMap)||o.lineMap,[e.sourceMap])),s)&&(i.noCompilers=!1,i.sourceMap=e.sourceMap,i.ranges=e.ranges,i.type="js",i.lineMap=utils_1.default.updateFileMap(i.lineMap,[e.sourceMap]),i.coverable=o.coverable,i.hideFromErrorStackTrace=o.hideFromErrorStackTrace,i.numberOfFunctions=o.numberOfFunctions,i.changePosition=_.textIndexPosition(c._getInstrumentedFileContent(o),o.changeStart),i.logMarkers=o.logMarkers,i.extractedComments=o.extractedComments),s?(a=await c._processFile(i,e.content,void 0,!1,!0,!!n),o.tmpLineMap=i.lineMap,o.compiledTmpLineMap=i.lineMap,o.ranges=i.ranges,o.loggedRanges=i.loggedRanges,o.logpointInfo=i.logpointInfo,o.notInstrumentedLogMarkers=i.notInstrumentedLogMarkers,o.liveCommentLines=i.liveCommentLines,o.validSyntax=i.validSyntax,o.include=!1,o.numberOfFunctionsChanged=i.numberOfFunctionsChanged,o.numberOfFunctions=i.numberOfFunctions,o.lastSingleChangeTest=i.lastSingleChangeTest,delete i.lineMap):a=n?e.content:await c._doWriteFileWithLruCache(i.instrumentedPath,e.content)}n&&this.bundle.push({file:i,content:a})}},e,{logger:c._createLogger("postprocessor",e.logger)})}_createLogger(e,t){t=t||{};e=logger.create(e);return{debug:e.debug,trace:e.trace,error:t.error||console.error.bind(console),log:t.log||console.log.bind(console)}}_createPostProcessorInputFile(t,r){var s=this;return{path:t?r.path:s.normalizePath(path.relative(s._instrumentedRoot,r.instrumentedPath)),fullPath:t?path.resolve(path.join(s._localProjectDir,r.path)):r.instrumentedPath,binary:r.binary,ts:r.changeTs,id:r.id,type:!t&&r.instrumentedType||r.type,load:r.include,initialLoad:r.initialInclude,instrument:r.coverable,test:r.test,order:r.order,changeStart:r.changeStart,changePosition:r.changePosition,logMarkers:r.logMarkers,extractedComments:r.extractedComments,getContent:function(){var e;return t?s.getLatestOriginalFileContentByPathAsync(r.path):(e=s._lruCache.get(r.instrumentedPath))?Q.when(e):s._readFilePromise(r.instrumentedPath)},getContentSync:function(){return t?s.getLatestOriginalFileContentByPath(r.path):s._getInstrumentedFileContent(r)},setOrder:function(t,e){s._fileOrderUpdatePending=!0,e&&_.each(r.dependant,e=>{e.order=t}),r.order=t}}}_getQuokkaContent(e){return this._settings.quokka.vite?this._sourceFileCache[e.originalPath].content:this._getInstrumentedFileContent(e)}_getInstrumentedFileContent(e){return this._lruCache.get(e.instrumentedPath)||this._readFileSync(e.instrumentedPath)}getInstrumentedJavaScriptFileContentByPath(e){var t,e=this._structure.filesByPath[e];if(e)return(t={})[e.path]=e,(e=_.find(this._expandDependantFiles(t),e=>_.isEmpty(e.dependant)&&"js"===e.type)||e)&&this._getInstrumentedFileContent(e)}getLatestOriginalFileContentByPath(e){var t,e=this._structure.filesByPath[e];if(e)return(t=this._writeSourceFileCache[e.originalPath]||this._sourceFileCache[e.originalPath])?t.content:!this.isZeroConfigJest()&&!this.isVitest()&&!this.isNativeBundler()||e.inOriginalFilesCache?this._readFileSync(e.originalPath):this._readFileSync(path.join(this._localRoot,e.path))}async getLatestOriginalFileContentByPathAsync(e){var t,e=this._structure.filesByPath[e];if(e)return(t=this._writeSourceFileCache[e.originalPath]||this._sourceFileCache[e.originalPath])?t.content:!this.isZeroConfigJest()&&!this.isVitest()&&!this.isNativeBundler()||e.inOriginalFilesCache?await this._readFilePromise(e.originalPath):await this._readFilePromise(path.join(this._localRoot,e.path))}findTestFile(e){for(var t=this,r=e.files||[],s=0,i=r.length;s<i;s++){var n,o=r[s];if(n=t._structure.testFilesById[o])return n}if(e.testFile&&(n=t._structure.testFilesById[e.testFile]))return n;if(o=t._structure.filesById[r[0]]){var a=_.keys(o.testFilesLoadedFrom||{})[0];if(a)return(n=t._structure.testFilesById[a])&&debug('Test "%s" without test file id mapped to %s (%s)',e.name,n.path,JSON.stringify({log:e.log,filesInvolved:_.map(e.files,function(e){e=t._structure.filesById[e];return e?e.path:"unknown or deleted file"})})),n}}resolveLogEntryRange(e){var t,r;return!("log"!==e.type&&"autoLog"!==e.type&&"diff"!==e.type&&"system"!==e.type||!_.isNumber(e.file)||!_.isNumber(e.range)||(t=this._getFileMetadataById(e.file),r=e.range,t&&(e.range=t.ranges[r],e.range&&!e.range.length&&(e.range=this._findPreviousValidRange(t.ranges,r)),e.range&&e.range.length||delete e.range),0))}addTestFileWithGlobalErrorToTestTask(e){this._testTask&&this._testTask.addTestFileWithGlobalError(e)}_findPreviousValidRange(e,t){for(;0<t;){var r=e[--t];if(r&&r.length)return r}}_processValueExplorerValues(s){_.each(s,({entry:e},t)=>{var r;e.valueBag.data.proxyData&&(t=s[t.split("#")[0]])&&(r=(e,t)=>{t.label=Object.assign({name:t.proxyData.path.join(".")+" "+t.proxyData.trap.toUpperCase()},t.label),t.expressionPath=t.expressionPath.slice().concat(t.proxyData.path.map(e=>"."+e)),e.props.push(t)},(t=t.entry).valueBag.data.proxyContainerNode?r(t.valueBag.data.props[0],e.valueBag.data):(r(r={disallowToCopyPath:!0,disallowToCopyData:!0,expandable:!0,label:{name:"Accessed Members"},props:[],id:t.valueBag.data.id+",proxyNode",proxyNode:!0},e.valueBag.data),t.valueBag.data={disallowToCopyPath:!0,disallowToCopyData:!0,proxyContainerNode:!0,id:t.valueBag.data.id+",valueContainer",autoExpand:t.valueBag.data.autoExpand,changeId:t.valueBag.data.changeId,expandable:!0,label:t.valueBag.data.label,props:[r,Object.assign(Object.assign({},t.valueBag.data),{label:Object.assign({name:"Value"},t.valueBag.data.label)})]}))})}_processCoverageResult(v,s){var y=this,d=(v.ts=Date.now(),v.files=[],v.tests=[],v.testMatchSnapshotCalls={},v.log=s.log,v.globalErrors=s.globalErrors,v.fileChanges=s.fileChanges,v.additionalHeaderMessage=this._additionalHeaderMessage(),y._settings.reportConsoleErrorAsError&&{});const r={};var e=v.log.slice();const l={};v.log=[],_.each(e,function(e){if(!y.resolveLogEntryRange(e)&&"error"===e.type&&d)t={message:"\n"!==e.text&&e.text||"[console.error without any message]",stack:[]},(e.spec?d[e.spec]=d[e.spec]||[]:(v.globalErrors||(v.globalErrors=[]),v.globalErrors)).push(t);else{if(e&&e.valueBag&&e.valueBag.data&&e.valueBag.data.id){if(_.isNumber(e.valueBag.traceStep)&&(l[e.valueBag.traceStep]=e),e.valueBag.data.proxyData)return void(r[e.valueBag.data.id]={entry:e});var t=r[e.valueBag.data.id];if(t)return v.log[t.index]=e,void(t.entry=e);r[e.valueBag.data.id]={index:v.log.length,entry:e}}v.log.push(e)}}),this._processValueExplorerValues(r),debug("Processed console.log entries"),_.each(s.loadingSequence,function(e,r){_.each(e,e=>{var t=y._structure.filesById[e],t=(t&&!y.settings().ignoreFileLoadingDependencyTracking&&(t.testFilesLoadedFrom=t.testFilesLoadedFrom||{},t.testFilesLoadedFrom[r]=runAlways),y._structure.testFilesById[e]);r!==e&&t&&(e=y._structure.testFilesById[r])&&v.globalErrors.push({message:`Test file '${e.path}' is importing or is causing import of another test file '${t.path}'.
This may cause tests in the '${t.path}' file to be executed more than once (when the test file runs and every time it gets imported).
If the '${t.path}' test file contains some test helper code, try refactoring the reused code into a file of its own and use it by importing the new file into '${e.path}' and '${t.path}' test files.`})})}),debug("Processed loading sequences");var i,t,n,b={},h={},g=!1,o=(_.each(s.tests,function(e){if("disabled"!==e.status&&!b[e.id]){e.matchSnapshotCalls&&_.each(e.matchSnapshotCalls,e=>{var t,r=y._structure.filesById[e.fileId];r&&r.matchSnapshotRanges&&(r=r.matchSnapshotRanges[e.snapshotCallRangeId])&&(t=v.testMatchSnapshotCalls[e.fileId]=v.testMatchSnapshotCalls[e.fileId]||{},delete e.snapshotCallRangeId,delete e.fileId,t[r[0]]=e)}),d&&(u=d[e.id])&&(e.log=(e.log||[]).concat(u));for(var t=v.tests,r=v,s=0,i=e.suite.length;s<i;s++){var n=e.suite[s];(r=_.find(t,function(e){return e.name===n&&e.tests}))||t.push(r={name:n,tests:[]}),t=r.tests}var o,a,l,c,u=!(!e.log||!e.log.length),p=y.findTestFile(e);p?(o=p.id,(l=e.suite.slice()).unshift(p.path),l.push(e.name),a=l.join(testPathSeparator),u&&y._testTask.failingTest(o,l),(p=h[a])?(debug("Test name duplicate: "+e.name),e.name+=" #"+p,h[a]=p+1):h[a]=1,l={name:e.name,id:e.id,fileId:o,log:e.log,time:e.time,slow:e.slow,status:e.status,duplicateNumber:p},r.tests.push(l),b[e.id]={out:l,timeRange:e.timeRange},_.each(e.files,function(e){e=y._structure.filesById[e];e&&(e.tests[a]=runAlways)}),c=[],_.each(l.log,function(t){t.external&&t.stack&&(_.each(t.stack,function(e){e=y._structure.filesById[e[0]];e&&(e.tests[a]=e.tests[a]||runOneTime,e.test)&&e.id!==o&&(t._global=!0)}),t._global&&c.push(t),delete t.external),t.snapshot=!(!t.message||!(~t.message.indexOf(".toMatchSnapshot(")||~t.message.indexOf(".toThrowErrorMatchingSnapshot(")||~t.message.indexOf("Snapshot name:")&&~t.message.indexOf("Received")||t.message.startsWith("Snapshot `")&&~t.message.indexOf("mismatched")))}),c.length&&(v.globalErrors=(v.globalErrors||[]).concat(c),l.log=_.filter(l.log,function(e){return!e._global}))):(console.warn("Test without test file id, most likely the test did not run, OR the test/test body is in the file that is not in the `tests` list in the configuration file",{testFileIdCanNotBeDetermined:e.name,id:e.id,log:e.log,filesInvolved:_.map(e.files,function(e){e=y._structure.filesById[e];return e?e.path:"unknown or deleted file"})}),u&&(g=!0))}}),g&&(v.globalErrors||(v.globalErrors=[]),v.globalErrors.unshift({message:"Some of the failing tests can not be reported, check the wallaby console for more details"})),debug("Processed executed tests"),y._updateFileOrder(),_.each(!0===s.changed?y._structure.sourceFilesInOrder.concat(y._structure.testFilesInOrder):_.map(s.changed,function(e,t){return y._getFileMetadataById(t)}),function(e){var t;e&&(t=e.id,_.isNumber(t))&&!s.coverage[t]&&y._isJavaScript(e)&&(s.coverage[t]=[])}),{});if(_.each(s.coverage,function(a,l){l=parseInt(l,10);var c,u,e=s.changed[l],p={id:l,ranges:[],changed:!0===s.changed||!!e,singleTestChanged:!(!e||!e.singleTestChange)||void 0},d=(o[l]=p,y._getFileMetadataById(l)),r=(d.instrumentedByTestingFramework&&(p.instrumentedByTestingFramework=!0),d.notInstrumentedLogMarkers&&(p.notInstrumentedLogMarkers=d.notInstrumentedLogMarkers),d.liveCommentLines&&(p.liveCommentLines=d.liveCommentLines),d.ranges),h=(_.each(d.loggedRanges,(e,t)=>{t=r[t];t&&(t.logged=!0)}),{}),g={},f={},m={};_.each(r,function(i,e){const n=!i.length;var t,r,s,o,e=a[e],e=_.map(e,function(e,t){var r,s;return(t=parseInt(t,10))&&(r=b[t])?((s=r.timeRange)&&((s[0]===e||u&&!n)&&(u=n||(d.test&&y._looksLikeTestDeclarationRange(c,i)&&(v.log.push({type:"system",text:_.isNumber(r.out.time)?r.out.time+"ms":"",file:l,range:c,context:""}),r.out.declaration=c),r.out.start=i,l!==r.out.fileId&&(g[r.out.fileId]=!0),!1)),n),t):null});!n&&(t=(c=i).join("."),s=i[0],(r=f[s])?r.hasMultipleRanges||r.rangeKey===t||(r.hasMultipleRanges=!0):f[s]={rangeKey:t},(r=p.changed||e.length||d.relatedFilesWithTests)||i.hasDuplicates)&&(s={items:i,hits:e},(o=h[t])?(e&&e.length||(m[t]=o),i.logged&&(o.items.logged=i.logged),i.hasDuplicates=!0,o.items.hasDuplicates=!0):(h[t]=s,r&&p.ranges.push(s)))}),_.each(m,e=>{var t=e.items[0],t=f[t];t&&t.hasMultipleRanges&&(e.hits=[])}),_.isEmpty(g)||(d.relatedFilesWithTests=g,_.each(g,function(e,t){t=y._getFileMetadataById(t);t&&(t.relatedFilesWithTests=t.relatedFilesWithTests||{},t.relatedFilesWithTests[d.id]=!0)})),v.files.push(p)}),_.isObject(s.changed)&&(i=function(e){e=o[e];e&&(e.changed=!0,e.singleTestChanged=void 0)},t={},n=function(e){t[e]||(t[e]=!0,(e=y._getFileMetadataById(e))&&e.relatedFilesWithTests&&(i(e.id),_.each(e.relatedFilesWithTests,function(e,t){i(t),n(t)})))},_.each(s.changed,function(e,t){n(t)})),debug("Processed code coverage"),s.trace){v.trace={sequence:[],callStack:s.trace.callStack,tests:s.trace.tests,files:{}};const c=_.values(s.trace.tests);let n=void 0,o=c.shift();const u=[];let a=_.isEmpty(l)?void 0:(e,t)=>{var r=l[t];if(r){delete l[t];var s,[i,n]=r.valueBag.data.id.split(","),i=parseInt(i,10),n=parseInt(n,10);if(e[0]!==i||e[1]!==n)for(s of u.slice().reverse())if(s&&s.data[0]===i&&s.data[1]===n){r.valueBag.traceStep=s.index;break}_.isEmpty(l)&&(a=void 0,u.length=0)}};_.each(s.trace.sequence,(e,t)=>{var r,s=y._getFileMetadataById(e[0]),i=(n&&n.end===v.trace.sequence.length&&(n=void 0),o&&o.start===v.trace.sequence.length&&(n=o,o=c.shift()),!!n);s&&!s.test&&((r=v.trace.files[s.path])?!r.hitFromTest&&i&&(r.hitFromTest=!0,r.start=v.trace.sequence.length):v.trace.files[s.path]={start:v.trace.sequence.length,hitFromTest:i,name:s.path}),a&&(a(e,t),r=e[2],u[r]={data:e,index:t}),v.trace.sequence.push(e)}),debug("Processed code trace")}return v}_looksLikeTestDeclarationRange(e,t){return e&&t&&e[0]<=t[0]&&(e[2]>=t[2]||this.isZeroConfigJest()||this.isVitest()||this.isNativeBundler())}_filesAreUpToDate(e){return this._structure.awaitingFiles=_.without.bind(null,this._structure.awaitingFiles).apply(null,e),this._signalIfBecameLive()}_filesAreRequired(e){this._structure.awaitingFiles=_.union(this._structure.awaitingFiles,e),this._structure.awaitingFiles.length&&(this._live=!0,this._emit({type:"filesRequired",files:this._structure.awaitingFiles}))}_signalIfBecameLive(){if(this._structure&&!this._structure.awaitingFiles.length&&!this._live){this._live=!0;var e={type:"live"};if(process.env.quokka||(e.wallabyAppPort=this._uiService&&this._uiService.port,e.projectCachePath=this._root),this._emit(e),process.env.quokka){let e=process.version;process.env.WALLABY_ELECTRON_RUN_AS_NODE&&(e+=" - Electron"),this._emitInternal(_.extend({type:"configChanged",settings:this._quokkaSettings},JSON.parse(process.env.quokka),{nodeVersion:e}))}return debug("Stopping process pool"),this._processorPool.stop(),!0}}_writeFileChanges(s,i,e,t,n,o){var a,l=this,c=(s.inOriginalFilesCache=!0,s.changeTs=+new Date,[]);_.each(e,function(e){_.isPatch(e)?c.push(e):(a=e,c.length=0)}),void 0!==i&&(a=i);const u=c.length===e.length&&void 0===i;return trace("File %s changes are patches only: %s",s.path,u),Promise.all([u||process.env.quokka?l._readOriginalSourceFile(s.id,s.originalPath):Q.when(!1),l._dirEnsurePromise(path.dirname(s.originalPath)),l._dirEnsurePromise(path.dirname(s.instrumentedPath))]).then(function(e){u&&(a=e[0]);var r=void 0;return delete s.lastChangeIsComplex,_.each(c,function(e){var t=l._diffMatchPatch.patch_fromText(e);1===c.length&&3===e.split("@@").length?s.test&&!n&&_.each(t,function(e){e.diffs&&e.diffs.length&&2===e.diffs[0].length&&!e.diffs[0][0]&&(r=e.start2+e.diffs[0][1].length)}):s.lastChangeIsComplex=!0,void 0===i&&(a=l._diffMatchPatch.patch_apply(t,a)[0])}),process.env.quokka&&l._quokkaFileChanged(a),Promise.all([s.binary?l._doWriteFile(s.originalPath,Buffer.from(a,"base64")):l._writeSourceFile(s.originalPath,a),l._processFile(s,a,r,!l._live,!1,!1,o)])}).then(function(){return s.ts=t,trace("File %s changes saved, store ts: %s, change ts: %s",s.path,s.ts,s.changeTs),Q.when(!0)})}_quokkaFileChanged(content){var inlineConfig,inlineConfigString,file;if(content){var match=/^[\s;]*(\s*\/\/.*?\r?\n)*\s*\(\s*?{/.exec(content);if(match&&match[0]){for(var braceStack=[],start=match[0].length-1,i=start,len=content.length;i<len;i++){var character=content[i];if("{"===character?braceStack.push(character):"}"===character&&braceStack.pop(),!braceStack.length)break}try{inlineConfig=eval(_ad9‍.c("("+content.substring(start,i+1)+")")),inlineConfigString=JSON.stringify(inlineConfig)}catch(e){}}}this._settings._currentInlineQuokkaConfigString!==inlineConfigString&&(this._loadQuokkaSettings(inlineConfig),this._settings=this._quokkaSettings,this._settings._currentInlineQuokkaConfigString=inlineConfigString,this._settings._currentInlineQuokkaConfig=inlineConfig,file=this._structure.filesByPath[this._quokkaFileName],delete file.noCompilers,delete file.noPreprocessors,this._recycleRunner=!0)}isZeroConfigJest(){return!(!this._settings.testFramework.version||0!==this._settings.testFramework.version.indexOf("jest")||!this._settings.testFramework.autoDetected)}isVitest(){return!(!this._settings.testFramework.version||0!==this._settings.testFramework.version.indexOf("vitest")||!this._settings.testFramework.autoDetected)}isNodeJasmine(){return!("node"!==this._settings.env.type||!this._settings.testFramework.version||0!==this._settings.testFramework.version.indexOf("jasmine"))}isQuokkaVite(){return!(!this._settings.quokka||!this._settings.quokka.vite)}hasGlobalSetupOrTeardown(){return!!this._settings.globalSetup}isNativeBundler(){return this._settings.postprocessor&&this._settings.postprocessor.bundler&&this._settings.postprocessor.bundler.native}_notInstrumented(t,r,e){if(trace("File "+t.path+" is not instrumented by core"),t.validSyntax=!0,this.isZeroConfigJest()||this.isVitest()||this.isQuokkaVite()){if(!this.isQuokkaVite()&&(t.changeStart=e,t.changeStart?t.changePosition=_.textIndexPosition(r,t.changeStart):delete t.changePosition,!t.binary)&&t.test&&!process.env.quokka){let e;var s,i;this._settings.extractComments?(e={includedTestFile:!1,excludedTestFile:!1},(s=t.extractedComments)&&s.testFileSelection&&(e.includedTestFile=s.testFileSelection.included,e.excludedTestFile=s.testFileSelection.excluded,delete s.testFileSelection)):(s=utils_1.default.deserializeRegExp(this._settings.hints.testFileSelection.include),i=utils_1.default.deserializeRegExp(this._settings.hints.testFileSelection.exclude),e=utils_1.default.testFileSelection(r,s,i,this._settings.automaticTestFileSelection)),this._updateTestFileSelection(t,e)}}else t.ranges=[],this.isNativeBundler()&&(t.changeStart=e,t.changeStart?t.changePosition=_.textIndexPosition(r,t.changeStart):delete t.changePosition);return Q.when({code:r})}_processFile(p,e,d,h,t,r,s){var g,f=this;const m=e=e&&e.toString()||"";if(s)return p.validSyntax=!0,Q.when({code:m});if(f.isZeroConfigJest()||f.isVitest()||f.isNativeBundler()||f.isQuokkaVite())return this._notInstrumented(p,m,d);if(process.env.quokka&&(h=!1,f._settings.error))throw new Error(f._settings.error);return p.changeStart=d,trace("Preparing to process %s",p.path),"node"===f.settings().env.type&&(f._isJavaScript(p)||f._isOriginallyTypeScript(p))&&((p.coverable||p.test)&&(e=e.replace(/^\#\!.*/,"")),f._isJavaScript(p))&&f._settings.testFramework.jsPreprocessor&&(e=f._settings.testFramework.jsPreprocessor(e)),f._settings.testFramework.version&&0===f._settings.testFramework.version.indexOf("jest")&&(f._isOriginallyTypeScript(p)||f._isJavaScript(p))&&(p.originalId?p.docBlockComment=(f._structure.filesById[p.originalId]||{}).docBlockComment:p.docBlockComment=utils_1.default.docBlockComment(e).replace(/\r?\n|\r/g," ")||void 0),p.originalId&&(g=f._structure.filesById[p.originalId])&&(p.includedTestFile=g.includedTestFile,p.excludedTestFile=g.excludedTestFile),"snap"===p.type&&(s=f._structure.filesByPath[path.join(path.dirname(p.path),"..",path.basename(p.path,".snap"))])&&(p.testFilesLoadedFrom=p.testFilesLoadedFrom||{},p.testFilesLoadedFrom[s.id]=runAlways),h&&f._startProcessorPool(),!p.changeStart||p.noCompilers||p.binary||(p.changePosition=_.textIndexPosition(e,p.changeStart)),(p.binary||!p.coverable&&!p.test?new Promise(e=>e(f._notInstrumented(p,m,d))):(t?Q.when(e):f._runThroughProcessors(p,e,h,!0).catch(e=>(f._cleanStack(e),Promise.reject(new Error("Failed to run compilers on "+p.path+", "+(e&&(e.stack||e.message))))))).then(function(r){if(p.noScript)return new Promise(e=>e(f._notInstrumented(p,m,d)));if(!p.noCompilers){trace("Processing compiled "+p.path),p.instrumentedType="js";var e=p.sourceMap,o=new utils_1.default.SourceMapConsumer(e),a=(delete p.sourceMap,_.reduce(p.ranges,function(e,t){return(e[t[0]]=e[t[0]]||[]).push(t),e},{}));p.changePosition&&(p.changePosition.source=e.sources&&e.sources[0]||".",(e=f._findClosestRange(a,p.changePosition,!0))&&(p.changePosition.column=e[1]),p.changePosition.bias=2,p.changeStart=o.generatedPositionFor(p.changePosition));const c={};if(p.logMarkers)for(const u of p.logMarkers)u.originalRange=u.originalRange||u.range,u.range=utils_1.default.mapOriginalRangeToTransformed(o,u.originalRange),u.range&&(c[u.range.join(",")]=u.originalRange);var l=f._isOriginallyCoffeeScript(p),s=function(e,n){_.each(e,e=>{if(p.logMarkers){var t=e.join(","),t=n[t]||t;if(c[t])return t=c[t],e[0]=t[0],e[1]=t[1],e[2]=t[2],void(e[3]=t[3])}var r,s,t={line:e[0],column:e[1]},i=o.originalPositionFor(t);5===e.length&&(r="_extends"===e[4]||"Babel.React.createElement"===e[4]||"Babel.objectSpread"===e[4],e.length=4,(i=i.source&&!r&&(r={line:e[0],column:e[1],bias:2},(r=o.originalPositionFor(r)).source)&&i.line<r.line?r:i).source||(t.column+=7,(i=o.originalPositionFor(t)).source)||(i=(t.column+=l?7:26,o.originalPositionFor(t)))),(s=i.source?f._findClosestRange(a,i):s)?(e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3]):e.length=0})}}if(!f._isOriginallyJavaScript(p)&&p.noCompilers)return new Promise(e=>e(f._notInstrumented(p,m,d)));trace("Instrumenting "+p.path+", via process pool: "+h);let t=_.extend({},f._settings.hints);p.test&&(process.env.quokka||t.allowIgnoringCoverageInTests||(t=_.omit(t,"ignoreCoverage","ignoreCoverageForFile")),!f._settings.extractComments)||(t=_.omit(t,"testFileSelection"));const i=p.scriptRange?r.substring(p.scriptRange.start,p.scriptRange.end):r;e=p.logMarkers||[];const n=process.env.quokka&&f._settings.quokka.snaps;return f._instrument(i,{file:p.tmp?p.originalId:p.id,test:p.test,testFileChangeStart:p.changeStart,logMarkers:e.map(e=>({originalRange:e.originalRange,range:e.range,changeId:e.id,traceId:e.traceId,expanded:e.expanded,new:e.new,exp:e.exp,action:e.action,logpoint:e.logpoint,inlineLogpoint:e.inlineLogpoint})),extractedComments:(0,remapComments_1.default)(p.extractedComments,i,o),hints:t,recordValues:f._settings.autoConsoleLog,captureConsoleLog:f._settings.captureConsoleLog,preserveComments:f._settings.preserveComments||!1,automaticTestFileSelection:!process.env.quokka&&p.test&&!f._settings.extractComments&&f._settings.automaticTestFileSelection,sequenceExpressionToDiff:!!process.env.quokka,snaps:{enabled:n,onlyMode:f._snapsOnlyMode,asyncWrap:!0}},h).then(function(e){var t;if(e.error)throw e.error;if(s&&s(e.ranges,e.logMarkerRangeMap),p.test&&(f._settings.extractComments?(t=p.extractedComments,f._updateTestFileSelection(g,{includedTestFile:t&&t.testFileSelection&&t.testFileSelection.included,excludedTestFile:t&&t.testFileSelection&&t.testFileSelection.excluded}),t&&delete t.testFileSelection):f._updateTestFileSelection(p,e)),p.esm=e.esm,p.validSyntax=!0,p.ranges=e.ranges,p.loggedRanges=e.loggedRanges,p.logpointInfo=e.logpointInfo,p.notInstrumentedLogMarkers=e.notInstrumentedLogMarkers,e.liveCommentLines&&o?p.liveCommentLines=_.chain(e.liveCommentLines).map((e,t)=>({line:parseInt(t,10),column:e+1})).map(({line:e,column:t})=>utils_1.default.mapTransformedRangeToOriginal(o,[e,t,e,t])).filter(e=>e&&e.length).map(e=>e[0]).value():e.liveCommentLines&&(p.liveCommentLines=Object.keys(e.liveCommentLines).map(e=>parseInt(e,10)).filter(e=>e).map(e=>e)),p.lineMap=utils_1.default.updateFileMap(p.noCompilers?{}:p.lineMap,[JSON.parse(e.map)]),delete p.tmpLineMap,p.numberOfFunctionsChanged=p.numberOfFunctions!==e.numberOfFunctions,p.numberOfFunctions=e.numberOfFunctions,p.lastSingleChangeTest=p.test&&!p.numberOfFunctionsChanged&&e.testName||void 0,p.lastSingleChangeTest&&debug("Detected single test [%s] change",e.testName),p.docBlockComment&&e.code&&(debug("Re-attaching document block comment"),e.code=p.docBlockComment+e.code),p.scriptRange&&(e.code=r.substring(0,p.scriptRange.start)+e.code+r.substring(p.scriptRange.end)),n){if(f._snapsOnlyMode&&(!e.snaps||!e.snaps.length))return Q.when(new Error(utils_1.default.snapsNotFoundError));if(f._settings.autoExpandAllLogs=!!(e.snaps||[]).find(e=>e.output),f._mapSnaps(p,e.snaps,o),f._snapsOnlyMode){if(!f._snapsAutoRun&&e.snaps&&e.snaps.length)return Q.when(new Error(utils_1.default.snapsFoundButNoAutoRunError));if(null==(t=e.snaps)||!t.find(e=>!e.empty))return Q.when(new Error(utils_1.default.snapsAreEmptyError))}}return Q.when(e)}).catch(function(e){p.validSyntax=!1;var t=_.map(p.tests,(e,t)=>t.split(testPathSeparator))||[];return f._testTask.addChangedFile(p,t),f._cleanStack(e),Q.when(utils_1.default.formatInstrumentationError(e,i,p.path))})})).then(function(e){return e instanceof Error?Q.when(e):f._runThroughProcessors(p,e.code,h,!1).then(e=>r?Q.when(e):(trace("Writing to disk and caching processed file %s",p.path),p.binary?f._doWriteFile(p.instrumentedPath,Buffer.from(e,"base64")):f._doWriteFileWithLruCache(p.instrumentedPath,e))).catch(e=>(f._cleanStack(e),Q.when(new Error("Failed to run preprocessors on "+p.path+", "+(e&&(e.stack||e.message))))))}).then(e=>e instanceof Error?Promise.reject(e):Q.when(e))}testRunnerTransformedFile(e){const t=this._getFileMetadataById(e.id);if(t){trace("Test Runner transformed file: %s %s",t.path,e.transformedTime),t.ranges=[],t.matchSnapshotRanges=e.matchSnapshotRanges;var r=process.env.quokka&&this._settings.quokka.snaps;if(process.env.quokka&&this._lruCache.set(t.instrumentedPath,e.instrumented.code),e.transformed.map)try{const s=new utils_1.default.SourceMapConsumer(e.transformed.map);_.each(e.instrumented.ranges||[],e=>{e=utils_1.default.mapTransformedRangeToOriginal(s,e);e&&(e[3]===1/0&&(e[3]=e[1]+1),e[2]>=e[0]||(e[2]=e[0]),e[3]>=e[1]||(e[3]=e[1]+1)),t.ranges.push(e||[])}),t.runnerCacheKey=e.runnerCacheKey,r&&this._mapSnaps(t,e.instrumented.snaps,s)}catch(e){t.ranges=[],debug("Failed to map ranges for [%s], error: %s",t.path,e.message)}else t.ranges=e.instrumented.ranges,t.runnerCacheKey=e.runnerCacheKey,r&&this._mapSnaps(t,e.instrumented.snaps,void 0);t.lineMap=e.lineMap,t.lastSingleChangeTest=e.instrumented.testName,t.numberOfFunctions=e.instrumented.numberOfFunctions,t.loggedRanges=e.instrumented.loggedRanges,t.logpointInfo=e.instrumented.logpointInfo,t.notInstrumentedLogMarkers=e.instrumented.notInstrumentedLogMarkers,t.liveCommentLines=e.instrumented.liveCommentLines,e.parentFilePath&&(r=this.getFileMetadataByPath(e.parentFilePath))&&(t.parentFilePath=e.parentFilePath,r.childFilePath=t.path,r.runnerCacheKey=t.runnerCacheKey),t.instrumentedByTestingFramework=!0}}_mapSnaps(e,t,r){let s;try{if(t&&t.length)if(r){e.originalId&&(e=this._structure.filesById[e.originalId]);try{var i=this.getLatestOriginalFileContentByPath(e.path);if(!i)throw new Error("Unable to locate original file content");0===(s=utils_1.default.mapSnapRanges(r,t,i)).length&&(s=void 0)}catch(e){console.warn("Failed to process snaps: "+e.message)}}else s=t}finally{this._emit({type:"snapsFound",file:e.path,snaps:s})}}_updateTestFileSelection(e,t){var r,s;e&&(r=e.includedTestFile,s=e.excludedTestFile,e.includedTestFile=t.includedTestFile,e.excludedTestFile=t.excludedTestFile,e.originalId||this._updateFileStructure(e),!!e.includedTestFile==!!r&&!!e.excludedTestFile==!!s||(this._testSelectionChanged=!0),e.originalId)&&this._updateTestFileSelection(this._structure.filesById[e.originalId],t)}_findClosestRange(e,t,r){var s=e[t.line];if(s)for(var i,n=1/0,o=0;o<s.length;o++){var a=s[o],l=Math.abs(a[1]-t.column);l<n&&(!r||a[1]<=t.column)&&(n=l,i=a)}return i}_runThroughProcessors(t,e,r,s){var i=this;return!Object.keys(s?i._settings.compilers:i._settings.preprocessors).length||(s?t.noCompilers:t.noPreprocessors)?(trace("No %s configured for %s",s?"compilers":"preprocessors",t.path),s?t.noCompilers=!0:t.noPreprocessors=!0,Q.when(e)):(e={content:e,config:process.env.quokka?i._settings:i._configFile,file:t,root:i._instrumentedRoot,type:s?"compiler":"preprocessor"},(r&&i._processorPool.started()?i._processorPool.run(e):processor(e)).then(e=>{if(e.error)throw e.error;return s?t.noCompilers=e.noProcessors:t.noPreprocessors=e.noProcessors,i._updateInstrumentedFile(e,t,s&&!t.noCompilers),e.content}))}_updateInstrumentedFile(e,t,r){r&&delete t.lineMap,e.maps&&e.maps.length&&(t.lineMap=utils_1.default.updateFileMap(t.lineMap,e.maps)),e.newPath&&(t.instrumentedPath=path.resolve(this._instrumentedRoot,e.newPath),t.instrumentedType=_.trim(path.extname(t.instrumentedPath),"."),this._structure.filesRenamed[e.newPath]=t.path),r&&(t.ranges=e.ranges,t.scriptRange=e.scriptRange,t.noScript=e.noScript,t.sourceMap=e.maps&&e.maps[0],t.ranges&&t.ranges.length||t.noScript||debug("Compiler did not set ranges for file [%s]",t.path),t.sourceMap||t.noScript||debug("Compiler did not set source map for file [%s]",t.path))}_instrument(t,r,e){return e&&this._processorPool.started()?this._processorPool.run({content:t,opts:r,type:"instrumentor"}):new Promise(e=>e((0,instrumentor_1.default)(t,r)))}_writeSourceFile(e,t){var r=this._sourceFileCache[e];return r&&(r.content=t),this.isZeroConfigJest()||this.isVitest()||!r?(this._writeSourceFileCache[e]={content:t},this._doWriteFile(e,t).finally(()=>{delete this._writeSourceFileCache[e]})):Q.when(!0)}_doWriteFile(e,t){var r=this;return r._dirEnsurePromise(path.dirname(e)).then(function(){return r._writeFilePromise(e,t)})}_doWriteFileWithLruCache(e,t){var r=this;return r._dirEnsurePromise(path.dirname(e)).then(function(){return r._writeFilePromise(e,t)}).then(()=>(r._lruCache.set(e,t),Q.when(!0)))}_deleteSourceFile(e){return delete this._sourceFileCache[e],this._unlinkFilePromise(e)}_readOriginalSourceFile(i,n){var o=this,e=o._sourceFileCache[n];return e?(trace("Returning previously cached file [%s] from memory",i),Promise.resolve(e.content)):o._readFilePromise(n).then(function(e){var t=Promise.resolve();const r=e.toString();var s,e=_.keys(o._sourceFileCache);return 2<=e.length&&(e=e[0],s=o._sourceFileCache[e],delete o._sourceFileCache[e],o._structure.filesById[s.id]?(t=o._doWriteFile(e,s.content),trace("Writing previously cached file [%s] to disk",e)):trace("Previously cached file [%s] was deleted and does not need saving to disk",e)),trace("Caching file [%s] in memory",i),o._sourceFileCache[n]={content:r,id:i},t.then(function(){return Q.when(r)})})}_flushSourceFileCacheSync(){var r=this;try{_.each(r._sourceFileCache,function(e,t){r._dirEnsureSync(path.dirname(t)),r._writeFileSync(t,e.content)})}catch(e){_.each(r._sourceFileCache,function(e){e=r._structure.filesById[e.id];e&&(e.ts=0)})}}_getOrCreateFileMetadata(e){var t=this._structure.filesByPath[e.path];return t||(t=this._createFileMetadata(e,e.id),this._fileOrderUpdatePending=!0,t)}_getFileMetadataById(e){return this._structure.filesById[e]}getFileMetadataByPath(e){return this._structure.filesByPath[e]}_overrideFileType(e,t,r){}_createFileMetadata(e,t){var r,s,i,n;if(process.env.quokka||path.resolve(e.path)!==path.normalize(e.path).replace(new RegExp(path.sep+"$"),""))return r=path.join(this._originalRoot,process.env.quokka?path.basename(e.path):e.path),s=path.join(this._instrumentedRoot,e.path),e.instrumentedPath&&s!==e.instrumentedPath&&(s=e.instrumentedPath,e.instrumentedType=_.trim(path.extname(s),"."),(i=path.relative(this._instrumentedRoot,s))!==e.path)&&(this._structure.filesRenamed[i]=e.path),i=e.type,n=this._overrideFileType(e.type,e.path,e.id)||e.type,t={id:t,path:e.path,type:n||"js",originalType:e.originalType||i||n,binary:e.binary||void 0,tmp:e.tmp||void 0,instrumentedType:e.instrumentedType||n||"js",order:e.order,originalPath:r,instrumentedPath:s,ts:e.ts,changeTs:e.ts,runnerCacheKey:e.runnerCacheKey,triggersTests:e.triggersTests,include:e.include,initialInclude:_.isBoolean(e.initialInclude)?e.initialInclude:e.include,esm:e.esm,includedTestFile:e.includedTestFile,includedExplicitlyTestFile:e.includedExplicitlyTestFile,smartModeStart:e.smartModeStart,excludedTestFile:e.excludedTestFile,coverable:e.coverable,hideFromErrorStackTrace:e.hideFromErrorStackTrace||void 0,test:e.test,tests:e.tests||{},ranges:e.ranges||void 0,loggedRanges:e.loggedRanges||void 0,logpointInfo:e.logpointInfo||void 0,extractedComments:e.extractedComments||void 0,notInstrumentedLogMarkers:e.notInstrumentedLogMarkers||void 0,liveCommentLines:e.liveCommentLines||void 0,matchSnapshotRanges:e.matchSnapshotRanges||void 0,lineMap:e.lineMap||void 0,tmpLineMap:e.tmpLineMap||void 0,validSyntax:e.validSyntax||void 0,numberOfFunctions:e.numberOfFunctions||void 0,docBlockComment:e.docBlockComment||void 0,instrumentedByTestingFramework:e.instrumentedByTestingFramework||void 0,childFilePath:e.childFilePath,getFileLineMap:function(){return this.tmpLineMap||this.lineMap}},this._updateFileStructure(t),t;throw new Error("Configured file paths must be relative: "+e.path)}_deleteTmpFiles(){var t=this;this._deleteDependantFilesMetadata(),_.each(t._structure.filesByPath,e=>e.tmp&&t._deleteFileMetadata(e)),t._fileOrderUpdatePending=!0}_deleteDependantFilesMetadata(e){var t=this;e?(_.each(e.dependant,e=>t._deleteFileMetadata(e)),e.dependant={}):_.each(t._structure.filesByPath,e=>t._deleteDependantFilesMetadata(e))}_deleteFileMetadata(e){e=this._structure.filesByPath[e.path];if(e)return this._updateFileStructure(e,!0),this._fileOrderUpdatePending=!0,e}_updateFileStructure(e,t){t?(this._deleteDependantFilesMetadata(e),delete this._structure.filesById[e.id],delete this._structure.testFilesById[e.id],delete this._structure.filesByPath[e.path],delete this._structure.testFileSelectionById.excluded[e.id],delete this._structure.testFileSelectionById.included[e.id]):(this._structure.filesById[e.id]=e,(this._structure.filesByPath[e.path]=e).test&&(this._structure.testFilesById[e.id]=e,delete this._structure.testFileSelectionById.included[e.id],delete this._structure.testFileSelectionById.excluded[e.id],e.excludedTestFile?this._structure.testFileSelectionById.excluded[e.id]=e:(this._settings.testLocations?e.includedExplicitlyTestFile:e.includedTestFile)&&(this._structure.testFileSelectionById.included[e.id]=e)))}selectedTestFiles(){return{hasSomeIncludedTestFiles:!_.isEmpty(this._structure.testFileSelectionById.included),hasSomeExcludedTestFiles:!_.isEmpty(this._structure.testFileSelectionById.excluded)}}hasSomeSelectedTestFiles(){var e=this.selectedTestFiles();return e.hasSomeIncludedTestFiles||e.hasSomeExcludedTestFiles}isExcludedTestFile(e){return!!this._structure.testFileSelectionById.excluded[e]}isIncludedTestFile(e){return!!this._structure.testFileSelectionById.included[e]}getIncludedTestFiles(){return _.values(this._structure.testFileSelectionById.included)}getNotExcludedTestFiles(){return _.filter(this._structure.testFilesInOrder,e=>!e.originalId&&!this.isExcludedTestFile(e.id))}_getExcludedTestFiles(){return _.values(this._structure.testFileSelectionById.excluded)}_additionalHeaderMessage(){var e,t;return this._settings.testLocations?0===this._settings.testLocations.length?this._settings.smartStart&&this._settings.smartStart.find(e=>"**/*"===e.pattern&&e.test&&"edit"===e.startMode)?"(waiting for test to be modified)":"(waiting for test to be opened)":(e=`(only executed ${this._settings.testLocations.map((e,r)=>{var t=e.split("/");for(let e=1;e<t.length;e++){const s=t.slice(t.length-e).join("/");if(!this._settings.testLocations.find((e,t)=>t!==r&&e.endsWith(s)))return s}return e}).map(e=>""===e?"./":e).join(", ")})`,2<=this._settings.testLocations.length&&120<e.length?`(only executing ${this._settings.testLocations.length} test files)`:e):(e=this.selectedTestFiles(),this._settings.runSelectedTestsOnly||e.hasSomeIncludedTestFiles||e.hasSomeExcludedTestFiles?(t="",this._settings.runSelectedTestsOnly&&!e.hasSomeIncludedTestFiles?t="no test files selected":e.hasSomeIncludedTestFiles&&(t="only executed "+_.map(this.getIncludedTestFiles(),e=>e.path).join(", ")),`(${t=!t&&e.hasSomeExcludedTestFiles?"skipped "+_.map(this._getExcludedTestFiles(),e=>e.path).join(", "):t})`):void 0)}_updateFileOrder(){var t=this;t._fileOrderUpdatePending&&(t._structure.testFilesInOrder=[],t._structure.sourceFilesInOrder=[],_.each(t._orderFilesByConfig(t._structure.filesByPath),function(e){(e.test?t._structure.testFilesInOrder:t._structure.sourceFilesInOrder).push(e)}),delete t._fileOrderUpdatePending)}_orderFilesByConfig(e){return _.chain(e).sortBy(function(e){return e.path}).sortBy(function(e){return e.order}).value()}saveLatestQuokkaFileChange(e){const t=path.join(this._globalSettingsDir,"recentFiles");var r=e=>path.join(t,e),s=e=>e&&("win32"===process.platform?e.toLowerCase():e);if(e.scratchFile){if(utils_1.default.textLines(e.content).length<=1&&e.content.length<50&&(e.content=""),!e.content)return;if(3e3<e.content.length){try{this._dirEnsureSync(t),this._writeFileSync(r(e.fileId),e.content)}catch(e){}delete e.content}}else delete e.content;var i=path.join(this._globalSettingsDir,"recentFiles.json");let n={};try{this._fileExistsSync(i)&&(n=JSON.parse(this._readFileSync(i)))}catch(e){}n.projects||(n.projects={});var o=s(this._localRoot),a=(e.projectRoot=this._localRoot,n.projects[o]||{}),o=(delete n.projects[o],n.projects[o]=a,e.fileId||s(e.path)),s=!a[o];for(delete a[o],a[o]=e,s&&(n.total=(n.total||0)+1);100<n.total;)for(var l in n.projects){var c=n.projects[l];if(!_.isEmpty(c)){for(var u in c){var p=c[u];if(delete c[u],n.total--,p.scratchFile&&!p.content)try{this._unlinkFileSync(r(p.fileId))}catch(e){}break}break}delete n.projects[l]}try{this._writeFileSync(i,JSON.stringify(n))}catch(e){}}}exports.Project=Project},{"./babelCompiler":9,"./chromeProfileViewer":12,"./config":15,"./extension/shared/utils":44,"./instrumentor":47,"./processor":64,"./testTask":68,"./tracking":70,"./typeScriptPostprocessor":72,"./typeScriptUtils":73,"./utils":75,"./utils/remapComments":77,child_process:void 0,"lru-cache":void 0,os:void 0,path:void 0,semver:void 0,typescript:void 0,url:void 0,util:void 0}],66:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.WorkerPool=void 0;const s=e("os"),d=e("path"),n=e("http"),f=e("./utils"),m=logger.create("workers")["debug"],o=e("ws");var i=/^win/.test(process.platform),g="&wallabyFileId=",v="Wallaby.js cache is corrupted, please restart wallaby.js",y=/.*jasmine\.js:(\d|\s)*throw error;[^\^]*\^\s*/s;r.WorkerPool=class{constructor(t,e){this._connectingWorkers={},this._project=t,this._opts=t.settings(),this._extension=e,this._mapConsoleMessagesStackTrace=this._project.settings().mapConsoleMessagesStackTrace,process.env.quokka&&(this.reportConsoleOutput=function(e){e=_.extend({},e);t.resolveLogEntryRange(e),t._emitInternal({type:"consoleOutput",data:e})},this.reportIntermediateResult=function(){}),this._sessions={},this._executedTestNumber=0,this._testRunId=0,this._workers={},this._testFilesByWorker={},this._workerPingTimeoutOverride={},this._connectingWorkers={},this._workerPendingCleanup={},this._calculateNumberOfParallelWorkers(),this._hasGlobalSetupOrTeardown=this._project.hasGlobalSetupOrTeardown();for(var r=Math.max(this._maxWorkers,this._minWorkers)+(this._hasGlobalSetupOrTeardown?1:0),s=0;s<r;s++)this.getWorker(s);this._globalWorkerId=r,this._normalizedWallabyServerPath=this._project.normalizePath(d.dirname(process.mainModule.filename)),this._normalizedLocalRoot=this._project.normalizePath(this._project._localRoot),this._zeroConfigJest=this._project.isZeroConfigJest(),this._vitest=this._project.isVitest(),this._viteNode=this._project.isQuokkaVite(),this._nodeJasmine=this._project.isNodeJasmine(),this._unresponsiveStandardTimeout=Math.max(500,this._opts.unresponsiveStandardTimeout||(this._zeroConfigJest||this._vitest?2e3:200)),this._unresponsiveInitialTimeout=Math.max(this._unresponsiveStandardTimeout,this._opts.unresponsiveInitialTimeout||(this._zeroConfigJest||this._vitest?7e3:200)),this._longExecutingWarningTimeout=Math.max(500,this._opts.longExecutingWarningTimeout||5e3),this._longExecutingPingTimeout=Math.max(200,this._opts.longExecutingPingTimeout||200),this._globalSetupTeardownTimeout=Math.max(10,this._opts.globalSetupTeardownTimeout||5e3)}"worker:transformedFile"(e){this._project.testRunnerTransformedFile(e)}"worker:profile"(e){this._resolveProfileRunPromise&&(this._resolveProfileRunPromise(e),delete this._resolveProfileRunPromise)}start(e){var i=this,r=this._httpServer=e?n.createServer(e):n.createServer();return r.listen(0),new Promise(function(e,t){r.on("listening",function(){try{i._receiverPort=r.address().port,m("Web server is listening at "+i._receiverPort),i._wss=new o.Server({server:r,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}}),i._wss.on("connection",function(s){s.on("message",function(t){var r;try{r=JSON.parse(t)}catch(e){return void console.error("Failed to deserialize message from worker: "+t+", "+(e&&e.message))}if(i["worker:"+r.type])return i["worker:"+r.type](r.data);if(r.worker){t=i._workers[r.worker];if(t){if(t.onConnected)t.onConnected(s);else if(process.env.quokka&&t.instance){if(t.instance.channel)try{t.instance.channel.close(),t.instance.channel.removeAllListeners()}catch(e){}t.instance.channel=s}try{s.send(JSON.stringify({type:"in:connected"}))}catch(e){console.error('Failed to send the "connected" message to worker. '+e.message)}}}else if(r.session){var t=i._sessions[r.session],e=!(t=t&&r.childSession?t.childSession(r.session+"."+r.childSession):t)||(t._disposing||i.cancelled(t._testRunId))&&!t._globalSetup;if("console"===r.type&&r.data){if("debugLog"===r.data.type)return void m(r.data.text);(r.data.spec||process.env.quokka)&&!e||"autoLog"===r.data.type||console.log("console."+r.data.type+": "+r.data.text)}if(!e)try{t[r.type](r.data)}catch(e){console.error("Failed to process message "+r.type+" from worker, "+(e&&e.message)),t.reject(e)}}})}),e(void 0)}catch(e){t(e)}})})}wallabyFileIdPrefix(){return g}traceContext(){return this._traceContext}receiverPort(){return this._receiverPort}setFileRoot(e){this._fileRoot=this._project.normalizePath(e)}async run(e){var r=this;this._cancelled=!1,this._testRunId++,this._executedTestNumber=0,this._runPriority=e.priority,this._traceContext=e.traceContext,this._profileRun=e.profileRun;let t=0;this._profileRun?(this._profileRunPromise=new Promise(function(e){r._resolveProfileRunPromise=e}),e.testFilesToLoad&&1===e.testFilesToLoad.length&&(t=r._findWorkerThatExecutedTestFile(e.testFilesToLoad[0])||0)):(delete this._resolveProfileRunPromise,delete this._profileRunPromise),e.recycleBeforeRun&&_.each(this._workers,function(e,t){r.recycleWorker(t)}),m("Starting test run, priority: "+this._runPriority),this._startTime=(new Date).getTime();var s=e.fullRun&&1<this._maxWorkers&&1<e.testFilesToLoad.length?this._maxWorkers:1<this._minWorkers&&1<e.testFilesToLoad.length&&!(e.fullRun&&this._maxWorkers<this._minWorkers)?this._minWorkers:1;let i=void 0;if(this._hasGlobalSetupOrTeardown&&e.testFilesToLoad.length){var n=setTimeout(()=>{console.log("Some long running code has been detected: Global Setup")},this._longExecutingWarningTimeout);try{i=await r._runGlobalSetup(e),clearTimeout(n)}catch(e){if(clearTimeout(n),e.error)throw e.error;return e.result}}1===s&&_.each(e.testFilesToLoad,e=>r._testFileIsAssignedToWorker(e,t));var n=Object.assign(Object.assign({},e),{processEnvUpdates:i&&i.processEnvUpdates});let o,a=void 0;try{o=1<s?await this._runInParallel(n,s):[await this._prepareSandbox(n,t).then(e=>r._runTests(e))]}catch(e){throw e}finally{if(i){e=setTimeout(()=>{console.log("Some long running code has been detected: Global Teardown")},this._longExecutingWarningTimeout);i.sandbox.instance.teardown();const{error:c,result:l}=await i.result;if(clearTimeout(e),c)throw c;a=l}}this._workerPingTimeoutOverride={};const l=1===o.length?o[0]:await r._mergeRunTestsResults(o);return a&&(l.log=(l.log||[]).concat(a.log||[]),l.globalErrors=(l.globalErrors||[]).concat(a.globalErrors||[])),this._executedTestNumber&&(this._endTime=(new Date).getTime(),s="millisecond(s)",1e3<(n=r._endTime-r._startTime)&&(s="second(s)",60<(n/=1e3))&&(n/=60,s="minute(s)"),console.log("Finished executing "+this._executedTestNumber+" affected test(s) in "+Math.round(100*n)/100+" "+s)),this._profileRunPromise&&(l.profile=await r._profileRunPromise,delete r._profileRunPromise),l}_handleError(t,e,r,s,i,n,o,a,l,c,u){var p=this,d=(n===o&&(n=o=void 0),p._reportableError(r,s)),e=(m("Sandbox (%s) [%s] error: %s",t.active()?"active":"inactive",e,d),"SyntaxError: Parse error"===r&&_.isEmpty(s));if(p._corruptedCache(d))p._project.invalidateCache(),t.reject(new Error(v)),t.recycleWorker();else if(p._corruptedJestCache(r,s))m("Jest cache corrupted: %s",s),p._project.invalidateCache(),t.reject(new Error("Jest cache is corrupted, please clear jest cache (`npx jest --clearCache`) and then restart wallaby.js"));else if(process.env.quokka?m("Runtime error: "+d):console.error("Runtime error: "+d),t.active())if(u||t.scheduleCompleteIfNotActiveFor(process.env.WALLABY_INTEGRATION_TEST_RUN?1e3:100),!s||p._viteNode&&(f.default.isSnapsAreEmptyError({message:r})||f.default.isSnapsFoundButNoAutoRunError({message:r})||f.default.isSnapsNotFoundError({message:r})))t.reject(new Error(r));else if(!e)try{var h={message:r,stack:_.isString(s)?s:_.reduce(s,function(e,t){return e+t.file+":"+t.line+"\n"},""),external:!0,actual:n,expected:o,snapshot:a},g=(p._nodeJasmine&&(h.message=h.message&&h.message.replace(y,""),h.message.endsWith("\r")&&(h.message=h.message.slice(0,-1)),h.stack=h.stack&&h.stack.replace(y,"")),(p._zeroConfigJest||p._vitest||p._viteNode)&&(h.delayStackMapping=!0,h.allowNotMappedStackLines=!0,h.testFilePath=c,t._notMappedStackEntries.push(h)),p._viteNode&&["at ViteNodeRunner.","at async ViteNodeRunner."].forEach(e=>{var e=h.stack.indexOf(e);-1!==e&&(e=h.stack.lastIndexOf("\n",e),h.stack=h.stack.substring(0,e))}),[h]);p._processTestLog(g,l),h.delayStackMapping||h.stack&&h.stack.length||!c||(h.stack=`Error: ${h.message}.
    at ${c}:1:0`,p._mapStackEntries(h,!0),delete h.testFilePath),h.stack&&h.stack.length||(~h.message.indexOf("Cannot find module")||(h.message=d),h.stack=[]),!i&&t._executingTest?t.addToTestLog(h):t._globalErrors.push(h)}catch(e){t.reject(new Error(r+", "+(e&&e.message)))}}_createAndStartSession(n,t,r,e){var o=this;try{const i=()=>{var i=o._createSession(n.sessionId,n.workerId,n.testRunId,n.instance,t,r,e);n.instance.start(function(e){return o.cancelled(n.testRunId)?(i.reject({runCancelled:!0}),!1):"success"===e||(i.reject(new Error("Sandbox load failed, status: "+e)),!1)},function(e,t,r,s){o._handleError(i,n.sessionId,e,t,!1,r,s)})};var s=o._workerPendingCleanup[n.workerId];s?(m("[%s] Sandbox is waiting for worker cleanup",n.sessionId),s.onDone.push(e=>{if(o.cancelled(n.testRunId))return m("[%s] Sandbox run was cancelled while it was waiting for worker cleanup",n.sessionId),r({runCancelled:!0});if(e){m("[%s] Sandbox worker requires recycling, creating new session",n.sessionId);try{return t(o._prepareSandbox(n.opts,n.workerId).then(function(e){return o._runTests(e)}))}catch(e){return r(e)}}i()})):i()}catch(e){r(e)}}_getRunTestResult(e){var t,r;return e.session?(r=(t=e.session).runResult,_.each(_.keys(t),function(e){e&&"_"===e[0]&&!_.isFunction(t[e])&&"_disposing"!==e&&delete t[e]}),delete e.session,Promise.resolve(r)):Promise.resolve(e)}_runTests(r){var s=this;return s.cancelled(r.testRunId)?Promise.reject({runCancelled:!0}):(m("[%s] Running tests in sandbox",r.name),new Promise(function(e,t){if(s.cancelled(r.testRunId))return t({runCancelled:!0});s._createAndStartSession(r,e,t,void 0)}).then(function(e){return s._getRunTestResult(e)}))}_createRunResult(e,t){var r=e._coverage,s=e._trace,i=e._loadingSequence,n=e._tests,o=e._log,a=e._fileChanges,l=e._globalErrors.concat(e._executingTestLog);return _.each(l,e=>this._removeAnsi(e)),l.length||(l=void 0),e._notMappedStackEntries.length&&(_.each(e._notMappedStackEntries,e=>{delete e.delayStackMapping,this._mapStackEntries(e,e.allowNotMappedStackLines),e.stack&&e.stack.length||!e.testFilePath||(e.stack=`Error: ${e.message}.
    at ${e.testFilePath}:1:0`,this._mapStackEntries(e,!0),delete e.testFilePath),delete e.allowNotMappedStackLines}),e._notMappedStackEntries.length=0),{coverage:r,trace:s,tests:n,log:o,globalErrors:l,loadingSequence:i,time:t,fileChanges:a}}_removeAnsi(e){return!f.default.hasAnsi(e.message)||f.default.hasAnsi(e.actual)||f.default.hasAnsi(e.expected)||(e.message=f.default.removeAnsi(e.message)),e}_reportableError(e,t){return _.isString(t)?(this._project._cleanStack(t={stack:t}),t.stack):e}cancel(e){if(!_.isEmpty(this._sessions))return e>=this._runPriority&&(_.each(this._sessions,function(e){e.reject({runCancelled:!0})}),this._cancelled=!0,m("Cancelling test run, cancel requester priority: %s, current run priority: %s",e,this._runPriority),!0)}cancelled(e){return this._cancelled||e&&e!==this._testRunId}_areLogEntryMessagesEqual(e="",t=""){return e===t||(this._opts.testFramework&&this._opts.testFramework.version&&0===this._opts.testFramework.version.indexOf("mocha")?0<e.indexOf(":")&&_.contains(e,t)||0<t.indexOf(":")&&_.contains(t,e):void 0)}_createSession(l,c,n,u,o,a,t,e){var p=this;return p._sessions[l]={_id:l,_coverage:{},_tests:[],_loadingSequence:{},_log:[],_fileChanges:[],_executingTestLog:[],_globalErrors:[],_total:0,_skipped:0,_disposing:!1,_exceededMaxTestAllowedLogLimit:!1,_onFinished:u.closing,_messagesPerTest:{},_closeByErrorTimeout:void 0,_longRunningWarningTimeout:void 0,_longRunningPingTimeout:void 0,_globalSetupCompleteTimeout:void 0,_executingFiles:{},_executingTest:void 0,_notMappedStackEntries:[],_globalSetup:!!t,_globalSetupDoneCalled:!1,_completed:!1,_testRunId:n,_parentSession:e,_children:[],childSession:function(e){return p._sessions[e]||(e=p._createSession(e,c,n,u,()=>{},()=>{},void 0,this),this._children.push(e),e)},started:function(e){var t=this;m("[%s] Loaded %s test(s)",l,e.total),t._total=e.total,_.each(e.loadingSequence,e=>{t._loadingSequence[e[0]]=e.slice(1)})},active:function(){return!this._disposing&&!p.cancelled(n)},scheduleCompleteIfNotActiveFor:function(e){var t=this;clearTimeout(t._closeByErrorTimeout),t._closeByErrorTimeout=setTimeout(function(){t.complete()},e)},addToTestLog:function(e){var t=this._executingTestLog[this._executingTestLog.length-1];t&&p._areLogEntryMessagesEqual(t.message||void 0,e.message||void 0)&&t.stack&&e.stack&&0<t.stack.length&&0<e.stack.length&&_.isEqual(e.stack[0],t.stack[0])?e.stack.length>t.stack.length&&(t.stack=e.stack):this._executingTestLog.push(e)},intermediateComplete:function(){this._parentSession||p.reportIntermediateResult&&p.reportIntermediateResult(p._createRunResult(this))},trace:function(e){var t=this;t._trace=e.trace,t._trace&&_.each(t._trace.callStack,e=>{e.delayStackMapping=!0,t._notMappedStackEntries.push(e)})},complete:function(t){var e=this;if(clearTimeout(e._closeByErrorTimeout),clearTimeout(e._longRunningWarningTimeout),clearTimeout(e._longRunningPingTimeout),clearTimeout(e._globalSetupCompleteTimeout),e._completed=!0,!e._parentSession){e._children.length&&e._children.forEach(e=>{e.runResult=p._createRunResult(e,t&&t.time),e.complete()}),e._onFinished();const i=e._children.map(e=>e.runResult).filter(e=>!!e);var r=e._children.length?e._children.reduce((e,t)=>e+(t._tests||[]).length,0):(e._tests||[]).length,s=e._children.length?e._children.reduce((e,t)=>e+t._skipped,0):e._skipped;e._dispose(function(){p.cancelled(n)?a({runCancelled:!0}):(e._children.length?e.runResult=p._reduceTestResults([p._createRunResult(e,t&&t.time),...i]):e.runResult=p._createRunResult(e,t&&t.time),o({session:e,time:t&&t.time}))}),m("[%s] Run %s test(s), skipped %s test(s)",l,r-s,s)}},globalSetupComplete:function(e){t&&(this._globalSetupDoneCalled=!0,t(e))},globalError:function(e){this._parentSession?this._parentSession.globalError(e):p._handleError(this,l,e.message,e.stack,e.declaration,e.actual,e.expected,e.snapshot,e.allowNotMappedStackLines,e.testFilePath,e.keepSessionActive)},programScopeStart:function(e){this._executingFiles[e]=1,this._setTimeoutForLongRunningOperation()},programScopeEnd:function(e){delete this._executingFiles[e],_.isEmpty(this._executingFiles)&&!this._executingTest&&(clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout))},preTest:function(e){this._setTimeoutForLongRunningOperation(),this._executingTest=e},postTest:function(){delete this._executingTest},_setTimeoutForLongRunningOperation:function(){var s,i;process.env.quokka||(s=this,i=function(e){console.warn(e),m(e)},clearTimeout(s._longRunningWarningTimeout),clearTimeout(s._longRunningPingTimeout),s._longRunningWarningTimeout=setTimeout(function(){var r="Some long running code has been detected: ",e=s._executingTest,t=!_.isEmpty(s._executingFiles);if(r+=(e?'test "'+e+'"':"one of your "+(t?"files":"tests"))+" is taking more than "+p._longExecutingWarningTimeout+"ms to execute.",t&&(r+="\nExecution of the following files has started but has not finished:",_.each(s._executingFiles,function(e,t){t=p._project._getFileMetadataById(t);r+="\n- "+(t?t.path:"unknown")})),s._log.length&&(r+="\nThe last recorded console.log: "+_.last(s._log).text),e||t){r+="\nTry commenting out the test or excluding the test file from the `tests` list in your wallaby config,\nand restarting wallaby to make sure that it is this test/file causing the issue and not something else.",e&&(r+="\nAlso review your recent changes to the code that the test covers, as well as its `before` and `after` hooks."),r+="\nPinging test runner sandbox...";try{u.ping(function(){clearTimeout(s._longRunningPingTimeout),s.active()&&i("Sandbox is responsive. The issue may be asynchronous in nature (for example, a missing callback).")}),s._longRunningPingTimeout=setTimeout(function(){i("The sandbox is not responsive. Check for possibly recently introduced infinite loops.")},p._longExecutingPingTimeout)}catch(e){r+="\nThe sandbox ping failed: "+e.message}}i(r)},p._longExecutingWarningTimeout))},module:function(e){p._project._emitInternal({type:"moduleLoaded",path:e.path,session:this})},test:function(t){var r=this;delete r._executingTest,clearTimeout(r._closeByErrorTimeout),r._setTimeoutForLongRunningOperation(),t.hook&&t.log?(p._processTestLog(t.log),_.isString(t.hook)&&_.each(t.log,e=>{e.message=t.hook+(e.message?": ":"")+e.message}),r._globalErrors=r._globalErrors.concat(t.log)):("disabled"!==t.status?(m("[%s] Test executed: "+t.name,l),p._processTestLog(t.log),t.log&&_.each(t.log,e=>r.addToTestLog(e)),r._executingTestLog.length&&(t.log=r._executingTestLog.slice()),_.isUndefined(t.slow)&&(t.slow=t.time>p._opts.slowTestThreshold),t.slow=t.slow||void 0,r._executingTestLog.length=0,++p._executedTestNumber%50||console.log("Execution progress: "+p._executedTestNumber+" tests"),process.env.WALLABY_INTEGRATION_TEST_RUN&&(t.time=1)):(r._skipped++,p._processTestLog(t.log)),r._tests.push(t))},coverage:function(e){this._coverage[e.id]=e.ranges},fileChange:function(e){this._fileChanges.push(e)},console:function(e){var t=p._opts.maxConsoleMessagesPerTest,r=this._messagesPerTest[e.spec]=(this._messagesPerTest[e.spec]||0)+1;if(r===t+1)console.warn("Number of console messages per test exceeded maximum allowed value ("+t+"), current test console messages recording stopped.\nYou may increase the limit by adding `maxConsoleMessagesPerTest` setting to your config file.");else if(r<=t)if(this._log.push(e),e.valueBag&&e.valueBag.data&&e.valueBag.data.props){const n=e.valueBag.data.props[0];if(n.callStack){p._mapStackEntries(n.callStack);let i;n.callStack.replaceFirstEntryLine&&(r=Object.assign({},e),p._project.resolveLogEntryRange(r),i=r.range&&r.range[0]),n.props=n.callStack.stack.map((e,t)=>{var r,s=e[0],e=0<t||!i?e[1]:i,s=p._project.stackEntryByFileIdWithoutLineMapping(s,e);if(s)return r=n.callStack.context[t]||"...",{id:n.id+",se"+t,target:s,callStackEntryNode:!0,label:{name:r,description:d.basename(s.file)+":"+e},disallowToCopyPath:!0,disallowToCopyData:!0}}).filter(e=>!!e)}}else if(p._mapConsoleMessagesStackTrace&&e.text&&e.text.length)if(/^\s*at .*$/gm.test(e.text)){const o={stack:e.text,suppressErrorReporting:!0};if(p._mapStackEntries(o),o.stack.length){let t=!1;e.text=e.text.split("\n").reduce((s,e)=>{if(e.trimStart().startsWith("at ")){if(!t){const i=e.substr(0,e.indexOf("at "));o.stack.map((e,t)=>{var r=e[0],e=e[1],r=p._project.stackEntryByFileIdWithoutLineMapping(r,e);r&&(t=o.context[t]||"...",s.push(`${i}at ${t} (${d.basename(r.file)}:${e})`))}),t=!0}}else s.push(e);return s},[]).join("\n")}}p.reportConsoleOutput(e)},resume:function(){m("Sandbox requested early screen shot capture"),this._onFinished(),this._onFinished=_.noop,u.resume()},reject:function(e){this._parentSession||this._disposing||this._dispose(function(){p.cancelled(n)?a({runCancelled:!0}):a(e)})},recycleWorker:function(){this._parentSession||p.recycleWorker(c)},_dispose:function(e){var r=this;if(r._disposing=!0,clearTimeout(r._closeByErrorTimeout),clearTimeout(r._longRunningWarningTimeout),clearTimeout(r._longRunningPingTimeout),!r._parentSession){const a=p._workerPendingCleanup[c]={onDone:[]};var s=!1,i=function(t){s=!0,o&&clearTimeout(o),delete p._sessions[l],r._children.length&&r._children.forEach(e=>{delete p._sessions[e._id]}),a.onDone&&(a.onDone.forEach(e=>e(t)),a.onDone.length=0),delete p._workerPendingCleanup[c],e()},n=function(){s||(m("[%s] Sandbox is not responsive, recycling worker instance",l),p._tryClosingSandbox(u.close,l),p.recycleWorker(c),i(!0))};if(!r._globalSetup||r._completed||void 0!==p._opts.globalSetupTeardownTimeoutRecycle&&!p._opts.globalSetupTeardownTimeoutRecycle)if(r._globalSetup&&r._completed&&!r._globalSetupDoneCalled)console.error("[%s] Error running Global Setup, recycling worker.",l),n();else if(r._globalSetup&&r._completed&&0<r._globalErrors.length)console.error("[%s] Error running Global Teardown, recycling worker.",l),n();else try{var t=p._workerPingTimeoutOverride[c]||p._unresponsiveStandardTimeout,o=setTimeout(function(){n()},t);u.ping(function(){if(!s){clearTimeout(o),m("[%s] Sandbox is responsive, closing it",l);const t=setTimeout(()=>{console.error("[%s] Wallaby Teardown did not complete in %sms, recycling worker.",l,p._globalSetupTeardownTimeout),n()},p._globalSetupTeardownTimeout);p._tryClosingSandbox(u.close,l,function(e){s||(clearTimeout(t),(e?i:n)())})}})}catch(e){m("[%s] Sandbox can not be pinged: %s",l,e&&e.message),n()}else console.log("[%s] Global Setup and Teardown is not complete, waiting for %sms before recycling worker",l,p._globalSetupTeardownTimeout),r._globalSetupCompleteTimeout=setTimeout(()=>{console.error("[%s] Global Setup and Teardown did not complete, recycling worker.",l),n()},p._globalSetupTeardownTimeout)}}}}_tryClosingSandbox(e,t,r){r=r||function(){};try{e(r)}catch(e){m("[%s] Sandbox closing error, %s",t,e.message)}}_corruptedCache(e){return e&&e.match(/evaluating '[a-z]\.\$_\$coverage\[/)}_corruptedJestCache(e,t){if(this._zeroConfigJest&&e&&"string"==typeof e&&t&&"string"==typeof t&&~e.indexOf("Cannot read property '0' of undefined")){e=t.split("\n").map(e=>e.trim());if(1<e.length&&~e[1].toLowerCase().indexOf("server.js"))return!0}return!1}_processTestLog(e,r){var s=this;_.each(e,function(e){var t=e.message&&e.message.indexOf(" in file:///")||-1;~t&&(e.message=e.message.substring(0,t)),s._corruptedCache(e.message)&&(s._project.invalidateCache(),e.message=v),s._removeAnsi(e),s._mapStackEntries(e,r),process.env.quokka&&e.message&&(e.message=e.message.replace(s._normalizedLocalRoot,".").replace(s._project._localRoot,"."))})}_mapStackEntries(e,a){var l,c,u,p,t,r,d=this,h=g.length;e.stack&&_.isString(e.stack)&&!e.delayStackMapping&&(l=[],c={},(t=e.stack.split("\n"))&&d._corruptedCache(t[0])&&(d._project.invalidateCache(),e.message=v),_.each(t,function(e){var t=e.lastIndexOf(g);if(~t){t=e.substr(t+h).split(":");2<=t.length&&(r=parseInt(t[1],10),(u=d._project.stackEntryByFileId(parseInt(t[0],10)||t[0],r,parseInt((t[2]||"").replace(/\(/,""),10)))&&u.line?((p=d._extractBrowserStackLineContext(e))&&(c[l.length]=p),l.push([u.file,u.line])):u&&a&&l.push([u.file,r]))}else if(process.env.quokka){if(process.env.quokka){if(_.contains(e,"snapRootStackTraceMarker"))return!1;var t=-1!==e.indexOf("file:");if(e=d._project.normalizePath(e),t&&1<(r=e.split("?session=")).length&&(3===(t=r[1].split(":")).length&&(t[0]=""),e=r[0]+t.join(":")),_.contains(e,d._normalizedWallabyServerPath)){if(_.contains(e,"quokkaStackTraceMarker"))return!1}else{var r=e;3===(i=r!==(e=e.replace(d._normalizedLocalRoot,"."))?(s=r.lastIndexOf(d._normalizedLocalRoot),e.substr(s).split(":")):0!==(s=e.lastIndexOf("(")+1)?e.substring(s,e.lastIndexOf(")")-1).split(":"):2!==(s=e.lastIndexOf("at ")+3)?e.substr(s).split(":"):[]).length&&(p=d._extractNodeStackLineContext(e,s),t=parseInt(i[1],10),(u=d._project.stackEntryByFilePath(d._project.normalizePath(f.default.isLevelUpRelativePath(i[0])?i[0]:_.ltrim(i[0],"./")),t,parseInt(i[2],10)))&&u.line?(o=u.file,n=u.line):u&&u.file?u&&a&&(o=u.file||i[0],n=t):(o=i[0],n=t),o)&&(p&&(c[l.length]=p),l.push([o,n]))}}}else{-1!==e.indexOf("file://")&&([r,s]=e.split("?update="),r)&&s&&([,t]=s.split("&wallaby=true"),t)&&(e=decodeURI(r).replace("file://","")+t),e=d._project.normalizePath(e);var s,i,n,o=d._fileRoot?e.lastIndexOf(d._fileRoot):-1;!~o||3!==(i=_.rtrim(e.substr(o+d._fileRoot.length),")").split(":")).length&&2!==i.length||(n=parseInt(i[1],10),(u=d._project.stackEntryByFilePath(d._project.normalizePath(_.ltrim(i[0],"/")),n,parseInt(i[2],10)))&&u.line?((p=d._extractNodeStackLineContext(e,o))&&(c[l.length]=p),l.push([u.file,u.line])):u&&a&&0<n&&l.push([u.file,n]))}}),l.length||e&&e.suppressErrorReporting||m("Failed to map the stack to user code, entry message: %s, stack: %s",e.message&&e.message.substring(0,1024),e.stack.substring(0,1024)),e.message=d._project._cleanMessage(e.message),"node"===d._project.settings().env.type&&e.message&&~e.message.indexOf("Cannot find module")&&(e.message=d._project._cleanMessage(e.message,d._project._root)),e.message&&e.message.startsWith("TestingLibraryElementError")&&([t,...r]=e.message.split("\n\nIgnored nodes: comments, <script />, <style />\n"),t&&r?e.formattedMessage={header:{content:t,format:"error"},body:{content:r.join("\n\n"),format:"html"}}:([t,...r]=e.message.split("\n\n"),t&&r&&(e.formattedMessage={header:{content:t,format:"error"},body:{content:r.join("\n\n"),format:"html"}}))),e.stack=l,_.isEmpty(c)||(e.context=c),e.stackMapped=!0)}_extractNodeStackLineContext(e,t){if(4<t&&"("===e[t-1])return(e.substr(0,t-2)||"").split("at ")[1]}_extractBrowserStackLineContext(e){var t=e.split(" (http");return 2<=t.length?(t[0]||"").split("at ")[1]:2<=(t=e.split("@http")).length?t[0]:void 0}async _runGlobalSetup(e){const i=this;let n,o,a=!1;return n=await i._prepareSandbox(Object.assign(Object.assign({},e),{runGlobals:!0}),i._globalWorkerId),new Promise((r,s)=>{o=new Promise(t=>{i._createAndStartSession(n,async e=>{e=await i._getRunTestResult(e);(a?t:s)({result:e})},e=>{(a?t:s)({error:e})},e=>{a=!0,r({result:o,sandbox:n,processEnvUpdates:e})})})})}_reduceTestResults(e){return _.reduce(e,function(e,t){e.runCancelled=t.runCancelled||e.runCancelled,e.tests=e.tests.concat(t.tests||[]),e.log=e.log.concat(t.log||[]),e.fileChanges=e.fileChanges.concat(t.fileChanges||[]),e.globalErrors=e.globalErrors.concat(t.globalErrors||[]),e.error=t instanceof Error||e.error,e.loadingSequence=_.extend(e.loadingSequence,t.loadingSequence||{}),e.trace=e.trace||t.trace;var r=e.coverage;return _.isEmpty(r)?e.coverage=t.coverage:_.each(t.coverage,function(e,t){var s=r[t];s?_.each(e,function(e,t){var r=s[t];r?_.extend(r,e):s[t]=e}):r[t]=e}),e},{coverage:{},tests:[],log:[],globalErrors:[],loadingSequence:{},trace:void 0,fileChanges:[]})}_mergeRunTestsResults(e){m("Merging parallel test run results");e=this._reduceTestResults(e);return e.runCancelled?Promise.reject(e):e.error?Promise.reject(e.error):Promise.resolve(e)}_findWorkerThatExecutedTestFile(r){let s;return _.each(this._testFilesByWorker,(e,t)=>{if(e[r.normalizedRelativePath])return s=t,!1}),s}_testFileIsAssignedToWorker(e,t){var r=this._testFilesByWorker[t]=this._testFilesByWorker[t]||{};r[e.normalizedRelativePath]||(this._workerPingTimeoutOverride[t]=this._unresponsiveInitialTimeout,r[e.normalizedRelativePath]=!0)}_unassignAllTestFilesFromWorker(e){this._testFilesByWorker[e]={}}_runInParallel(e,t){var r=this,s=e.testFilesToLoad,i={};m("Distributing tests between %s workers",t);for(var n=0;n<t;n++){var o=_.omit(e,"testFiles");o.testFilesToLoad=[],i[n]={opts:o,workerId:n,ranges:0}}return _.each(s,function(e){var t=_.chain(i).sortBy(function(e){return e.ranges}).sortBy(function(e){return e.opts.testFilesToLoad.length}).value()[0];t.opts.testFilesToLoad.push(e),t.ranges+=e.rangesLength,r._testFileIsAssignedToWorker(e,t.workerId)}),m("Running tests in parallel"),Promise.all(_.chain(i).filter(function(e){return!(!e.ranges&&!e.opts.testFilesToLoad.length)}).map(function(e){return r._prepareSandbox(e.opts,e.workerId).then(function(e){return r._runTests(e)})}).value())}_prepareSandbox(t,e){const r=this._testRunId;return this._extension.prepare(t,e).then(e=>(e.testRunId=r,e.opts=t,e))}getWorker(l){var c=this;return(c._workers[l]||(c._workers[l]={id:l,promise:new Promise(function(a){var e=c._workers[l];if(e)if(e.instance){if(c._extension.healthy(e.instance))return void a(e);m("Found inactive run worker instance #%s, recycling",l),c.recycleWorker(l)}else if(e.promise)return e.promise;m("Starting run worker instance #"+l);try{c._extension.create(l,function(t){var r,s,i,e,n,o;t?(r=c._workers[l]=c._workers[l]||{id:l},t.onConnected?(r.onConnected=_.bind(t.onConnected,r),delete t.onConnected,r.promise=new Promise(function(e){s=e}),i=!1,e=setTimeout(function(){var e;i||(n(),(e=c._workers[l])&&e._connected?c._extension.recycle(t):c.recycleWorker(l),m("Worker is not created in time, recycling it"),s&&s({runCancelled:!0,rerun:!0}),a({runCancelled:!0,rerun:!0}))},1e4),n=function(){i=!0,clearTimeout(e)},(o=c._connectingWorkers[l])&&c._extension.recycle(o),c._connectingWorkers[l]=t,r.onConnected(function(e){delete c._connectingWorkers[l],i||(n(),m("Started run worker instance (delayed) #"+l),r.instance=t,r._connected=!0,t.channel=e,r.promise=Promise.resolve(t),s&&s(t),a(t))})):(m("Started run worker instance (immediate) #"+l),r.instance=t,r.promise=Promise.resolve(t),a(t))):a(new Error("Failed to create worker instance"))})}catch(e){a(e)}})})).promise}reportConsoleOutput(e){}recycleWorker(t){this._unassignAllTestFilesFromWorker(t);try{var e=this._workers[t];e&&e.instance&&(m("Recyling run worker instance #%s",t),this._extension.recycle(e.instance))}catch(e){m("Error while recycling run worker instance #%s: %s",t,e&&(e.stack||e.message))}finally{delete this._workers[t],delete this._workerPendingCleanup[t]}}stop(){var r=this;_.each(r._workers,function(e,t){r.recycleWorker(t)});try{r._wss&&r._wss.close()}catch(e){}try{r._httpServer&&r._httpServer.close()}catch(e){}}_calculateNumberOfParallelWorkers(){this._maxWorkers=Math.max(1,this._opts.workers.initial||Math.max(s.cpus().length-2,2)),i&&!this._opts.workers.initial&&"phantomjs"===this._opts.env.kind&&(this._maxWorkers=Math.min(16,this._maxWorkers)),this._minWorkers=Math.max(1,this._opts.workers.regular||Math.max(Math.floor(this._maxWorkers/2),2)),m("Parallelism for initial run: %s, for regular run: %s",this._maxWorkers,this._minWorkers)}}},{"./utils":75,http:void 0,os:void 0,path:void 0,ws:void 0}],67:[function(i,e,t){e.exports={initServerOptions:function(e){const r=i("graceful-fs"),s=i("fs-extra");e.runnerResolver=function(e,t){return i("browser"===e?"electron"===t?"./electronRunner":"chrome"===t?"./chromeRunner":"./phantomRunner":"./nodeRunner").Runner},e.processorPool=i("./processPool"),e.fileStructureCachePromise=function(e){return Q.nfcall(r.readFile,e).then(function(e){return Q.when(JSON.parse(e))})},e.fileStatPromise=function(e){return Q.nfcall(r.stat,e)},e.readFilePromise=function(e){return Q.nfcall(r.readFile,e)},e.writeFilePromise=function(e,t){return Q.nfcall(r.writeFile,e,t)},e.unlinkFilePromise=function(e){return Q.nfcall(r.unlink,e)},e.unlinkFileSync=function(e){return r.unlinkSync(e)},e.writeFileSync=function(e,t){return r.writeFileSync(e,t)},e.readFileSync=function(e){return r.readFileSync(e).toString("utf8")},e.fileExistsSync=function(e){return r.existsSync(e)},e.realpathSync=function(e){return r.realpathSync(e)},e.dirRemovePromise=function(e){return Q.nfcall(s.remove,e)},e.dirRemoveSync=function(e){return s.removeSync(e)},e.dirEnsurePromise=function(e){return Q.nfcall(s.ensureDir,e)},e.dirEnsureSync=function(e){return s.ensureDirSync(e)},e.copySync=function(e,t){return s.copySync(e,t)},e.nodeModulesLookup=i("./utils").default.nodeModulesLookup}}},{"./chromeRunner":13,"./electronRunner":43,"./nodeRunner":49,"./phantomRunner":51,"./processPool":63,"./utils":75,"fs-extra":void 0,"graceful-fs":void 0}],68:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.runPriority=r.TestTask=void 0;const s={testRunPriority:1,fileChangePriority:2,fullRunPriority:3},g=(r.runPriority=s,logger.create("testTask"))["debug"];r.TestTask=class{constructor(e){this._filesAndAffectedTests={},this._failingTests={},this._tests=[],this._priority=0,this._project=e,this._singleChangeTests=[]}files(){return _.reduce(this._filesAndAffectedTests,(e,t)=>(e[t.file.id]=t.file,e),{})}tests(){return this._tests}hasAnyFiles(){return 0<_.keys(this._filesAndAffectedTests).length}addTests(e){this._tests=this._tests.concat(e)}addTestFileWithGlobalError(e){this._testFilesWithGlobalErrors=this._testFilesWithGlobalErrors||{},this._testFilesWithGlobalErrors[e]=!0}addChangedFile(e,t){this._mergeAffectedTests(e.id,{file:e,tests:t,testFilesLoadedFrom:e.testFilesLoadedFrom})}setTestRunPriority(){this._priority=s.testRunPriority}setFileChangeRunPriority(){this._priority=s.fileChangePriority}setFullRunPriority(){this._priority=s.fullRunPriority}setEditorRequestedRun(){this._editorRequestedRun=!0}setEvaluatedExpressionRun(){this._editorRequestedRun=!0}setInitialTraceRun(e){this._initialTraceRun=e,this._editorRequestedRun=!0}setProfileRun(e){this._profileRun=e,this._editorRequestedRun=!0}setCodeClipSharingRun(e){this._codeClipSharingRun=e,this._editorRequestedRun=!0}setRegularTraceRunTest(e){this._traceTest=e}setManuallyRequestedRun(){this._manuallyRequestedRun=!0}setUpdateSnapshotsRun(){this._updateSnapshotsRun=!0}getFullRunPriority(){return s.fullRunPriority}getPriority(){return this._priority}isFullRun(){return this._priority===s.fullRunPriority}isFileChangedRun(){return this._priority===s.fileChangePriority}isManualRun(){return(this._priority===s.testRunPriority||this._manuallyRequestedRun)&&!this._editorRequestedRun}isEditorRequestedRun(){return this._priority===s.testRunPriority&&this._editorRequestedRun}initialTraceRunData(){return this._initialTraceRun}isInitialTraceRun(){return!!this._initialTraceRun}isProfileRun(){return!!this._profileRun}profileRunData(){return this._profileRun}isCodeClipSharingRun(){return!!this._codeClipSharingRun}codeClipSharingRunData(){return this._codeClipSharingRun}isUpdateSnapshotsRun(){return!!this._updateSnapshotsRun}isRegularTraceRun(){return!!this._traceTest}filesAdded(){this._anyFilesAdded=!0}filesNotAdded(){delete this._anyFilesAdded}filesDeleted(){this._anyFilesDeleted=!0}filesNotDeleted(){delete this._anyFilesDeleted}anyFilesAdded(){return this.isFullRun()||this._anyFilesAdded}anyFilesDeleted(){return this._anyFilesDeleted}mergeTask(e){var r=this;r._priority=Math.max(r._priority,e._priority),_.each(e._filesAndAffectedTests,(e,t)=>{r._mergeAffectedTests(t,e)}),r._failingTests=_.extend({},e._failingTests,r._failingTests),r._tests=r._tests.concat(e._tests),r._testFilesWithGlobalErrors=_.extend({},e._testFilesWithGlobalErrors||{},r._testFilesWithGlobalErrors||{}),r._singleChangeTests=r._singleChangeTests.concat(e._singleChangeTests),r._anyFilesAdded=r._anyFilesAdded||e._anyFilesAdded,r._anyFilesDeleted=r._anyFilesDeleted||e._anyFilesDeleted}_mergeAffectedTests(e,t){var r=this._filesAndAffectedTests[e];r?(r.tests=r.tests?r.tests.concat(t.tests):t.tests,r.testFilesLoadedFrom=_.extend(r.testFilesLoadedFrom||{},t.testFilesLoadedFrom||{})):this._filesAndAffectedTests[e]=t}failingTest(e,t){(this._failingTests[e]=this._failingTests[e]||[]).push(t)}_getAllTests(){var t,i,n,o,r,s,a,l,c,u,p=this,d=[],h=(this._traceTest?d=[this._traceTest]:(t=!1,i={},n={},l=a=s=r=o=0,_.each(p._filesAndAffectedTests,r=>{var s=r.file,e=(r.tests=_.map(r.tests,function(e){var t=p._getTestFileId(e);return i[t]||(i[t]=1,o++),r.testFilesLoadedFrom&&r.testFilesLoadedFrom[t]||s.numberOfFunctionsChanged||s.lastChangeIsComplex||s.relatedFilesWithTests?[e[0]]:e}),s.test&&(t=!0),s.test&&s.lastSingleChangeTest&&!s.relatedFilesWithTests&&!p._project.hadGlobalErrorsPreviousRun());e&&this._singleChangeTests.push([s.id,"?",s.lastSingleChangeTest]),d=d.concat(e?this._singleChangeTests:r.tests),_.extend(n,r.testFilesLoadedFrom||{})}),_.each(p._tests,e=>{e=p._getTestFileId(e);i[e]||(i[e]=1,r++)}),d=d.concat(p._tests),this.isFileChangedRun()&&_.each(this._testFilesWithGlobalErrors,(e,t)=>{t=parseInt(t,10),i[t]||(i[t]=1,d.push([t]))}),_.each(n,(e,t)=>{t=parseInt(t,10),i[t]||(i[t]=1,d.push([t]),a++)}),!d.length&&p._project._lastAffectedTestFileIds&&p._project.hasAnyPendingInEditorFileChanges()&&(d=d.concat(_.map(p._project._lastAffectedTestFileIds,e=>(i[e]||(i[e]=1,s++),[e])))),t&&1===_.size(p._filesAndAffectedTests)||p.isManualRun()||p.isInitialTraceRun()||p.isRegularTraceRun()||p.isProfileRun()||(c=[],u={},_.each(d,e=>{var t,e=p._getTestFileId(e);u[e]||(t=p._failingTests[e])&&(c=c.concat(t),u[e]=i[e]=1,l++)}),d=d.concat(c)),g("Test files from affected: %s, from deleted or manually requested: %s, from recently changed: %s, from loaded by: %s, from failing: %s",o,r,s,a,l)),this._project.settings().runAllTestsInAffectedTestFile&&_.each(d,e=>{e&&(e.length=1)}),this._project.selectedTestFiles());return this._project.settings().runSelectedTestsOnly&&!h.hasSomeIncludedTestFiles?d=[]:(h.hasSomeIncludedTestFiles||h.hasSomeExcludedTestFiles)&&(d=_.filter(d,e=>{e=p._getTestFileId(e);return(!h.hasSomeExcludedTestFiles||!p._project.isExcludedTestFile(e))&&(!h.hasSomeIncludedTestFiles||p._project.isIncludedTestFile(e))}),g("Running only selected or not excluded tests")),d}testData(){return this._getTestRunData()}_getTestRunData(){var e,l,c,u=this;return this.isFullRun()?(e=this._project.selectedTestFiles(),this._project.settings().runSelectedTestsOnly&&!e.hasSomeIncludedTestFiles?void 0:e.hasSomeIncludedTestFiles?{files:_.reduce(u._project.getIncludedTestFiles(),(e,t)=>(e[t.id]=t,e),{}),names:"*"}:e.hasSomeExcludedTestFiles?{files:_.reduce(u._project.getNotExcludedTestFiles(),(e,t)=>(e[t.id]=t,e),{}),names:"*"}:void 0):(e=u._getAllTests())?(l={},c={},_.each(e,function(e){var t=l,r=u._getTestFileId(e);if(r){r=u._project._structure.testFilesById[r];if(r&&(c[r.id]=r,"*"!==(l=1===e.length?"*":l)))for(var s=1,i=e.length;s<i;s++){var n=e[s],o=t[":"+n],a=s===i-1;if("*"===(o=o&&!a?o:t[":"+n]=a?"*":{}))break;t=o}}}),{files:c,names:l}):void 0}_getTestFileId(e){e=e&&e[0];if(e)return _.isNumber(e)?e:(this._project._structure.filesByPath[e]||{}).id}}},{}],69:[function(e,t,r){for(var s,m=function(){return this}()||global,i=["alert","confirm","prompt"],n=0;n<i.length;n++){var o=i[n];m[o]&&~m[o].toString().indexOf("[native code]")&&(m[o]=function(){})}m.addEventListener&&(m.addEventListener("beforeunload",function(){if(!(m.$_$tracer&&m.$_$tracer._finished||m.navigator&&m.navigator.userAgent&&!/PhantomJS/.test(m.navigator.userAgent)&&!/Electron/.test(m.navigator.userAgent)&&!m.$_$tracer._startRequested)&&m.$_$throwOnBeforeunload)throw new Error("One of your tests is trying to unload window object.")}),m.$_$reportUnhanledPromises)&&m.addEventListener("unhandledrejection",function(e){var t;if(e&&e.reason)throw t=new Error,e.reason.stack&&(t.stack=e.reason.stack),t.message="Unhandled promise rejection: "+(e.reason.message||e.reason),t});try{m.Error.stackTraceLimit=80}catch(e){}var _,d,a,l,u=/%[sdjc%]/g,c=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*$/,p=/^(0|[1-9][0-9]*)$/,h=/'([^\\']|\\')*'/,g=/\s?<!doctype html>|(<html\b[^>]*>|<body\b[^>]*>|<x-[^>]+>)+/i,f=/<\/?[a-z][\s\S]*>/i;try{f=new RegExp(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"].map(function(e){return"<"+e+"\\b[^>]*>"}).join("|"),"i")}catch(e){}function v(){var r=this;r._noOp=function(){},r._maxLogEntrySize=m.$_$maxLogEntrySize||16384,r._maxTraceSteps=m.$_$maxTraceSteps||999999,r._evaluatedExpressionPerRangeLimit=10,r._evaluatedProxyExpressionPerRangeLimit=300,r._undefined=m.undefined,r._setTimeout=m.setTimeout,r._Date=m.Date,r._Error=m.Error,r._Symbol=m.Symbol,r._JSONStringify=JSON.stringify,r._XMLHttpRequest=m.XMLHttpRequest,r._regExpToString=RegExp.prototype.toString,r._dateToString=Date.prototype.toString,r._HTMLAllCollection=m.HTMLAllCollection,r._getOwnPropertyNames=Object.getOwnPropertyNames,r._getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,r._pauseAfterSingleTestExecution=m.navigator&&m.navigator.userAgent&&/PhantomJS/.test(m.navigator.userAgent),r._replacedConsoleLog=m.console.log=function(){r._suppressConsoleLog||r._doWhenReceiverIsReady(function(e){r._log.apply(r,e)},arguments)},m.console.warn=function(){r._doWhenReceiverIsReady(function(e){r._warn.apply(r,e)},arguments)},m.console.error=function(){r._doWhenReceiverIsReady(function(e){r._error.apply(r,e)},arguments)},m.console.dir=function(){r._doWhenReceiverIsReady(function(e){r._dir.apply(r,e)},arguments)},m.console.debug=function(){r._doWhenReceiverIsReady(function(e){r._debug.apply(r,e)},arguments)},m.console.info=function(){r._doWhenReceiverIsReady(function(e){r._info.apply(r,e)},arguments)},r._receiver=m.$_$receiver||new m.WebSocket("ws://"+(m.$_$receiverHost||"127.0.0.1")+":"+m.$_$receiverPort),r._onReceiverReady=[function(){r._receiverReady=!0}],r._receiver.onopen=function(){for(var t=0,e=r._onReceiverReady.length;t<e;t++)try{r._onReceiverReady[t]()}catch(e){if(m.$_$reuseableTracer||void 0===r._onStartIndex||!(t<r._onStartIndex))throw e;r._globalBrowserError(e.message,void 0,void 0,void 0,e)}},r._receiver.onerror=function(e){throw new Error("Sandbox receiver error: "+e.message)},r.reset()}"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(e){function t(){return s.apply(this instanceof i?this:e||{},r.concat(Array.prototype.slice.call(arguments)))}var r=Array.prototype.slice.call(arguments,1),s=this,i=function(){};return i.prototype=this.prototype||{},t.prototype=new i,t}),v.prototype={setGlobalErrorHandler:function(){var e=this;m.$_$reuseableTracer||(m.onerror=function(){e._globalBrowserError.apply(e,arguments)})},_globalBrowserError:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._sendBrowserGlobalError.apply(t,e)},arguments)},reportDeclarationError:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._sendDeclarationError.apply(t,e)},arguments)},reportGlobalErrorObject:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._sendGlobalErrorObject.apply(t,e)},arguments)},reportSnapsImportError:function(e){var t=this;t._doWhenReceiverIsReady(function(e){t._sendGlobalErrorObject.apply(t,e)},[{message:e.message,stack:e.stack,keepSessionActive:!0}])},reportSnapsProgramScopeError:function(e){var t=this;t._doWhenReceiverIsReady(function(e){t._sendGlobalErrorObject.apply(t,e)},[{message:e.message,stack:e.stack,keepSessionActive:!0}])},sendTransformedFile:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._sendTransformedFile.apply(t,e)},arguments)},_sendTransformedFile:function(e){this._send("transformedFile",e)},sendFileChange:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._sendFileChange.apply(t,e)},arguments)},_sendFileChange:function(e){this._send("fileChange",e)},initialSpecId:function(){return m.$_$initialSpecId},setInitializeResult:function(e){this._initializeResult=e},start:function(e){var t,r=this;!e&&(r._delayStart||r._startRequested&&!m.$_$reuseableTracer)||(r.reset(),e?(r._onStart=e,r._patchFrameworks()):(t=function(){if(e)r._onStart=e,r._patchFrameworks();else{if(!r._onStart)throw new Error("Missing tracer start subscription");r._startRequested=!0,r._receiverReady?r._onStart():(r._onReceiverReady.push(r._onStart),r._onStartIndex=r._onReceiverReady.length-1)}},r._initializeResult&&r._initializeResult instanceof Promise?(r._initializeResult.then(t).catch(function(e){e.message="Uncaught Error in Wallaby `setup` function: "+e.message,r._globalBrowserError(e.message,void 0,void 0,void 0,e)}),delete r._initializeResult):t()))},isInitialized:function(){return!!m.$_$coverage},statement:function(e,t){m.$_$coverage[e][t][this._spec]=s++},scopeStart:function(e){this._fileEncounter[e]||(this._fileEncounterSequence.push(e),this._fileEncounter[e]=1)},programScopeStartLoading:function(e){this._testFileIds[e]&&(this._resetFileData(),m.$_$traceContext)&&m.$_$traceContext.test&&(e===m.$_$traceContext.test[0]?this._setTraceRecordMode():this._resetTracerMode()),this.scopeStart(e)},programScopeEndLoading:function(e){this._testFileIds[e]&&(this._saveCurrentTestLoadingSequence(),this._resetFileData())},_saveCurrentTestLoadingSequence:function(){this._fileEncounterSequence.length&&this._testLoadingSequence.push(this._fileEncounterSequence.slice())},entryFile:function(){return this._fileEncounterSequence[0]},started:function(e){(e=e||{}).loadingSequence=this._testLoadingSequence.slice(),this._resetLoadingData(),this._resetFileData(),m.$_$wp=this._original_$_$wp,m.$_$wpe=this._original_$_$wpe,this._send("started",e)},specStart:function(e,t){var r=this,s="string"==typeof t?t:r._format(t).content;this._doWhenReceiverIsReady(function(){r._sendWithHighPriority("preTest",s)}),this._spec=e,this._specName=s,this._resetFileData(),m.$_$trace&&(m.$_$trace.tests[e]={start:m.$_$trace.sequence.length})},specSyncStart:function(){var e;this._specRangeStart=s,m.$_$trace&&this._spec&&(e=m.$_$trace.tests[this._spec])&&(e.start=m.$_$trace.sequence.length)},specSyncEnd:function(){this._specRangeEnd=s-1},specEnd:function(){m.$_$trace&&(e=m.$_$trace.tests[this._spec])&&(e.end=Math.max(m.$_$trace.sequence.length-1,e.start),e.start>m.$_$trace.sequence.length-1)&&delete m.$_$trace.tests[this._spec],this._spec=0,delete this._specName;var e=this._specRangeStart,t=this._specRangeEnd;return this._specRangeStart=0,this._specRangeEnd=0,[e,t||s]},needToNotifySingleTestRun:function(){if(this._paused||this._onResumed||!this.hasSpecFilter()||m.$_$reuseableTracer||!this._pauseAfterSingleTestExecution)return!1;for(var e=m.$_$tests;"*"!==e;){var t=Object.keys(e);if(1!=t.length)return!1;e=e[t[0]]}return!0},notifySingleTestAfterEach:function(e){this._paused||this._onResumed||m.$_$reuseableTracer?e():(this._paused=!0,this._onResumed=e,this._send("resume"))},resume:function(){this._paused&&(this._paused=!1,this._onResumed)&&(this._onResumed(),delete this._onResumed)},paused:function(){return this._paused},hasSpecFilter:function(){return!!m.$_$tests&&"*"!==m.$_$tests},specFilter:function(e){var t=m.$_$tests[":?"];if(t&&t[":"+e[e.length-1]])return!0;for(var r=m.$_$tests,s=0,i=e.length;s<i;s++){if(!(r=r[":"+e[s]]))return!1;if("*"===r)return!0}return!1},globalSetupComplete:function(e){this._send("globalSetupComplete",e)},complete:function(e){m.$_$coverage&&(this._sendCoverageAndTimeMeasures(),m.$_$trace&&(m.$_$trace.values={},this._send("trace",{trace:m.$_$trace}),delete m.$_$trace,this._resetTracerMode()),this._send("complete",e),m.$_$reuseableTracer||(this._receiver.close(),this._finished=!0))},intermediateComplete:function(){this._sendCoverageAndTimeMeasures()},_sendCoverageAndTimeMeasures:function(){if(m.$_$coverage){for(var e=0,t=m.$_$coverage.length;e<t;e++){var r=m.$_$coverage[e];r&&r.length&&this._send("coverage",{id:e,ranges:r})}var s=Object.keys(_._autoTimeHits);for(e=0,t=s.length;e<t;e++){var i,n,o,a,l,c=_._autoTimeHits[s[e]];c.fileId&&(c.logMarkerContext&&(i=c.logMarkerContext.changeId,n=c.logMarkerContext.traceId,o=c.logMarkerContext.traceStep,a=c.logMarkerContext.permanent),(n||i||a)&&(l=l||{},a)&&(l.permanent=a),(n||i)&&(n&&(l.traceId=n),i&&(l.changeId=i),l.traceStep=o),this._sendLog("autoLog",{content:c.value?this._formatTime(c.value)+"ms":"Σ "+this._formatTime(c.total)+"ms, μ "+this._formatTime(c.total/c.n)+"ms, ⋀ "+this._formatTime(c.min)+"ms, ⋁ "+this._formatTime(c.max)+"ms",format:"raw"},c.context,c.fileId,c.rangeId,l))}}},_formatTime:function(e){return e.toFixed(3)},result:function(e){e.files=this._fileEncounterSequence,e.matchSnapshotCalls=this._matchSnapshotCalls,delete this._matchSnapshotCalls,m.$_$reuseableTracer&&this._sendWithHighPriority("postTest"),this._send("test",e)},_patchFrameworks:function(){var e,t,s,r,i,n,o,a=this;a._patchedFrameworks||m.$_$reuseableTracer||(a._patchedFrameworks=!0,e=m.requirejs&&"function"==typeof m.requirejs.load,t=m.System&&(m.System.fetch||m.System.import),a._shouldReportProgramScope=a._shouldReportProgramScope||e||t,e&&(s=m.requirejs.load,m.requirejs.load=function(e,t,r){return s.call(this,e,t,a._urlWithFileData(r))}),t&&(r=m.System.fetch,m.System.fetch=function(){var e=arguments[0]&&arguments[0].address;return e&&(arguments[0].address=a._urlWithFileData(e)),r.apply(this,arguments)},(i=m.fetch)&&(m.fetch=function(){var e=arguments[0];return e&&(arguments[0]=a._urlWithFileData(e)),i.apply(this,arguments)}),n=m.System.import,m.System.import=function(){var e=arguments[0];return e&&(arguments[0]=a._urlWithFileData(e)),n.apply(this,arguments)}),a._XMLHttpRequest&&(o=a._XMLHttpRequest.prototype.open,a._XMLHttpRequest.prototype.open=function(e,t){arguments[1]=a._urlWithFileData(t),o.apply(this,arguments)}),a._Error&&!a._Error.captureStackTrace&&m.navigator&&m.navigator.userAgent&&/PhantomJS\/2/.test(m.navigator.userAgent)&&(a._Error.captureStackTrace=function(){}))},_urlWithFileData:function(e){if(!e||!~e.indexOf("wallabyFileId")){for(var t=[],r=e.replace(/\\/g,"/").split("/"),s=0;s<r.length;s++)"."!==r[s]&&(".."===r[s]&&t.length&&".."!==t[t.length-1]?t.pop():t.push(r[s]));e=t.join("/"),e=this._appendFileData(e)}return e},_appendFileData:function(e){var t="/"===e.charAt(0)?e.substr(1):e,r=m.location&&m.location.host&&e.indexOf(m.location.host),r=(0<=r&&(t=t.substr(r+m.location.host.length+1)),e.lastIndexOf("?")),t=(t=0<=r?t.substring(0,r):t)&&this._getFileMetadata(t);return t?e+(~r?"&":"?")+t.ts+"&wallabyFileId="+t.id:e},_getFileMetadata:function(e){return m.$_$files[e]||m.$_$files[e.split("\\").join("/")]},_doWhenReceiverIsReady:function(e,t){this._receiverReady?e(t):this._onReceiverReady.push(function(){e(t)})},_log:function(){this._sendLog("log",this._format.apply(this,arguments))},_warn:function(){this._sendLog("warn",this._format.apply(this,arguments))},_error:function(){this._sendLog("error",this._format.apply(this,arguments))},_dir:function(e){this._sendLog("dir",{content:this._inspect(e),format:"raw"})},_debug:function(e){this._sendLog("debug",{content:this._inspect(e),format:"raw"})},_info:function(e){this._sendLog("info",this._format.apply(this,arguments))},_debugLog:function(){this._sendLog("debugLog",this._format.apply(this,arguments))},_sendBrowserGlobalError:function(e,t,r,s,i){e=e&&e.toString()||"",t=t&&t.toString()||"",(r=r&&r.toString()||"")&&(s=0<=s&&s.toString()||"")&&(r+=":"+s),this._send("globalError",{message:e,stack:i&&i.stack?i.stack:e+"\nat "+t+":"+r})},_sendDeclarationError:function(e){this._send("globalError",{message:e.message,stack:e.stack,declaration:!0})},_sendGlobalErrorObject:function(e){this._send("globalError",e)},setEnvGlobal:function(e){this._envGlobal=e},resetEnvGlobal:function(){delete this._envGlobal},debugLog:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._debugLog.apply(t,e)},arguments)},log:function(){var u,p,d=this,e=(m.$_$trace&&m.$_$traceContext&&(u="*",p=m.$_$trace.sequence.length-1),d._replacedConsoleLog!==m.console.log);if(e||d._envGlobal){for(var t=[],r=arguments.length-3,s=0;s<r;s++)t.push(arguments[s]);d._suppressConsoleLog=!0,d._envGlobal&&d._envGlobal.console.log.apply(d._envGlobal.console,t),e&&m.console.log.apply(console,t),d._suppressConsoleLog=!1}d._doWhenReceiverIsReady(function(e){d._loggingValue=!0;for(var t=[],r=e.length-3,s=0;s<r;s++)t.push(e[s]);var i,n=e[r],o=e[1+r],a=e[2+r],l=o+","+a,c=d._consoleHits[l]=d._consoleHits[l]||0,l=(c<d._evaluatedExpressionPerRangeLimit?i=d._evaluateExpressions(d._expressionId(o,l,c),t[0],n):c===d._evaluatedExpressionPerRangeLimit&&(i=d._evaluateExpressions(d._expressionId(o,l,c),t[0],n,new Error("Only the first "+c+" values are evaluated"))),d._consoleHits[l]=c+1,i&&u&&(i.traceId=u,i.traceStep=p),d._format.apply(d,t));d._sendLog("log",l.content?l:{content:"",format:"raw"},n,o,a,i),d._loggingValue=!1},arguments)},canUpdateSnapshots:function(){return this._updateSnapshotsRun},_expressionId:function(e,t,r,s){var i=(this.entryFile()||"").toString(),t=t+","+r+(i===(e=e.toString())?"":","+i);return s&&(t+="#"+s.hitCount),t},setAssertionData:function(e,t){try{e.actual||e.expected||!e.matcherResult||((e=e.matcherResult).showDiff="toEqual"===e.name);var r=Object.prototype.toString.call(e.actual);!0===e.showDiff&&r==Object.prototype.toString.call(e.expected)&&void 0!==e.expected&&"[object Boolean]"!==r&&"[object Number]"!==r&&"[object Function]"!==r&&("string"!=typeof e.actual&&(e.actual=this._inspect(e.actual,8,1e3,!0,!0,!0),e.expected=this._inspect(e.expected,8,1e3,!0,!0,!0)),t.actual=e.actual,t.expected=e.expected),"UnexpectedError"===e.name&&e.getErrorMessage&&(t.formattedDiff=e.getErrorMessage("ansi").toString()),e.actual&&e.actual.stack&&"string"==typeof e.actual.stack&&(t.stack=t.stack||"",t.stack+="\nFrom actual error object:\n"+e.actual.stack)}catch(e){}return t},diff:function(t,r,s,i,n){var o=this;return o._doWhenReceiverIsReady(function(){var e=o.setAssertionData({showDiff:!0,expected:t,actual:r},{});o._sendLog("diff",{content:""},s,i,n,void 0,e.expected,e.actual)},arguments),r},_sendLog:function(e,t,r,s,i,n,o,a){var l=t.content?t.content.length:0;t.content&&l>this._maxLogEntrySize&&(t.content=t.content.slice(0,this._maxLogEntrySize)+"...\n(truncated, total length: "+l+")",t.format="raw"),this._send("console",{type:e,text:t.content||"",format:t.format,valueBag:n,spec:this._spec,file:s,range:i,context:r,expected:o,actual:a})},_send:function(e,t){this._receiver.send(this._JSONStringify(this._createMessage(e,t)))},_createMessage:function(e,t){return{type:e,data:t,session:m.$_$session,childSession:m.$_$childSession}},_sendWithHighPriority:function(e,t){var r;this._highPriorityReceiver?((r=this._createMessage(e,t))._p="###wpm###",this._highPriorityReceiver.send(this._JSONStringify(r)+"\n")):this._send(e,t)},_resetLoadingData:function(){this._testLoadingSequence=this._safeObject([])},_resetFileData:function(){this._fileEncounterSequence=this._safeObject([]),this._fileEncounter=this._safeObject([])},reset:function(){var e=this;s=1,e._formattingOpts={},e._consoleHits={},e._consoleProxyHits={},delete e._proxyCache,e._autoTimeHits={},e._spec=0,delete e._specName,e._specRangeStart=0,e._specRangeEnd=0,e._stackDepth=0,e._functionCallId=0,e._resetFileData()},_safeObject:function(e){return e.toJSON=this._undefined,e},_format:function(e){var t=this._formattingOpts.depth||m.$_$logLimits.inline.depth,r=this._formattingOpts.maxElementsPerLevel||m.$_$logLimits.inline.elements,s=this._formattingOpts.resolveGetters;if("string"!=typeof e){for(var i=[],n=0;n<arguments.length;n++)i.push(this._inspect(arguments[n],t,r,!1,!1,s));return{content:i.join(" ")}}n=1;for(var o=arguments,a=o.length,l=1===a?e:String(e).replace(u,function(e){if("%%"===e)return"%";if(a<=n)return e;switch(e){case"%s":return String(o[n++]);case"%d":return Number(o[n++]);case"%j":return JSON.stringify(o[n++]);case"%c":return n++&&"";default:return e}}),c=o[n];n<a;c=o[++n])l+=null===c||"object"!=typeof c?" "+c:" "+this._inspect(c,t,r);return this._maybeHtml(l)?{content:l,format:"html"}:{content:"'"+(l||"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",format:"raw"}},_inspect:function(e,t,r,s,i,n){s={seen:[],showHidden:!1,hideTypes:s,depth:t||m.$_$logLimits.inline.depth,stylize:function(e){return e},maxElementsPerLevel:r||m.$_$logLimits.inline.elements,customInspect:m.$_$reuseableTracer&&this._nodeUtil,sortProperties:!!i,resolveGetters:!!n};return this._formatValue(s,e,s.depth)},_formatValue:function(t,r,s){var i=this,e=this._formatPrimitive(t,r);if(e)return e;if(t.customInspect){e=i._nodeUtil.inspect&&r[i._nodeUtil.inspect.custom];if("function"==typeof(e=e||r.inspect===i._nodeUtil.inspect||"function"!=typeof r.inspect?e:r.inspect)&&e!==i._nodeUtil.inspect&&(!r.constructor||r.constructor.prototype!==r)){e=e.call(r,s,t);if(e!==r)return"string"!=typeof e?i._formatValue(t,e,s):e}}var e=Object.keys(r),n=this._arrayToHash(e),o=(t.showHidden&&(e=Object.getOwnPropertyNames(r)),t.sortProperties&&e.sort(),this._getOwnPropertySymbols(r));if(o.length&&(t.showHidden||"function"!=typeof r.propertyIsEnumerable||(o=o.filter(function(e){return r.propertyIsEnumerable(e)})),e=e.concat(o)),0===e.length){if("function"==typeof r)return o=r.name?": "+r.name:"",t.stylize("[λ"+o+"]","special");if(this._isRegExp(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(this._isDate(r))return t.stylize(Date.prototype.toString.call(r),"date");if(this._isBigInt(r))return r.toString()+"n";if(this._isError(r))return this._formatError(r)}var a,o="",l=!1,c=!1,u=!1,p=["{","}"],d=r&&r.constructor&&"string"==typeof r.constructor.name&&r.constructor.name||void 0;if("Object"!==d&&!t.hideTypes||(d=void 0),this._isArray(r)?(l=!(d=void 0),p=["[","]"]):this._isSet(r)?c=!0:this._isMap(r)&&(u=!0),"function"==typeof r&&(o=" [λ"+(r.name?": "+r.name:"")+"]"),this._isRegExp(r)&&(o=" "+RegExp.prototype.toString.call(r)),this._isDate(r)&&(o=" "+Date.prototype.toUTCString.call(r)),""===(o=this._isError(r)?" "+this._formatError(r):o)&&d&&(p[0]=d+("String"!==d&&"Number"!==d&&"Boolean"!==d||"function"!=typeof r.valueOf?"":" "+this._formatPrimitive(t,r.valueOf()))+" "+p[0]),l||u||c||(this._isGenerator(r)?o=" [Generator] ":this._isIterator(r)&&(o=" [Iterator] ")),this._nodeUtil&&this._nodeUtil.inspect&&this._looksLikePromise(r))return this._nodeUtil.inspect(r);if(!(0!==e.length||l&&0!==r.length||c||u))return p[0]+o+p[1];if(s<0)return this._isRegExp(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special");t.seen.push(r);d=!1;e.length>t.maxElementsPerLevel&&(e.length=t.maxElementsPerLevel,l&&(r=r&&r.slice(0,t.maxElementsPerLevel)),d=!0);try{a=l?this._formatArray(t,r,s,n,e):c?this._formatSet(t,r,s,n,e,d):u?this._formatMap(t,r,s,n,e,d):e.map(function(e){return i._formatProperty(t,r,s,n,e,l)})}catch(e){a=[]}return d&&a.push("..."),t.seen.pop(),this._reduceToSingleString(a,o,p)},_isArray:function(e){return Array.isArray(e)||"object"==typeof e&&"[object Array]"===this._objectToString(e)},_isSet:function(e){return!!(e&&m.Set&&"[object Set]"===this._objectToString(e)&&e.forEach)},_isMap:function(e){return!!(e&&m.Map&&"[object Map]"===this._objectToString(e)&&e.forEach)},_isIterator:function(e){return!!(e&&m.Symbol&&m.Symbol.iterator&&"function"==typeof e[m.Symbol.iterator])},_isGenerator:function(e){return!!(e&&m.Symbol&&m.Symbol.toStringTag&&"Generator"===e[m.Symbol.toStringTag])},_isRegExp:function(e){return"object"==typeof e&&"[object RegExp]"===this._objectToString(e)},_isDate:function(e){return"object"==typeof e&&"[object Date]"===this._objectToString(e)},_isBigInt:function(e){return"bigint"==typeof e},_isError:function(e){return"object"==typeof e&&("[object Error]"===this._objectToString(e)||e instanceof Error)},_objectToString:function(e){return Object.prototype.toString.call(e)},_isNegativeZero:function(e){return 1/e===Number.NEGATIVE_INFINITY},_reduceToSingleString:function(e,t,r){return 60<e.reduce(function(e,t){return e+t.length+1},0)?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]},_formatPrimitive:function(e,t){switch(typeof t){case"undefined":return e.stylize("undefined","undefined");case"string":var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string");case"number":return!t&&this._isNegativeZero(t)?e.stylize("-0","number"):e.stylize(""+t,"number");case"boolean":return e.stylize(""+t,"boolean");case"symbol":return this._Symbol&&this._Symbol.prototype.toString.call(t)}if(null===t)return e.stylize("null","null")},_formatError:function(e){return"["+Error.prototype.toString.call(e)+"]"},_formatSet:function(t,e,r,s,i,n){var o=this,a=[];e.forEach(function(e){a.length>t.maxElementsPerLevel||(e=o._formatValue(t,e,null===r?null:r-1),a.push(e))}),!n&&a.length>t.maxElementsPerLevel&&a.push("...");for(var l=0;l<i.length;l++)a.push(o._formatProperty(t,e,r,s,i[l],!1));return a},_formatMap:function(s,e,i,t,r,n){var o=this,a=[];e.forEach(function(e,t){var r;a.length>s.maxElementsPerLevel||(r=o._formatValue(s,t,t=null===i?null:i-1),r=(r+=" => ")+o._formatValue(s,e,t),a.push(r))}),!n&&a.length>s.maxElementsPerLevel&&a.push("...");for(var l=0;l<r.length;l++)a.push(o._formatProperty(s,e,i,t,r[l],!1));return a},_formatArray:function(t,r,s,i,e){for(var n=this,o=[],a=0,l=r.length;a<l;++a)this._hasOwnProperty(r,String(a))?o.push(this._formatProperty(t,r,s,i,String(a),!0)):o.push("");return e.forEach(function(e){e.toString().match(/^\d+$/)||o.push(n._formatProperty(t,r,s,i,e,!0))}),o},_formatProperty:function(e,t,r,s,i,n){var o,a,t=!e.resolveGetters&&Object.getOwnPropertyDescriptor(t,i)||{value:t[i]};if(t.get?a=t.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):t.set&&(a=e.stylize("[Setter]","special")),this._hasOwnProperty(s,i)||(o="["+i.toString()+"]"),a||(e.seen.indexOf(t.value)<0?-1<(a=null===r?this._formatValue(e,t.value,null):this._formatValue(e,t.value,r-1)).indexOf("\n")&&(a=n?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),void 0===o){if(n&&i.match(/^\d+$/))return a;o=this._propertyName(i),o=e.stylize(o,"string")}return o+": "+a},_arrayToHash:function(e){var t={};return e.forEach(function(e){t[e]=!0}),t},_hasOwnProperty:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},_getOwnPropertySymbols:function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]},_propertyName:function(e){return e.match(/^\d+$/)?e:(e=JSON.stringify(""+e)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?e.substr(1,e.length-2):e.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'")},_evaluate:function(e,t,r,s,i,n){var o={};try{var a,l,c=r||{};c.props=c.props!==this._undefined?c.props:100,c.sortProps=c.sortProps!==this._undefined&&c.sortProps,c.elements=c.elements!==this._undefined?c.elements:100,c.depth=c.depth!==this._undefined?c.depth:1,c.strLength=c.strLength!==this._undefined?c.strLength:m.$_$logLimits.values.default.stringLength,c.expId=c.expId||s,c.rootExpression=t,c.autoExpand=c.autoExpand!==this._undefined&&c.autoExpand,c.autoExpandPreviousObjects=[],c.autoExpandPropertyCount=0,c.autoExpandLimit=c.autoExpandLimit!==this._undefined?c.autoExpandLimit:m.$_$logLimits.values.autoExpand.elements,c.autoExpandMaxDepth=c.autoExpandMaxDepth!==this._undefined?c.autoExpandMaxDepth:m.$_$logLimits.values.autoExpand.depth,c.resolveGetters=c.autoExpand||m.$_$resolveGetters,c.node={current:this._undefined,parent:this._undefined,index:0},c.level=0,i?(a={error:i.message},this._processTreeNodeResult(a,c),o.data=a):(o.data=this._traverseObject({},e,c,c.expressionsToEvaluate||{}),this._suppressCallStackEval||n||!(o.data.expandable&&o.data.props&&o.data.props.length)&&o.data.expandable||(l={id:o.data.id+",cs",expandable:!0,callStackNode:!0,label:{name:"Call Stack"},disallowToCopyPath:!0,disallowToCopyData:!0,queryPath:o.data.queryPath.slice().concat(["_s_."])},o.data.expandable||(o.data.expandable=!0,o.data.props=[]),o.data.props.unshift(l),c.expressionsToEvaluate&&c.expressionsToEvaluate["_s_."]&&(l.callStack={stack:this._currentStack(),replaceFirstEntryLine:!c.proxyValue})),this._specName&&!c.proxyValue&&o.data&&o.data.label&&o.data.label.value&&(o.data.label.value+=" ("+this._specName+")"))}catch(e){r={error:'Error while evaluating "'+t+'": '+(e&&e.message||"")};this._processTreeNodeResult(r,c),o.data=r}return o},_addProperty:function(i,n,o,a,l,c){var u=this;return function(e){var t=l.node.current,r=l.node.index,s=l.node.parent;l.node.parent=t,l.node.index="number"==typeof a?a:e,i.push(u._property(n,o,a,l,c)),l.node.parent=s,l.node.index=r}},_addObjectProperty:function(i,e,n,o,a,l,c){var u=this;return e["_p_"+a.toString()]=!0,function(e){var t=l.node.current,r=l.node.index,s=l.node.parent;l.node.parent=t,l.node.index=e,i.push(u._property(n,o,a,l,c)),l.node.parent=s,l.node.index=r}},_traverseObject:function(t,s,i,e){var r,n,o,a=this,l=i.autoExpand;try{i.level++,i.autoExpand&&i.autoExpandPreviousObjects.push(s);var c,u,p=[],d=[],h=this._type(s),g="array"===h,f=!1,m="function"===h,_=this._isPrimitiveType(h),v=this._isPrimitiveWrapperType(h),y=_||v,b={},w=0,k=!1,x=/^(([1-9]{1}[0-9]*)|0)$/;if(i.depth){if(g){var S=s.length,P=e.ranges||i.ranges;if(P&&P.length===S)f=!0,p=P.props,this._traverseRanges(p,function(e,t,r){for(R=t;R<=r;R++)d.push(a._addProperty(e.props,s,h,R,i))});else if(S>i.elements){var F,f=!0,C=0,T=S-1;i.autoExpand?(F=a._createRanges(C,T,i)).length&&(p=p.concat(F),F[0].props=!0,a._traverseRanges([F[0]],function(e,t,r){for(R=t;R<=r;R++)d.push(a._addProperty(e.props,s,h,R,i))})):d.push((r=C,n=T,o=i,function(){p=p.concat(a._createRanges(r,n,o))}))}else for(T=S,R=C=0;R<T;R++)d.push(a._addProperty(p,s,h,R,i));i.autoExpandPropertyCount+=d.length}if("null"!==h&&"undefined"!==h&&!_&&"String"!==h&&"Buffer"!==h&&"bigint"!==h){var j=e.props||i.props;if(this._isSet(s)?(R=0,s.forEach(function(e){var t;w++,i.autoExpandPropertyCount++,j<w||!i.isExpressionToEvaluate&&i.autoExpand&&i.autoExpandPropertyCount>i.autoExpandLimit?k=!0:d.push(a._addProperty(p,s,"Set",R++,i,(t=e,function(){return t})))})):this._isMap(s)&&s.forEach(function(e,t){var r;w++,i.autoExpandPropertyCount++,j<w||!i.isExpressionToEvaluate&&i.autoExpand&&i.autoExpandPropertyCount>i.autoExpandLimit?k=!0:(100<(t=a._inspect(t,2,10).replace(/\r?\n|\r/g," ").replace(/\s\s+/g," ")).length&&(t=t.slice(0,100)+"..."),d.push(a._addProperty(p,s,"Map",t,i,(r=e,function(){return r}))))}),!f){try{for(c in s)if(!(g&&x.test(c)||this._blacklistedProperty(s,c))){if(w++,i.autoExpandPropertyCount++,j<w){k=!0;break}if(!i.isExpressionToEvaluate&&i.autoExpand&&i.autoExpandPropertyCount>i.autoExpandLimit){k=!0;break}d.push(a._addObjectProperty(p,b,s,h,c,i))}}catch(e){}if(b._p_length=!0,m&&(b._p_name=!0),!k){var E=this._getOwnPropertyNames(s).concat(this._getOwnPropertySymbols(s)),R=0;for(S=E.length;R<S;R++)if(c=E[R],!(g&&x.test(c.toString())||this._blacklistedProperty(s,c)||b["_p_"+c.toString()])){if(w++,i.autoExpandPropertyCount++,j<w){k=!0;break}if(!i.isExpressionToEvaluate&&i.autoExpand&&i.autoExpandPropertyCount>i.autoExpandLimit){k=!0;break}d.push(a._addObjectProperty(p,b,s,h,c,i))}}}}}if(t.type=h,y?(t.value=s.valueOf(),this._capIfString(h,t,i,e)):"date"===h?t.value=this._dateToString.call(s):"bigint"===h?t.value=s.toString():"RegExp"===h?t.value=this._regExpToString.call(s):"symbol"===h&&this._Symbol?t.value=this._Symbol.prototype.toString.call(s):i.depth||"null"===h||"undefined"===h||(delete t.value,t.capped=!0),k&&(t.cappedProps=!0),u=i.node.current,i.node.current=t,this._treeNodePropertiesBeforeFullValue(t,i),d.length)for(R=0,S=d.length;R<S;R++)d[R](R);p.length&&(t.props=p)}catch(e){t.type="unknown",t.error=e.message,u=i.node.current,i.node.current=t,this._treeNodePropertiesBeforeFullValue(t,i)}return this._additionalMetadata(s,t),this._treeNodePropertiesAfterFullValue(t,i),i.node.current=u,i.level--,i.autoExpand=l,i.autoExpand&&i.autoExpandPreviousObjects.pop(),t},_blacklistedProperty:function(e,t){if((e===m||e===this._envGlobal)&&"wallaby"===t||t.indexOf&&0===t.indexOf("$_$"))return!0},_createRanges:function(e,t,r,s){s=s||{index:0};for(var i=r.elements,n=[],o=Math.max(Math.ceil((t-e+1)/i),i),a=e;a<t;a+=o){var l=a,c=Math.min(a+o-1,t),l={rangeNode:!0,name:l+" - "+(c=t<=c+i/2?t:c),props:2*i<c-l+1&&1<i?this._createRanges(l,c,r,s):[]};if(this._setNodeId(l,r),this._setNodeLabel(l,r),this._setNodeExpandableState(l,r),this._setNodePermissions(l,r),l.id+=" r "+s.index++,n.push(l),c===t)break}return n},_traverseRanges:function(e,t){for(var r=0,s=e.length;r<s;r++){var i,n=e[r];n.rangeNode=!0,n.props&&(n.props.length?this._traverseRanges(n.props,t):!0===n.props&&(i=n.name.split("-"),n.props=[],t(n,parseInt(i[0],10),parseInt(i[1],10))))}},_capIfString:function(e,t,r,s){s=s.strLength||r.strLength;("string"===e||"String"===e)&&t.value&&t.value.length>s&&(t.capped=t.value.substr(0,s),delete t.value)},_property:function(e,t,r,s,i){var n=this,o=(i=i||function(e,t){return e[t]},r.toString()),a=s.expressionsToEvaluate||{},l=s.depth,c=s.isExpressionToEvaluate;try{var u,p=this._isMap(e),d=o,h=(p&&"'"===d[0]&&(d=d.substr(1,d.length-2)),s.expressionsToEvaluate=a["_p_"+d]),g=(h&&(s.depth=s.depth+1),s.isExpressionToEvaluate=!!h,"symbol"==typeof r),f={name:g||p?o:this._propertyName(o)};if(g&&(f.symbol=!0),"array"!==t&&"Error"!==t){var m=this._getOwnPropertyDescriptor(e,r);if(m&&(m.set&&(f.setter=!0),m.get)&&!h&&!s.resolveGetters)return f.getter=!0,this._processTreeNodeResult(f,s),f}try{u=i(e,r)}catch(e){return f={name:o,type:"unknown",error:e.message},this._processTreeNodeResult(f,s),f}var _=this._type(u),v=this._isPrimitiveType(_);return f.type=_,v?this._processTreeNodeResult(f,s,u,function(){f.value=u.valueOf(),h||n._capIfString(_,f,s,{})}):s.autoExpand&&s.level<s.autoExpandMaxDepth&&s.autoExpandPreviousObjects.indexOf(u)<0&&"function"!==_&&s.autoExpandPropertyCount<s.autoExpandLimit||s.level<l||h?(this._traverseObject(f,u,s,h||{}),this._additionalMetadata(u,f)):this._processTreeNodeResult(f,s,u,function(){"null"!==_&&"undefined"!==_&&(delete f.value,f.capped=!0)}),f}finally{s.expressionsToEvaluate=a,s.depth=l,s.isExpressionToEvaluate=c}},_processTreeNodeResult:function(e,t,r,s){this._treeNodePropertiesBeforeFullValue(e,t),s&&s(),this._additionalMetadata(r,e),this._treeNodePropertiesAfterFullValue(e,t)},_treeNodePropertiesBeforeFullValue:function(e,t){this._setNodeId(e,t),this._setNodeQueryPath(e,t),this._setNodeExpressionPath(e,t),this._setNodePermissions(e,t)},_treeNodePropertiesAfterFullValue:function(e,t){this._setNodeLabel(e,t),this._setNodeExpandableState(e,t),t.sortProps&&this._sortProps(e,t),this._addFunctionsNode(e,t),this._addLoadNode(e,t),this._cleanNode(e,t)},_additionalMetadata:function(e,t){try{e&&"number"==typeof e.length&&(t.length=e.length)}catch(e){}if("number"===t.type||"Number"===t.type)if(isNaN(t.value))t.nan=!0,delete t.value;else switch(t.value){case Number.POSITIVE_INFINITY:t.positiveInfinity=!0,delete t.value;break;case Number.NEGATIVE_INFINITY:t.negativeInfinity=!0,delete t.value;break;case 0:this._isNegativeZero(t.value)&&(t.negativeZero=!0)}else"function"===t.type&&"string"==typeof e.name&&e.name&&t.name&&e.name!==t.name&&(t.funcName=e.name)},_setNodeId:function(e,t){e.id=t.node.parent?t.node.parent.id+" "+t.node.index:t.expId},_sortProps:function(e){e.props&&e.props.length&&"array"!==e.type&&"Map"!==e.type&&"Set"!==e.type&&e.props.sort(function(e,t){e=e.name.toLowerCase(),t=t.name.toLowerCase();return e<t?-1:t<e?1:0})},_addFunctionsNode:function(e,t){if(e.props&&e.props.length){for(var r,s=[],i=[],n=0,o=e.props.length;n<o;n++){var a=e.props[n];("function"===a.type?s:i).push(a)}!i.length&&t.autoExpand&&(e.capped=!0),!i.length||s.length<=1||(e.props=i,r={functionsNode:!0,props:s},t.autoExpand&&(r.capped=!0),this._setNodeId(r,t),this._setNodeLabel(r,t),this._setNodeExpandableState(r,t),this._setNodePermissions(r,t),r.id+=" f",e.props.unshift(r))}},_addLoadNode:function(e,t){var r;e.props&&e.props.length&&e.cappedProps&&"string"!==e.type&&(this._setNodeId(r={loadActionNode:!0},t),this._setNodeQueryPath(r,t),this._setNodeLabel(r,t),this._setNodeExpandableState(r,t),this._setNodePermissions(r,t),r.id+=" l",e.props.push(r))},_setNodeExpandableState:function(e){(e.capped||e.cappedProps||e.functionsNode||e.loadActionNode||e.rangeNode||e.getter||this._isArray(e.props))&&(e.expandable=!0)},_setNodePermissions:function(e,t){var t=t.node.parent,r=(e._hasSymbolPropertyOnItsPath=e.symbol||t&&t._hasSymbolPropertyOnItsPath,t&&t._hasSetOnItsPath),t=t&&t._hasMapOnItsPath,s=(e._hasSetOnItsPath="Set"===e.type||r,e._hasMapOnItsPath="Map"===e.type||t,!(e.functionsNode||e.loadActionNode||e.rangeNode||e.error));(!s||e._hasSymbolPropertyOnItsPath||r||t)&&(e.disallowToCopyPath=!0),s&&!e.getter&&"function"!==e.type&&"symbol"!==e.type&&"Set"!==e.type&&"Map"!==e.type||(e.disallowToCopyData=!0)},_cleanNode:function(e){delete e._hasSymbolPropertyOnItsPath,delete e._hasSetOnItsPath,delete e._hasMapOnItsPath},_setNodeExpressionPath:function(e,t){var r;t.node.parent?(r=t.node.parent.expressionPath.slice(),e.expressionPath=r.concat([this._propertyAccessor(e.name)])):e.expressionPath=[t.rootExpression]},_propertyAccessor:function(e){return e?e.match(p)?"["+e+"]":e.match(c)?"."+e:e.match(h)?"["+e+"]":"['"+e+"']":""},_setNodeQueryPath:function(e,t){var r;t.node.parent?e.loadActionNode?e.queryPath=t.node.current.queryPath.slice():((r=e.name)&&"'"===r[0]&&(r=r.substr(1,r.length-2)),e.queryPath=t.node.parent.queryPath.slice().concat(["_p_"+r])):e.queryPath=[e.id]},_setNodeLabel:function(e,t){e.label={},e.rangeNode?e.label.name=e.name:e.loadActionNode?e.label.name="...":e.functionsNode?e.label.name="Functions":(e.label.name=e.name,e.label.type=this._formatNodeType(e,t),e.label.value=this._formatNodeValue(e,t))},_formatNodeValue:function(e,t,r){if(e.rangeNode)return e.name;if(e.error)return e.error;if(e.getter)return"(...)";if("number"===e.type.toLowerCase()){if(e.nan)return"NaN";if(e.positiveInfinity)return"Infinity";if(e.negativeInfinity)return"-Infinity";if(e.negativeZero)return"-0"}return"null"===e.type||"undefined"===e.type?e.type:"string"===e.type.toLowerCase()?"'"+(e.capped?e.capped+"...":e.value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'"+(e.capped?" (total length: "+e.length+")":""):(this._isUndefined(e.value)?this._formatCompactObjectView(e,t,r):e.value)+(e.funcName?":"+e.funcName:"")},_formatCompactObjectView:function(e,t,r){if("function"===e.type)return"λ";var s="array"===e.type&&0===e.length,i=["array"===e.type?"[":"{","","array"===e.type?"]":"}"];if(r||e.capped||e.ranges)i[1]=s?"":"...";else if(e.props){for(var n=[],o=[],a=0;a<e.props.length&&o.length<=5;a++){var l=e.props[a];("function"===l.type||l.getter?n:o).push("array"===e.type?this._formatNodeValue(l,t,!0):l.name+": "+this._formatNodeValue(l,t,!0))}o.length<5&&(o=o.concat(n)),i[1]=o.join(", "),5<e.props.length&&(i[1]+=", ...")}return i.join("")},_formatNodeType:function(e){if(this._isDisplayableType(e.type))return e.error?"":"date"===e.type?"Date":"array"===e.type?e.length?"Array("+e.length+")":"":e.type},_isUndefined:function(e){return e===this._undefined},_isDisplayableType:function(e){return!("boolean"===e||"Boolean"===e||"symbol"===e||"string"===e||"String"===e||"number"===e||"Number"===e||"object"===e||"Object"===e||"function"===e||"null"===e||"undefined"===e)},_type:function(e){var t=typeof e;return"object"===t?"[object Array]"===this._objectToString(e)?t="array":"[object Date]"===this._objectToString(e)?t="date":"[object BigInt]"===this._objectToString(e)?t="bigint":null===e?t="null":e.constructor&&(t=e.constructor.name||t):"undefined"===t&&this._HTMLAllCollection&&e instanceof this._HTMLAllCollection&&(t="HTMLAllCollection"),t},_isPrimitiveType:function(e){return"boolean"===e||"string"===e||"number"===e},_isPrimitiveWrapperType:function(e){return"Boolean"===e||"String"===e||"Number"===e},initLoadingPhase:function(){var r=this;this._resetLoadingData(),this._testFileIds=this._safeObject({}),(m.$_$testFiles||[]).forEach(function(e){r._testFileIds[e.id]=1}),r._original_$_$wp=m.$_$wp,r._original_$_$wpe=m.$_$wpe,m.$_$wp=function(e,t){return r._initializeCoverage(e,t),r._reportProgramScope("programScopeStart",e),r.programScopeStartLoading(e),r._executionContext()},m.$_$wpe=function(e){r._reportProgramScope("programScopeEnd",e),r.programScopeEndLoading(e)},!m.$_$traceContext||m.$_$traceContext.test?r._resetTracerMode():m.$_$traceContext.test||r._setTraceRecordMode(),m.$_$profileRun?r._setProfileMode():r._resetTracerMode()},_resetTracerMode:function(){m.$_$w=_.$_$w,m.$_$w_=_.$_$w_,m.$_$wv=_.$_$wv,m.$_$wf=_.$_$wf,this._envGlobal&&(this._envGlobal.$_$w=m.$_$w,this._envGlobal.$_$w_=m.$_$w_,this._envGlobal.$_$wv=m.$_$wv,this._envGlobal.$_$wf=m.$_$wf)},_setProfileMode:function(){m.$_$wf=m.$_$w_=m.$_$w=function(){},m.$_$wv=function(e,t,r,s,i,n){return n},this._envGlobal&&(this._envGlobal.$_$w=m.$_$w,this._envGlobal.$_$w_=m.$_$w_,this._envGlobal.$_$wf=m.$_$wf,this._envGlobal.$_$wv=m.$_$wv)},_setTraceRecordMode:function(){m.$_$trace||(m.$_$trace={sequence:[],tests:{},values:{}}),m.$_$traceContext.allowRecordingValues=!0,m.$_$traceContext.currentFrame=m.$_$traceContext.currentFrame||0,m.$_$w=function(e,t,r){_.$_$w(e,t),_._recordTrace(e,t,r[0]),_._recordTraceValues(e,t,r[1]),_._recordCallStack()},m.$_$wv=function(e,t,r,s,i,n,o,a,l,c){if(m.$_$trace){var u=_._expressionId(e,r,0);if(!c||!c.traceId||c.permanent){var p={};for(prop in c)p[prop]=c[prop];p.traceId="*",p.traceStep=m.$_$trace.sequence.length-1;var d=_.$_$wv(e,t,r,s,i,n,o,a,l,p);if(!p.permanent)return d}c.permanent&&delete c.permanent,m.$_$trace.values[u]={fileId:e,rangeId:t,fileRangeId:r,context:i,val:n,exp:o,singleHit:a,evalOpts:l,logMarkerContext:c},_._recordTraceValues(e,t,s[1],!0)}return n},m.$_$w_=function(e,t,r,s){_.$_$w_(e,t),m.$_$traceContext.allowRecordingValues&&s&&m.$_$traceContext.currentFrame<=m.$_$trace.sequence.length-1&&(m.$_$traceContext.allowRecordingValues=!1)},m.$_$wf=function(e){return _.scopeStart(e),_._executionContext()},this._envGlobal&&(this._envGlobal.$_$w=m.$_$w,this._envGlobal.$_$wv=m.$_$wv,this._envGlobal.$_$wf=m.$_$wf)},_executionContext:function(){return[++this._stackDepth,++this._functionCallId]},_recordCallStack:function(){m.$_$trace&&m.$_$traceContext.captureCallStackFrame===m.$_$trace.sequence.length-1&&(m.$_$trace.callStack={},m.$_$trace.callStack[m.$_$traceContext.captureCallStackFrame]={stack:_._currentStack()})},_recordTraceValues:function(e,t,r,s){var i,n;m.$_$traceContext.allowRecordingValues&&m.$_$trace&&(i=m.$_$traceContext.currentFrame===m.$_$trace.sequence.length-1,(m.$_$traceContext.currentFrame<m.$_$trace.sequence.length-1&&!m.$_$traceContext.currentFrameFunctionCallId||r<=m.$_$traceContext.currentFrameFunctionCallId)&&(m.$_$traceContext.allowRecordingValues=!1),i&&!s&&(m.$_$traceContext.currentFrameFunctionCallId=r),i||s&&m.$_$traceContext.currentFrameFunctionCallId&&r===m.$_$traceContext.currentFrameFunctionCallId)&&Object.keys(m.$_$trace.values).length&&(n=m.$_$trace.values,m.$_$trace.values={},_._doWhenReceiverIsReady(function(){for(var e=Object.keys(n),t=0,r=e.length;t<r;t++){var s=e[t],s=n[s];_._autoLogImmediateValue(s.fileId,s.rangeId,-1,s.context,s.val,s.exp,s.singleHit,s.evalOpts,s.logMarkerContext)}}))},_recordTrace:function(e,t,r){m.$_$trace&&m.$_$trace.sequence.length>this._maxTraceSteps||(m.$_$trace._stackDepth!==r&&(m.$_$trace._stackDepth=r),m.$_$trace.sequence.push([e,t,r]))},_currentStack:function(){try{throw new Error("stack trace")}catch(e){return e.stack}},_initializeCoverage:function(e,t){if(t){void 0===m.$_$coverage[e]&&(m.$_$coverage[e]=[]);var r=m.$_$coverage[e];if(r.length!==t){this.debugLog("Range mismatch (fileId: "+e+", calculated: "+r.length+", actual: "+t+")");for(var s=r.length;s<t;s++)r[s]={}}}},_reportProgramScope:function(e,t){var r=this;this._shouldReportProgramScope&&this._doWhenReceiverIsReady(function(){r._sendWithHighPriority(e,t)})},_looksLikePromise:function(e){return e&&e.constructor&&"Promise"===e.constructor.name&&"function"==typeof e.then&&"function"==typeof e.catch&&(m.Promise||{}).prototype!==e},_looksLikeObservable:function(e){return e&&e.constructor&&e.constructor.name&&"string"==typeof e.constructor.name&&~e.constructor.name.indexOf("Observable")&&"function"==typeof e.forEach},_looksLikeBuffer:function(e){return e&&e.constructor&&"Buffer"===e.constructor.name&&"function"==typeof e.toString&&(m.Buffer||{}).prototype!==e},_autoLogValue:function(t,r,s,i,e,n,o,a,l,c){var u=this,p=m.$_$session;this._loggingValue=!0,u._looksLikePromise(e)?(this._loggingValue=!1,e.then(function(e){m.$_$session===p&&u._autoLogResolvedValue(t,r,s,i,"then ",u._valueToFormat(e,n),o,a,l,c)}).catch(function(e){m.$_$session===p&&u._autoLogResolvedValue(t,r,s,i,"catch ",(e||"<No Reason Provided>").toString(),o,a,l,c)})):u._looksLikeObservable(e)?(this._loggingValue=!1,e.forEach(function(e){m.$_$session===p&&u._autoLogResolvedValue(t,r,s,i,"",u._valueToFormat(e,n),o,a,l,c)})):u._autoLogImmediateValue(t,r,s,i,e,n,o,a,l,c),this._loggingValue=!1},_createProxy:function(o,a){a=a||{path:[]};var i,e=o.val,l=this;if(!l._loggingValue)return l._proxyCache||(l._proxyCache=new m.WeakMap),i=function(e,t,r){var s,i,n;if(!l._loggingValue)return t=(t||"").toString(),!(n="function"==typeof e)&&"object"!=typeof e||"get"!==r||(s=l._proxyCache.get(e))||((i={}).path=a.path.slice(),t&&i.path.push(t),s=l._createProxy({fileId:o.fileId,rangeId:o.rangeId,hitCount:o.hitCount,context:o.context,val:e,exp:o.exp,singleHit:o.singleHit,evalOpts:o.evalOpts,logMarkerContext:o.logMarkerContext},i),l._proxyCache.set(e,s)),n||((i={}).path=a.path.slice().concat(t?[t]:[]),i.trap=r,n=l._expressionId(o.fileId,o.rangeId,o.hitCount),i.hitCount=l._consoleProxyHits[n]||0,l._autoLogValue(o.fileId,o.rangeId,o.hitCount,o.context,e,o.exp,o.singleHit,o.evalOpts,o.logMarkerContext,i),l._consoleProxyHits[n]=i.hitCount+1),s},new m.Proxy(e,{get:function(e,t,r){e=Reflect.get(e,t,r);return i(e,t,"get")||e},set:function(e,t,r,s){return i(r,t,"set"),Reflect.set(e,t,r,s)},apply:function(e,t,r){e=Reflect.apply(e,t,r);return i(e,void 0,"call"),e},deleteProperty:function(e,t){return i(Reflect.get(e,t,e),t,"delete"),Reflect.deleteProperty(e,t)}})},_valueToFormat:function(e,t){return"$_$ne"===t?e:t(e)},_autoLogImmediateValue:function(e,t,r,s,i,n,o,a,l,c){this._isBigInt(i)&&(i=i.toString()+"n"),this._autoLogResolvedValue(e,t,r,s,"",this._valueToFormat(this._looksLikeBuffer(i)?i.toString():i,n),o,a,l,c)},_autoLogResolvedValue:function(e,t,r,s,i,n,o,a,l,c){l&&(u=l.changeId,p=l.traceId,d=l.traceStep,h=l.permanent),this._loggingValue=!0,this._formattingOpts={maxElementsPerLevel:o?10:100,resolveGetters:m.$_$resolveGetters||1&a||this._autoExpandAllLogs};var u,p,d,h,g,l=e+","+t,l=(!i&&2&a&&(i="⚑ "),r<this._evaluatedExpressionPerRangeLimit?c&&c.hitCount===this._evaluatedProxyExpressionPerRangeLimit?g=this._evaluateExpressions(this._expressionId(e,l,r,c),n,s,new Error("Only the first "+c.hitCount+" values are evaluated"),a,p,!!c):(!c||c.hitCount<this._evaluatedProxyExpressionPerRangeLimit)&&(g=this._evaluateExpressions(this._expressionId(e,l,r,c),n,s,void 0,a,p,!!c)):r===this._evaluatedExpressionPerRangeLimit&&(g=this._evaluateExpressions(this._expressionId(e,l,r,c),n,s,new Error("Only the first "+r+" values are evaluated"),a,p,!!c)),(p||u||h)&&(g=g||{},h)&&(g.permanent=h),(p||u)&&(p&&(g.traceId=p),u&&(g.changeId=u),g.traceStep=d),c&&g&&g.data&&(g.data.proxyData=c),o&&(this._formattingOpts.depth=this._formattingOpts.depth||2),this._format(n));l.content=l.content||"",i&&(l.content=i+(l.content||""),l.format="raw"),this._sendLog("autoLog",l,s,e,t,g),this._formattingOpts={},this._loggingValue=!1},_evaluateExpressions:function(e,t,r,s,i,n,o){var a=this._expressionsToEvaluate&&this._expressionsToEvaluate[e],l={expressionsToEvaluate:a},a=(a||(l.depth=0),o&&(l.proxyValue=!0),1&i||this._autoExpandAllLogs),o=(a&&(l.autoExpand=!0,l.depth=1,l.strLength=m.$_$logLimits.values.autoExpand.stringLength),this._evaluate(t,r,l,e,s,n));return(o.data||{}).id=e,(o.data||{}).autoExpand=!!a,o},_maybeHtml:function(e){return e=e.trim().slice(0,500),g.test(e)||f.test(e)}},m.$_$doNotInit?m.$_$Tracer=v:((_=new v).setGlobalErrorHandler(),d=function(e,t){return t-e},m.performance?_._time=function(){return m.performance.now()}:m.process&&m.process.hrtime?(_._time=function(){return m.process.hrtime()},d=function(e,t){return 1e3*(t[0]-e[0])+(t[1]-e[1])/1e6}):_._time=function(){return+new Date},_._logTime=function(t,r,s,i,n,o,e,a,l){var c,u,p=this;return p._looksLikePromise(e)?(c=m.$_$session,e.then(function(e){m.$_$session===c&&p._logTime(t,r,s,i,n,o,e,p._time(),l)}).catch(function(e){m.$_$session===c&&p._logTime(t,r,s,i,n,o,e,p._time(),l)})):(a=d(o,a),(u=_._autoTimeHits[s])?(u.value&&(u.n=1,u.min=u.value,u.max=u.value,u.total=u.value,delete u.value),u.min=Math.min(u.min,a),u.max=Math.max(u.max,a),u.total+=a,u.n+=1):_._autoTimeHits[s]={value:a,context:n,fileId:t,rangeId:r,logMarkerContext:l}),e},_.$_$w=_.$_$w_=m.$_$w=m.$_$w_=function(e,t){_.statement(e,t)},m.$_$wp=function(e,t){return _._initializeCoverage(e,t),_._reportProgramScope("programScopeStart",e),_.scopeStart(e),_._executionContext()},m.$_$wpe=function(e){_._reportProgramScope("programScopeEnd",e)},_.$_$wf=m.$_$wf=function(e){_.scopeStart(e)},_.$_$wv=m.$_$wv=function(e,t,r,s,i,n,o,a,l,c){var u,p,d,h,g,f=_._consoleHits[r]||0;return a?_._identifierExpressionAutoLogHitLimit?f<_._identifierExpressionAutoLogHitLimit?_._doWhenReceiverIsReady(function(){_._autoLogValue(e,t,f,i,n,o,a,l,c)},arguments):f===_._identifierExpressionAutoLogHitLimit&&_._doWhenReceiverIsReady(function(){_._sendLog("log",{content:"Only the first "+_._identifierExpressionAutoLogHitLimit+" values are automatically logged, use console.log("+(i||"...")+") for the full output",format:"raw"},i,e,t)},arguments):f||_._doWhenReceiverIsReady(function(){_._autoLogValue(e,t,f,i,n,o,a,l,c)},arguments):!_._logLimit||f<_._logLimit?_._doWhenReceiverIsReady(function(){_._autoLogValue(e,t,f,i,n,o,a,l,c)},arguments):f===_._logLimit&&(u=c&&c.changeId,p=c&&c.traceId,d=c&&c.traceStep,h=c&&c.permanent,(p||u||h)&&(g={},h&&(g.permanent=h),p&&(g.traceId=p),u&&(g.changeId=u),p||u)&&(g.traceStep=d),_._doWhenReceiverIsReady(function(){_._sendLog("log",{content:"Only the first "+_._logLimit+" values are automatically logged. Increase this limit with the `logLimit` setting.",format:"raw"},i,e,t,g)},arguments)),_._consoleHits[r]=f+1,!(2&l&&"object"==typeof n&&m.Proxy&&m.WeakMap)||c&&c.traceId?n:_._createProxy({fileId:e,rangeId:t,hitCount:f,context:i,val:n,exp:o,singleHit:a,evalOpts:l,logMarkerContext:c})},m.$_$tracer=_,m.$_$coverage=m.$_$coverage||[],m.$_$reuseableTracer||(m.$_$tracer._expressionsToEvaluate=m.$_$expressionsToEvaluate||{}),l=function(e){return e.path},a=m.$_$testFiles&&(m.$_$testFiles||[]).map(l).map(function(e){return e&&e.replace(/\\/g,"/")}),l=m.$_$testFiles&&m.$_$testFiles.filter(function(e){return e.loaded}).map(l),_.initLoadingPhase(),m.wallaby={delayStart:function(){_._patchFrameworks(),_._delayStart=!0},start:function(){_._delayStart=!1,_.start()},_startWhenReceiverIsReady:function(e){_._shouldReportProgramScope=!0,_._doWhenReceiverIsReady(function(){e()})},tests:a,loadedTests:l,baseDir:m.$_$baseDir,slowTestThreshold:m.$_$slow||75})},{}],70:[function(e,t,r){"use strict";const n=e("path"),o=e("uuid"),i=e("https"),a={Atom:"AT",VSCode:"VSC",Sublime:"ST",IntelliJ:"IJ",VS:"VS"};t.exports=class{constructor(s,e){if(s&&_.isString(e)){this._edition=s.edition,this._version=s.coreVersion||"unknown";var i=s.client&&a[s.client];this._client=i||(~e.indexOf("wallaby-vscode")?"VSC":~e.indexOf(".wallaby")?"VS":~e.indexOf("atom-wallaby")?"AT":~e.indexOf("Sublime")?"ST":"IJ");let t=s.cidFile;t=t||("VS"===this._client?n.join(e,"..","..","t.id"):"VSC"===this._client?n.join(e,"..","..","..",".wtid"):n.join(e,"..","t.id"));let r;try{r=s.readFileSync(t)}catch(e){r=o.v4();try{s.writeFileSync(t,r)}catch(e){}}this._cid=r||o.v4(),this._sid=o.v4(),this._sendHeartbeat=!0,this._featureUseTelemetry=void 0}}start(e){try{this._env=`${"browser"===e.env.type?e.env.kind:e.env.type} `+e.testFramework.version.substr(0,e.testFramework.version.indexOf("@"))+(e.testFramework.autoDetected?".auto":"")}catch(e){this._env="unknown"}this._kind=e.env.kind,this._type=e.env.type,this._auto=e.testFramework.autoDetected,this._framework=e.testFramework.version;let t=this;this._heartbeatInterval=setInterval(()=>t._heartbeat(),3e5),this._started=!0,t._heartbeat()}dispose(){clearInterval(this._heartbeatInterval),clearTimeout(this._sendPendingFeatureUseTelemetryTimeout)}busy(){this._sendHeartbeat=!0}featureUsed(e,t){switch(e){case"vscode.liveShare.available":case"vscode.liveShare.started":return}e.startsWith("vscode.")&&(e=e.slice("vscode.".length));var r=void 0===this._featureUseTelemetry;this._featureUseTelemetry||(this._featureUseTelemetry={}),this._featureUseTelemetry[e]=t||{},r&&(this._sendPendingFeatureUseTelemetryTimeout=setTimeout(()=>this._sendPendingFeatureUseTelemetry(),1e4))}mode(e){this._mode=e}_sendPendingFeatureUseTelemetry(){if(this._started&&this._featureUseTelemetry){const t=this._featureUseTelemetry;this._featureUseTelemetry=null,Object.keys(t).forEach(e=>{this._send(this._build(e,t[e]))})}}_heartbeat(){this._sendHeartbeat&&(this._send(this._build("heartbeat")),this._sendPendingFeatureUseTelemetry()),delete this._sendHeartbeat}_build(e,t){try{var r={name:e.replace(/\./g,"_"),params:{}};return r.params=Object.assign(r.params,t),r.params.session_id=this._sid,r.params.name=e,r.params.editor=this._client,r.params.version=this._version,r.params.env=this._env,this._mode&&(r.params.mode=this._mode),this._edition&&(r.params.edition=this._edition),process.env.quokka||(this._kind&&(r.params.kind=this._kind),r.params.type=this._type,r.params.framework=this._framework,r.params.auto=this._auto),r}catch(e){}}_send(e){if(e)try{var t=JSON.stringify({client_id:this._cid,events:[e]}),r={hostname:"www.google-analytics.com",path:`/mp/collect?measurement_id=${process.env.quokka?"G-08B1NWS1SF":"G-0HETDVEV9W"}&api_secret=`+(process.env.quokka?"H4qI9zDATbyt9zwEvgYNjg":"5o2jcERDQQel559K7G-3kw"),method:"POST",headers:{"Content-Type":"application/json","Content-Length":t.length}},s=i.request(r,function(e){e.on("data",_.noop),e.on("end",_.noop)});s.on("error",_.noop),s.write(t),s.end()}catch(e){}}}},{https:void 0,path:void 0,uuid:void 0}],71:[function(s,e,t){"use strict";var i,r=s("./typeScriptVisitor"),n=s("./utils").default,o=s("./typeScriptUtils"),a=s("semver");class l{constructor(e,t){this._useTsconfigFile=!0,this._opts=o.createOptions(i,e||{},this),this._useTsconfigFile&&(this._opts=o.mergeTsConfigOptions(i,this._opts,t)),this._opts.isolatedModules=!0,this._opts.suppressOutputPathCheck=!0,this._opts.allowNonTsExtensions=!0,this._opts.noLib=!0,this._opts.lib=void 0,this._opts.types=void 0,this._opts.noEmit=void 0,this._opts.noEmitOnError=void 0,this._opts.paths=void 0,this._opts.rootDirs=void 0,this._opts.declaration=void 0,this._opts.declarationDir=void 0,this._opts.out=void 0,this._opts.outFile=void 0,this._opts.noResolve=!0,this._visitor=new r(i)}run(e){this._code="",this._ranges=[];var t=this._opts,r=e.path,s=i.createSourceFile(r,e.content,t.target),s=(this._ranges=this._visitor.visit(s),i.transpileModule(e.content,{fileName:r,compilerOptions:t,reportDiagnostics:!0})),t=(this._code=s.outputText,s&&s.diagnostics);if(t&&t.length)throw new Error(_.reduce(t,(e,t)=>{t=o.formatErrorText(i,t);return e[t]||(e[t]=t,e.message+="\n  - "+t),e},{message:"TypeScript compiler errors:"}).message);if(s.emitSkipped)return e.content;t=s.sourceMapText&&JSON.parse(s.sourceMapText);if(t)return this._noRename||e.changeExt("js"),{map:t,code:this._code,ranges:this._ranges};throw new Error("Cannot find source map for "+r)}}e.exports=r=>e=>{if(e.typescript)i=e.typescript;else try{i=n.requireModuleFrom(r,"typescript")}catch(e){i=s("typescript")}if(a.valid(i.version)&&a.lt(i.version,"2.1.5"))throw new Error("TypeScript version for compiler must be >= 2.1.5");delete e.typescript;var t=new l(e,r);return e=>t.run(e)}},{"./typeScriptUtils":73,"./typeScriptVisitor":74,"./utils":75,semver:void 0,typescript:void 0}],72:[function(r,e,t){"use strict";var c,u=r("path"),l=r("graceful-fs"),o=r("micromatch").isMatch,s=r("semver"),i=r("./utils").default,p=r("./typeScriptUtils"),d=r("./typeScriptVisitor");class n{constructor(e,t){var r=this;e=e||{},this._filePatterns=[],this._localProjectDir=t,this._useTsconfigFile=!0,e.files?(this._opts=!1,_.each(e.files,(e,t)=>{r._filePatterns.push(t);t=p.createOptions(c,e=e||{},this);r._opts||(r._opts=t)})):(this._filePatterns.push("**/*.ts?(x)"),this._filePatterns.push("**/*.cts"),this._filePatterns.push("**/*.mts"),this._opts=p.createOptions(c,e,this)),this._allTrackedFiles={},this._allFiles={},this._ts=1}createPostprocessor(){var l=this,e=n=>{var o=n.logger,e=(l._ts++,l._filesToBeCompiled(n.affectedFiles,void 0,n.dot));if(!l._compiler||n.anyFilesAdded||n.anyFilesDeleted)if(l._compiler?n.tsPostprocessorOnly||o.debug("TypeScript language service is being re-created because some tracked files were added or deleted"):o.debug("New TypeScript language service is required"),l._allTrackedFiles=l._filesToBeCompiled(n.allFiles,e=>l._allFiles[e.fullPath]=e,n.dot),l._compiler&&n.tsPostprocessorOnly)n.anyFilesDeleted&&(n.affectedFiles||[]).length===(n.allFiles||[]).length&&(e={});else{if(e=l._allTrackedFiles,_.isEmpty(e))return o.debug("TypeScript postprocessor will be removed because in %s project files none were found by patterns: %s",n.allFiles.length,l._filePatterns),Q.when({removePostprocessor:!0});o.trace("TypeScript compiler options module (before tsconfig.json): %s",(l._opts||{}).module),l._useTsconfigFile&&(l._opts=p.mergeTsConfigOptions(c,l._opts,l._localProjectDir,o),o.trace("TypeScript compiler options module (after tsconfig.json): %s",(l._opts||{}).module)),l._compiler=l._createLanguageService(n.baseDir),l._visitor||(l._visitor=new d(c))}else _.each(e,e=>{var t=l._allTrackedFiles[e.fullPath];t&&(t.ts=e.ts)});var a=[];return _.each(e,e=>{l._orderFilesByReferenceComments&&l._dependencies&&(t=l._dependencies.files[e.path])&&t.hash!==l._getFileDependencies(e).hash&&delete l._dependencies;var t=l._compiler.getEmitOutput(e.fullPath),r=l._compiler.getSyntacticDiagnostics(e.fullPath);if(t.emitSkipped){var s=r.concat(l._compiler.getSemanticDiagnostics(e.fullPath));if(this._logErrors(o,s),l._opts.noEmitOnError)throw new Error(_.reduce(s.concat(l._compiler.getCompilerOptionsDiagnostics()),(e,t)=>{t=p.formatErrorText(c,t);return e[t]||(e[t]=t,e.message+="\n  - "+t),e},{message:"TypeScript compiler errors:"}).message)}else r&&r.length&&this._logErrors(o,r);var s=l._visitor.visit((l._compiler.getSourceFile?l._compiler:l._compiler.getProgram()).getSourceFile(e.fullPath)),i={};t.outputFiles.forEach(e=>{var t=u.extname(e.name);".map"===t?i.sourceMap=e.text:".js"===t||".jsx"===t||".cjs"===t||".mjs"===t?i.code=e.text:o.debug("Unexpected output file: %s",e.name)}),i.sourceMap&&a.push(n.createFile({path:_.isUndefined(l._opts.module)||l._opts.module?l._changeExtToJs(e.path):e.path+".compiled.js",original:e,content:i.code,sourceMap:JSON.parse(i.sourceMap),ranges:s,order:e.order,load:e.initialLoad}))}),l._orderFilesByReferenceComments&&!l._dependencies&&l._updateFileOrder(),Q.all(a)};return e.filePatterns=l._filePatterns,e.ts=!0,e}_logErrors(t,e){e.forEach(e=>{t.error(p.formatErrorText(c,e))})}_updateFileOrder(){var t=this,r=(t._dependencies={files:{},min:Number.POSITIVE_INFINITY},_.each(t._allTrackedFiles,e=>t._orderFilesByReferences(e,t._dependencies,{})),t._dependencies.min);_.each(t._dependencies.files,e=>{e.file.test||e.file.setOrder(r++,!0)})}_orderFilesByReferences(e,t,r){var s,i=this;r[e.path]||(r[e.path]=!0,t.files[e.path])||(e.test||(t.min=Math.min(t.min,e.order)),s=i._getFileDependencies(e),_.each(s.items,e=>i._orderFilesByReferences(e,t,r)),t.files[e.path])||(t.files[e.path]={hash:s.hash,file:e})}_getFileDependencies(t){var e,r=this,s="";try{e=c.preProcessFile(t.getContentSync()).referencedFiles}catch(e){throw new Error("Failed to get file dependencies: "+e.stack)}return{items:_(e).map(e=>r._allTrackedFiles[u.join(u.dirname(t.fullPath),e.fileName)]).filter(e=>!_.isUndefined(e)).map(e=>(s+=e.path,e)).value(),hash:i.quickHash(s)}}_changeExtToJs(e){return e.substr(0,e.lastIndexOf(".")+1)+(_.endsWith(e,".js")?"jsts":"js")}_createLanguageService(s){var i=this;if(!i._opts.noResolve){const a=c.resolveModuleName;c.resolveModuleName=function(e,t){var r=a.apply(this,arguments);if(r&&!r.resolvedModule){arguments[1]=t.replace(c.normalizePath&&c.normalizePath(s)||s,c.normalizePath&&c.normalizePath(i._localProjectDir)||i._localProjectDir);t=a.apply(this,arguments);if(t&&t.resolvedModule)return t}return r}}const n={},o={};return c.createLanguageService({getScriptFileNames:function(){return[...i._opts.typeRoots?i._opts.typeRoots.filter(e=>e.endsWith(".d.ts")):[],...Object.keys(i._allTrackedFiles)]},getScriptVersion:function(e){e=u.normalize(e);e=i._allTrackedFiles[e];return e&&e.ts.toString()},readFile:function(e){return(this.getScriptSnapshot(e)||{}).text},fileExists:function(e){var t,r,s;return e=u.normalize(e),!(i._opts.noResolve||!~e.indexOf(i._localProjectDir))&&(!1===(t=o[e])||t?t:(r=u.dirname(e),!1===(s=n[r])?o[e]=!1:(t=o[e]=l.existsSync(e))?n[r]=!0:s?void 0:(n[r]=l.existsSync(r),!1)))},getScriptSnapshot:function(e){e=u.normalize(e);var t=i._allFiles[e];if(t)return c.ScriptSnapshot.fromString(t.getContentSync());if(i._opts.noEmitOnError||!i._opts.noResolve)try{var r=e.replace(s,i._localProjectDir);if(l.existsSync(r))return c.ScriptSnapshot.fromString(l.readFileSync(r).toString())}catch(e){}},getCurrentDirectory:function(){return s},getCompilationSettings:function(){return i._opts},getDefaultLibFileName:function(e){return c.getDefaultLibFilePath(e)},getCustomTransformers:function(){return i._getCustomTransformers?i._getCustomTransformers(i._compiler.getProgram()):void 0},getProjectVersion:function(){return i._ts}},c.createDocumentRegistry())}_filesToBeCompiled(e,s,i){var n=this;return s=s||function(){},_.reduce(e,function(e,t){const r=0===(t.path||"").indexOf("..")?u.basename(t.path):t.path;return _.find(n._filePatterns,e=>o(r,e,{dot:i}))&&(e[t.fullPath]=t),s(t),e},{})}}e.exports=t=>e=>{if(e.typescript)c=e.typescript;else try{c=i.requireModuleFrom(t,"typescript")}catch(e){c=r("typescript")}if(s.valid(c.version)&&s.lt(c.version,"1.5.3"))throw new Error("TypeScript version for compiler must be >= 1.5.3");return delete e.typescript,new n(e,t).createPostprocessor()}},{"./typeScriptUtils":73,"./typeScriptVisitor":74,"./utils":75,"graceful-fs":void 0,micromatch:void 0,path:void 0,semver:void 0,typescript:void 0}],73:[function(n,e,t){var o=n("path"),a=n("graceful-fs");e.exports={createOptions(e,t,r){t&&(r._orderFilesByReferenceComments||(r._orderFilesByReferenceComments=t.orderFilesByReferenceComments),delete t.orderFilesByReferenceComments,r._useStandardDefaults||(r._useStandardDefaults=t.useStandardDefaults),delete t.useStandardDefaults,r._getCustomTransformers||(r._getCustomTransformers=t.getCustomTransformers),delete t.getCustomTransformers,r._useTsconfigFile&&(r._useTsconfigFile=!1!==t.tsconfig),delete t.tsconfig);var e=this._normaliseOptions(e,t)||{},t={noLib:!0,noResolve:!0,noEmit:!1,removeComments:!1},s={sourceMap:!0,inlineSourceMap:!1,inlineSources:!1,declarationMap:!1,rootDir:void 0,mapRoot:void 0,outFile:void 0,noEmitOnError:!1,composite:!1,declaration:!1};return r._useStandardDefaults&&(delete t.noLib,delete t.noResolve,delete s.declaration,delete s.noEmitOnError,delete s.composite),_.extend(t,e,s)},getCompilerOptions:function(e,t){return this._normaliseOptions(e,e.parseJsonConfigFileContent?e.parseJsonConfigFileContent(e.parseConfigFileTextToJson(t,a.readFileSync(t).toString()).config,e.sys,e.getDirectoryPath(e.normalizePath(t)),{},t).options:e.readConfigFile(t,function(e){return a.readFileSync(e).toString()}).config.compilerOptions)},mergeTsConfigOptions(e,t,r,s={debug:()=>{}}){var i,r=o.join(r,"tsconfig.json");try{i=e.parseJsonConfigFileContent?e.parseJsonConfigFileContent(e.parseConfigFileTextToJson(r,a.readFileSync(r).toString()).config,_.extend(e.createCompilerHost(e.getDefaultCompilerOptions()),{readDirectory:e.sys.readDirectory}),e.getDirectoryPath(e.normalizePath(r)),{},r).options:e.readConfigFile(r,function(e){return a.readFileSync(e).toString()}).config.compilerOptions}catch(e){s.debug("Error parsing tsconfig file "+r+"\n("+e.message+")");try{i=n(r).compilerOptions}catch(e){s.debug("Error reading tsconfig file from "+r+"\n("+e.message+")")}}return(s=i?(i.allowJs&&!t.outDir&&delete t.outDir,_.extend({},this._normaliseOptions(e,i)||{},t)):t).allowJs||delete s.outDir,s},formatErrorText(e,t){var r,e=e.flattenDiagnosticMessageText(t.messageText,"\n");return t.file?(r=t.file.getLineAndCharacterOfPosition(t.start),`Error ${t.file.fileName} (${r.line+1},${r.character+1}): `+e):"Error: "+e},_normaliseOptions(e,s){var i=this;if(s)return this._optionDeclarations||(this._optionDeclarations=_.reduce(e.optionDeclarations,(e,t)=>(e[t.name]=t,e),{})),_.each(s,(e,t)=>{var r=i._optionDeclarations[t];r&&(_.isObject(r.type)&&_.isString(e)?s[t]=i._getNormalisedValue(e,r.type):"list"===r.type&&_.isArray(e)&&r.element&&_.isObject(r.element.type)&&(s[t]=_.map(e,e=>_.isString(e)&&i._getNormalisedValue(e,r.element.type)||e)))}),s},_getNormalisedValue(e,t){return _.isFunction(t.get)?t.get(e.toLowerCase()):t[e.toLowerCase()]}}},{"graceful-fs":void 0,path:void 0}],74:[function(e,t,r){"use strict";t.exports=class{constructor(r,e=0){var s=this,i={};this._ts=r,i[r.SyntaxKind.DoStatement]=i[r.SyntaxKind.WhileStatement]=i[r.SyntaxKind.IfStatement]=i[r.SyntaxKind.SwitchStatement]=function(e){e.expression&&s._pushRange(e.expression)},i[r.SyntaxKind.ForStatement]=function(e){e.condition&&s._pushRange(e.condition)},i[r.SyntaxKind.ForInStatement]=i[r.SyntaxKind.ForOfStatement]=function(e){e.expression&&s._pushRange(e.expression)},i[r.SyntaxKind.BreakStatement]=i[r.SyntaxKind.ContinueStatement]=i[r.SyntaxKind.ThrowStatement]=function(e){s._pushRange(e)},i[r.SyntaxKind.VariableStatement]=function(e){s._parent&&(s._parent.kind===r.SyntaxKind.ForStatement||s._parent.kind===r.SyntaxKind.ForInStatement||s._parent.kind===r.SyntaxKind.ExportAssignment)||s._pushRange(e)},i[r.SyntaxKind.ExpressionStatement]=i[r.SyntaxKind.ReturnStatement]=function(e){s._pushRange(e)},process.env.quokka&&(i[r.SyntaxKind.ImportDeclaration]=function(e){s._pushRange(e)}),i[r.SyntaxKind.ConditionalExpression]=function(e){s._pushRange(e.whenTrue),s._pushRange(e.whenFalse)},i[r.SyntaxKind.BinaryExpression]=function(e){s._pushRange(e.left),s._pushRange(e.right)},i[r.SyntaxKind.ArrowFunction]=function(e){e.body.statements||s._pushRange(e.body)},s._visit=function(e){var t=i[e.kind];t&&t(e),s._parent=e,r.forEachChild(e,s._visit)}}visit(e){return this._ranges=[],this._parent=null,this._sourceFile=e,this._visit(e),this._parent=null,this._sourceFile=null,this._ranges.slice()}_pushRange(e){this._ranges.push(this._getRange(e))}_getRange(e){var t=this._ts.getLineAndCharacterOfPosition(this._sourceFile,e.getStart(this._sourceFile)),e=this._ts.getLineAndCharacterOfPosition(this._sourceFile,e.getEnd());return[t.line+1,t.character,e.line+1,e.character]}}},{}],75:[function(h,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const g=h("path"),a=h("fs");const r=h("./extension/shared/utils").default["normalizePath"],s=h("module")["Module"],o=h("source-map").SourceMapConsumer,n=h("source-map").SourceMapGenerator,i=/^\s*(\/\*\*?(.|\r?\n)*?\*\/)/,l=/^\s*/,c=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-PRZcf-nqry=><]/g,p=/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,d=/(^[\s]*?(fit|fdescribe)[\s]*?|[^.\w\s][\s]*?(fit|fdescribe)[\s]*?|(test|test\.concurrent|it|describe)[\s]*?\.[\s]*?only[\s]*?)((\.each[\s]*?(`[^`]*?`[\s]*?)*?)?\([\s]*?[^)\s])/gm;var u=/[#@] sourceMappingURL=([^\s'"]*)/;const f=RegExp("(?:/\\*(?:\\s*\r?\n(?://)?)?(?:"+u.source+")\\s*\\*/|//(?:"+u.source+"))\\s*","g"),m=/data:application\/json[^,]+base64,/;let v=void 0;function y(){if(void 0===v){let t;try{a.statSync("/.dockerenv"),t=!0}catch(e){t=!1}let r;try{r=a.readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch(e){r=!1}v=t||r}return v}const b=(t,e)=>"js"===t||"jsx"===t||"es6"===t||"es7"===t||"mjs"===t||"cjs"===t||e&&e.find(e=>t===e),w=e=>"ts"===e||"tsx"===e||"cts"===e||"mts"===e,k=e=>"vue"===e,x=e=>"svelte"===e,S=(e,t)=>"coffee"===e||/\.(litcoffee|coffee\.md)$/.test(t||""),P={},F={},C=("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split("").forEach(function(e,t){P[e]=t,F[t]=e}),"_$_$w_id"),T="Expected to find some snaps in the file, but no snaps were found.",j="Expected to find some snaps with code in the file, but only empty snaps were found.",E="Found some snaps with code in the file, but not allowed to run them.";t.default={wallabyRandomIdCommentPostfix:C,randomIdLength:5,selectedTestRegExp:d,snapsNotFoundError:T,snapsAreEmptyError:j,snapsFoundButNoAutoRunError:E,SourceMapConsumer:o,wallabyRandomIdCommentPrefix(e){return".coffee"===g.extname(e)?"\n#":"\n//"},isSnapsNotFoundError(e){return e&&e.message&&e.message.endsWith(T)},isSnapsAreEmptyError(e){return e&&e.message&&e.message.endsWith(j)},isSnapsFoundButNoAutoRunError(e){return e&&e.message&&e.message.endsWith(E)},requireResolve:function(e,t){return s._resolveFilename(e,null,!1,t)},randomId:function(){return Math.random().toString(36).substr(2,5)},addWallabyRandomIdCommentToFileContent:function(e,t,r){return t+this.wallabyRandomIdCommentPrefix(e)+(r||this.randomId())+C},removeWallabyRandomIdCommentFromFileContent:function(e,t){return _.endsWith(t,C)?t.slice(0,-(this.wallabyRandomIdCommentPrefix(e).length+5+C.length)):t},addOrReplaceWallabyRandomIdComment(e,t){return this.addWallabyRandomIdCommentToFileContent(e,this.removeWallabyRandomIdCommentFromFileContent(e,t))},noopTrue:function(){return!0},noopTruePromise:function(){return Q.fcall(this.noopTrue)},isPatch:function(e){return e&&2<e.length&&"@"===e[0]&&"@"===e[1]},isLevelUpRelativePath:function(e){return!!e&&"."===e[0]&&"."===e[1]},docBlockComment:function(e){e=e.match(i);return e&&e[0].replace(l,"")||""},normalizePath:function(e){return e&&e.replace("win32"===process.platform?"file:///":"file://","").split(g.sep).join("/")},fileUrl:function(e){e=g.resolve(e).replace(/\\/g,"/");return"/"!==e[0]&&(e="/"+e),encodeURI("file://"+e)},trimSlashes(e){return e&&e.replace(/^\/|\/$/g,"")},platformDependentPath:function(e){return!e||"win32"!==process.platform||~e.indexOf(g.sep)?e:e.split("/").join(g.sep)},getSourceMapFromCode:function(e){for(f.lastIndex=0;null!==(t=f.exec(e));){var t=t?t[1]||t[2]||"":null;if(t)if(m.test(t))return t=t.slice(t.indexOf(",")+1),Buffer.from(t,"base64").toString()}},makeRe:function(e,t){return"string"==typeof e?h("micromatch").makeRe(e,t,!1,!0):e},pathMatchesPattern:function(e,t,r){if(e)return"string"==typeof t?(0,h("micromatch").isMatch)(e,t,r):(e=this.platformDependentPath(r&&r.absolute?"":"./")+this.platformDependentPath(e)).match(t)},escapePathForRegex:function(e){return"\\"===g.sep&&(e=e.replace(/\\/g,"/")),this.replacePathSepForRegex(this.escapeRegExp(e))},escapeRegExp:function(e){return e.replace(/[[\]{}()*+?.\\^$|]/g,"\\$&")},replacePathSepForRegex:function(e){return"\\"===g.sep?e.replace(/(\/|(.)?\\(?![[\]{}()*+?.^$|\\]))/g,(e,t,r)=>r&&"\\"!==r?r+"\\\\":"\\\\"):e},displayTestName:function(e){return e.replace(/\r?\n|\r/g," ").replace(/\s\s+/g," ")},getOriginalLineByGeneratedLine(e,t,r){var s=e[t];if(s){if(0<(s=this._decodeMapping(s)))return s;r&&(r-=1);for(let e=0;e<s.length;e++){if(s[e].column===r)return s[e].line;if(r<s[e].column)return(0===e?s[0]:s[e-1]).line}return s[s.length-1].line}},_decodeMapping(t){if(_.isUndefined(t)||_.isObject(t))return t;if(_.isNumber(t))return t;var r=[];let s=0,i=0,n;for(let e=0;e<t.length;e+=1){var o=P[t[e]],a=32&o;o&=31,i+=o<<s,a?s+=5:(o=1&i,i>>>=1,a=o?0===i?-2147483648:-i:i,n=0<=n?void r.push({line:n,column:a}):a,i=s=0)}return r},_encodeMapping(e,t,r){e=e[t];if(!_.isObject(e))return e;const s=Object.values(e);if(r&&1===s.length&&0===s[0].originalColumn&&0===s[0].generatedColumn&&r[t])return r[t];if(1!==s.length&&s.find(e=>e.originalLine!==s[0].originalLine)){s.sort((e,t)=>e.generatedColumn-t.generatedColumn);let t="",r=(t=(t+=this._encodeInteger(s[0].originalLine))+this._encodeInteger(s[0].generatedColumn),0);for(let e=1;e<s.length;e++)if(s[e].originalLine!==s[e-1].originalLine){if(2e3<++r)return s[0].originalLine;t=(t+=this._encodeInteger(s[e].originalLine))+this._encodeInteger(s[e].generatedColumn)}return t}return s[0].originalLine},_encodeInteger(t){let r="";t<0?t=-t<<1|1:t<<=1;do{let e=31&t;0<(t>>>=5)&&(e|=32),r+=F[e]}while(0<t);return r},generateLineMappings:function(t,r){const s={};return Object.keys(t).forEach(e=>{s[e]=this._encodeMapping(t,e,r)}),s},_previousLineMapNextGreaterThanOrEqualTo(e,t){let r=0,s=e.length-1,i=-1;for(;r<=s;){var n=parseInt((r+s)/2,10);e[n].column<t?r=n+1:(i=n,s=n-1)}return i=-1===(i=0===i?1:i)?e.length:i},_previousLineMapNextGreaterThan(e,t){let r=0,s=e.length-1,i=-1;for(;r<=s;){var n=parseInt((r+s)/2,10);e[n].column<=t?r=n+1:(i=n,s=n-1)}return i=-1===(i=0===i?1:i)?e.length:i},updateFileMap:function(t,e){var n=_.extend({},t);return _.each(e,e=>{var e=new o(e),s={},i=_.isEmpty(n);e.eachMapping(e=>{var t,r;e.originalLine&&e.generatedLine&&(i?(s[e.generatedLine]||(s[e.generatedLine]={}),s[e.generatedLine][e.generatedColumn]&&!e.name||(s[e.generatedLine][e.generatedColumn]=Object.assign({},e))):!n[e.originalLine]||s[e.generatedLine]&&s[e.generatedLine][e.generatedColumn]&&!e.name||(t=n[e.originalLine]=this._decodeMapping(n[e.originalLine]))&&(0<t?(s[e.generatedLine]||(s[e.generatedLine]={}),s[e.generatedLine][e.generatedColumn]=Object.assign(Object.assign({},e),{originalLine:t,originalColumn:0})):(r=this._previousLineMapNextGreaterThan(t,e.originalColumn),s[e.generatedLine]||(s[e.generatedLine]={}),s[e.generatedLine][e.generatedColumn]=Object.assign(Object.assign({},e),{originalLine:t[r-1].line,originalColumn:t[r-1].column}))))}),n=this.generateLineMappings(s,t)}),n},formatInstrumentationError:function(e,t,r){e=(e&&(e.stack||e.message))+"";let s=this.textLines(e);var e=s[0],i=e.match(/^SyntaxError.*\((\d+):(\d+)\)$/);return i&&(s=[this.codeFrame(t,parseInt(i[1],10),parseInt(i[2],10)+1,e)]),Error("Failed to instrument "+r+"\n"+s.join("\n"))},combineSourceMaps:function(e,t){var r,s,i;return e?t?(r=new o(t),s=new o(e),i=new n,r.eachMapping(e=>{var t;null!=e.originalLine&&null!=(t=s.originalPositionFor({line:e.originalLine,column:e.originalColumn})).source&&i.addMapping({original:{line:t.line,column:t.column},generated:{line:e.generatedLine,column:e.generatedColumn},source:t.source,name:t.name||e.name})}),[s,r].forEach(r=>{r.sources.forEach(e=>{i._sources.add(e);var t=r.sourceContentFor(e);null!=t&&i.setSourceContent(e,t)})}),i._sourceRoot=e.sourceRoot,i._file=e.file,JSON.parse(i.toString())):e:t},mapTextPosition:function(e,t){let r;var s;return r=e?t?((s={line:e.line,column:e.column}).source=t.sources&&t.sources[0]||".",s.bias=2,t.generatedPositionFor(s)):e:r},textIndexPosition:function(e,t,r){e=this.textLines(e,t,r);return{line:e.length,column:e[e.length-1].length}},mapTransformedRangeToOriginal:function(e,t){var r,s,i,t={start:{line:t[0],column:t[1]},end:{line:t[2],column:t[3]}},n=(n=e,s=t.start.line,r=t.start.column,null===(i=n.originalPositionFor({line:s,column:r,bias:1})).source?n.originalPositionFor({line:s,column:r,bias:2}):i);s=t.end;let o=null===(s=(r=e).originalPositionFor({line:s.line,column:s.column-1})).source?null:null===(i=r.generatedPositionFor({source:s.source,line:s.line,column:s.column+1,bias:2})).line||r.originalPositionFor(i).line!==s.line?{source:s.source,line:s.line,column:1/0}:r.originalPositionFor(i);return!(n&&o&&n.source&&o.source&&n.source===o.source&&null!==n.line&&null!==n.column&&null!==o.line&&null!==o.column)?null:(n.line===o.line&&n.column===o.column&&((o=e.originalPositionFor({line:t.end.line,column:t.end.column,bias:2})).column=o.column-1),[n.line,n.column,o.line,o.column])},mapOriginalRangeToTransformed:function(e,[t,r,s,i]){if(!e)return[t,r,s,i];t={line:t,column:r},t.source=e.sources&&e.sources[0]||".",r=e.generatedPositionFor(t),t={line:s,column:i},t.source=e.sources&&e.sources[0]||".",t.bias=2,s=e.generatedPositionFor(t);if(r&&s&&null!==r.line&&null!==r.column){if(null===s.line||null===s.column){if(null===r.line||null===r.column)return;s.source=r.source,s.line=r.line,s.column=1/0}return s.line<r.line&&(s.line=r.line),r.line===s.line&&s.column<r.column&&(s.column=1/0),null===r.column&&(r.column=0),null===s.column&&(s.column=0),[r.line,r.column,s.line,s.column]}},mapSnapRanges:function(c,e,t){const d=this.textLines(t),h=(e,t)=>{e=d[e-1];if(e)return e[t]},n=(e,t,r)=>h(e,t)===r,u=(e,t,r,s,i=0)=>{for(;-1<e[r];){if(n(e[t],e[r]-i,s))return e;--e[r]}},p=(e,t,r)=>{let s=!(e=[...e]),i=!1;for(;0<e[0];){for(;0<=e[1];){if(h(e[0],e[1])===t){if(s){i=!0;break}s=!0}e[1]--}if(i)break;var n;e[0]--,0<e[0]&&(n=d[e[0]-1],e[1]=n?n.length-1:0)}let o=!1,a=!1;for(;e[2]<d.length;){for(var l=d[e[2]-1];l&&e[3]<=l.length;){if(h(e[2],e[3])===r){if(o){a=!0;break}o=!0}e[3]++}if(a)break;e[2]++,e[3]=0}if(i&&a)return e[3]+=1,e},g=(e,t,r,s,i)=>{let n=e[2],o=e[3],a=!1;for(;n<d.length;){const c=d[n-1];for(;c&&o<=c.length;){if(h(n,o)===t){a=!0;break}o++}if(a)break;n++,o=0}var e=i||(s?this.textLines(s,void 0,"\n").length:1),l=n+(e-1);const c=d[l-1];let u=c&&c.length?c.length-1:0,p=!1;for(;0<=u;){if(h(l,u)===r){p=!0;break}u--}if(a&&p)return[n,o,l,u+1]},s=(e,t,r,s,i,n)=>{var o=r===s;let a=this.mapTransformedRangeToOriginal(c,e),l=!1;if(a||(e[3]+=1,(a=this.mapTransformedRangeToOriginal(c,e))?(null===a[2]&&(a[2]=a[0],l=!0),a[3]<0&&(a[3]=a[1],l=!0)):t&&(o?a=g(t,r,s,i,n):(n=this.mapTransformedRangeToOriginal(c,t))&&(n[3]=Math.min(n[3],d[n[2]-1].length),a=p(n,r,s)))),!a)throw new Error(`Unable to map snaps${o?" output":""} ranges`);if(l=l||o&&!isFinite(a[3]),a[3]=Math.min(a[3],d[a[2]-1].length),!(a=u(a,0,1,r)))throw new Error(`Unable to map snap${o?" output":""} range start`);if(!(a=u(a,2,3,s,1)))throw new Error(`Unable to map snap${o?" output":""} range end`);if(a[0]>a[2])throw new Error(`Unable to map snap${o?" output":""} range lines correctly`);if(a[0]===a[2]){if(a[1]>a[3]||!o&&a[1]===a[3])throw new Error(`Unable to map snap${o?" output":""} range columns correctly`);if(a[1]===a[3]||l){t=i?i.split("\n").length-1:e[2]-e[0],n=a[0]+t,i=d[n-1].lastIndexOf(s)+1;if(0===i)throw new Error("Unable to map snap output range end correctly");a[2]=n,a[3]=i}if(a[0]===a[2]){e=a[3]-a[1];if((!o&&e<4||o&&e<2)&&(--a[1],!(a=u(a,0,1,r))))throw new Error(`Unable to map snap${o?" output":""} range start`)}}return a};return e.map(e=>{var t=e.body.range,r=e.body.fallbackRange;return e.body.range=s(t,r,"{","}"),e.output&&(t=e.output.range,e.output.range=s(t,e.body.range,"`","`",e.output.content,e.output.lines),delete e.output.content,delete e.output.lines),e}).filter(e=>e.body.range)},textLines:function(e,t,r,s){return(e=_.isUndefined(t)||t===e.length-1?e:e.substr(0,t)).split(_.isUndefined(r)?/\r\n|\r|\n/:r,s)},instrumentableRange:function(e,r){let[s,i,n,o]=r;if(500<n-s)return r;if(!(n<s||n===s&&o<i)){var a=e.value;if(s===n&&i===o&&0<s&&0<=i&&s<=a.length&&i<a[s-1].length+1)return r;s<1&&(s=1),n>a.length&&(n=a.length),i<0&&(i=0);let t=!1;for(let e=s;e<=n;e++){var l=a[e-1],c=(s=e)===n&&o<=l.length?o:l.length;for(let e=i;e<=c;e++)if(i=e,l.charAt(e).trim().length){t=!0;break}if(t)break;i=0}if(t){for(let e=n;e>=s;e--){var u=a[e-1],p=(n!==e&&(n=e,o=u.length),e===s&&0<=s?i:0);let t=!1;for(let e=o;e>=p;e--){if(u.charAt(e).trim().length){t=!0;break}o=e}if(t)break}return[s,i,n,o]}}},instrumentableLogpointRange(e,t){var[r,s,i,n]=t;if(r===i){i=e.value[r-1];if(void 0===i||""===i.trim())return;if(s===n)return n=i.trimEnd().length-1,0===s||n<=s?[r,1+n,r,1+n]:i[s].trim().length?[r,s,r,s]:(n=i.substring(0,s).trimEnd().length)?[r,n-1,r,n-1]:[r,n=i.length-i.substring(s).trimStart().length,r,n]}return this.instrumentableRange(e,t)},verifyLocalOrigin:function(e,t){if(!e)return!0;var r=!1;try{var s=h("url").parse(e).hostname,r="localhost"===s||"0.0.0.0"===s||"127.0.0.1"===s||"::1"===s}catch(e){}return r||t||console.error("wallaby.js refused to accept connection from "+e),r},patchModule:function(t,r){var e=h("module").Module.prototype,s=e.require;e.require=function(e){return e===t?r(s.bind(this)):s.call(this,e)}},patchModulesCode:function(e,i){const n={},t=(e.forEach(t=>{t.files.forEach(e=>{n[e]=(n[e]||[]).concat(t.replacements)})}),"node_modules/"),o=a.readFileSync;a.readFileSync=function(r){let s=o.apply(this,arguments);var e=(e=r)?(e=(e="string"!=typeof e?"file://"===e.protocol?e.pathname||"":e.toString():e).replace(/\\/g,"/")).substr(e.lastIndexOf(t)+t.length):"",e=n[e];return e&&(s=s.toString(),e.forEach(e=>{var t=s;s=s.split(e.from).join(e.to),e.optional||s!==t||console.warn(i+` (${r})`)})),s}},requireModuleFrom:function(t,r){try{return h(g.join(t,"node_modules",r))}catch(e){var s=h("module"),i=new s(".",null);return i.filename=g.join(t,"wallaby.js"),i.paths=s._nodeModulePaths(t),s._load(r,i,!1)}},resolveModulePathFrom:function(e,t){var r=h("module"),s=new r(".",null);return s.filename=g.join(e,"wallaby.js"),s.paths=r._nodeModulePaths(e),r._resolveFilename(t,s,!1)},tryRequireModuleWithPathFrom:function(t,r,s){try{var i=h("module"),n=new i(".",null),o=(n.filename=g.join(t,"wallaby.js"),n.paths=i._nodeModulePaths(t),i._resolveFilename(r,n,!1));let e;return{module:(e=process.env.WALLABY_INTEGRATION_TEST_RUN||process.env.WALLABY_UNIT_TEST_RUN?h(o):i._load(r,n,!1))&&e.default||e,moduleExports:e,path:o}}catch(e){if(s)throw e}},nodeModulesLookup:function(r,t){var e=h("module").Module,s=e.prototype,i=e._nodeModulePaths,n=s.require;e._nodeModulePaths=function(e){var t=i.call(this,e);return r(t,e,i,this),t},t&&(s.require=function(e){return n.call(this,t(e))})},nodeModulePaths:function(e){return h("module")._nodeModulePaths(e)},patchBabelResolve:function(e){const s=this.nodeModulePaths(e);this.patchModule("resolve",e=>{e=e("resolve");const r=e.sync;return e.sync=function(e,t){return~e.indexOf("babel")&&t&&(t.paths=(t.paths||[]).concat(s)),r.apply(this,arguments)},e})},hasAnsi:function(e){return e&&"string"==typeof e&&e.match(c)},removeAnsi:function(e){return e&&"string"==typeof e?e.replace(c,""):e},copyToClipboard:function(e){var t=e=>e&&console.warn("May have failed to copy to clipboard. "+("linux"===process.platform?'Linux/Ubuntu environments require "xclip" to be installed. ':"")+(e&&e.message));try{h("copy-paste").copy(e,t)}catch(e){t(e)}},testFileSelection:function(e,t,r,s){if(_.isString(t)){const c=t;t={test:e=>!!~e.indexOf(c)}}if(_.isString(r)){const u=r;r={test:e=>!!~e.indexOf(u)}}let i=!1,n=!1,o;var a={};for(p.lastIndex=0;null!==(o=p.exec(e));){var l=o.index+o[0].length;for(let e=o.index;e<l;e++)a[e]=1;i=i||t.test(o[0]),n=n||r.test(o[0])}if(!i&&s)for(d.lastIndex=0;null!==(o=d.exec(e));)if(!a[o.index]){i=!0;break}return{includedTestFile:i,excludedTestFile:n}},codeFrame:function(e,t,r,o){e=this.textLines(e),r={start:{column:r,line:t}};const{start:a,end:s,markerLines:l}=function(e,t,r){var s=Object.assign({column:0,line:-1},e.start),e=Object.assign(Object.assign({},s),e.end),{linesAbove:r=2,linesBelow:i=3}=r||{},n=s.line,o=s.column,s=e.line,a=e.column;let l=Math.max(n-(r+1),0),c=Math.min(t.length,s+i);-1===n&&(l=0),-1===s&&(c=t.length);var u=s-n,p={};if(u)for(let e=0;e<=u;e++){var d,h=e+n;o?0===e?(d=t[h-1].length,p[h]=[o,d-o]):e===u?p[h]=[0,a]:(d=t[h-e].length,p[h]=[0,d]):p[h]=!0}else p[n]=o===a?!o||[o,0]:[o,a-o];return{start:l,end:c,markerLines:p}}(r,e);t=r.start&&"number"==typeof r.start.column;const c=String(s).length;let i=e.slice(a,s).map((t,r)=>{var s,r=a+1+r,i=` ${(" "+r).slice(-c)} | `,n=l[r],r=!l[r+1];if(n){let e="";return Array.isArray(n)&&(s=t.slice(0,Math.max(n[0]-1,0)).replace(/[^\t]/g," "),n=n[1]||1,e=["\n ",i.replace(/\d/g," "),s,"^".repeat(n)].join(""),r)&&o&&(e+=" "+o),[">",i,t,e].join("")}return" "+i+t}).join("\n");return i=t?i:""+" ".repeat(c+1)+o+`
`+i},loadJest:async function(t,e,r){let s,i=!1;try{var n=h(g.resolve(t,"package.json")),o=n&&n.scripts,a=n&&n.devDependencies||{},l=n&&n.dependencies||{};i=!!a.jest||!!l["react-scripts"]||!!l.jest,o&&o.test&&-1!==o.test.indexOf("react-app-rewired")?(this.tryRequireModuleWithPathFrom(t,"react-app-rewired/scripts/test"),this.tryRequireModuleWithPathFrom(t,"react-scripts/config/env"),s=this.tryRequireModuleWithPathFrom(t,"react-scripts/scripts/utils/createJestConfig")):!(o&&o.test&&-1!==o.test.indexOf("react-scripts")||!a)&&a.jest||o&&o.test&&-1!==o.test.indexOf("jest")&&-1===o.test.indexOf("react-scripts")||(s=this.tryRequireModuleWithPathFrom(t,"react-scripts/scripts/utils/createJestConfig"),this.tryRequireModuleWithPathFrom(t,"react-scripts/config/env"))}catch(e){s=void 0}let c,u;e=e&&(g.isAbsolute(e)?e:g.resolve(g.join(t,e)));n=(c=e?this.tryRequireModuleWithPathFrom(e,"jest"):s?this.tryRequireModuleWithPathFrom(s.path,"jest"):this.tryRequireModuleWithPathFrom(t,"jest"))?c.path:t;let p;const d=this.tryRequireModuleWithPathFrom(n,"jest-cli");if(!d)throw new Error(`Module jest-cli is not found in '${t}'.`);l=d.module.getVersion?()=>d.module.getVersion():c&&c.module.getVersion?()=>c.module.getVersion():void 0;if(!l)throw new Error("Cannot find compatible jest-cli module.");{let e="x.x.x",t=0;try{e=l(),t=parseInt(e.split(".")[0])}catch(e){throw new Error(`Cannot detect/parse jest-cli module version: ${e.message}.`)}if(t<24)throw new Error(`Only Jest v24.x or higher is supported, but found v${e} at '${d.path}'.`)}if(u=this.tryRequireModuleWithPathFrom(d.path,"jest-config"))try{r=r&&(g.isAbsolute(r)?r:g.resolve(g.join(t,r))),(p=await u.module.readConfigs(r?{config:r}:s?{config:JSON.stringify(s.module(e=>g.resolve(s.path,"../../..",e)))}:{},[t])).globalConfig=Object.assign({},p.globalConfig),p.configs=(p.configs||[]).filter(e=>"jest-runner"===e.runner||~this.normalizePath(e.runner||"").indexOf("node_modules/jest-runner/")||"jest-runner-groups"===e.runner||~this.normalizePath(e.runner||"").indexOf("node_modules/jest-runner-groups/")).map(e=>Object.assign({},e))}catch(e){throw new Error(`Failed to read Jest configuration from '${t}': `+(e.stack||"unknown."))}if(!p)throw new Error(`Failed to read Jest configuration from '${t}'.`);if(p.configs.length)return{jestConfig:p,jestCLI:d,jestConfigLoader:u,isDirectDependency:i};throw new Error(`Can not find any Jest runner configurations in '${t}'.`)},serializeRegExp:function(e){if(_.isRegExp(e))return"__REGEXP "+e.toString();if(_.isString(e))return e;throw new Error("Must pass a string or a regular expression")},deserializeRegExp:function(e){var t;return 0===e.indexOf("__REGEXP ")?(t=e.split("__REGEXP ")[1].match(/\/(.*)\/(.*)?/),new RegExp(t[1],t[2]||"")):e},generateNodeModulesExcludesForIncludePatterns:function(e){e=e.map(e=>e.split("/")).filter(e=>"node_modules"===e[0]).reduce((e,t)=>{let r=e;for(let e=0;e<t.length;e++)r.has(t[e])||r.set(t[e],new Map),r=r.get(t[e]);return e},new Map);if(0===e.size)return["node_modules/**"];const s=(t,r)=>{var e=Array.from(t.keys());return 0===e.length?[]:[`${r}/!(${e.join("|")})/**`,...e.map(e=>s(t.get(e),r+"/"+e)).reduce((e,t)=>e.concat(t),[])]};return s(e.get("node_modules"),"node_modules")},isJavaScript:b,isTypeScript:w,isVue:k,isSvelte:x,isCoffeeScript:S,isCoverable:(e,t,r)=>!!(b(e,r)||w(e)||k(e)||S(e,t)||x(e)),quickHash:function(e){var t,r,s=0;if(0<e.length)for(t=0,r=e.length;t<r;t++)s=(s<<5)-s+e.charCodeAt(t),s|=0;return s},isDocker:y,isWsl:()=>{var e=h("os");if("linux"!==process.platform)return!1;if(e.release().toLowerCase().includes("microsoft"))return!y();try{return!!a.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")&&!y()}catch(e){return!1}},wslHostIpAddress:()=>{var e=a.readFileSync("/etc/resolv.conf").toString().split("\n").map(e=>e.split(" ")).filter(e=>"nameserver"===e[0]).map(e=>1<e.length&&e[1]);return 1<=e.length?e[0]:"127.0.0.1"},lazyLoadDependencyReplacement:(e,t,{doubleQuotes:r,dependencyOverride:s,replaceBothDependencyAndDependencyOverride:i,varType:n}={})=>{r=r?`require("${t}")`:`require('${t}')`,t=s||r,s=[{from:""+e,to:e+"()",optional:!0},{from:(n=n||"var")+` ${e}() = ${t};`,to:`var ${e} = function() { const data = ${t}; ${e} = function() { return data; }; return data; }`,optional:!0}];return i&&s.push({from:n+` ${e}() = ${r};`,to:`var ${e} = function() { const data = ${r}; ${e} = function() { return data; }; return data; }`,optional:!0}),s},findFirstFileMatchingContentInDirectory(e,n){return a.existsSync(e)?r(function e(t){for(const i of a.readdirSync(t)){var r=g.resolve(g.join(t,i));if(a.statSync(r).isDirectory()){var s=e(r);if(s)return s}else if((i.endsWith(".js")||i.endsWith(".mjs"))&&-1!==a.readFileSync(r,"utf8").indexOf(n))return r}}(e)):""}}},{"./extension/shared/utils":44,"copy-paste":void 0,fs:void 0,micromatch:void 0,module:void 0,os:void 0,path:void 0,"source-map":void 0,url:void 0}],76:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("path"),o=e("fs");r.default=function(r,e=3){if(!r.length)return"";for(let t=0;t<e;t++){var s=[];s.push(r[0]);for(let e=0;e<t;e++)s.push("..");for(let e=1;e<r.length;e++)s.push(r[e]);var i=(0,n.join)(...s);if((0,o.existsSync)(i))return i}return(0,n.join)(...r)}},{fs:void 0,path:void 0}],77:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),e("../../lib/global");const _=e("../../lib/utils");r.default=function(e,i,r){if(e){if(e.isCoverageIgnored)return{isCoverageIgnored:!0};var s={},n={},o=_.default.textLines(i,void 0,"\n");let t=0;for(let e=0;e<o.length;e++){var a=o[e].length;n[e+1]={index:t,length:a},t+=a+1}if(e.liveComments){var l=[];for(const f of e.liveComments){let t=_.default.mapTextPosition(f.position,r),s=!1;if(null===t.line&&f.position){let e=f.position.column;for(;0<e;)if(e--,null!==(t=_.default.mapTextPosition({line:f.position.line,column:e},r)).line){s=!0;break}}var c=n[t.line];if(c){const r=t.column>c.length-1?c.index+c.length-1:c.index+t.column;if(!s||t.column>c.length-1)l.push({index:r,exp:f.exp});else{var u=/[\s;]/,p=c.index+c.length-1;let t=!1;for(let e=r;e<p;e++)if(u.test(i[e])){l.push({index:e,exp:f.exp}),t=!0;break}t||l.push({index:p,exp:f.exp})}}}s.liveComments=l.length?l:void 0}if(e.ignoreComments){var d=[];for(const m of e.ignoreComments){var h=_.default.mapTextPosition(m.position,r),g=n[h.line];if(g){const e=h.column>g.length-1?g.length-1:g.index+h.column;d.push({index:e})}}s.ignoreComments=d.length?d:void 0}return s}}},{"../../lib/global":46,"../../lib/utils":75}],78:[function(e,t,r){t.exports={name:"wallaby-core",version:"1.0.1523",author:"Wallaby.js",license:"Proprietary",homepage:"https://wallabyjs.com",scripts:{postinstall:"node ./node_modules/grunt/bin/grunt patchNodeModules",test:"npm run test:unit","test:unit":"jest --no-cache --config=jest.unit.config.js --forceExit --detectOpenHandles","test:integration:bootstrap":"cd ./test/samples/integration && node install","test:integration:reset":"cd ./test/samples/integration && node clean && node install","test:integration:isolated":"node ./test/samples/integration/test",build:"npm run eslint && node ./node_modules/grunt/bin/grunt bump-only && node ./node_modules/grunt/bin/grunt",release:"node ./docker/run.js","pre-release":"node ./docker/run.js --pre-release",eslint:"eslint .","ts-check":"node ./node_modules/grunt/bin/grunt ts"},dependencies:{"@babel/parser":"7.21.3","@babel/register":"7.10.3","@swc/helpers":"0.5.3","@swc/wasm":"1.3.105",acorn:"8.7.0","acorn-jsx":"5.3.1","acorn-walk":"8.0.2",arg:"4.1.3",bufferutil:"4.0.1",chokidar:"3.5.2","chrome-launcher":"0.15.2","chrome-remote-interface":"0.32.1","coffee-script":"1.10.0",commander:"2.5.0",compression:"1.7.2","copy-paste":"1.3.0",debug:"4.1.1","escodegen-wallaby":"1.6.42","esm-wallaby":"3.2.29",express:"4.17.1","fs-extra":"6.0.1","graceful-fs":"4.2.4",lodash:"3.0.0","lru-cache":"2.5.0",micromatch:"4.0.5",open:"8.0.7",phantom:"0.7.2",q:"1.5.0","regenerator-runtime":"0.14.0",resolve:"1.22.1",semver:"4.3.3","source-map":"0.4.3","style-loader":"3.3.1","ts-node":"10.9.2","tsconfig-paths":"4.2.0",typescript:"5.3.2","underscore.string":"2.3.3","utf-8-validate":"5.0.2","util.promisify":"1.0.0",uuid:"7.0.3","vite-node":"1.2.0","write-file-atomic":"4.0.1",ws:"1.1.5"},devDependencies:{"@babel/core":"^7.10.4","@babel/generator":"^7.6.4","@babel/preset-env":"^7.12.11","@swc/core":"^1.3.100","@swc/jest":"^0.2.29","@types/chokidar":"^2.1.3","@types/chrome-remote-interface":"^0.31.14","@types/compression":"^1.7.5","@types/express":"^4.17.21","@types/lodash":"^4.14.136","@types/micromatch":"^4.0.6","@types/node":"12.0.10","@types/semver":"^6.0.1","@types/uuid":"^9.0.7","@types/ws":"^7.4.7","adm-zip":"^0.5.5","aws-sdk":"2.333.0","browserify-transform-tools":"1.7.0",chai:"4.2.0","chai-subset":"1.6.0",esbuild:"0.18.14",escodegen:"1.6.1",eslint:"^8.45.0","expect.js":"0.3.1",grunt:"1.0.3","grunt-browserify":"6.0.0","grunt-bump":"0.0.16","grunt-contrib-clean":"0.7.0","grunt-contrib-compress":"2.0.0","grunt-contrib-copy":"0.8.2","grunt-contrib-uglify":"5.2.2","grunt-run":"^0.8.1","grunt-terser":"^2.0.0","grunt-ts":"^6.0.0-beta.22","javascript-obfuscator":"4.0.0",jest:"29.7.0","line-column":"^1.0.2","node-fetch":"^2.6.0",removeNPMAbsolutePaths:"1.0.4",terser:"^5.15.1"},optionalDependencies:{keytar:"^7.9.0"},private:!0}},{}],79:[function(s,$,A){const i=s("fs");var n,o=s("path");try{Error.stackTraceLimit=80}catch(e){}function a(t){try{let e=process.cwd();for(;e;){var r=o.join(e,t);if(i.existsSync(r))return r;var s=o.dirname(e);if(s===e)break;e=s}return null}catch(e){return null}}process.env&&process.env.NODE_MODULES_OVERRIDE&&(console.warn(" ---- Using node modules from: "+process.env.NODE_MODULES_OVERRIDE+" ---- "),s("./lib/utils").default.nodeModulesLookup(function(e){e.unshift(process.env.NODE_MODULES_OVERRIDE)})),function e(t){var r=o.join(t,"node_modules",".pnpm","node_modules"),r=(i.existsSync(r)&&(process.env.NODE_PATH?-1===process.env.NODE_PATH.indexOf(r)&&(process.env.NODE_PATH+=("win32"===process.platform?";":":")+r):process.env.NODE_PATH=r),o.dirname(t));r!==t&&e(r)}(process.cwd()),process.env&&(process.env.WALLABY_ENTRY=!0);var l,c,u,r,e=process.argv[2];if("worker"===e)process.noDeprecation=!0,s("./lib/global"),process.on("message",function(e){if(e&&"exit"===e.type)process.exit(0);else if("instrumentor"===e.type){var t=s("./lib/instrumentor").default;try{var r=t(e.content,e.opts);process.send(r)}catch(e){process.send({error:{message:e&&e.message,stack:e&&e.stack}})}}else if("preprocessor"===e.type||"compiler"===e.type){t=s("./lib/processor");try{t(e).catch(function(e){process.send({error:{message:e&&e.message,stack:e&&e.stack}})}).then(function(e){e&&process.send(e)})}catch(e){process.send({error:{message:e&&e.message,stack:e&&e.stack}})}}}),process.send("READY");else if("runner"===e)process.env.WALLABY_ENV=!0,(n=process.argv[7])&&!process.env.quokka&&(l=s("fs"),c=process.cwd(),u=o.dirname(n),r=o.join(c,"node_modules"),c!==u)&&s("./lib/utils").default.nodeModulesLookup(function(e,t,r,s){var i=!1;e&&e[0]&&0===e[0].indexOf(c)&&(i=!0,Array.prototype.splice.apply(e,[0,e.length].concat(function(e,t){for(var r=[],s=0;s<t.length;s++)r.push(t[s]),e[s]&&r.push(e[s]);for(;s<e.length;s++)r.push(e[s]);return r}(r.call(s,t.replace(c,u)),e)))),i||e.push(n)},function(e){var t=e.replace(r,n);return t===e||l.existsSync(t)?t:e}),s("./lib/nodeTestWorker")(process.argv[3],process.argv[4],process.argv[5],process.argv[6],n,process.argv[8],process.argv[9],process.argv[10],process.argv[11]);else if("extractor"===e){if(!process.versions||!process.versions.pnp){e=["cjs","js"];const i=s("fs");e.reduce((e,t)=>{if(e)return e;e=a(".pnp."+t);if(e)try{return s(e).setup(),!0}catch(e){}return!1},!1)}if("vitest"===process.argv[3]){var e=s("./lib/configurators/vitest/extract").extract,{moduleFolderPath:t,moduleVersion:p,hooksFileUrl:d,configFile:h}=JSON.parse(process.argv[process.argv.length-1]);function g(r,s,i){let n=0;!function e(){var t;n<s.length?(t=s.slice(n,n+4096),r.write(t)?(n+=4096,setImmediate(e)):r.once("drain",e)):i()}()}e(t,p,d,h).then(e=>{g(process.stdout,e,()=>process.exit(0))}).catch(e=>{g(process.stderr,e.message,()=>process.exit(1))})}}else{process.versions&&process.versions.pnp||["cjs","js"].reduce((e,t)=>{if(e)return e;e=a(".pnp."+t);if(e)try{s(e).setup(),process.env.WALLABY_PNP="--require "+e;const r=o.join(o.dirname(e),".pnp.loader");return["mjs","js"].reduce((e,t)=>{if(e)return e;i.existsSync(r+"."+t)&&(process.env.WALLABY_PNP_ESM="--experimental-loader "+r+"."+t)},!1),!0}catch(e){}return!1},!1),process.env.PWD=process.cwd(),process.env.DEBUG="wallaby:.*",process.env.DEBUG_COLORS="no",i.existsSync(o.join(process.cwd(),"node_modules",".bin"))&&(process.env.PATH=o.join(process.cwd(),"node_modules",".bin")+(process.env.PATH?o.delimiter+process.env.PATH:"")),process.noDeprecation=!0,l=s("graceful-fs");var f,m,v,y,b,w,k,x,S,P,F,C,T,j,E,R,I,e=s("./lib/app"),t=s("commander"),O=!1,L=(t.unknownOption=function(){},t.option("-p, --port <port>","specify port").option("-l, --projectCachePath <projectCachePath>","specify project cache location").option("-l, --configPath <configPath>","specify config file location").option("-l, --testsPath <testsPath>","specify tests location",(e,t)=>void 0===t?[e]:t.concat([e]),void 0).option("-l, --smartStart <smartStart>","specify wallaby start start").option("-k, --lkp [lkp]","specify lkp location").option("-c, --client [client]","specify client").option("-q, --quokka [quokka]","specify quokka").option("-q, --editorTypeScript [editorTypeScript]","specify editorTypeScript").option("-q, --homeDir <homeDir>","specify homeDir").option("-q, --cv <cv>","specify cv").option("-q, --ol <true|false>","specify ol").option("-q, --te <te>","specify te").option("-q, --fid <te>","specify fid").option("-q, --snapsOnlyMode <te>","specify mode").option("-q, --snapsAutoRun <te>","specify auto run").option("-q, --waitForInitialRunSignal","waitForInitialRunSignal flag").parse(process.argv),{port:47878,location:o.join(__dirname,"lib","project")});if(t.port&&(L.port=t.port),t.smartStart&&(L.testsPath=[]),t.projectCachePath&&!t.quokka)if(t.projectCachePath&&t.projectCachePath.endsWith("-wsl")&&l.existsSync("/run/WSL")&&(p=o.basename(t.projectCachePath),d=o.join(s("os").homedir(),".wallaby"),t.projectCachePath=o.join(d,"projects",p.substr(0,p.length-4)),l.existsSync(d)||l.mkdirSync(d)),L.projectCachePath=t.projectCachePath,"true"!==t.ol){l.existsSync(L.projectCachePath)||(L.projectCachePath?(h=o.dirname(L.projectCachePath),l.existsSync(h)||(h?l.mkdirSync(h):console.error("No project cache parent directory: "+JSON.stringify(Object.assign(Object.assign({},t),{options:void 0})))),l.mkdirSync(L.projectCachePath)):console.error("No project cache directory: "+JSON.stringify(Object.assign(Object.assign({},t),{options:void 0}))));try{L.projectCachePath=l.realpathSync(t.projectCachePath)}catch(e){}}if(t.configPath){L.configPath=t.configPath,"win32"===process.platform&&(L.configPath=L.configPath.split(o.sep).reduce((e,t)=>{var r;return e?(r=l.readdirSync(e+o.sep),e+o.sep+(r.find(e=>e===t)||r.find(e=>e.toLowerCase()===t.toLowerCase())||t)):t.toUpperCase()},""));p=o.dirname(L.configPath);if(p!==process.cwd())try{process.chdir(o.dirname(p)),process.chdir(p)}catch(e){try{process.chdir(p)}catch(e){throw new Error("Wallaby.js working directory could not be initialized.")}}}if(void 0!==t.testsPath&&(L.testsPath=t.testsPath),"win32"===process.platform&&(L.projectCachePath&&":"===L.projectCachePath[1]&&(L.projectCachePath=L.projectCachePath.charAt(0).toUpperCase()+L.projectCachePath.slice(1)),L.configPath)&&":"===L.configPath[1]&&(L.configPath=L.configPath.charAt(0).toUpperCase()+L.configPath.slice(1)),L.projectCachePath&&!process.env.quokka&&"true"!==t.ol){var N=L.projectCachePath;let e=1;for(;;){var M=o.join(L.projectCachePath,"running"),D={pid:process.pid,date:Date.now()};if(!l.existsSync(L.projectCachePath)){l.mkdirSync(L.projectCachePath),l.writeFileSync(M,JSON.stringify(D));break}if(!l.existsSync(M)){l.writeFileSync(M,JSON.stringify(D));break}{let t=!1;try{var q=JSON.parse(l.readFileSync(M));t=process.kill(q.pid,0)}catch(e){t="EPERM"===e.code}if(!t){l.writeFileSync(M,JSON.stringify(D));break}L.projectCachePath=o.join(o.dirname(N),o.basename(N)+"_"+e),e++}}}t.editorTypeScript&&(L.editorTypeScript=t.editorTypeScript),t.homeDir&&(L.homeDir=t.homeDir),t.cv&&(L.cv=t.cv),t.ol&&(L.ol=t.ol),t.te&&(L.te=parseInt(t.te,10),0<=L.te||delete L.te),t.fid&&(L.fileId=t.fid),L.waitForInitialRunSignal=!!t.waitForInitialRunSignal,(O=t.quokka)&&(L.snapsOnlyMode=!!t.snapsOnlyMode,L.snapsAutoRun=!!t.snapsAutoRun,process.env.quokka=!0),s("./lib/serverUtils").initServerOptions(L),L.intervalAction=!0,O&&(f={},m={},v={},y=function(e){return m[e]||v[o.dirname(e)]||!(!e||!~e.indexOf("quokka_fake_path")&&!~e.indexOf(o.join(process.cwd(),O.substr(0,O.lastIndexOf(".")))))},L.fileStructureCachePromise=function(e){return L.readFilePromise(e).then(function(e){return Q.when(JSON.parse(e))})},b=L.fileStatPromise,L.fileStatPromise=function(e){var t;return y(e)?(t=f[e])?Q.when({size:t.content?t.content.length:0}):Q.reject(new Error("File "+e+" not found")):b(e)},w=L.readFilePromise,L.readFilePromise=function(e){var t;return y(e)?(t=f[e])?Q.when(t.content):Q.reject(new Error("File "+e+" not found")):w(e)},k=L.writeFilePromise,L.writeFilePromise=function(e,t){return y(e)?(f[e]={content:t},Q.when(!0)):k(e,t)},x=L.unlinkFilePromise,L.unlinkFilePromise=function(e){return y(e)?(delete f[e],Q.when(!0)):x(e)},S=L.unlinkFileSync,L.unlinkFileSync=function(e){if(!y(e))return S(e);delete f[e]},P=L.writeFileSync,L.writeFileSync=function(e,t){if(!y(e))return P(e,t);f[e]={content:t}},F=L.readFileSync,L.readFileSync=function(e){if(y(e)){var t=f[e];if(t)return t.content;throw new Error("File "+e+" not found")}return F(e)},C=L.fileExistsSync,L.fileExistsSync=function(e){return y(e)?!!f[e]:C(e)},T=L.realpathSync,L.realpathSync=function(e){return y(e)?e:T(e)},j=L.dirRemovePromise,L.dirRemovePromise=function(e){return y(e)?Q.when(e):j(e)},E=L.dirRemoveSync,L.dirRemoveSync=function(e){return y(e)?e:E(e)},R=L.dirEnsurePromise,L.dirEnsurePromise=function(e){return y(e)?Q.when(e):R(e)},I=L.dirEnsureSync,L.dirEnsureSync=function(e){return y(e)?e:I(e)},L.useMemoryFs=function(e,t){t&&(v[o.dirname(e)]=!0),m[e]=!0;for(var r=e;r!==o.dirname(r);)r=o.dirname(r),m[r]=!0}),L.onStart=_.noop,L.onConnected=_.noop;d=s("ws/lib/Sender.fallbacks.js");L._init=d.create,L.coreVersion=s("./package.json").version,"extended-core"===process.argv[2]||"extended-core-ws"===process.argv[2]||O?"extended-core"!==process.argv[2]?(L.quokka=O,L.client=t.client||"Sublime",L.lkp=t.lkp,L.Receiver=d.create(),new(s("ws").Server)({port:L.port,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}},function(){console.log(L.quokka?"quokka.js started":"wallaby.js started")}).on("connection",function(t){var r={send:function(e){t.send(JSON.stringify(e))},receive:_.noop};L.onConnected(r),t.on("message",function(e){e=JSON.parse(e);"stop"===e.type?process.exit():r.receive(e)}),r.send({type:"started",version:s("./package.json").version})})):(L.client=t.client||"Atom",L.lkp=t.lkp,s("util"),L.Receiver=d.create(),process.nextTick(function(){var t={send:function(e){process.send(e)},receive:_.noop};process.on("message",function(e){"connection"===e.type?L.onConnected(t):"stop"===e.type?process.exit():t.receive(e)}),t.send({type:"started",version:L.coreVersion})})):(L.Receiver=s("./lib/project").Project,new(s("ws").Server)({port:L.port,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}},function(){console.log("wallaby.js started"),console.log("core v"+L.coreVersion)}).on("connection",function(t){var r={send:function(e){t.send(JSON.stringify(e))},receive:_.noop};L.onConnected(r),t.on("message",function(e){r.receive(JSON.parse(e))})})),e.start(L)}},{"./lib/app":8,"./lib/configurators/vitest/extract":41,"./lib/global":46,"./lib/instrumentor":47,"./lib/nodeTestWorker":50,"./lib/processor":64,"./lib/project":65,"./lib/serverUtils":67,"./lib/utils":75,"./package.json":78,commander:void 0,fs:void 0,"graceful-fs":void 0,os:void 0,path:void 0,"ts-node":void 0,util:void 0,ws:void 0,"ws/lib/Sender.fallbacks.js":void 0}]},{},[79]);